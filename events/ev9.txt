namespace = magic_ev9
#cult management...
magic_ev9.1 = {
	hidden = yes
	scope = none
	
	immediate = {
		every_ruler = {
			limit = {
				is_landless_adventurer = yes
				government_has_flag = government_is_landless_adventurer
				has_realm_law = camp_purpose_seekers
			}
			if = {
				limit = {
					domicile ?= { has_domicile_parameter = camp_unlocks_witch_convertion }
				}
				trigger_event = {
					id = magic_ev9.1001
					days = { 1 360 }
				}
			}
			
			consider_cult_events_effect = yes
			consider_magic_rumors_events_effect = yes
		}
	}
}
#convertion
magic_ev9.1001 = {
	hidden = yes
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		domicile ?= { has_domicile_parameter = camp_unlocks_witch_convertion }
	}
	immediate = {
		save_temporary_scope_as = leader
			if = {
				limit = {
					is_witch_trigger = yes
				}
				random_courtier = {
					limit = {
						is_witch_trigger = no
						age > 6
					}
					save_temporary_scope_as = neowitch
				}
				if = {
					limit = {
						exists = scope:neowitch
					}
					send_interface_message = {
						type = event_toast_effect_neutral
						title = cult_caravan_convertion_domicile_building
						desc = cult_caravan_convertion_domicile_building
						left_icon = scope:leader
						right_icon = scope:neowitch
						scope:neowitch = {
							give_witch_secret_or_trait_effect2 = yes
						}
					}
					scope:neowitch = {
						random_secret = {
							limit = { secret_type = secret_witch }
							reveal_to = scope:leader
						}
					}
				}
			}
			else = {
				give_witch_secret_or_trait_effect2 = yes
			}
	}
}

#spread the cult #1
magic_ev9.2 = {
	title = spread_the_cult_decision_title
	desc = ev9.2.desc
	theme = realm
	left_portrait = {
		character = root
		animation = spymaster
	}
	lower_left_portrait = scope:cpriest
	lower_right_portrait = scope:lruler
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					employs_court_position = cult_priest_camp_officer
				}
				court_position:cult_priest_camp_officer = {
					save_scope_as = cpriest
				}
			}
			location = {
				province_owner = {
					save_scope_as = lruler
				}
			}
		}
	}
	option = {
		name = ev9.2.0.a
		custom_tooltip = witch_dark_cult_custom_tooltip
		stress_impact = {
			heresiarch = minor_stress_loss
			zealous = major_stress_loss
			humble = medium_stress_gain
			brave = minor_stress_gain
			true_witch = medium_stress_loss
			honest = medium_stress_loss
		}
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = cultist
			value = 20
		}
		scope:lruler = {
			add_opinion = {
				target = ROOT
				modifier = impious_opinion
				opinion = -80
			}
		}
		location = {
			add_province_modifier = {
				modifier = witch_dark_cult_modifier
				years = 20
			}
		}
		hidden_effect = {
			domicile ?= {
				if = {
					limit = {
						NOT = {
							exists = var:my_cult_list
						}
					}
					set_variable = my_cult_list
				}
				if = {
					limit = {
						NOT = {
							is_target_in_variable_list = {
								name = my_cult_list
								target = root.location
							}
						}
					}
					add_to_variable_list = {
						name = my_cult_list
						target = root.location
						years = 20
					}
				}
			}
		}
	}
	option = {
		name = ev9.2.0.b
		trigger = {
			exists = scope:cpriest
		}
		stress_impact = {
			craven = minor_stress_loss
			deceitful = medium_stress_loss
			honest = medium_stress_gain
		}
		scope:cpriest = {
			if = {
				limit = {
					NOT = {
						has_trait = gallowsbait
					}
				}
				add_trait = gallowsbait
			}
			add_trait_xp = {
				trait = gallowsbait
				track = cultist
				value = 20
			}
		}
		scope:lruler = {
			add_opinion = {
				target = scope:cpriest
				modifier = impious_opinion
				opinion = -80
			}
		}
		location = {
			add_province_modifier = {
				modifier = witch_dark_cult_modifier
				years = 10
			}
		}
		hidden_effect = {
			domicile ?= {
				if = {
					limit = {
						NOT = {
							exists = var:my_cult_list
						}
					}
					set_variable = my_cult_list
				}
				if = {
					limit = {
						NOT = {
							is_target_in_variable_list = {
								name = my_cult_list
								target = root.location
							}
						}
					}
					add_to_variable_list = {
						name = my_cult_list
						target = root.location
						years = 10
					}
				}
			}
		}
	}
	option = {
		name = ev9.2.0.c
		stress_impact = {
			craven = medium_stress_loss
			brave = medium_stress_gain
			heresiarch = minor_stress_gain
			zealous = major_stress_gain
			patient = minor_stress_loss
			ambitious = minor_stress_gain
		}
	}
}
#spread the cult #2
magic_ev9.3 = {
	title = spread_the_cult_decision_title
	desc = ev9.3.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:lruler
	immediate = {
		hidden_effect = {
			location = {
				province_owner = {
					save_scope_as = lruler
				}
			}
		}
	}
	option = {
		name = ev9.3.0.a
		duel = {
			skill = diplomacy
			target = scope:lruler
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					add_contact = scope:lruler
					scope:lruler = {
						add_trait = witch
					}
				}
				scope:lruler = {
					add_opinion = {
						target = ROOT
						modifier = respect_opinion
						opinion = 80
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					if = {
						limit = {
							NOT = {
								has_trait = gallowsbait
							}
						}
						add_trait = gallowsbait
					}
					add_trait_xp = {
						trait = gallowsbait
						track = cultist
						value = 20
					}
					
				}
				scope:lruler = {
					add_opinion = {
						target = ROOT
						modifier = impious_opinion
						opinion = -80
					}
				}
			}
		}
	}
	option = {
		name = ev9.3.0.b
		stress_impact = {
			lazy = minor_stress_loss
			craven = minor_stress_loss
			heresiarch = minor_stress_gain
			zealous = minor_stress_gain
		}
	}
}

#spread the cult #3
magic_ev9.4 = {
	title = spread_the_cult_decision_title
	desc = ev9.4.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:cpriest
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					employs_court_position = cult_priest_camp_officer
				}
				court_position:cult_priest_camp_officer = {
					save_scope_as = cpriest
				}
			}
		}
		custom_tooltip = witch_dark_cult_custom_tooltip
		location = {
			add_province_modifier = {
				modifier = witch_dark_cult_modifier
				years = 10
			}
		}
		hidden_effect = {
			domicile ?= {
				if = {
					limit = {
						NOT = {
							exists = var:my_cult_list
						}
					}
					set_variable = my_cult_list
				}
				if = {
					limit = {
						NOT = {
							is_target_in_variable_list = {
								name = my_cult_list
								target = root.location
							}
						}
					}
					add_to_variable_list = {
						name = my_cult_list
						target = root.location
						years = 10
					}
				}
			}
		}
	}
	option = {
		name = ev9.4.0.a
		scope:cpriest = {
			if = {
				limit = {
					NOT = {
						has_trait = gallowsbait
					}
				}
				add_trait = gallowsbait
			}
			add_trait_xp = {
				trait = gallowsbait
				track = cultist
				value = 20
			}
			if = {
				limit = {
					NOT = {
						has_trait = heresiarch
					}
				}
				add_trait = heresiarch
			}
		}
	}
	option = {
		name = ev9.4.0.b
		trigger = {
			NOT = {
				has_trait = heresiarch
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = cultist
			value = 20
		}
		if = {
			limit = {
				NOT = {
					has_trait = heresiarch
				}
			}
			add_trait = heresiarch
		}
	}
}
#cults reward #1
magic_ev9.5 = {
	title = ev9.5.title
	desc = ev9.5.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = char_interaction.0231.a	#Good
		domicile ?= {
			change_provisions = {
				value = {
					value = root.location.gather_provisions_forage_base_value
					multiply = 1
				}
			}
		}
	}
}
#cults reward #2
magic_ev9.6 = {
	title = ev9.5.title
	desc = ev9.6.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = ev9.6.0.a
		domicile ?= {
			change_provisions = {
				value = {
					value = root.location.gather_provisions_forage_base_value
					multiply = 0.8
				}
			}
		}
	}
	option = {
		name = ev9.6.0.b
		add_gold = potion_gold_value
	}
	option = {
		name = ev9.6.0.c
		spawn_army = {
			name = cultists
			men_at_arms = {
				type = cultists
				stacks = 1
			}
			inheritable = no
			uses_supply = no
			location = root.location
		}
	}
}
#cults reward #3
magic_ev9.7 = {
	title = ev9.5.title
	desc = ev9.7.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:created_witch
		animation = beg
	}
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
			create_character = {
				employer = ROOT
				template = witchy_template
				random_traits = no
				save_scope_as = created_witch
				after_creation = {
					add_trait = loyal
				}
			}
		}
	}
	option = {
		name = ev9.7.0.a
		hidden_effect = {
			scope:created_witch = {
				move_to_pool = yes
				if = {
					limit = {
						is_witch_trigger = no
					}
					give_witch_secret_or_trait_effect2 = yes
				}
				random_secret = {
					limit = { secret_type = secret_witch }
					reveal_to = root
				}
			}
			random_secret = {
				limit = { secret_type = secret_witch }
				reveal_to = scope:created_witch
			}
		}
		add_courtier = scope:created_witch
	}
	option = {
		name = ev9.7.0.b
		scope:created_witch = {
			move_to_pool = yes
		}
		hidden_effect = {
			domicile = {
				remove_list_variable = {
					name = my_cult_list
					target = scope:cbranch
				}
			}
			scope:cbranch = {
				remove_province_modifier = witch_dark_cult_modifier
			}
			domicile ?= {
				add_to_variable_list = {
					name = my_cult_list
					target = root.location
					years = 10
				}
			}
		}
		custom_tooltip = ev9.7.0.b_ct
		scope:cbranch = {
			add_province_modifier = {
				modifier = witch_dark_cult_modifier
				years = 10
			}
		}
	}
}
#cults reward #4
magic_ev9.8 = {
	title = ev9.5.title
	desc = ev9.8.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = ev9.8.0.a
		add_stress = minor_stress_gain
		hidden_effect = {
			domicile = {
				remove_list_variable = {
					name = my_cult_list
					target = scope:cbranch
				}
			}
		}
		scope:cbranch = {
			
			remove_province_modifier = witch_dark_cult_modifier
		}
	}
}
#cults reward #5
magic_ev9.9 = {
	title = ev9.5.title
	desc = ev9.9.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = ev9.9.0.a
		add_intrigue_skill = 1
	}
	option = {
		name = ev9.9.0.b
		add_learning_skill = 1
	}
}
#cults reward #6
magic_ev9.10 = {
	title = ev9.5.title
	desc = ev9.10.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = ev9.10.0.a
		trigger = {
			has_trait = heresiarch
			NOT = {
				has_nickname = darkprophet_nickname
			}
		}
		give_nickname = darkprophet_nickname
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = cultist
			value = 20
		}
		add_prestige = medium_prestige_gain
		stress_impact = {
			zealous = medium_stress_loss
			humble = minor_stress_gain
			ambitious = medium_stress_loss
		}
	}
	option = {
		name = ev9.10.0.b
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = cultist
			value = 10
		}
		add_prestige = minor_prestige_gain
		stress_impact = {
			zealous = medium_stress_loss
			ambitious = medium_stress_loss
		}
	}
	option = {
		name = ev9.10.0.c
		stress_impact = {
			craven = minor_stress_loss
			paranoid = minor_stress_loss
		}
		hidden_effect = {
			scope:cbranch = {
				remove_province_modifier = witch_dark_cult_modifier
			}
			domicile ?= {
				remove_list_variable = {
					name = my_cult_list
					target = scope:cbranch
				}
				add_to_variable_list = {
					name = my_cult_list
					target = root.location
					years = 10
				}
			}
		}
		custom_tooltip = ev9.7.0.b_ct
		scope:cbranch = {
			add_province_modifier = {
				modifier = witch_dark_cult_modifier
				years = 10
			}
		}
	}
}
#cults reward #7
magic_ev9.11 = {
	title = ev9.5.title
	desc = ev9.11.desc
	theme = realm
	left_portrait = root
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
		has_realm_law = camp_purpose_seekers
		domicile ?= {
			any_in_list = {
				variable = my_cult_list
				count > 0
			}
		}
		
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			domicile ?= {
				random_in_list = {
					variable = my_cult_list
					save_scope_as = cbranch
				}
			}
		}
	}
	option = {
		name = ev9.11.0.a
		trigger = {
			has_nickname = darkprophet_nickname
		}
		add_internal_flag = special
		add_prestige = major_prestige_gain
		add_dread = medium_dread_gain
		stress_impact = {
			zealous = medium_stress_loss
			ambitious = medium_stress_loss
			callous = minor_stress_loss
		}
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = cultist
			value = 20
		}
	}
	option = {
		name = ev9.11.0.b
		add_prestige = minor_prestige_gain
		stress_impact = {
			zealous = minor_stress_loss
		}
	}
	option = {
		name = ev9.11.0.c
		domicile ?= {
			change_provisions = {
				value = {
					value = root.location.gather_provisions_forage_base_value
					multiply = 0.8
				}
			}
		}
		add_gold = potion_gold_value
		stress_impact = {
			greedy = medium_stress_loss
		}
	}
	option = {
		name = ev9.11.0.d
		stress_impact = {
			deceitful = minor_stress_loss
			arbitrary = minor_stress_loss
		}
		scope:cbranch = {
			county = {
				add_county_modifier = {
					modifier = high_investment_in_revolt_modifier
					years = 5
				}
			}
		}
	}
}
#witch contract #1 - local witch
magic_ev9.12 = {
	title = laamp_magic_1001_contract
	desc = ev9.12.desc
	theme = intrigue
	override_background = { reference = corridor_night }
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
		animation = spymaster
	}
	lower_right_portrait = scope:created_witch
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
				#save_scope_as = bg_override_char
			}
			location = {
				random_character_in_location = {
					limit = {
						is_pool_character = yes
						has_trait = witch
						is_powerful_being = no
						NOT = {
							has_character_flag = special_magic_character
						}
					}
					save_scope_as = created_witch
				}
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:created_witch
				}
			}
			hidden_effect_new_object = {
				create_character = {
					location = root.location
					faith = root.faith
					culture = root.culture
					template = witchy_template
					random_traits = no
					save_scope_as = created_witch
					after_creation = {
						turn_into_true_witch_effect = yes
					}
				}
			}
		}
		
		#scope:task_contract = {
		#	complete_task_contract = success_standard
		#}
	}
	option = {
		name = ev9.12.0.a
		duel = {
			skill = diplomacy
			target = scope:created_witch
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					custom_tooltip = ev9.12.0.a_ct
				}
				trigger_event = magic_ev9.14
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev9.12.0.a_ct2
				}
				trigger_event = magic_ev9.13
			}
		}
	}
	option = {
		name = ev9.12.0.b
		duel = {
			skill = intrigue
			value = 20
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:created_witch = {
						death = {
							death_reason = death_burned_witch
						}
					}
				}
				trigger_event = magic_ev9.14
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					add_prestige = {
						value = minor_prestige_gain
						multiply = -1
					}
				}
				trigger_event = magic_ev9.13
			}
		}
	}
	option = {
		name = ev9.12.0.c
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = bandit
			value = 20
		}
		duel = {
			skill = martial
			value = 20
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:created_witch = {
						death = {
							death_reason = death_murder
							killer = ROOT
						}
					}
				}
				add_secret = {
					type = secret_murder
					target = scope:created_witch
				}
				trigger_event = magic_ev9.14
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				custom_tooltip = ev9.12.0.c_ct2
				trigger_event = magic_ev9.13
			}
		}
	}
	option = {
		name = ev9.12.0.d
		trigger = {
			domicile ?= { has_domicile_parameter = camp_unlocks_cult_priest }
			OR = {
				AND = {
					has_trait = gallowsbait
					has_trait_xp = {
						trait = gallowsbait
						track = cultist
						value > 19
					}
				}
				has_trait = heresiarch
			}
			
		}
		duel = {
			skill = diplomacy
			target = scope:created_witch
			4 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					add_courtier = scope:created_witch
				}
				trigger_event = magic_ev9.14
			}
			6 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev9.12.0.a_ct2
				}
				trigger_event = magic_ev9.13
			}
		}
	}
}
#witch contract #1A - local witch - failure
magic_ev9.13 = {
	title = laamp_magic_1001_contract
	desc = ev9.13.desc
	theme = intrigue
	override_background = { reference = corridor_night }
	left_portrait = {
		character = root
		animation = sadness
	}
	right_portrait = {
		character = scope:employer
		animation = disappointed
	}
	lower_right_portrait = scope:created_witch
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
	}
	
	option = {
		name = ev9.13.0.a
		pay_short_term_gold = {
			target = scope:created_witch
			gold = medium_gold_max_value_static
		}
		duel = {
			skill = diplomacy
			target = scope:created_witch
			6 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					custom_tooltip = ev9.13.0.a_ct
				}
				trigger_event = magic_ev9.14
			}
			4 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev9.12.0.a_ct2
				}
				scope:task_contract = {
					complete_task_contract = failure_standard
				}
				
			}
		}
	}
	option = {
		name = learning_scholarship.5004.c	#I give up.
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #1B - local witch - success
magic_ev9.14 = {
	title = laamp_magic_1001_contract
	desc = ev9.14.desc
	theme = intrigue
	override_background = { reference = corridor_night }
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	right_portrait = {
		character = scope:employer
		animation = toast
	}
	lower_right_portrait = scope:created_witch
	immediate = {
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	
	option = {
		name = char_interaction.0220.a	#Good.
		give_knowledge_reward_for_wandering_mage_effect = yes
	}
}

#witch contract #2 - ingrediens
magic_ev9.15 = {
	title = laamp_magic_1002_contract
	desc = ev9.15.desc
	theme = learning
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
	}
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
	}
	option = {
		name = ev9.15.0.a
		remove_short_term_gold = potion_gold_value
		stress_impact = {
			greedy = medium_stress_gain
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.15.0.b
		trigger = {
			learning > 20
		}
		stress_impact = {
			lazy = minor_stress_gain
			diligent = minor_stress_loss
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.15.0.c
		trigger = {
			has_trait = lifestyle_herbalist
		}
		stress_impact = {
			lifestyle_herbalist = minor_stress_loss
			impatient = minor_stress_loss
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}

	}
	option = {
		name = ev9.15.0.d
		trigger = {
			has_trait = true_witch
		}
		stress_impact = {
			shy = medium_stress_gain
			gregarious = minor_stress_loss
			paranoid = minor_stress_gain
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}
	}
	option = {
		name = ev9.15.0.e
		stress_impact = {
			ambitious = minor_stress_loss
		}
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #3 - possession - failure (lack of skills)
magic_ev9.16 = {
	title = laamp_magic_1003_contract
	desc = ev9.16.desc
	theme = realm
	left_portrait = {
		character = root
		animation = disappointed
	}
	right_portrait = {
		character = scope:employer
		animation = dismissal
	}
	lower_center_portrait = scope:cpossessed
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
		hidden_effect = {
			scope:employer = {
				random_courtier_or_guest = {
					limit = {
						OR = {
							has_trait = possessed_1
							has_trait = possessed_genetic
						}
					}
					save_scope_as = cpossessed
				}
			}
			
			if = {
				limit = {
					NOT = {
						exists = scope:cpossessed
					}
				}
				scope:employer = { 
					random_courtier_or_guest = {
						add_trait = possessed_1
						save_scope_as = cpossessed
					}
				}
			}
		}
		
	}
	
	option = {
		name = epidemic_events.1060.a	#There is nothing I can do.
		stress_impact = {
			ambitious = minor_stress_gain
			compassionate = minor_stress_gain
		}
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #3A - possession - begins
magic_ev9.17 = {
	title = laamp_magic_1003_contract
	desc = ev9.17.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:cpossessed
		animation = rage
	}
	lower_left_portrait = scope:employer
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
		hidden_effect = {
			scope:employer = {
				random_courtier_or_guest = {
					limit = {
						OR = {
							has_trait = possessed_1
							has_trait = possessed_genetic
						}
					}
					save_scope_as = cpossessed
				}
			}
			
			if = {
				limit = {
					NOT = {
						exists = scope:cpossessed
					}
				}
				scope:employer = { 
					random_courtier_or_guest = {
						add_trait = possessed_1
						save_scope_as = cpossessed
					}
				}
			}
		}
		
	}
	
	option = {
		name = ev9.17.0.a
		trigger = {
			has_trait = lifestyle_mystic
		}
	}
	option = {
		name = ev9.17.0.b
		trigger = {
			has_trait = lifestyle_herbalist
		}
	}
	option = {
		name = ev9.17.0.c
		trigger = {
			has_trait = heresiarch
		}
	}
	option = {
		name = ev9.17.0.d
		trigger = {
			has_trait = witch
		}
		stress_impact = {
			impatient = minor_stress_gain
		}
	}
	option = {
		name = ev9.17.0.a
		trigger = {
			NOR = {
				has_trait = lifestyle_mystic
				has_trait = lifestyle_herbalist
				has_trait = heresiarch
				has_trait = witch
			}
		}
		add_stress = minor_stress_gain
	}
	after = {
		trigger_event = magic_ev9.18
	}
}
#witch contract #3B - possession - examination
magic_ev9.18 = {
	title = laamp_magic_1003_contract
	desc = ev9.18.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:cpossessed
		animation = lunatic
	}
	lower_left_portrait = scope:employer
	
	option = {
		name = ev9.18.0.a
		trigger_event = {
			id = magic_ev9.19
			days = 5
		}
	}
	option = {
		name = ev9.18.0.b
		add_internal_flag = special
		trigger = {
			#is_true_mage = yes
			has_access_to_aura_reading_trigger = yes
			is_antimagic_trigger = no
		}
		trait = archmage
		add_prestige = minor_prestige_gain
		if = {
			limit = {
				can_spend_standard_ps_trigger = yes
				NOR = {
					has_character_modifier = master_magic_modifier
					has_character_modifier = magic_eyes_modifier
				}
			}
			spend_standard_ps_effect = yes
		}
		
		trigger_event = magic_ev9.19
	}
}
#witch contract #3C - possession - conclusion
magic_ev9.19 = {
	title = laamp_magic_1003_contract
	desc = ev9.19.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = personality_rational
	}
	right_portrait = {
		character = scope:cpossessed
		animation = pain
	}
	lower_left_portrait = scope:employer
	
	option = {
		name = ev9.19.0.a
		trigger = {
			has_trait = true_witch
		}
		custom_tooltip = ev9.19.0.a_ct
		trigger_event = magic_ev9.20
	}
	option = {
		name = ev9.19.0.b
		trigger = {
			is_true_mage = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
		}
		add_prestige = medium_prestige_gain
		spend_standard_ps_effect = yes
		custom_tooltip = ev9.19.0.a_ct
		trigger_event = magic_ev9.20
	}
	option = {
		name = ev9.19.0.c
		trigger = {
			has_trait = lifestyle_mystic
		}
		random_list = {
			1 = {
				send_interface_toast = {
					title = ev3.52.a_1
					custom_tooltip = ev9.19.0.a_ct
				}
				trigger_event = magic_ev9.20
			}
			1 = {
				send_interface_toast = {
					title = ev3.52.a_2
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
			}
		}
	}
	option = {
		name = ev9.19.0.d
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #3D - possession - success
magic_ev9.20 = {
	title = laamp_magic_1003_contract
	desc = ev9.20.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:cpossessed
		animation = happiness
	}
	lower_left_portrait = scope:employer
	immediate = {
		scope:cpossessed = {
			if = {
				limit = {
					has_trait = possessed_1
				}
				remove_trait = possessed_1
			}
			if = {
				limit = {
					has_trait = possessed_genetic
				}
				remove_trait = possessed_genetic
			}
		}
		if = {
			limit = {
				is_true_mage = yes
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
	}
	option = {
		name = ev9.20.0.a
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.20.0.b
		custom_tooltip = ev9.20.0.b_ct
		trigger_event = magic_ev9.21
	}
}
#witch contract #3E - possession - searching
magic_ev9.21 = {
	title = ev9.21.title
	#desc = ev9.21.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_character_flag = magic_contract3_o1_flag
						has_character_flag = magic_contract3_o2_flag
					}
				}
				desc = ev9.21.desc2
			}
			desc = ev9.21.desc
		}
	}
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = {
		name = ev9.21.0.a
		trigger = {
			NOT = {
				has_character_flag = magic_contract3_o1_flag
			}
		}
		random_list = {
			4 = {
				desc = ev3.52.a_1
				show_chance = no
				custom_tooltip = ev9.21.0.a_ct1
				trigger_event = {
					id = magic_ev9.23
					days = 5
				}
			}
			6 = {
				desc = ev3.52.a_2
				show_chance = no
				custom_tooltip = ev9.21.0.a_ct2
				if = {
					limit = {
						OR = {
							has_character_flag = magic_contract3_o1_flag
							has_character_flag = magic_contract3_o2_flag
						}
					}
					trigger_event = {
						id = magic_ev9.22
						days = 5
					}
				}
				else = {
					add_character_flag = magic_contract3_o1_flag
					trigger_event = {
						id = magic_ev9.21
						days = 5
					}
				}
			}
		}
	}
	option = {
		name = ev9.21.0.b
		trigger = {
			NOT = {
				has_character_flag = magic_contract3_o2_flag
			}
		}
		random_list = {
			4 = {
				desc = ev3.52.a_1
				show_chance = no
				custom_tooltip = ev9.21.0.a_ct1
				trigger_event = {
					id = magic_ev9.23
					days = 5
				}
			}
			6 = {
				desc = ev3.52.a_2
				show_chance = no
				custom_tooltip = ev9.21.0.a_ct2
				if = {
					limit = {
						OR = {
							has_character_flag = magic_contract3_o1_flag
							has_character_flag = magic_contract3_o2_flag
						}
					}
					trigger_event = {
						id = magic_ev9.22
						days = 5
					}
				}
				else = {
					add_character_flag = magic_contract3_o2_flag
					trigger_event = {
						id = magic_ev9.21
						days = 5
					}
				}
			}
		}
	}
	option = {
		name = ev9.21.0.c
		trigger = {
			intrigue > 24
		}
		custom_tooltip = ev9.21.0.a_ct1
		trigger_event = {
			id = magic_ev9.23
			days = 5
		}
	}
	option = {
		name = ev9.21.0.d
		trigger = {
			is_true_mage = yes
		}
		custom_tooltip = ev9.21.0.a_ct1
		trigger_event = magic_ev9.23
	}
}
#witch contract #3E1 - possession - search fails
magic_ev9.22 = {
	title = ev9.22.title
	desc = ev9.22.desc
	theme = realm
	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:employer
	}
	lower_right_portrait = scope:cpossessed
	option = {
		name = ev9.22.0.a
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = magic_contract3_o1_flag
				}
				remove_character_flag = magic_contract3_o1_flag
			}
			if = {
				limit = {
					has_character_flag = magic_contract3_o2_flag
				}
				remove_character_flag = magic_contract3_o2_flag
			}
		}
	}
}

#witch contract #3E2 - possession - search successful
magic_ev9.23 = {
	title = ev9.21.title
	desc = ev9.23.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:created_witch
		animation = shock
	}
	immediate = {
		hidden_effect_new_object = {
			create_character = {
				location = root.location
				faith = scope:employer.faith
				culture = scope:employer.culture
				template = witchy_template
				random_traits = no
				save_scope_as = created_witch
				after_creation = {
					turn_into_true_witch_effect = yes
					set_spell_id = { ID = 3 }
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = magic_contract3_o1_flag
				}
				remove_character_flag = magic_contract3_o1_flag
			}
			if = {
				limit = {
					has_character_flag = magic_contract3_o2_flag
				}
				remove_character_flag = magic_contract3_o2_flag
			}
		}
	}
	option = {
		name = ev9.23.0.a
		trigger_event = magic_ev9.24
	}
}
#witch contract #3F - possession - search successful
magic_ev9.24 = {
	title = ev9.21.title
	desc = ev9.24.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:created_witch
		animation = fear
	}
	
	option = {
		name = ev9.24.0.a
		duel = {
			skill = prowess
			target = scope:created_witch
			6 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				scope:created_witch = {
					death = {
						death_reason = death_fight
						killer = root
					}
				}
				trigger_event = magic_ev9.26
			}
			4 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				custom_tooltip = ev9.24.0.a_ct
				trigger_event = magic_ev9.25
			}
		}
	}
	option = {
		name = ev9.24.0.b
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
		}
		custom_tooltip = ev7.45.0.d_ct
		spend_standard_ps_effect = yes
		scope:created_witch = {
			death = {
				death_reason = death_fight
				killer = root
			}
		}
		hidden_effect = {
			add_character_flag = {
				flag = kill_witch_with_power_strike_flag
				months = 1
			}
			trigger_event = magic_ev9.26
		}
	}
}
#witch contract #3G1 - possession - failure
magic_ev9.25 = {
	title = ev9.22.title
	desc = ev9.25.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = disgust
	}
	lower_right_portrait = scope:created_witch
	option = {
		name = ev9.22.0.a
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	after = {
		hidden_effect = {
			scope:created_witch = {
				move_to_pool = yes
			}
		}
	}
}

#witch contract #3G2 - possession - kill the witch
magic_ev9.26 = {
	title = ev9.21.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = kill_witch_with_power_strike_flag
				}
				desc = ev9.26.desc2
			}
			desc = ev9.26.desc
		}
		desc = ev9.26.desc3
	}
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_left_portrait = scope:employer
	lower_right_portrait = scope:created_witch
	option = {
		name = ev9.26.0.a
		if = {
			limit = {
				is_true_mage = yes
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else_if = {
			limit = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
			}
			custom_tooltip = ev2.47.a_ct
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
		}
		else_if = {
			limit = {
				can_unlock_arcane_focus_trigger = no
			}
			if = {
				limit = {
					is_ai = yes
				}
				random = {
					chance = 40
					add_character_flag = arcane_unlocked_flag
				}
			}
			else = {
				random = {
					chance = 40
					add_perk = magical_experiments_p1_perk
				}
			}
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else_if = {
			limit = {
				NOT = {
					has_character_modifier = secret_knowledge_modifier
				}
			}
			add_character_modifier = {
				modifier = secret_knowledge_modifier
				years = 1
			}
		}
		else = {
			add_learning_skill = 1
			add_intrigue_skill = 1
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}
	}
}

#witch contract #4 - curse rival
magic_ev9.27 = {
	title = laamp_magic_1004_desc_title
	desc = ev9.27.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
		#animation = personality_callous
	}
	lower_center_portrait = scope:nrival
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
			scope:employer = {
				random_relation = {
					type = rival
					limit = {
						is_antimagic_trigger = no
						has_immunity_for_regular_curse = no
						has_immunity_for_powerful_curse = no
						is_magic_protected = no
						NOT = { THIS = ROOT }
					}
					save_scope_as = nrival
				}
			}
			
			if = {
				limit = {
					NOT = {
						exists = scope:nrival
					}
				}
				random_ruler = {
					limit = {
						in_diplomatic_range = scope:employer
						NOR = {
							this = root
							this = scope:employer
							is_antimagic_trigger = no
							has_immunity_for_regular_curse = no
							has_immunity_for_powerful_curse = no
							is_magic_protected = no
						}
					}
					set_relation_rival = scope:employer
					save_scope_as = nrival
				}
			}
		}
	}
	option = {
		name = ev9.27.0.a
		trigger = {
			NOR = {
				has_perk = evil_eye_perk
				has_perk = fate_weaver_p10_perk
			}
		}
		custom_tooltip = ev9.27.0.a_ct
		trigger_event = magic_ev9.28
	}
	option = {
		name = ev9.27.0.b
		trigger = {
			OR = {
				has_perk = evil_eye_perk
				has_perk = fate_weaver_p10_perk
			}
		}
		trigger_event = magic_ev9.28
	}
	option = {
		name = ev9.27.0.c
		custom_tooltip = ev9.27.0.c_ct
		#scope:task_contract = {
		#	complete_task_contract = failure_standard
		#}
		scope:task_contract = {
			invalidate_contract = yes
		}
	}
}

#witch contract #4B - curse rival
magic_ev9.28 = {
	title = laamp_magic_1004_desc_title
	desc = ev9.28.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
		animation = schadenfreude
	}
	lower_center_portrait = scope:nrival
	
	option = {
		name = ev9.28.0.a
		trigger = {
			OR = {
				has_perk = evil_eye_perk
				has_trait = true_witch
			}
		}
		scope:nrival = {
			hidden_effect = {
				if = {
					limit = {
						has_character_modifier = cursed_modifier
					}
					remove_character_modifier = cursed_modifier
				}
			}
			add_character_modifier = {
				modifier = cursed_modifier
				years = 5
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.28.0.b
		trigger = {
			OR = {
				has_perk = fate_weaver_p10_perk
				is_true_mage = yes
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			OR = {
				has_perk = fate_weaver_p10_perk
				is_true_mage = yes
			}
		}
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		scope:nrival = {
			random_list = {
				6 = {
					death = natural
				}
				4 = {
					add_trait_force_tooltip = wounded_3
					add_trait_force_tooltip = disfigured
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}
	}
	option = {
		name = ev9.28.0.c
		
		duel = {
			skill = intrigue
			target = scope:employer
			5 = {
				desc = ev9.27.0.c1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:task_contract = {
						complete_task_contract = success_standard
					}
				}
				hidden_effect = {
					random = {
						chance = 40
						trigger_event = {
							id = magic_ev10.35
							days = 2
						}
					}
				}
			}
			5 = {
				desc = ev9.27.0.c2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					if = {
						limit = {
							NOT = {
								has_trait = gallowsbait
							}
						}
						add_trait = gallowsbait
					}
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
				add_trait_xp = {
					trait = gallowsbait
					track = trickster
					value = 20
				}
			}
		}
		
	}
	option = {
		name = ev9.27.0.c
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}

#witch contract #5 - healer
magic_ev9.29 = {
	title = laamp_magic_1005_desc_title
	desc = ev9.29.desc
	theme = healthcare
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
		animation = sick
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
			scope:employer = {
				if = {
					limit = {
						NOR = {
							has_trait = cancer
							has_trait = consumption
							has_trait = pneumonic
							has_trait = typhus
						}
					}
					add_trait = cancer
				}
			}
		}
	}
	option = {
		name = ev9.29.0.a
		trigger = {
			OR = {
				has_trait = lifestyle_herbalist
				has_trait = lifestyle_physician
			}
		}
		duel = {
			skill = learning
			value = 25
			5 = {
				desc = ev9.29.0.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				hidden_effect = {
					scope:employer = {
						if = {
							limit = {
								has_character_modifier = safe_disease_treatment_success_low_modifier
							}
							remove_character_modifier = safe_disease_treatment_success_low_modifier
						}
					}
				}
				send_interface_toast = {
					title = ev9.29.0.a1
					scope:task_contract = {
						complete_task_contract = success_standard
					}
				}
				scope:employer = {
					add_character_modifier = {
						modifier = safe_disease_treatment_success_low_modifier
						years = 1
					}
				}
			}
			5 = {
				desc = ev9.29.0.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				hidden_effect = {
					scope:employer = {
						if = {
							limit = {
								has_character_modifier = safe_disease_treatment_failure_modifier
							}
							remove_character_modifier = safe_disease_treatment_failure_modifier
						}
					}
				}
				send_interface_toast = {
					title = ev9.29.0.a2
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
				scope:employer = {
					add_character_modifier = {
						modifier = safe_disease_treatment_failure_modifier
						years = 1
					}
				}
			}
		}
	}
	option = {
		name = ev9.29.0.b
		trigger = {
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
		}
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		hidden_effect = {
			scope:employer = {
				if = {
					limit = {
						has_character_modifier = aura_boost2_modifier
					}
					remove_character_modifier = aura_boost2_modifier
				}
			}
		}
		scope:employer = {
			add_character_modifier = {
				modifier = aura_boost2_modifier
				years = 5
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.29.0.c
		trigger = {
			OR = {
				is_true_mage = yes
				can_use_healing_spell = yes
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			OR = {
				is_true_mage = yes
				can_use_healing_spell = yes
			}
		}
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		scope:employer = {
			if = {
				limit = {
					has_trait = cancer
				}
				remove_trait = cancer
			}
			if = {
				limit = {
					has_trait = consumption
				}
				remove_trait = consumption
			}
			if = {
				limit = {
					has_trait = pneumonic
				}
				remove_trait = pneumonic
			}
			if = {
				limit = {
					has_trait = typhus
				}
				remove_trait = typhus
			}
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}
	}
	option = {
		name = ev9.29.0.d
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}

#witch contract #6A - anomaly
magic_ev9.30 = {
	title = laamp_magic_1006_desc_title
	desc = ev9.30.desc
	theme = secret
	left_portrait = {
		character = root
		animation = interested
	}
	override_background = { reference = wilderness_mountains }
	trigger = {
		#has_trait = archmage
		is_true_mage = yes
	}
	on_trigger_fail = {
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
	option = {
		name = ev9.30.0.a
		trigger = {
			is_true_mage = yes
		}
		custom_tooltip = ev9.30.0.a_ct
		trigger_event = magic_ev9.31
	}
}
#witch contract #6A - anomaly
magic_ev9.31 = {
	title = laamp_magic_1006_desc_title
	desc = ev9.31.desc
	theme = secret
	left_portrait = {
		character = root
		animation = interested
	}
	override_background = { reference = wilderness_mountains }
	immediate = {
		stress_impact = {
			patient = minor_stress_loss
			impatient = minor_stress_gain
		}
	}
	option = {
		name = ev9.31.0.a
		duel = {
			skill = learning
			value = 30
			5 = {
				desc = ev9.31.0.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev3.25.a_ct
				trigger_event = magic_ev9.33
			}
			5 = {
				desc = ev9.31.0.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				trigger_event = magic_ev9.32
			}
		}
	}
	option = {
		name = ev9.31.0.b
		trigger = {
			OR = {
				has_trait = lifestyle_mystic
				has_trait = eccentric
			}
		}
		duel = {
			skill = learning
			value = 25
			5 = {
				desc = ev9.31.0.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev3.25.a_ct
				trigger_event = magic_ev9.33
			}
			5 = {
				desc = ev9.31.0.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				trigger_event = magic_ev9.32
			}
		}
	}
	option = {
		name = ev9.31.0.c
		trigger = {
			has_trait = scholar
		}
		duel = {
			skill = learning
			value = 20
			5 = {
				desc = ev9.31.0.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev3.25.a_ct
				trigger_event = magic_ev9.33
			}
			5 = {
				desc = ev9.31.0.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				trigger_event = magic_ev9.32
			}
		}
	}
	option = {
		name = ev9.31.0.d
		trigger = {
			OR = {
				has_trait = intellect_good_2
				has_trait = intellect_good_3
			}
		}
		custom_tooltip = ev9.31.0.a1
		custom_tooltip = ev3.25.a_ct
		trigger_event = magic_ev9.33
		
	}
}
#witch contract #6B1 - anomaly failed
magic_ev9.32 = {
	title = ev9.32.title
	desc = ev9.32.desc
	theme = secret
	left_portrait = {
		character = root
		animation = disappointed
	}
	override_background = { reference = wilderness_mountains }
	option = {
		name = ev9.32.0.a
		gain_sc_xp1_effect = yes
		if = {
			limit = {
				has_trait = lifestyle_mystic
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #6B2 - anomaly success
magic_ev9.33 = {
	title = laamp_magic_1006_desc_title
	desc = ev9.33.desc
	theme = secret
	left_portrait = {
		character = root
		animation = personality_content
	}
	override_background = { reference = wilderness_mountains }
	option = {
		name = ev9.33.0.a
		gain_sc_xp1_effect = yes
		gain_huge_ps_effect = yes
	}
	option = {
		name = ev9.33.0.b
		gain_sc_xp2_effect = yes
		add_learning_skill = 1
	}
	option = {
		name = ev9.33.0.c
		trigger = {
			has_trait = scholar
			me_may_unlocks_special_project = yes
		}
		trait = scholar
		gain_sc_xp2_effect = yes
		random = {
			chance = 25
			custom_tooltip = ev3.22.a3_ct
			hidden_effect = {
				me_unlock_new_special_project_effect2 = yes
			}
		}

	}
	after = {
		custom_tooltip = ev9.33.0.a_ct
		add_prestige = medium_prestige_gain
		hidden_effect = {
			scope:task_contract = {
				complete_task_contract = success_standard
			}
		}
	}
}

#magic rumors
magic_ev9.34 = {
	title = camp_fire_juicy_rumors_domicile_building
	desc = ev9.34.desc
	theme = laamp
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:robserver
	}
	lower_center_portrait = scope:rumors_target
	override_background = { reference = corridor_night }
	trigger = {
		is_alive = yes
		is_imprisoned = no
		any_living_character = {
			NOT = { THIS = ROOT }
			any_character_artifact = { has_variable = magic1 }
			in_diplomatic_range = ROOT
		}
		NOT = {
			has_character_flag = used_magic_rumors_flag
		}
	}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					NOT = { THIS = ROOT }
					any_character_artifact = { has_variable = magic1 }
					in_diplomatic_range = ROOT
				}
				save_scope_as = rumors_target
			}
			random_courtier_or_guest = {
				limit = {
					is_adult = yes
				}
				save_scope_as = robserver
			}
			add_character_flag = used_magic_rumors_flag
		}
	}
	option = {
		name = bp2_adult_education.1090.c
	}
}

#witch contract #7 - secret scroll - intro
magic_ev9.35 = {
	title = laamp_magic_1007_desc_title
	desc = ev9.35.desc
	theme = realm
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
		animation = personality_bold
	}
	artifact = {
        target = scope:newly_created_artifact
        position = lower_right_portrait
    }
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
			create_magic_ancient_scroll_artifact_effect = { OWNER = scope:employer }
		}
	}
	option = {
		name = ev9.35.0.a
		duel = {
			skill = diplomacy
			target = scope:employer
			5 = {
				desc = ev9.35.0.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					custom_tooltip = ev9.35.0.a_ct
				}
				hidden_effect = {
					add_character_flag = msscroll_discount_flag
				}
			}
			5 = {
				desc = ev9.35.0.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:employer = {
						add_opinion = {
							target = ROOT
							modifier = irritated_opinion
							opinion = -20
						}
					}
				}
			}
		}
		trigger_event = magic_ev9.36
	}
	option = {
		name = ev9.35.0.b
		trigger = {
			gold >= 1000
		}
		show_as_unavailable = {
			always = yes
		}
		stress_impact = {
			greedy = massive_stress_gain
			archmage = minor_stress_loss
			true_witch = minor_stress_loss
		}
		pay_short_term_gold = {
			target = scope:employer
			gold = 1000
		}
		scope:newly_created_artifact = {
			set_owner = {
				target = ROOT
				history = {
					type = purchased
					actor = scope:employer
					recipient = root
					location = root.location
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
}

#witch contract #7A - secret scroll - buying (or not)
magic_ev9.36 = {
	title = laamp_magic_1007_desc_title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = msscroll_discount_flag
				}
				desc = ev9.36.desc2
			}
			desc = ev9.36.desc
		}
	}
	theme = realm
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:employer
		animation = personality_bold
	}
	artifact = {
        target = scope:newly_created_artifact
        position = lower_right_portrait
    }
	option = {
		name = ev9.36.0.a
		trigger = {
			gold >= 800
			has_character_flag = msscroll_discount_flag
		}
		show_as_unavailable = {
			has_character_flag = msscroll_discount_flag
		}
		stress_impact = {
			greedy = major_stress_gain
			archmage = minor_stress_loss
			true_witch = minor_stress_loss
		}
		
		pay_short_term_gold = {
			target = scope:employer
			gold = 800
		}
		scope:newly_created_artifact = {
			set_owner = {
				target = ROOT
				history = {
					type = purchased
					actor = scope:employer
					recipient = root
					location = root.location
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.36.0.a
		trigger = {
			gold >= 1000
			NOT = {
				has_character_flag = msscroll_discount_flag
			}
		}
		show_as_unavailable = {
			NOT = {
				has_character_flag = msscroll_discount_flag
			}
		}
		stress_impact = {
			greedy = major_stress_gain
			archmage = minor_stress_loss
			true_witch = minor_stress_loss
		}
		pay_short_term_gold = {
			target = scope:employer
			gold = 1000
		}
		scope:newly_created_artifact = {
			set_owner = {
				target = ROOT
				history = {
					type = purchased
					actor = scope:employer
					recipient = root
					location = root.location
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
	option = {
		name = ev9.36.0.b
		stress_impact = {
			just = major_stress_gain
			arbitrary = minor_stress_loss
			honest = medium_stress_gain
			deceitful = medium_stress_loss
		}
		custom_tooltip = ev9.36.0.b_ct
		trigger_event = magic_ev9.37
	}
	option = {
		name = ev9.36.0.c
		if = {
			limit = {
				NOT = {
					has_character_flag = msscroll_discount_flag
				}
			}
			stress_impact = {
				irritable = medium_stress_loss
			}
		}
		stress_impact = {
			ambitious = minor_stress_gain
		}
		custom_tooltip = ev9.36.0.c_ct
		hidden_effect = {
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = msscroll_discount_flag
				}
				remove_character_flag = msscroll_discount_flag
			}
		}
	}
}

#witch contract #7B - secret scroll - criminal
magic_ev9.37 = {
	title = laamp_magic_1007_desc_title
	desc = ev9.37.desc
	theme = intrigue
	override_background = { reference = corridor_night }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_center_portrait = scope:employer
	artifact = {
        target = scope:newly_created_artifact
        position = lower_right_portrait
    }
	
	option = {
		name = ev9.37.0.a
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = thief
			value = 20
		}
		duel = {
			skill = intrigue
			value = 26
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:newly_created_artifact = {
						set_owner = {
							target = ROOT
							history = {
								type = stolen
								actor = scope:employer
								recipient = root
								location = root.location
							}
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:employer = {
						imprison = {
							target = ROOT	#court_position:cult_priest_camp_officer
							type = dungeon
						}
					}
				}
			}
		}
	}
	option = {
		name = ev9.37.0.b
		trigger = {
			employs_court_position = master_thief_camp_officer
		}
		if = {
			limit = {
				NOT = {
					has_trait = gallowsbait
				}
			}
			add_trait = gallowsbait
		}
		add_trait_xp = {
			trait = gallowsbait
			track = thief
			value = 10
		}
		custom_tooltip = ev9.37.0.b_ct
		court_position:cult_priest_camp_officer = {
			duel = {
				skill = intrigue
				value = 26
				5 = {
					desc = ev3.52.a_1
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = 0
					}
					send_interface_toast = {
						title = ev3.52.a_1
						scope:newly_created_artifact = {
							set_owner = {
								target = ROOT
								history = {
									type = stolen
									actor = scope:employer
									recipient = root
									location = root.location
								}
							}
						}
					}
				}
				5 = {
					desc = ev3.52.a_2
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = 0
					}
					send_interface_toast = {
						title = ev3.52.a_2
						scope:employer = {
							imprison = {
								target = root.court_position:cult_priest_camp_officer
								type = dungeon
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev9.37.0.d
		trigger = {
			is_true_mage = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			scope:employer = {
				custom_description = {
					text = have_antimagic_seal
					has_immunity_for_magic_domination = no
				}
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
		}
		spend_standard_ps_effect = yes
		scope:employer = {
			set_relation_mmaster = ROOT
		}
		hidden_effect = {
			if = {
				limit = {
					has_hook = scope:employer
				}
				remove_hook = {
					target = scope:employer
				}
			}
		}
		
		add_hook = {
			type = magic_domination_hook
			target = scope:employer
		}
		scope:newly_created_artifact = {
			set_owner = {
				target = ROOT
				history = {
					type = given
					actor = scope:employer
					recipient = root
					location = root.location
				}
			}
		}
	}
	option = {
		name = ev9.37.0.c
		if = {
			limit = {
				NOT = {
					has_character_flag = msscroll_discount_flag
				}
			}
			stress_impact = {
				irritable = medium_stress_loss
			}
		}
		stress_impact = {
			ambitious = minor_stress_gain
		}
		custom_tooltip = ev9.36.0.c_ct
	}
	after = {
		hidden_effect = {
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
	}
}

#singularity scroll search - failure
magic_ev9.38= {
	title = ev2.66.title
	desc = ev9.38.desc
	type = character_event
	theme = witchcraft
	left_portrait = root
	trigger = {
		NOT = {
			any_character_artifact = {
				has_variable = msscroll
			}
		}
	}
	option = {
		name = ev9.22.0.a
		trigger = {
			NOT = {
				has_trait = intellect_good_3
			}
		}
		add_stress = minor_stress_gain
	}
	option = {
		name = ev2.73.d
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		stress_impact = {
			impatient = medium_stress_gain
			patient = medium_stress_loss
		}
		#custom_tooltip = ev2.73.b_ct
		custom_tooltip = me_as_project_ct2
		hidden_effect = {
			add_character_flag = me_as_project_may_be_random_flag
		}
	}
}

#singularity scroll search - success
magic_ev9.39= {
	title = ev2.66.title
	desc = ev9.39.desc
	type = character_event
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:aowner
	artifact = {
        target = scope:scroll
        position = lower_right_portrait
    }
	trigger = {
		NOT = {
			any_character_artifact = {
				has_variable = msscroll
			}
		}
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					any_artifact = {
						has_variable = msscroll
					}
				}
				random_artifact = {
					limit = {
						has_variable = msscroll
					}
					save_scope_as = scroll
					artifact_owner = {
						save_scope_as = aowner
					}
				}
			}
			else = {
				random_ruler = {
					limit = {
						in_diplomatic_range = ROOT
						is_adult = yes
						is_ai = yes
					}
					save_scope_as = aowner
					create_magic_ancient_scroll_artifact_effect = { OWNER = scope:aowner }
					scope:newly_created_artifact = {
						save_scope_as = scroll
					}
				}
			}
		}
	}
	
	option = {
		name = ev9.39.0.a
		if = {
			limit = {
				NOT = {
					has_personal_artifact_claim = scope:scroll
				}
			}
			add_personal_artifact_claim = scope:scroll
		}
	}
	option = {
		name = ev2.73.d
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		stress_impact = {
			impatient = medium_stress_gain
			patient = medium_stress_loss
		}
		#custom_tooltip = ev2.73.b_ct
		custom_tooltip = me_as_project_ct2
		hidden_effect = {
			add_character_flag = me_as_project_may_be_random_flag
		}
	}
}

#witch contract #8A - a trap
magic_ev9.40 = {
	title = laamp_magic_1008_contract
	desc = ev9.40.desc
	theme = martial
	override_background = { reference = courtyard_location }
	left_portrait = {
		character = root
		animation = disbelief
	}
	right_portrait = {
		character = scope:employer
		animation = personality_bold
	}
	trigger = {
		is_landless_adventurer = yes
		government_has_flag = government_is_landless_adventurer
	}
	immediate = {
		hidden_effect = {
			save_scope_as = this0
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
			dynasty ?= {
				set_variable = laamp_magic_secret_mission_took
			}
			random_courtier = {
				limit = {
					is_ai = yes
					is_imprisoned = no
					is_adult = yes
				}
				save_scope_as = rcourt
			}
		}		
	}
	option = {
		name = ev9.40.0.a
		if = {
			limit = {
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			add_stress = medium_stress_gain
		}
		else = {
			stress_impact = {
				craven = major_stress_gain
			}
		}
		trigger_event = magic_ev9.41
	}
}
#witch contract #8B - a trap
magic_ev9.41 = {
	title = ev9.41.title
	desc = ev9.41.desc
	theme = martial
	override_background = { reference = courtyard_location }
	left_portrait = {
		character = root
		animation = paranoia
	}
	right_portrait = {
		character = scope:employer
		animation = aggressive_mace
	}
	immediate = {
		scope:employer = {
			add_trait = witch_hunter
			hidden_effect = {
				add_trait_xp = {
					trait = witch_hunter
					value = 80
				}
			}
			set_relation_rival = ROOT
		}
		hidden_effect = {
			random_courtier = {
				limit = {
					is_a_demon_trigger = yes
					NOT = {
						has_trait = compassionate
					}
				}
				save_scope_as = demon
			}
		}
	}
	option = {
		name = ev9.41.0.a
		duel = {
			skill = martial
			value = 25
			5 = {
				desc = ev9.41.0.a_ct1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev2.48.a_ct1
				hidden_effect = {
					if = {
						limit = {
							any_character_artifact = {
								has_variable = dark_blade
							}
						}
						dark_blade_grows_stronger = yes
					}
				}
				trigger_event = magic_ev9.44
			}
			5 = {
				desc = ev9.41.0.a_ct2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 70
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
				
			}
		}
	}
	option = {
		name = ev9.41.0.b
		trigger = {
			has_trait = strategist
		}
		custom_tooltip = ev2.48.a_ct1
		hidden_effect = {
			if = {
				limit = {
					any_character_artifact = {
						has_variable = dark_blade
					}
				}
				dark_blade_grows_stronger = yes
			}
		}
		trigger_event = magic_ev9.44
	}
	option = {
		name = ev9.41.0.c
		trigger = {
			OR = {
				has_trait = schemer
				has_trait = intellect_good_3
				has_trait = shrewd
			}
		}
		duel = {
			skill = intrigue
			value = 20
			5 = {
				desc = ev9.41.0.c_ct1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = ev9.41.0.c_ct1A
				trigger_event = magic_ev9.42
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 70
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
			}
		}
	}
	option = {
		name = ev9.41.0.d
		trigger = {
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
		}
		spend_standard_ps_effect = yes
		duel = {
			skill = martial
			value = 15
			5 = {
				desc = ev9.41.0.a_ct1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev2.48.a_ct1
				custom_tooltip = ev2.48.d_ct1
				add_character_flag = magic_contract_8_used_magic_flag
				trigger_event = magic_ev9.44
			}
			5 = {
				desc = ev9.41.0.a_ct2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 70
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
			}
		}
	}
	option = {
		name = ev9.41.0.e
		trigger = {
			can_cast_firestorm_trigger = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			can_cast_firestorm_trigger = yes
		}
		spend_standard_ps_effect = yes
		custom_tooltip = ev9.41.0.e_ct
		show_as_tooltip = {
			scope:employer = {
				death = {
					death_reason = death_fight
					killer = ROOT
				}
			}
		}
		trigger_event = magic_ev9.43
	}
	option = {
		name = ev9.41.0.k
		trigger = {
			OR = {
				is_the_choosen_one_trigger = yes
				is_legendary_mage_trigger = yes
				has_character_modifier = ultimate_spell_modifier
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			OR = {
				is_the_choosen_one_trigger = yes
				is_legendary_mage_trigger = yes
				has_character_modifier = ultimate_spell_modifier
			}
		}
		spend_standard_ps_effect = yes
		if = {
			limit = {
				NOR = {
					is_the_choosen_one_trigger = yes
					is_legendary_mage_trigger = yes
				}
				has_character_modifier = ultimate_spell_modifier
			}
			remove_character_modifier = ultimate_spell_modifier
		}
		custom_tooltip = ev9.41.0.e_ct
		show_as_tooltip = {
			scope:employer = {
				death = {
					death_reason = death_fight
					killer = ROOT
				}
			}
		}
		trigger_event = magic_ev9.43
	}
	option = {
		name = ev9.41.0.f
		trigger = {
			is_true_mage = yes
			any_character_artifact = {
				OR = {
					has_artifact_modifier = singularity_modifier5
					has_artifact_modifier = singularity_modifierX
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
			any_character_artifact = {
				OR = {
					has_artifact_modifier = singularity_modifier5
					has_artifact_modifier = singularity_modifierX
				}
			}
		}
		spend_standard_ps_effect = yes
		custom_tooltip = ev9.41.0.e_ct
		show_as_tooltip = {
			scope:employer = {
				death = {
					death_reason = death_fight
					killer = ROOT
				}
			}
		}
		location.county = {
			add_county_modifier = {
				modifier = magic_damaged_walls_modifier
				years = 2
			}
		}
		trigger_event = magic_ev9.43
	}
	option = {
		name = ev9.41.0.g
		trigger = {
			OR = {
				has_character_flag = shadowstep_flag
				AND = {
					is_true_mage = yes
					any_equipped_character_artifact = {
						has_variable = magic_crown
					}
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			OR = {
				has_character_flag = shadowstep_flag
				AND = {
					is_true_mage = yes
					any_equipped_character_artifact = {
						has_variable = magic_crown
					}
				}
			}
		}
		spend_standard_ps_effect = yes
		custom_tooltip = ev9.41.0.g_ct
		hidden_effect = {
			every_courtier = {
				limit = {
					is_adult = yes
				}
				random = {
					chance = 70
					death = {
						death_reason = death_fight
						killer = scope:employer
					}
				}
			}
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
	}
	option = {
		name = ev9.41.0.h
		trigger = {
			is_true_mage = yes
			can_use_tornado_spell_trigger = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
			can_use_tornado_spell_trigger = yes
		}
		custom_tooltip = ev9.41.0.h_ct
		hidden_effect = {
			every_courtier = {
				limit = {
					is_adult = yes
				}
				random = {
					chance = 70
					death = {
						death_reason = death_violent_storm
					}
				}
			}
			scope:employer = {
				every_courtier = {
					random = {
						chance = 70
						death = {
							death_reason = death_violent_storm
						}
					}
				}
			}
		}
		death = {
			death_reason = death_violent_storm
		}
		scope:employer = {
			death = {
				death_reason = death_violent_storm
			}
		}
		custom_tooltip = ev9.41.0.h_ct2
	}
	option = {
		name = ev9.41.0.i
		trigger = {
			prowess > 40
		}
		custom_tooltip = ev2.48.a_ct1
		trigger_event = magic_ev9.44
	}
	option = {
		name = ev9.41.0.j
		trigger = {
			exists = scope:demon
		}
		custom_tooltip = ev9.41.0.j_ct
		hidden_effect = {
			send_interface_toast = {
				title = ev5.31.0.b_ct
				scope:employer = {
					add_stress = major_stress_gain
				}
			}
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
	}
}

#witch contract #8C - a trap - deception success
magic_ev9.42 = {
	title = ev9.41.title
	desc = ev9.42.desc
	theme = martial
	override_background = { reference = courtyard_location }
	left_portrait = {
		character = root
		animation = personality_cynical
	}
	right_portrait = {
		character = scope:employer
		animation = toast
	}
	immediate = {
		scope:employer = {
			remove_relation_rival = ROOT
		}
	}
	option = {
		name = ev9.42.0.a
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
}


#witch contract #8D - a trap - total win
magic_ev9.43 = {
	title = ev9.43.title
	desc = ev9.43.desc
	theme = martial
	override_background = { reference = courtyard_location }
	left_portrait = {
		character = root
		animation = personality_callous
	}
	right_portrait = scope:employer
	immediate = {
		hidden_effect = {
			hidden_effect = {
				scope:task_contract = {
					complete_task_contract = failure_standard
				}
			}
			scope:employer = {
				every_courtier = {
					random = {
						chance = 40
						death = {
							death_reason = death_fight
							killer = root
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = root
				}
			}
		}
	}
	
	option = {
		name = ev9.43.0.a
		add_prestige = major_prestige_gain
		add_dread = major_dread_gain
		stress_impact = {
			callous = major_stress_loss
			ambitious = major_stress_loss
			compassionate = major_stress_gain
			sadistic = major_stress_loss
		}
	}
	option = {
		name = ev9.43.0.b
		stress_impact = {
			compassionate = minor_stress_loss
			sadistic = minor_stress_gain
		}
	}

	after = {
		gain_sc_xp1_effect = yes
		
	}
}


#witch contract #8E - a trap - continue
magic_ev9.44 = {
	title = ev9.41.title
	#desc = ev9.44.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = magic_contract_8_used_magic_flag
				}
				desc = ev9.44.desc1
			}
			desc = ev9.44.desc0
		}
		desc = ev9.44.desc2
	}
	theme = martial
	override_background = { reference = armory }
	override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_war" }
	left_portrait = {
		character = root
		animation = personality_coward
	}
	lower_left_portrait = scope:rcourtier
	lower_center_portrait = scope:rcourtier2
	lower_right_portrait = scope:employer
	
	immediate = {
		hidden_effect = {
			random_courtier = {
				limit = {
					is_adult = yes
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				save_scope_as = rcourtier
			}
			random_courtier = {
				limit = {
					is_adult = yes
					NOT = {
						THIS = scope:rcourtier
					}
				}
				save_scope_as = rcourtier2
			}
		}
		scope:rcourtier = {
			add_trait = wounded_2
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = magic_contract_8_used_magic_flag
				}
			}
			send_interface_toast = {
				title = suffering_casualties
				scope:rcourtier2 = {
					death = {
						death_reason = death_fight
						killer = scope:employer
					}
				}
			}
		}
	}
	option = {
		name = ev9.44.0.a
		add_internal_flag = dangerous
		random_list = {
			1 = {
				desc = ev9.44.1.a
				custom_tooltip = ev9.44.0.a_ct
				trigger_event = magic_ev9.48
			}
			9 = {
				desc = ev9.44.2.a
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 70
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
			}
		}
	}
	option = {
		name = ev9.44.0.b
		custom_tooltip = ev9.44.0.b_ct
		trigger_event = magic_ev9.45
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = magic_contract_8_used_magic_flag
				}
				remove_character_flag = magic_contract_8_used_magic_flag
			}
		}
	}
}
#witch contract #8G - a trap - second assault
magic_ev9.45 = {
	title = ev9.41.title
	desc = ev9.45.desc
	theme = martial
	override_background = { reference = armory }
	override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_war" }
	left_portrait = {
		character = root
		animation = aggressive_sword
	}
	lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	
	option = {
		name = ev9.45.0.a
		trigger = {
			NOR = {
				has_trait = gallant
				has_trait = lifestyle_blademaster
				has_trait = unyielding_defender
				has_trait = strong
				has_trait = berserker
				has_trait = golem
			}
		}
		random_list = {
			5 = {
				custom_tooltip = ev9.45.0.a_ct
			}
			4 = {
				custom_tooltip = ev9.45.0.a_ct
				custom_tooltip = suffering_casualties
				hidden_effect = {
					send_interface_toast = {
						title = suffering_casualties
						scope:rcourtier = {
							death = {
								death_reason = death_fight
							}
						}
						if = {
							limit = {
								NOR = {
									has_trait = wounded_1
									has_trait = wounded_2
									has_trait = wounded_3
								}
							}
							add_trait = wounded_1
						}
					}
				}
			}
			1 = {
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 70
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
			}
		}
	}
	option = {
		name = ev9.45.0.a
		trigger = {
			OR = {
				has_trait = gallant
				has_trait = lifestyle_blademaster
				has_trait = unyielding_defender
				has_trait = strong
				has_trait = berserker
				has_trait = golem
			}
		}
		custom_tooltip = ev9.45.0.a_ct
		hidden_effect = {
			if = {
				limit = {
					any_character_artifact = {
						has_variable = dark_blade
					}
				}
				dark_blade_grows_stronger = yes
			}
		}
	}
	option = {
		name = ev9.45.0.b
		trigger = {
			has_trait = lifestyle_herbalist
		}
		custom_tooltip = ev9.45.0.a_ct
	}
	option = {
		name = ev9.45.0.c
		trigger = {
			is_true_mage = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
		}
		spend_standard_ps_effect = yes
		add_dread = minor_dread_gain
		custom_tooltip = ev9.45.0.a_ct
	}

	after = {
		trigger_event = magic_ev9.46
	}
}
#witch contract #8H - a trap - after second assault
magic_ev9.46 = {
	title = ev9.41.title
	desc = {
		desc = ev9.46.desc
		desc = ev9.46.desc2
	}
	theme = martial
	override_background = { reference = armory }
	#override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_war" }
	left_portrait = {
		character = root
		animation = personality_bold
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	
	option = {
		name = ev9.46.0.a
		death = {
			death_reason = death_burned_witch
			killer = scope:employer
		}
		custom_tooltip = ev9.46.0.a_ct
	}
	option = {
		name = ev9.46.0.b
		trigger = {
			has_trait = diplomat
		}
		pay_short_term_gold = {
			target = scope:employer
			gold = major_gold_value_check
		}
		scope:employer = {
			add_stress = medium_stress_gain
		}
		custom_tooltip = ev9.46.0.b_ct
		hidden_effect = {
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
	}
	option = {
		name = ev9.46.0.c
		every_court_position_holder = {
			add_opinion = {
				target = PREV
				modifier = disappointed_opinion
				opinion = -10
			}
		}
		trigger_event = magic_ev9.47
	}
}
#witch contract #8I - a trap - the plan
magic_ev9.47 = {
	title = ev9.41.title
	#desc = ev9.47.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = magic_contract_8_used_plan_b_flag
				}
				desc = ev9.47.desc2
			}
			desc = ev9.47.desc
		}
	}
	theme = martial
	override_background = { reference = armory }
	#override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_war" }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	immediate = {
		if = {
			limit = {
				has_character_flag = magic_contract_8_used_plan_b_flag
			}
			add_stress = minor_stress_gain
			hidden_effect = {
				random_courtier = {
					limit = {
						is_adult = yes
					}
					save_scope_as = rcourtier3
				}
			}
			scope:employer = {
				imprison = {
					target = scope:rcourtier3
					type = dungeon
				}
			}
		}
	}
	
	option = {
		name = ev9.47.0.a
		flavor = ev9.47.0.a_fl
		custom_tooltip = ev9.47.0.a_ct
		custom_tooltip = ev9.47.0.a_ct2
		random_list = {
			5 = {
				desc = ev9.44.1.a
				custom_tooltip = ev9.44.0.a_ct
				trigger_event = magic_ev9.48
			}
			5 = {
				desc = ev9.44.2.a
				hidden_effect = {
					every_courtier = {
						limit = {
							is_adult = yes
						}
						random = {
							chance = 50
							death = {
								death_reason = death_fight
								killer = scope:employer
							}
						}
					}
				}
				death = {
					death_reason = death_fight
					killer = scope:employer
				}
				custom_tooltip = mass_followers_dying
			}
		}
	}
	option = {
		name = ev9.47.0.b
		trigger = {
			number_of_maa_regiments > 0
			NOT = {
				has_character_flag = magic_contract_8_used_plan_b_flag
			}
		}
		flavor = ev9.47.0.b_fl
		random_list = {
			0 = {
				show_chance = no
				desc = ev9.47.1.b
				custom_tooltip = ev9.47.0.b_ct
			}
			1 = {
				desc = ev9.47.2.b
				show_chance = no
				show_as_tooltip = {
					add_stress = minor_stress_gain
				}
				
			}
		}
		hidden_effect = {
			add_character_flag = {
				flag = magic_contract_8_used_plan_b_flag
				years = 1
			}
			trigger_event = magic_ev9.47
		}
	}
	option = {
		name = ev9.46.0.a
		trigger = {
			OR = {
				number_of_maa_regiments = 0
				has_character_flag = magic_contract_8_used_plan_b_flag
			}
		}
		flavor = ev9.47.0.g_fl
		death = {
			death_reason = death_burned_witch
			killer = scope:employer
		}
		custom_tooltip = ev9.46.0.a_ct
	}
	option = {
		name = ev9.47.0.c
		trigger = {
			is_true_mage = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
		}
		flavor = ev9.47.0.c_fl
		custom_tooltip = ev9.47.0.c_ct
		trigger_event = magic_ev9.49
	}
	option = {
		name = ev9.47.0.d
		trigger = {
			is_true_mage = yes
			has_character_modifier = master_alteration_modifier
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
			has_character_modifier = master_alteration_modifier
		}
		flavor = ev9.47.0.d_fl
		hidden_effect = {
			send_interface_toast = {
				title = ev5.31.0.b_ct
				scope:employer = {
					add_stress = major_stress_gain
				}
			}
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
		custom_tooltip = ev9.44.0.a_ct
	}
	option = {
		name = ev9.47.0.e
		trigger = {
			is_true_mage = yes
			has_character_modifier = master_psionic_modifier
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
			has_character_modifier = master_psionic_modifier
		}
		flavor = ev9.47.0.e_fl
		trigger_event = magic_ev9.48
		custom_tooltip = ev9.47.0.e_ct
	}
	option = {
		name = ev9.47.0.f
		trigger = {
			is_true_mage = yes
			can_use_tornado_spell_trigger = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
			can_use_tornado_spell_trigger = yes
		}
		flavor = ev9.47.0.f_fl
		trigger_event = magic_ev9.48
		custom_tooltip = ev9.47.0.f_ct
		show_as_tooltip = {
			random = {
				chance = 20
				custom_tooltip = suffering_casualties
			}
		}
	}
}

#witch contract #8J - a trap - get the gate
magic_ev9.48 = {
	title = ev9.41.title
	desc = ev9.48.desc
	theme = martial
	override_background = { reference = corridor_night }
	override_sound = { reference = "event:/SFX/Events/Themes/sfx_event_theme_type_war" }
	left_portrait = {
		character = root
		animation = war_over_win
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	
	option = {
		name = ev9.48.0.a
		add_stress = major_stress_loss
	}
	option = {
		name = ev9.48.0.b
		add_prestige = major_prestige_gain
		stress_impact = {
			vengeful = massive_stress_loss
			forgiving = massive_stress_gain
		}
		hidden_effect = {
			remove_relation_rival = scope:employer
		}
		scope:employer = {
			set_relation_nemesis = ROOT
		}
	}
	after = {
		hidden_effect = {
			send_interface_toast = {
				title = ev5.31.0.b_ct
				scope:employer = {
					add_stress = major_stress_gain
				}
			}
			scope:task_contract = {
				complete_task_contract = failure_standard
			}
		}
		custom_tooltip = ev9.44.0.a_ct
	}
}


#witch contract #8K - a trap - summoning demon
magic_ev9.49 = {
	title = ev9.41.title
	desc = ev9.49.desc
	theme = martial
	override_background = { reference = armory }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:demon2
		animation = personality_callous
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	immediate = {
		hidden_effect_new_object = {
			create_character = {
				location = root.location
				faith = root.faith
				culture = root.culture
				gender_female_chance = 30
				template = generic_demon_character
				save_scope_as = demon2
				after_creation = {
					set_sexuality = bisexual
					give_witch_secret_or_trait_effect2 = yes
					add_trait_xp = {
						trait = demon2
						value = { 20 40 }
					}
					set_source4demon = yes
					if = {
						limit = {
							NOT = {
								has_trait = giant
							}
						}
						add_trait = giant
					}
				}
			}
		}
	}
	option = {
		name = ev9.49.0.a
		trigger_event = magic_ev9.50
		if = {
			limit = {
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			add_stress = minor_stress_gain
		}
		else = {
			stress_impact = {
				craven = medium_stress_gain
			}
		}
	}
}

#witch contract #8L - a trap - summoning demon2
magic_ev9.50 = {
	title = ev9.41.title
	desc = ev9.50.desc
	theme = martial
	override_background = { reference = armory }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:demon2
		animation = interested
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	option = {
		name = ev9.50.0.a
		trigger_event = magic_ev9.51
	}
}
#witch contract #8M - a trap - summoning demon3
magic_ev9.51 = {
	title = ev9.41.title
	desc = ev9.51.desc
	theme = martial
	override_background = { reference = armory }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:demon2
		animation = schadenfreude
	}
	#lower_left_portrait = scope:rcourtier
	lower_right_portrait = scope:employer
	option = {
		name = ev9.51.0.a
		trigger_event = magic_ev9.48
		custom_tooltip = ev9.44.0.a_ct
	}
}

#witch contract #9A - monster hunt
magic_ev9.52 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.52.desc
	theme = realm
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
		animation = worry
	}
	lower_center_portrait = scope:dead_courtier
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
				random_courtier_or_guest = {
					limit = {
						is_ai = yes
						is_imprisoned = no
						is_adult = yes
						is_witch_trigger = no
						NOT = {
							has_character_flag = special_magic_character
						}
					}
					save_scope_as = dead_courtier
					add_trait = wounded_3
					death = {
						death_reason = death_wild_animal
					}
				}
			}
		}
	}
	option = {
		name = ev9.52.0.a
		trigger_event = magic_ev9.53
	}
}
#witch contract #9B - monster hunt - the body
magic_ev9.53 = {
	title = laamp_magic_1009_desc_title
	#desc = ev9.53.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = witch_contract_o1
				}
				desc = ev9.53.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = witch_contract_o2
				}
				desc = ev9.53.desc2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = witch_contract_o3
				}
				desc = ev9.53.desc3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = witch_contract_o4
				}
				desc = ev9.53.desc4
			}
			desc = ev9.53.desc
		}
	}
	theme = realm
	override_background = { reference = dungeon }
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = scope:dead_courtier
	lower_center_portrait = scope:employer
	option = {
		name = ev9.53.0.b
		trigger = {
			OR = {
				has_trait = lifestyle_physician
				has_trait = scholar
			}
			NOT = {
				has_character_flag = witch_contract_o1_done
			}
		}
		stress_impact = {
			diligent = minor_stress_loss
			scholar = minor_stress_loss
			lazy = medium_stress_gain
		}
		add_character_flag = witch_contract_o1_done
		add_character_flag = witch_contract_o1
		if = {
			limit = {
				has_character_flag = witch_contract_o2
			}
			remove_character_flag = witch_contract_o2
		}
		if = {
			limit = {
				has_character_flag = witch_contract_o3
			}
			remove_character_flag = witch_contract_o3
		}
		if = {
			limit = {
				has_character_flag = witch_contract_o4
			}
			remove_character_flag = witch_contract_o4
		}
		trigger_event = magic_ev9.53
	}
	option = {
		name = ev9.53.0.c
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
			}
			NOT = {
				has_character_flag = witch_contract_o2_done
			}
		}
		hidden_effect = {
			add_character_flag = witch_contract_o2_done
			add_character_flag = witch_contract_o2
			if = {
				limit = {
					has_character_flag = witch_contract_o1
				}
				remove_character_flag = witch_contract_o1
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3
				}
				remove_character_flag = witch_contract_o3
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4
				}
				remove_character_flag = witch_contract_o4
			}
			trigger_event = magic_ev9.53
		}
	}
	option = {
		name = ev9.53.0.d
		trigger = {
			has_trait = lifestyle_hunter
			NOT = {
				has_character_flag = witch_contract_o3_done
			}
		}
		hidden_effect = {
			add_character_flag = witch_contract_o3_done
			add_character_flag = witch_contract_o3
			if = {
				limit = {
					has_character_flag = witch_contract_o1
				}
				remove_character_flag = witch_contract_o1
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2
				}
				remove_character_flag = witch_contract_o2
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4
				}
				remove_character_flag = witch_contract_o4
			}
			trigger_event = magic_ev9.53
		}
		
	}
	option = {
		name = ev9.53.0.e
		trigger = {
			has_access_to_aura_reading_trigger = yes
			has_character_flag = witch_contract_o2_done
			NOT = {
				has_character_flag = witch_contract_o4_done
			}
		}
		add_internal_flag = special
		hidden_effect = {
			add_character_flag = witch_contract_o4_done
			add_character_flag = witch_contract_o4
			if = {
				limit = {
					has_character_flag = witch_contract_o1
				}
				remove_character_flag = witch_contract_o1
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2
				}
				remove_character_flag = witch_contract_o2
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3
				}
				remove_character_flag = witch_contract_o3
			}
			trigger_event = magic_ev9.53
		}
	}
	option = {
		name = ev9.53.0.f
		trigger = {
			OR = {
				has_character_flag = witch_contract_o1_done
				has_character_flag = witch_contract_o2_done
				has_character_flag = witch_contract_o3_done
				has_character_flag = witch_contract_o4_done
			}
		}
		custom_tooltip = ev9.27.0.c_ct
		stress_impact = {
			craven = medium_stress_loss
			brave = minor_stress_gain
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = witch_contract_o1
				}
				remove_character_flag = witch_contract_o1
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2
				}
				remove_character_flag = witch_contract_o2
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3
				}
				remove_character_flag = witch_contract_o3
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4
				}
				remove_character_flag = witch_contract_o4
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o1_done
				}
				remove_character_flag = witch_contract_o1_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2_done
				}
				remove_character_flag = witch_contract_o2_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3_done
				}
				remove_character_flag = witch_contract_o3_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4_done
				}
				remove_character_flag = witch_contract_o4_done
			}
		}
		scope:task_contract = {
			#complete_task_contract = failure_standard
			invalidate_contract = yes
		}
	}
	option = {
		name = ev9.53.0.a
		stress_impact = {
			craven = medium_stress_gain
			brave = minor_stress_loss
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = witch_contract_o1
				}
				remove_character_flag = witch_contract_o1
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2
				}
				remove_character_flag = witch_contract_o2
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3
				}
				remove_character_flag = witch_contract_o3
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4
				}
				remove_character_flag = witch_contract_o4
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o1_done
				}
				remove_character_flag = witch_contract_o1_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o2_done
				}
				remove_character_flag = witch_contract_o2_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o3_done
				}
				remove_character_flag = witch_contract_o3_done
			}
			if = {
				limit = {
					has_character_flag = witch_contract_o4_done
				}
				remove_character_flag = witch_contract_o4_done
			}
			trigger_event = magic_ev9.54
		}
		
	}
}

#witch contract #9C - monster hunt - crime scene
magic_ev9.54 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.54.desc
	theme = realm
	override_background = { reference = wilderness_forest }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_center_portrait = scope:employer

	option = {
		name = ev9.54.0.a
		stress_impact = {
			craven = minor_stress_gain
			brave = minor_stress_loss
		}
		custom_tooltip = ev9.54.0.a_ct
		trigger_event = magic_ev9.55
	}
}
#witch contract #9D - monster hunt - swamps
magic_ev9.55 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.55.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_callous
	}
	lower_center_portrait = scope:employer

	option = {
		name = ev9.55.0.a
		random_list = {
			1 = {
				desc = ev9.55.0.a1
				custom_tooltip = ev9.55.0.a1_ct
			}
			1 = {
				desc = ev9.55.0.a2
				custom_tooltip = ev9.55.0.a2_ct
			}
		}
	}
	option = {
		name = ev9.55.0.b
		trigger = {
			has_trait = lifestyle_hunter
		}
		custom_tooltip = ev9.55.0.a1
		custom_tooltip = ev9.55.0.a1_ct
	}
	option = {
		name = ev9.55.0.c
		add_character_flag = {
			flag = witch_contract_o5
			years = 1
		}
		custom_tooltip = ev9.55.0.c_ct
	}
	after = {
		trigger_event = magic_ev9.56
	}
}
#witch contract #9E - monster hunt - confrontation1
magic_ev9.56 = {
	title = laamp_magic_1009_desc_title
	#desc = ev9.56.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = witch_contract_o5
				}
				desc = ev9.56.desc1
			}
			desc = ev9.56.desc0
		}
		desc = ev9.56.desc
	}
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = shock
	}
	right_portrait = {
		character = scope:demon2
		animation = scheme
	}
	immediate = {
		hidden_effect_new_object = {
			save_scope_as = this0
			create_character = {
				location = root.location
				name = behemoth_name
				faith = root.faith
				culture = root.culture
				gender_female_chance = 1
				template = generic_demon_character
				save_scope_as = demon2
				after_creation = {
					set_sexuality = bisexual
					give_witch_secret_or_trait_effect2 = yes
					add_prowess_skill = 10
					set_source4demon = yes
					add_character_modifier = power_saturated1
					if = {
						limit = {
							NOR = {
								has_trait = giant
								has_trait = dwarf
							}
						}
						add_trait = giant
					}
					if = {
						limit = {
							NOT = {
								has_trait = leper
							}
						}
						add_trait = leper
					}
				}
			}
		}
	}

	option = {
		name = ev9.56.0.a
		trigger = {
			NOT = {
				is_true_mage = yes
			}
		}
		trigger_event = magic_ev9.57
	}

	option = {
		name = ev9.56.0.b
		trigger = {
			is_true_mage = yes
		}
		trigger_event = magic_ev9.60
	}
}

#witch contract #9F - monster hunt - confrontation for the weak
magic_ev9.57 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.57.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:demon2
		animation = schadenfreude
	}
	

	option = {
		name = ev9.57.0.a
		duel = {
			skill = prowess
			target = scope:demon2
			5 = {
				desc = ev9.57.1.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				scope:demon2 = {
					death = {
						death_reason = death_fight
						killer = root
					}
				}
				trigger_event = magic_ev9.59
			}
			5 = {
				desc = ev9.57.2.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				death = {
					death_reason = death_fight
					killer = scope:demon2
				}
			}
		}
	}
	option = {
		name = ev9.57.0.b
		trigger_event = magic_ev9.58
	}
}
#witch contract #9G - monster hunt - confrontation for the weak2
magic_ev9.58 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.58.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:demon2
		animation = schadenfreude
	}
	

	option = {
		name = ev9.58.0.a
		duel = {
			skill = prowess
			target = scope:demon2
			5 = {
				desc = ev9.57.1.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				scope:demon2 = {
					death = {
						death_reason = death_fight
						killer = root
					}
				}
				trigger_event = magic_ev9.59
			}
			5 = {
				desc = ev9.57.2.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				death = {
					death_reason = death_fight
					killer = scope:demon2
				}
			}
		}
	}
}

#witch contract #9H - monster hunt - won by sword
magic_ev9.59 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.59.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = scope:demon2
	lower_center_portrait = scope:employer

	option = {
		name = ev9.59.0.a
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
}

#witch contract #9I - monster hunt - confrontation for the powerful
magic_ev9.60 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.60.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:demon2
		animation = scheme
	}

	option = {
		name = ev9.60.0.a
		trigger_event = magic_ev9.61
	}
}

#witch contract #9J - monster hunt - confrontation for the powerful2
magic_ev9.61 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.61.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:demon2
		animation = eyeroll
	}

	option = {
		name = ev9.61.0.a
		trigger_event = magic_ev9.62
	}
}
#witch contract #9K - monster hunt - confrontation for the powerful3
magic_ev9.62 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.62.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:demon2
		animation = personality_rational
	}

	option = {
		name = ev9.62.0.a
		stress_impact = {
			paranoid = medium_stress_loss
		}
		trigger_event = magic_ev9.63
	}
	option = {
		name = ev9.62.0.b
		stress_impact = {
			paranoid = massive_stress_gain
			trusting = medium_stress_loss
		}
		trigger_event = magic_ev9.64
		show_as_tooltip = {
			add_courtier = scope:demon2
		}
	}
}
#witch contract #9L - monster hunt - confrontation for the powerful4 - fight
magic_ev9.63 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.63.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = personality_content
	}
	right_portrait = {
		character = scope:demon2
		animation = personality_rational
	}

	option = {
		name = ev9.63.0.a
		#custom_tooltip = start_duel_ct
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon2
		}
	}
	option = {
		name = ev9.63.0.b
		duel = {
			skill = prowess
			target = scope:demon2
			5 = {
				desc = ev9.57.1.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				scope:demon2 = {
					death = {
						death_reason = death_fight
						killer = root
					}
				}
				trigger_event = magic_ev9.59
			}
			5 = {
				desc = ev9.57.2.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				death = {
					death_reason = death_fight
					killer = scope:demon2
				}
			}
		}
	}
}
#witch contract #9M - monster hunt - bad ending for the naive
magic_ev9.64 = {
	title = laamp_magic_1009_desc_title
	desc = ev9.64.desc
	theme = realm
	override_background = { reference = wilderness_wetlands }
	left_portrait = {
		character = root
		animation = severelywounded
	}
	right_portrait = {
		character = scope:demon2
		animation = schadenfreude
	}
	immediate = {
		hidden_effect = {
			add_trait = wounded_3
		}
	}
	option = {
		name = ev9.64.0.a
		death = {
			death_reason = death_mysterious
			killer = scope:demon2
		}
	}
}

#tornado spell
magic_ev9.65 = {
	title = tornado_spell
	desc = ev9.65.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	lower_center_portrait = scope:recipient
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	immediate = {
		hidden_effect = {
			scope:recipient = {
				if = {
					limit = {
						any_army = {
							count > 1
						}
					}
					ordered_army = {
						order_by = army_size
						check_range_bounds = no
						position = 0
						save_scope_as = army1
					}
					ordered_army = {
						order_by = army_size
						check_range_bounds = no
						position = 1
						save_scope_as = army2
					}
				}
				else_if = {
					limit = {
						any_army = {
							count > 0
						}
					}
					ordered_army = {
						order_by = army_size
						check_range_bounds = no
						position = 0
						save_scope_as = army1
					}
				}
			}
		}
	}
	option = {
		name = ev9.65.0.c
		trigger = {
			exists = scope:army1
		}
		gain_cm_xp1_effect = yes
		spend_standard_ps_effect = yes
		set_variable = {
			name = tornado_type
			value = 0
		}
		show_as_tooltip = {
			tornado_spell_effect0 = yes
		}
		set_spell_id = { ID = 30 }
		execute_or_counter_spell_hidden_effect = { SID = 30 }
		
	}
	option = {
		name = ev9.65.0.d
		trigger = {
			exists = scope:army2
			NOT = {
				scope:army1.location = scope:army2.location
			}
		}
		gain_cm_xp1_effect = yes
		spend_standard_ps_effect = yes
		set_variable = {
			name = tornado_type
			value = 1
		}
		show_as_tooltip = {
			tornado_spell_effect1 = yes
		}
		set_spell_id = { ID = 30 }
		execute_or_counter_spell_hidden_effect = { SID = 30 }
		
	}
	option = {
		name = ev9.65.0.a
		trigger = {
			scope:recipient = {
				OR = {
					AND = {
						exists = capital_province
						NOT = {
							capital_province = location
						}
					}
					is_landed = no
				}
				trigger_if = {
					limit = {
						exists= scope:army1
					}
					NOT = {
						scope:army1.army_commander = scope:recipient
					}
				}
				trigger_if = {
					limit = {
						exists= scope:army2
					}
					NOT = {
						scope:army2.army_commander = scope:recipient
					}
				}
			}
		}
		gain_cm_xp1_effect = yes
		spend_standard_ps_effect = yes
		set_variable = {
			name = tornado_type
			value = 2
		}
		show_as_tooltip = {
			tornado_spell_effect2 = yes
		}
		set_spell_id = { ID = 30 }
		execute_or_counter_spell_hidden_effect = { SID = 30 }
		
	}
	option = {
		name = ev9.65.0.b
		trigger = {
			scope:recipient = {
				exists = capital_province
			}
		}
		gain_cm_xp1_effect = yes
		spend_standard_ps_effect = yes
		set_variable = {
			name = tornado_type
			value = 3
		}
		show_as_tooltip = {
			tornado_spell_effect3 = yes
		}
		set_spell_id = { ID = 30 }
		execute_or_counter_spell_hidden_effect = { SID = 30 }
		
	}
	option = {
		name = ev9.65.0.e
		custom_tooltip = ev9.65.0.e_ct
		hidden_effect = {
			remove_interaction_cooldown = tornado_spell
		}
	}
}
#create potion - alchemy 99+ - part 1.
magic_ev9.66 = {
	title = ev2.41.title
	type = character_event
	desc = ev2.41.desc
	theme = witchcraft
	left_portrait = root

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev2.41.a
		send_interface_toast = {
			title = ev2.41.title
			add_character_modifier = {
				modifier = witch_poison_modifier
				years = 3
			}
			add_character_modifier = {
				modifier = intrigue_risky_poison_experimentation_modifier
				years = 3
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				any_scheme = {
					is_hostile = yes
				}
			}
		}
	}
	option = {
		name = ev2.41.b
		send_interface_toast = {
			title = ev2.41.title
			add_character_modifier = {
				modifier = love_potions_modifier
				years = 3
			}
		}
		send_interface_toast = {
			title = ev2.41.title
			add_character_modifier = {
				modifier = intoxicating_perfume_modifier
				years = 3
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev2.41.c
		send_interface_toast = {
			title = ev2.41.title
			add_character_modifier = {
				modifier = health_potion_modifier
				years = 3
			}
		}
		send_interface_toast = {
			title = ev2.41.title
			add_character_modifier = {
				modifier = witch_brew_modifier
				years = 3
			}
		}
		if = { limit = { has_trait = wounded_1 }
			remove_trait = wounded_1
		}
		else_if = { limit = { has_trait = wounded_2 }
			remove_trait = wounded_2
		}
		else_if = { limit = { has_trait = wounded_3 }
			remove_trait = wounded_3
			add_trait_force_tooltip = wounded_1
		}
		else_if = { limit = { has_trait = ill }
			remove_trait = ill
		}
		else_if = { limit = { has_trait = maimed }
			random = {
				chance = 25
				remove_trait = maimed
			}
		}
		else_if = { limit = { has_trait = smallpox }
			random = {
				chance = 25
				remove_trait = smallpox
			}
		}
		else_if = {	limit = {	has_character_modifier = chronic_headaches_modifier	}
			remove_character_modifier = chronic_headaches_modifier
		}
		else_if = {	limit = {	has_character_modifier = malnourished_modifier	}
			remove_character_modifier = malnourished_modifier
		}
		else_if = {	limit = {	has_character_modifier = infected_wound_modifier	}
			remove_character_modifier = infected_wound_modifier
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				requires_magic_healing_trigger = yes
			}
		}
	}
	option = {
		name = ev9.66.0.a
		trigger = {
			OR = {
				is_true_mage = yes
				has_trait = true_witch
			}
		}
		custom_tooltip = ev2.41.d_ct
		trigger_event = magic_ev9.67
		#hidden_effect = {
		#	create_rare_potion_effect = {
		#		OWNER = root
		#	}
		#}
		ai_chance = {
			base = 20
		}
	}
}

#create potion - alchemy 99+ - part 2.
magic_ev9.67 = {
	title = ev2.41.title
	type = character_event
	desc = ev9.67.desc
	theme = witchcraft
	left_portrait = root

	trigger = {
		is_alive = yes
	}

	option = {
		name = pot1
		hidden_effect = {
			create_artifact = {	
				name = pot1
				description = pot1_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot1
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot1_ct
	}
	option = {
		name = pot3	#mutagen
		hidden_effect = {
			create_artifact = {	
				name = pot3
				description = pot3_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot3
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot3_ct
	}
	option = {
		name = pot2	#magic
		hidden_effect = {
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot2
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot2_ct
	}
	option = {
		name = pot7	#mind reading
		hidden_effect = {
			create_artifact = {	
				name = pot7
				description = pot7_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot7
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot7_ct
	}
	option = {
		name = elixir_fertility_modifier	#fertility
		hidden_effect = {
			create_artifact = {	
				name = elixir_fertility_modifier
				description = pot10_desc
				template=magical_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot10
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot10_ct
	}
	option = {
		name = ev9.67.0.a
		trigger_event = magic_ev9.68
	}
}
#create potion - alchemy 99+ - part 3.
magic_ev9.68 = {
	title = ev2.41.title
	type = character_event
	desc = ev9.67.desc
	theme = witchcraft
	left_portrait = root

	trigger = {
		is_alive = yes
	}

	option = {
		name = pot5
		hidden_effect = {
			create_artifact = {	
				name = pot5
				description = pot5_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot5
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot5_ct
	}
	option = {
		name = pot6
		hidden_effect = {
			create_artifact = {	
				name = pot6
				description = pot6_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot6
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot6_ct
	}
	option = {
		name = pot8
		hidden_effect = {
			create_artifact = {	
				name = pot8
				description = pot8_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot8
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot2_ct
	}
	option = {
		name = elixir_learning_modifier
		hidden_effect = {
			create_artifact = {	
				name = elixir_learning_modifier
				description = pot9_desc
				template=general_unique_template
				type = miscellaneous
				#type = elixir
				visuals = flask
				#visuals = fp2_armillary_sphere
				modifier = elixir_modifier
				#wealth = scope:wealth
				#quality = scope:quality
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot9
			}
			trigger_event = magic_ev10.45
		}
		custom_tooltip = gain_pot9_ct
	}
	option = {
		name = ev9.68.0.a
		trigger_event = magic_ev9.66
	}
}

#magic epic - special project - unlocks golem army
magic_ev9.69 = {
	type = character_event
	title = ev9.69.title
	desc = ev9.69.desc
	theme = witchcraft
	left_portrait = root
	lower_left_portrait = scope:golem
	trigger = {
		is_imprisoned = no
		scope:golem = {
			is_alive = yes
		}
	}
	
	option = {
		name = ev9.69.0.a
		custom_tooltip = me_golem2_project_ct
		hidden_effect = {
			add_character_flag = me_golem2_project
		}
	}
}
#magic epic - special project - golem4
magic_ev9.70 = {
	type = character_event
	title = ev9.70.title
	desc = ev9.70.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = scope:golem
	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:golem = {
			is_alive = yes
		}
	}
	
	option = {
		name = ev9.70.0.a
		scope:golem = {
			random_list = {
				1 = {
					trigger = {
						NOR = {
							has_trait = ambitious
							has_trait = content
							has_trait = arrogant
							has_trait = humble
						}
					}
					add_trait = ambitious
					add_trait = arrogant
				}
				1 = {
					trigger = {
						NOR = {
							has_trait = forgiving
							has_trait = vengeful
							has_trait = compassionate
							has_trait = sadistic
							has_trait = callous
						}
					}
					add_trait = forgiving
					add_trait = compassionate
				}
				1 = {
					trigger = {
						NOR = {
							has_trait = honest
							has_trait = deceitful
							has_trait = just
							has_trait = arbitrary
						}
					}
					add_trait = honest
					add_trait = just
				}
				1 = {
					trigger = {
						NOR = {
							has_trait = zealous
							has_trait = cynical
						}
					}
					add_trait = cynical
				}
			}
		}
	}
	option = {
		name = ev9.70.0.b
		scope:golem = {
			if = {
				limit = {
					has_trait = intellect_bad_3
				}
				remove_trait = intellect_bad_3
			}
			else_if = {
				limit = {
					NOR = {
						has_trait = intellect_bad_1
						has_trait = intellect_bad_2
						has_trait = intellect_bad_3
						has_trait = intellect_good_1
						has_trait = intellect_good_2
						has_trait = intellect_good_3
					}
				}
				add_trait = intellect_good_1
			}
		}
	}
	option = {
		name = ev9.70.0.c
		trigger = {
			scope:golem = {
				NOR = {
					has_trait = chaste
					has_trait = lustful
				}
			}
		}
		scope:golem = {
			set_sexuality = bisexual
			add_trait = lustful
		}
	}
	option = {
		name = ev9.70.0.d
		trigger = {
			scope:golem = {
				NOR = {
					has_trait = callous
					has_trait = compassionate
					has_trait = sadistic
				}
			}
		}
		scope:golem = {
			set_sexuality = asexual
			if = {
				limit = {
					has_trait = calm
				}
				remove_trait = calm
			}
			add_trait = callous
		}
	}
	after = {
		hidden_effect = {
			trigger_event = {
				id = magic_ev10.101
				years = 5
			}
		}
	}
}

#from magic triangulation - refusing offer
magic_ev9.71 = {
	type = character_event
	title = ev9.0.title
	desc = ev9.71.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = disappointed
	}
	right_portrait = {
		character = scope:second_mage
		animation = disapproval
	}
	immediate = {
		add_stress = minor_stress_gain
	}
	
	option = {
		name = ev9.71.0.a
		if = {
			limit = {
				NOT = {
					has_character_flag = special_magic_character
				}
			}
			set_relation_rival = scope:second_mage
		}
		else = {
			hidden_effect = {
				add_opinion = {
					target = scope:second_mage
					modifier = irritated_opinion
					opinion = -100
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}

	option = {
		name = tour_grounds_events.3017.a	#A pity.
		hidden_effect = {
			add_opinion = {
				target = scope:second_mage
				modifier = refusal_opinion
				opinion = -25
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 100
				has_character_flag = special_magic_character
			}
		}
	}
}

#landless canibal witch
magic_ev9.72 = {
	type = character_event
	title = ev9.72.title
	desc = ev9.72.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = interested
	}
	lower_right_portrait = scope:victim
	trigger = {
		NOT = {
			has_character_modifier = ate_good_meal
		}
		is_landless_adventurer = yes
		is_imprisoned = no
		any_living_character = {
			age < 10
			is_imprisoned = no
			OR = {
				has_trait = beauty_good_3
				has_trait = beauty_good_2
				has_trait = intellect_good_2
				has_trait = intellect_good_3
				has_trait = physique_good_3
				has_trait = physique_good_2
			}
			in_diplomatic_range = ROOT
			NOR = {
				is_courtier_of = ROOT
				is_foreign_court_or_pool_guest_of = ROOT
			}
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				has_character_modifier = ate_good_meal
			}
			trigger_event = {
				id = magic_ev9.72
				years = 3
			}
		}
	}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					age < 10
					is_imprisoned = no
					OR = {
						has_trait = beauty_good_3
						has_trait = beauty_good_2
						has_trait = intellect_good_2
						has_trait = intellect_good_3
						has_trait = physique_good_3
						has_trait = physique_good_2
					}
					in_diplomatic_range = ROOT
					NOR = {
						is_courtier_of = ROOT
						is_foreign_court_or_pool_guest_of = ROOT
					}
				}
				save_scope_as = victim
			}
		}
	}
	
	option = {
		name = ev9.72.0.a
		stress_impact = {
			compassionate = massive_stress_gain
			sadistic = major_stress_loss
			gluttonous = major_stress_loss
		}
		start_scheme = {
			type = abduct
			target_character = scope:victim
		}
		hidden_effect = {
			random = {
				chance = 50
				trigger_event = {
					id = magic_ev9.72
					years = 10
				}
			}
		}
	}

	option = {
		name = ev9.72.0.b
		stress_impact = {
			lazy = minor_stress_loss
			temperate = minor_stress_loss
		}
	}
}
#Mage Summit - congratulation
magic_ev9.73 = {
	type = activity_event
	title = ev9.73.title
	desc = ev9.73.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = {
		character = scope:mage0
		animation = toast_goblet
	}
	lower_center_portrait = scope:defeated

	trigger = {
		is_alive = yes
		has_variable = mage_defeated_list
		any_in_list = {
			list = mage_defeated_list
			has_trait = archmage
		}
		scope:activity = {
			any_attending_character = {
				NOR = {
					THIS = ROOT
					has_relation_rival = ROOT
					has_relation_nemesis = ROOT
					has_relation_mminion = ROOT
				}
				NOT = {
					ROOT = {
						is_target_in_variable_list = {
							name = mage_defeated_list
							target = PREV
						}
					}
				}
				has_trait = archmage
			}
		}
	}
	cooldown = {
		years = 30
	}
	immediate = {
		hidden_effect = {
			random_in_list = {
				variable = mage_defeated_list
				limit = {
					has_trait = archmage
				}
				save_scope_as = defeated
			}
			scope:activity = {
				random_attending_character = {
					limit = {
						NOR = {
							THIS = ROOT
							THIS = scope:defeated
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
							has_relation_mminion = ROOT
						}
						has_trait = archmage
					}
					save_scope_as = mage0
				}
			}
			
		}
	}
	
	option = {
		name = ev9.73.0.a
		stress_impact = {
			gregarious = medium_stress_loss
			lifestyle_reveler = minor_stress_loss
			shy = minor_stress_gain
		}
		scope:mage0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 10
			}
		}
	}
	option = {
		name = ev9.73.0.b
		add_prestige = minor_prestige_gain
		stress_impact = {
			arrogant = medium_stress_loss
			humble = minor_stress_gain
		}
	}
	option = {
		name = ev9.73.0.c
		stress_impact = {
			arrogant = minor_stress_gain
			humble = medium_stress_loss
			ambitious = minor_stress_gain
			content = minor_stress_loss
			eccentric = minor_stress_loss
		}
	}
	option = {
		name = ev9.73.0.d
		add_dread = minor_dread_gain
		stress_impact = {
			shy = minor_stress_loss
			sadistic = minor_stress_loss
			callous = minor_stress_loss
			forgiving = minor_stress_gain
			compassionate = minor_stress_gain			
		}
		scope:mage0 = {
			add_opinion = {
				target = ROOT
				modifier = scared_opinion
				opinion = -10
			}
		}
	}
}

#forbidden ritual pay the price 4.
magic_ev9.74 = {
	title = ev7.0.title
	#desc = ev9.74.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					is_landless_adventurer = yes
				}
				desc = ev9.74.desc2
			}
			desc = ev9.74.desc
		}
	}
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:target
	immediate = {
		if = {
			limit = {
				exists = player_heir
			}
			player_heir = {
				save_scope_as = target
			}
		}
	}

	option = {
		name = ev9.74.0.a
		if = {
			limit = {
				is_landless_adventurer = yes
			}
			location = {
				hidden_effect = {
					if = {
						limit = {
							has_province_modifier = power_extraction_modifier
						}
						remove_province_modifier = power_extraction_modifier
					}
				}
				add_province_modifier = {
					modifier = power_extraction_modifier
					years = 1
				}
			}
			if = {
				limit = {
					NOT = {
						has_trait = gallowsbait
					}
				}
				add_trait = gallowsbait
			}
			add_trait_xp = {
				trait = gallowsbait
				track = cultist
				value = 20
			}
		}
		else = {
			every_held_title = {
				limit = {
					tier = tier_county
				}
				if = {
					limit = {
						exists = title_province
						title_province = {
							NOT = {
								has_province_modifier = power_extraction_modifier
							}
						}
					}
					title_province = {
						add_province_modifier = {
							modifier = power_extraction_modifier
							years = 1
						}
					}
				}
			}
		}
		
		gain_standard_ps_effect = yes
		hidden_effect = {
			add_character_flag = {
				flag = forbidden_ritual4_flag
				years = 1
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				OR = {
					is_landed_or_landless_administrative = yes
					has_trait = gallowsbait
				}
			}
		}
	}
	option = {
		name = ev9.74.0.b
		trigger = {
			exists = player_heir
			player_heir = {
				NOR = {
					has_trait = weak
					is_a_demon_trigger = yes
					has_trait = physique_good_1
					has_trait = physique_good_2
					has_trait = physique_good_3
				}
			}
		}
		player_heir = {
			hidden_effect = {
				if = {
					limit = {
						has_trait = strong
					}
					remove_trait = strong
				}
			}
			add_trait = weak
			add_stress = major_stress_gain
		}
		gain_standard_ps_effect = yes
		hidden_effect = {
			add_character_flag = {
				flag = forbidden_ritual4_flag
				years = 1
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				OR = {
					has_trait = sadistic
					has_trait = ambitious
				}
			}
		}
	}
	option = {
		name = ev9.74.0.c
		trigger = {
			NOR = {
				has_trait = weak
				is_a_demon_trigger = yes
				has_trait = physique_good_1
				has_trait = physique_good_2
				has_trait = physique_good_3
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_trait = strong
				}
				remove_trait = strong
			}
		}
		add_trait = weak
		gain_standard_ps_effect = yes
		hidden_effect = {
			add_character_flag = {
				flag = forbidden_ritual4_flag
				years = 1
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				has_trait = ambitious
			}
		}
	}

	option = {
		name = ev7.0.b
		ai_chance = {
			base = 10
		}
	}
}
#blackgrimoire special
magic_ev9.75 = {
	type = character_event
	title = study_blackgrimoire_decision
	desc = ev9.75.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = shock
	}

	option = {
		name = ev9.75.0.a
		add_stress = major_stress_gain
		if = {
			limit = {
				is_true_mage = yes
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			add_trait_xp = {
				trait = archmage
				track = secret_knowledge
				value = 2
			}
		}
		else = {
			add_learning_skill = 1
		}
		if = {
			limit = {
				NOR = {
					has_trait = lunatic_1
					has_trait = lunatic_genetic
				}
			}
			random = {
				chance = 2
				add_trait = lunatic_1
			}
		}
		hidden_effect = {
			add_character_flag = used_magic_book_flag2
		}
	}
}

#moloch - second meeting - for sadistic characters
magic_ev9.76 = {
	title = moloch_name
	type = character_event
	desc = ev9.76.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = schadenfreude
	}
	right_portrait = {
		character = scope:demon
		animation = anger
	}
	
	option = {
		name = ev9.76.0.a
		stress_impact = {
			sadistic = medium_stress_loss
			craven = medium_stress_gain
		}
		custom_tooltip = start_duel_ct
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon
		}
	}
	option = {
		name = ev9.76.0.b
		stress_impact = {
			arrogant = medium_stress_loss
		}
		trigger_event = magic_ev.18
	}
}
#met Hecate second time - 1.
magic_ev9.77 = {
	title = ev4.85.title
	desc = ev9.77.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	lower_center_portrait = scope:rcourtier

	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			random_courtier = {
				limit = {
					exists = house
					house = root.house
					NOR = {
						THIS = ROOT
						has_character_flag = special_magic_character
						is_a_demon_trigger = yes
						has_trait = archmage
					}
				}
				save_scope_as = rcourtier
			}
			if = {
				limit = {
					NOT = {
						exists = scope:rcourtier
					}
				}
				random_courtier = {
					limit = {
						NOR = {
							THIS = ROOT
							has_character_flag = special_magic_character
							is_a_demon_trigger = yes
							has_trait = archmage
						}
					}
					save_scope_as = rcourtier
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:rcourtier
					}
				}
				house = {
					random_house_member = {
						limit = {
							NOR = {
								THIS = ROOT
								has_character_flag = special_magic_character
								is_a_demon_trigger = yes
								has_trait = archmage
							}
						}
						save_scope_as = rcourtier
					}
				}
			}
		}
	}
	option = {
		name = ev9.77.0.a
		trigger_event = magic_ev9.78
	}
	
}
#met Hecate second time - 2.
magic_ev9.78 = {
	title = ev4.85.title
	desc = ev9.78.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:demon
	lower_center_portrait = scope:rcourtier

	trigger = {
		is_alive = yes
	}
	option = {
		name = ev4.28.0.a	#Let it be.
		scope:rcourtier = {
			death = {
				death_reason = death_mysterious
				killer = scope:demon
			}
		}
		if = {
			limit = {
				is_true_mage = yes
				is_legendary_mage_trigger = no
			}
			gain_sc_xp2_effect = yes
			gain_cm_xp1_effect = yes
			gain_demonology_standard_effect = yes
			gain_al_xp_small_effect = yes
			add_learning_skill = 1
		}
		else_if = {
			limit = {
				has_trait = demon2
			}
			add_trait_xp = {
				trait = demon2
				track = hell_powers
				value = 10
			}
		}
		else = {
			add_diplomacy_skill = 2
			add_martial_skill = 2
			add_stewardship_skill = 2
			add_intrigue_skill = 2
			add_learning_skill = 2
		}
	}
	option = {
		name = ev9.78.0.a	#I want more power.
		trigger = {
			is_the_choosen_one_trigger = no
			has_trait = source
		}
		scope:rcourtier = {
			death = {
				death_reason = death_mysterious
				killer = scope:demon
			}
		}
		add_trait_xp = {
			trait = source
			track = magic_potential
			value = 5
		}
	}
	option = {
		name = ev4.86.0.e	#I don't like your offer, disappear.
	}
	after = {
		trigger_event = magic_ev.18
	}
}

#from laamp_clear_inappropriate_buildings_effect2
magic_ev9.79 = {
	hidden = yes

	immediate = {
		if = {
			limit = {
				exists = domicile
				domicile = { 
					OR = {
						has_domicile_building_or_higher = cult_caravan_01
						has_domicile_construction = cult_caravan_chapel
					}
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_chapel }
		}
		if = {
			limit = {
				exists = domicile
				domicile = { 
					OR = {
						has_domicile_building_or_higher = cult_caravan_01
						has_domicile_construction = cult_caravan_arms
					}
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_arms }
		}
		if = {
			limit = {
				exists = domicile
				domicile = { 
					OR = {
						has_domicile_building_or_higher = cult_caravan_01
						has_domicile_construction = cult_caravan_convertion
					}
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_convertion }
		}
		if = {
			limit = {
				exists = domicile
				domicile = { 
					OR = {
						has_domicile_building_or_higher = cult_caravan_01
						has_domicile_construction = cult_caravan_archive
					}
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_archive }
		}
		if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_01
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_01 }
		}
		else_if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_02
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_02 }
		}
		else_if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_03
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_03 }
		}
		else_if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_04
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_04 }
		}
		else_if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_05
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_05 }
		}
		else_if = {
			limit = {
				exists = domicile
				domicile = { 
					has_domicile_building = cult_caravan_06
				}
				NOT = { has_realm_law_flag = unlocks_cult_caravan }
			}
			domicile = { remove_domicile_building = cult_caravan_06 }
		}
		if = {
			limit = {
				exists = domicile
				domicile = {
					has_domicile_building_or_higher = baggage_train_01
					has_domicile_construction = fortune_tellers_tent_01
				}
				NOT = { has_realm_law_flag = unlocks_fortune_tellers_tent }
			}
			domicile = { remove_domicile_building = fortune_tellers_tent_01 }
		}
	}
}

#witch contract #10 - haunted manor
magic_ev9.80 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.80.desc
	theme = intrigue
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
	}
	option = {
		name = ev9.80.0.a
		stress_impact = {
			cynical = medium_stress_loss
		}
	}
	option = {
		name = ev9.80.0.b
	}
	after = {
		trigger_event = magic_ev9.81
	}
}
#witch contract #10 - haunted manor - 2.
magic_ev9.81 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.81.desc
	theme = intrigue
	left_portrait = {
		character = root
	}
	right_portrait = {
		character = scope:employer
		#animation = personality_callous
	}
	override_background = { reference = throne_room }
	option = {
		name = ev2.36.b
		custom_tooltip = ev9.81.0.b_ct
		trigger_event = {
			id = magic_ev9.82
			days = 3
		}
	}
	option = {
		name = ev9.81.0.a
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #10 - haunted manor - 3.
magic_ev9.82 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.82.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = interested
	}
	lower_right_portrait = scope:employer
	override_background = {
		reference = bedchamber
	}
	option = {
		name = ev9.82.0.a
		trigger_event = magic_ev9.83
	}
}
#witch contract #10 - haunted manor - 3.
magic_ev9.83 = {
	title = laamp_magic_1010_desc_title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = searching_ghosts_flag
				}
				desc = ev9.83.desc2
			}
			desc = ev9.83.desc
		}
	}
	theme = intrigue
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:employer
	override_background = { reference = corridor_night }
	option = {
		name = ev9.83.0.a
		duel = {
			skill = learning
			value = 18
			5 = {
				desc = ev9.83.1.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev9.55.0.a1_ct
				trigger_event = magic_ev9.87
			}
			5 = {
				desc = ev9.83.2.a
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				show_as_tooltip = {
					add_stress = minor_stress_gain
				}
				
				trigger_event = magic_ev9.84
			}
		}
	}
	option = {
		name = ev9.83.0.b
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
			}
			NOT = {
				has_character_flag = searching_ghosts_flag
			}
		}
		custom_tooltip = ev9.83.0.b_ct
		add_character_flag = searching_ghosts_flag
		trigger_event = magic_ev9.83
	}
}

#witch contract #10 - haunted manor - 4A.
magic_ev9.84 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.84.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = disappointed
	}
	lower_right_portrait = scope:employer
	override_background = { reference = corridor_night }
	immediate = {
		add_stress = minor_stress_gain
	}
	option = {
		name = ev9.84.0.a
		stress_impact = {
			craven = medium_stress_gain
		}
		trigger_event = magic_ev9.85
	}
	option = {
		name = ev9.84.0.b
		stress_impact = {
			brave = medium_stress_gain
		}
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #10 - haunted manor - 5A.
magic_ev9.85 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.85.desc
	theme = intrigue
	left_portrait = {
		character = root
	}
	lower_right_portrait = scope:employer
	override_background = {
		reference = bedchamber
	}
	option = {
		name = ev9.85.0.a
		trigger_event = {
			id = magic_ev9.86
			days = 1
		}
	}
	option = {
		name = ev9.85.0.b
		trigger = {
			OR = {
				has_trait = intellect_good_1
				has_trait = intellect_good_2
				has_trait = intellect_good_3
				has_trait = lifestyle_herbalist
				has_trait = shrewd
				has_trait = scholar
			}
		}
		custom_tooltip = ev9.85.0.b_ct
		trigger_event = magic_ev9.87
	}
}
#witch contract #10 - haunted manor - 6 - failure.
magic_ev9.86 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.86.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = sick
	}
	lower_right_portrait = scope:employer
	override_background = {
		reference = bedchamber
	}
	option = {
		name = ev9.86.0.a
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			complete_task_contract = failure_standard
		}
	}
}
#witch contract #10 - haunted manor - 4B.
magic_ev9.87 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.87.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:employer
	override_background = {
		reference = bedchamber
	}
	option = {
		name = ev9.87.0.a
		trigger_event = {
			id = magic_ev9.88
			days = 1
		}
	}
}
#witch contract #10 - haunted manor - 4C.
magic_ev9.88 = {
	title = laamp_magic_1010_desc_title
	desc = ev9.88.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = interested
	}
	lower_right_portrait = scope:employer
	override_background = { reference = dungeon }
	option = {
		name = ev9.88.0.a
		if = {
			limit = {
				is_true_mage = yes
			}
			gain_al_xp_small_effect = yes
		}
		else = {
			add_learning_skill = 1
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
	}
}

#witch contract #11 - rumors about artifacts...
magic_ev9.89 = {
	title = laamp_magic_1011_desc_title
	desc = ev9.89.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = spymaster
	}
	right_portrait = {
		character = scope:employer
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
	}
	option = {
		name = ev9.89.0.a
		pay_short_term_gold = {
			target = scope:employer
			gold = 200
		}
		custom_tooltip = laamp_magic_1011_ct1
		trigger_event = magic_ev9.90
	}
	option = {
		name = ev9.89.0.b
		duel = {
			skill = intrigue
			target = scope:employer
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = laamp_magic_1011_ct1
				trigger_event = magic_ev9.90
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:task_contract = {
						invalidate_contract = yes
					}
				}
			}
		}
	}
	option = {
		name = ev9.89.0.c
		trigger = {
			OR = {
				diplomacy > 25
				has_trait = diplomat
			}
			scope:employer = {
				NOT = {
					has_hook = ROOT
				}
			}
		}
		scope:employer = {
			add_hook = {
				type = favor_hook
				target = ROOT
			}
		}
		custom_tooltip = laamp_magic_1011_ct1
		trigger_event = magic_ev9.90
	}
	option = {
		name = ev9.89.0.e
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
				has_character_modifier = mind_reader_modifier
			}
		}
		trait = archmage
		show_as_unavailable = {
			is_true_mage = yes
			has_character_modifier = mind_reader_modifier
		}
		hidden_effect = {
			set_spell_id = { ID = 17 }
		}
		spend_standard_ps_effect = yes
		custom_tooltip = laamp_magic_1011_ct1
		trigger_event = magic_ev9.90
	}
	option = {
		name = ev9.89.0.d
		custom_tooltip = ev9.89.0.d_ct
		scope:task_contract = {
			invalidate_contract = yes
		}
	}
}

#witch contract #11 - rumors about artifacts... - part 2.
magic_ev9.90 = {
	title = laamp_magic_1011_desc_title
	desc = ev9.90.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = spymaster
	}
	lower_left_portrait = {
		character = scope:employer
	}

	lower_center_portrait = {
		character = scope:maowner
	}
	artifact = {
        target = scope:mart
        position = lower_right_portrait
    }
	immediate = {
		hidden_effect = {
			random_artifact = {
				limit = {
					exists = artifact_owner
					has_variable = magic1
					NOR = {
						any_artifact_claimant = {
							THIS = ROOT
						}
						artifact_owner = ROOT
						artifact_owner = scope:employer
					}
					artifact_owner = {
						in_diplomatic_range = ROOT
					}
				}
				save_scope_as = mart
			}
			if = {
				limit = {
					NOT = {
						exists = scope:mart
					}
				}
				random_artifact = {
					limit = {
						exists = artifact_owner
						has_variable = magic1
						NOR = {
							any_artifact_claimant = {
								THIS = ROOT
							}
							artifact_owner = ROOT
							artifact_owner = scope:employer
						}
					}
					save_scope_as = mart
				}
			}
			scope:mart = {
				artifact_owner = {
					save_scope_as = maowner
				}
			}
		}
	}
	option = {
		name = ev9.90.0.a
	}
	option = {
		name = ev9.90.0.b
		trigger = {
			OR = {
				has_trait = true_witch
				has_trait = archmage
				has_trait = greedy
			}
		}
		if = {
			limit = {
				NOR = {
					has_relation_rival = scope:maowner
					has_relation_nemesis = scope:maowner
				}
			}
			set_relation_rival = scope:maowner
		}
		random = {
			chance = 20
			send_interface_toast = {
				title = game_concept_artifact_claims
				add_personal_artifact_claim = scope:mart
			}
		}
	}
	option = {
		name = ev9.90.0.c
		trigger = {
			employs_court_position = master_thief_camp_officer
			in_diplomatic_range = scope:maowner
		}
		begin_scheme_with_agents_effect = {
			SCHEME_TYPE = steal_back_artifact
			TARGET_TYPE = target_character
			TARGET_SCOPE = scope:maowner
			# Success.
			AGENT_1 = agent_thief
			AGENT_2 = agent_thief
			# Speed.
			AGENT_3 = agent_infiltrator
			AGENT_4 = agent_infiltrator
			# Secrecy.
			AGENT_5 = agent_lookout
		}
		scope:new_scheme ?= {
			set_variable = {
				name = target_artifact
				value = scope:mart
			}
		}
	}
	after = {
		hidden_effect = {
			scope:task_contract = {
				complete_task_contract = success_standard
			}
		}
	}
}


#preparation for the ultimate spell
magic_ev9.91 = {
	title = grand_spell_decision_title
	desc = ev9.91.desc
	type = character_event
	#window = scheme_preparations_event
	theme = intrigue
	left_portrait = {
		character = ROOT
		animation = schadenfreude
	}
	right_portrait = {
		character = scope:p1
		animation = fear
	}
	lower_left_portrait = scope:p2
	lower_center_portrait = scope:p3
	lower_right_portrait = scope:p4
	#right_portrait = {
	#	character = scope:right_portrait
	#	scripted_animation = scheme_prep_pick_best_stance
	#}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	override_background = {
		reference = magic_temple
	}
	trigger = {
		exists = scope:scheme
	}
	immediate = {
		add_character_flag = currently_in_scheme_preparations
		hidden_effect = {
			scope:scheme = {
				random_scheme_agent_character = {
					save_scope_as = p1
				}
				random_scheme_agent_character = {
					limit = {
						always = yes
						trigger_if = {
							limit = {
								exists = scope:p1
							}
							NOT = { THIS = scope:p1 }
						}
					}
					save_scope_as = p2
				}
				random_scheme_agent_character = {
					limit = {
						always = yes
						trigger_if = {
							limit = {
								exists = scope:p1
							}
							NOT = { THIS = scope:p1 }
						}
						trigger_if = {
							limit = {
								exists = scope:p2
							}
							NOT = { THIS = scope:p2 }
						}
					}
					save_scope_as = p3
				}
				random_scheme_agent_character = {
					limit = {
						always = yes
						trigger_if = {
							limit = {
								exists = scope:p1
							}
							NOT = { THIS = scope:p1 }
						}
						trigger_if = {
							limit = {
								exists = scope:p2
							}
							NOT = { THIS = scope:p2 }
						}
						trigger_if = {
							limit = {
								exists = scope:p3
							}
							NOT = { THIS = scope:p3 }
						}
					}
					save_scope_as = p4
				}
			}
			
		}
	}
	option = {
		name = ev9.91.0.a
		trigger = {
			custom_description = {
				text = chance_is_too_low_custom
				scope:scheme = {
					scheme_success_chance > 0
				}
			}
			custom_description = {
				text = advantages_are_too_low_custom
				scope:scheme = { scheme_agent_charges >= 2 }
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			always = yes
		}
		spend_standard_ps_effect = yes
		gain_sc_xp2_effect = yes
		hidden_effect = {
			set_spell_id = { ID = 26 }
		}
		scope:scheme = {
			every_scheme_agent_slot = {
				limit = {
					is_filled = yes
					NOT = {
						is_agent_slot_type = agent_magic_assistant
					}
				}
				slot_character = {
					if = {
						limit = {
							NOT = {
								THIS = ROOT
							}
							can_spend_standard_ps_trigger = yes
						}
						custom_description_no_bullet = {
							text = empty_description1
						}
						spend_standard_ps_effect = yes
						gain_sc_xp1_effect = yes
						hidden_effect = {
							set_spell_id = { ID = 26 }
						}
					}
				}
			}
			random_list = {
				0 = {
					desc = ev3.52.a_1
					modifier = {
						always = yes
						add = scheme_success_chance
					}
					custom_tooltip = ev9.91.1.a_ct
					hidden_effect = {
						if = {
							limit = {
								scope:scheme = {
									exists = var:scheme_traitor
									any_scheme_agent_character = {
										THIS = scope:scheme.var:scheme_traitor
									}
								}
							}
							ROOT = {
								trigger_event = magic_ev10.106
							}
						}
						else = {
							ROOT = {
								trigger_event = magic_ev7.129
							}
						}
					}
				}
				0 = {
					desc = ev3.52.a_2
					modifier = {
						always = yes
						add = scheme_failure_chance
					}
					custom_tooltip = ev9.91.2.a_ct
					custom_tooltip = ev9.91.3.a_ct
					custom_tooltip = ev9.91.4.a_ct
					hidden_effect = {
						ROOT = {
							random_list = {
								6 = {
									trigger_event = magic_ev9.94
								}
								4 = {
									trigger = {
										NOt = {
											has_character_flag = weaken_ultimate_spell_flag
										}
									}
									trigger_event = magic_ev9.93
								}
							}
						}
					}
				}
			}
		}
		
		#scope:scheme = { end_scheme = yes }
	}

	option = {
		name = ev9.91.0.b

	}
	after = {
		remove_character_flag = currently_in_scheme_preparations
	}
}

#preparation for the ultimate spell - part 0 - decision
magic_ev9.92 = {
	title = grand_spell_decision_title
	desc = ev9.92.desc
	theme = intrigue
	left_portrait = {
		character = root
		animation = spymaster
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	
	option = {
		name = ev9.92.0.c
		trigger = {
			is_the_choosen_one_trigger = yes
			custom_description = {
				text = power_needed_custom2
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 99
				}
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
			is_the_choosen_one_trigger = yes
		}
		add_trait_xp = {
			trait = archmage
			track = power_saturation
			value = -100
		}

		custom_tooltip = ev9.92.0.c_ct
		hidden_effect = {
			set_spell_id = { ID = 26 }
		}
		trigger_event = magic_ev7.129
	}

	option = {
		name = ev9.92.0.a
		trigger = {
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			always = yes
		}
		spend_standard_ps_effect = yes
		custom_tooltip = ev9.92.0.a_ct

		hidden_effect = {
			set_spell_id = { ID = 26 }
			start_scheme = {
				type = ultimate_spell_cast
				target_character = ROOT
			}
		}
	}

	option = {
		name = ev9.92.0.b
		hidden_effect = {
			remove_decision_cooldown = grand_spell_decision
		}
	}
}

#preparation for the ultimate spell - critical failure
magic_ev9.93 = {
	title = ev9.93.title
	desc = ev9.93.desc
	theme = intrigue
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = {
		character = scope:p1
		animation = fear
	}
	lower_left_portrait = scope:p2
	lower_center_portrait = scope:p3
	lower_right_portrait = scope:p4
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	override_background = {
		reference = burning_building
	}
	immediate = {
		hidden_effect = {
			scope:scheme = {
				every_scheme_agent_character = {
					send_interface_toast = {
						title = ev9.94.title
						show_as_tooltip = {
							scope:scheme = {
								end_scheme = yes
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = harm.0541.a	#"..."
		if = {
			limit = {
				exists = location
			}
			location = {
				save_scope_as = cur_location
				add_province_modifier = {
					modifier = magical_radiation_modifier
					years = 1
				}
				add_province_modifier = {
					modifier = magic_damaged_walls_modifier
					years = 2
				}
			}
		}
		death = {
			death_reason = death_accident
		}
		scope:scheme = {
			every_scheme_agent_slot = {
				limit = {
					is_filled = yes
					NOT = {
						is_agent_slot_type = agent_magic_assistant
					}
				}
				slot_character = {
					death = {
						death_reason = death_accident
					}
				}
			}
		}
		
	}
	after = {
		hidden_effect = {
			scope:cur_location = {
				every_character_in_location = {
					limit = {
						NOR = {
							has_trait = cancer
							has_trait = golem
							has_trait = necromancer
						}
					}
					add_trait = cancer
				}
			}
			scope:scheme = {
				end_scheme = yes
			}
		}
	}
}

#preparation for the ultimate spell - regular failure
magic_ev9.94 = {
	title = ev9.94.title
	desc = ev9.94.desc
	theme = intrigue
	left_portrait = {
		character = ROOT
		animation = fear
	}
	right_portrait = {
		character = scope:p1
		animation = stress
	}
	lower_left_portrait = scope:p2
	lower_center_portrait = scope:p3
	lower_right_portrait = scope:p4
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	override_background = {
		reference = burning_building
	}
	immediate = {
		hidden_effect = {
			scope:scheme = {
				every_scheme_agent_character = {
					send_interface_toast = {
						title = ev9.94.title
						show_as_tooltip = {
							scope:scheme = {
								end_scheme = yes
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev9.94.0.a
		duel = {
			skill = learning
			value = 26
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					if = {
						limit = {
							NOT = {
								has_trait = disfigured
							}
						}
						add_trait = disfigured
					}
					scope:scheme = {
						end_scheme = yes
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				hidden_effect = {
					scope:scheme = {
						end_scheme = yes
					}
				}
				death = {
					death_reason = death_accident
				}
				scope:scheme = {
					every_scheme_agent_slot = {
						limit = {
							is_filled = yes
							NOT = {
								is_agent_slot_type = agent_magic_assistant
							}
						}
						slot_character = {
							death = {
								death_reason = death_accident
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev9.94.0.b
		trigger = {
			exists = scope:p1
		}
		add_stress = medium_stress_gain
		add_prestige_level = -1
		scope:p1 = {
			death = {
				death_reason = death_accident
			}
		}
		if = {
			limit = {
				exists = scope:p2
			}
			scope:p2 = {
				add_stress = major_stress_gain
			}
		}
		if = {
			limit = {
				exists = scope:p3
			}
			scope:p3 = {
				add_stress = major_stress_gain
			}
		}

		if = {
			limit = {
				exists = scope:p4
			}
			scope:p4 = {
				add_stress = major_stress_gain
			}
		}
		scope:scheme = {
			end_scheme = yes
		}
	}

	option = {
		name = ev2.66.a
		trigger = {
			has_trait = intellect_good_3
		}
		add_stress = massive_stress_gain
		if = {
			limit = {
				NOR = {
					has_trait = cancer
					has_trait = golem
					has_trait = necromancer
				}
			}
			random = {
				chance = 25
				add_trait = cancer
			}
		}
		
		scope:scheme = {
			end_scheme = yes
		}
	}
}
#ultimate spell ongoing - 1.
magic_ev9.95 = {
	type = character_event
	title = ev9.95.title
	desc = ev9.95.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = ROOT
		animation = spymaster
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	trigger = {
		exists = scope:scheme
		scope:scheme = {
			NOR = {
				has_scheme_modifier = ultimate_spell_stable_modifier
				has_scheme_modifier = ultimate_spell_stable_modifier
			}
		}
	}
	cooldown = { years = 4 }
	
	option = {
		name = ev9.95.0.a
		duel = {
			skill = learning
			value = 20
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:scheme = {
						add_scheme_modifier = {
							type = ultimate_spell_stable_modifier
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:scheme = {
						add_scheme_modifier = {
							type = ultimate_spell_unstable_modifier
						}
					}
				}
			}
		}
		stress_impact = {
			lazy = major_stress_gain
			diligent = major_stress_loss
			scholar = minor_stress_loss
		}
	}

	option = {
		name = ev9.95.0.b
		stress_impact = {
			trusting = medium_stress_loss
			brave = medium_stress_loss
			intellect_bad_1 = medium_stress_loss
			intellect_bad_2 = medium_stress_loss
			intellect_bad_3 = medium_stress_loss
		}
		random = {
			chance = 60
			send_interface_toast = {
				title = ev3.52.a_2
				scope:scheme = {
					add_scheme_modifier = {
						type = ultimate_spell_unstable_modifier
					}
				}
			}
		}
	}
}
#ultimate spell ongoing - 2.
magic_ev9.96 = {
	type = character_event
	title = ev9.96.title
	desc = ev9.96.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = ROOT
		animation = spymaster
	}
	right_portrait = {
		character = scope:p1
		animation = interested
	}
	lower_left_portrait = scope:p2
	lower_center_portrait = scope:p3
	lower_right_portrait = scope:p4
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	trigger = {
		exists = scope:scheme
	}
	cooldown = { years = 2 }
	immediate = {
		hidden_effect = {
			scope:scheme = {
				random_scheme_agent_character = {
					save_scope_as = p1
				}
				random_scheme_agent_character = {
					limit = {
						NOT = {
							THIS = scope:p1
						}
					}
					save_scope_as = p2
				}
				random_scheme_agent_character = {
					limit = {
						NOR = {
							THIS = scope:p1
							THIS = scope:p2
						}
					}
					save_scope_as = p3
				}
				random_scheme_agent_character = {
					limit = {
						NOR = {
							THIS = scope:p1
							THIS = scope:p2
							THIS = scope:p3
						}
					}
					save_scope_as = p4
				}
			}
			
		}
	}
	option = {
		name = ev9.96.0.a
		trigger = {
			custom_description = {
				text = power_needed_custom
				OR = {
					can_spend_standard_ps_trigger = yes
					scope:p1 ?= {
						can_spend_standard_ps_trigger = yes
					}
					scope:p2 ?= {
						can_spend_standard_ps_trigger = yes
					}
					scope:p3 ?= {
						can_spend_standard_ps_trigger = yes
					}
					scope:p4 ?= {
						can_spend_standard_ps_trigger = yes
					}
				}
			}
		}
		show_as_unavailable = {
			always = yes
		}
		spend_standard_ps_effect = yes
		scope:scheme = {
			every_scheme_agent_character = {
				limit = {
					NOT = { THIS = ROOT }
					can_spend_standard_ps_trigger = yes
				}
				custom_description_no_bullet = {
					text = empty_description1
				}
				send_interface_toast = {
					title = ev9.96.title
					spend_standard_ps_effect = yes
				}
			}
		}
		#if = {
		#	limit = {
		#		exists = scope:p1
		#		scope:p1 = {
		#			can_spend_standard_ps_trigger = yes
		#		}
		#	}
		#	scope:p1 = {
		#		send_interface_toast = {
		#			title = ev9.96.title
		#			spend_standard_ps_effect = yes
		#		}
		#	}
		#}
		
	}
	option = {
		name = ev9.96.0.b
		custom_tooltip = ev9.96.0.b_ct
		hidden_effect = {
			if = {
				limit = {
					Not = {
						has_character_flag = weaken_ultimate_spell_flag
					}
				}
			}
			add_character_flag = {
				flag = weaken_ultimate_spell_flag
				years = 5
			}
		}
	}
}
#ultimate spell ongoing - 3.
magic_ev9.97 = {
	type = character_event
	title = ev9.97.title
	desc = ev9.97.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = ROOT
		animation = interested
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	cooldown = { years = 4 }
	trigger = {
		exists = scope:scheme
		NOT = {
			has_character_flag = experiment_ultimate_spell_flag
		}
		has_trait = source
		has_trait_xp = {
			trait = source
			track = magic_potential
			value < 100
		}
	}
	option = {
		name = ev9.97.0.a
		random_list = {
			1 = {
				desc = ev3.52.a_1
				send_interface_toast = {
					title = ev3.52.a_1
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = 2
					}
				}
			}
			1 = {
				desc = ev3.52.a_2
				send_interface_toast = {
					title = ev3.52.a_2
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = -1
					}
					if = {
						limit = {
							NOT = {
								has_trait = disfigured
							}
						}
						add_trait = disfigured
					}
				}
			}
		}
	}
	option = {
		name = ev2.56.c
		gain_sc_xp1_effect = yes
	}
	after = {
		hidden_effect = {
			add_character_flag = experiment_ultimate_spell_flag
		}
	}
}

#additional to grand rite: heresiarch - dark gifts
magic_ev9.98 = {
	type = activity_event
	title = ev9.98.title
	desc = ev9.98.desc
	theme = witchcraft
	override_background = {
		reference = bp1_bonfire
	}
	left_portrait = {
		character = root
		animation = fear
	}
	
	option = {
		name = ev9.98.0.a
		add_character_flag = magic_ev_9_98_o1_flag
		add_stress = minor_stress_gain
	}
	option = {
		name = ev9.98.0.b
		add_character_flag = magic_ev_9_98_o2_flag
		add_stress = minor_stress_gain
	}
	option = {
		name = ev9.98.0.c
		add_character_flag = magic_ev_9_98_o3_flag
		add_stress = minor_stress_gain
	}
	after = {
		trigger_event = magic_ev9.99
	}
}
#additional to grand rite: heresiarch - dark gifts - part 2.
magic_ev9.99 = {
	type = activity_event
	title = ev9.98.title
	desc = ev9.99.desc
	theme = witchcraft
	override_background = {
		reference = bp1_bonfire
	}
	left_portrait = {
		character = root
		animation = shock
	}
	
	option = {
		name = ev9.99.0.a	#It was not a dream!
		trigger = {
			has_character_flag = magic_ev_9_98_o1_flag
		}
		add_character_modifier = {
			modifier = magic_claws_modifier
		}
	}

	option = {
		name = ev9.99.0.b	#My eyes!
		trigger = {
			has_character_flag = magic_ev_9_98_o2_flag
		}
		add_trait = blind
		add_character_modifier = {
			modifier = magic_eyes_modifier
		}
	}

	option = {
		name = ev7.121.a	#it's just a dream.
		trigger = {
			has_character_flag = magic_ev_9_98_o3_flag
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = magic_resonance
				}
				remove_character_modifier = magic_resonance
			}
		}
		add_character_modifier = {
			modifier = magic_resonance
			years = 4
		}
	}

	option = {
		name = ev9.99.0.c	#It was inspiring.
		trigger = {
			has_character_flag = magic_ev_9_98_o3_flag
			NOT = {
				has_trait = callous
			}
			number_of_personality_traits < 4
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_modifier = magic_resonance
				}
				remove_character_modifier = magic_resonance
			}
		}
		add_character_modifier = {
			modifier = magic_resonance
			years = 4
		}
		if = {
			limit = {
				has_trait = sadistic
			}
			remove_trait = sadistic
		}
		if = {
			limit = {
				has_trait = compassionate
			}
			remove_trait = compassionate
		}
		add_trait = callous
	}
	
}