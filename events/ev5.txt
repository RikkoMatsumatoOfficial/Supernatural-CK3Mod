namespace = magic_ev5

#caster perk (old healer perk)
magic_ev5.1 = {
	title = healer_p9_perk
	desc = ev5.1.desc
	theme = learning_scholarship_focus
	#left_portrait = root
	left_portrait = {
		character = root
		animation = chaplain
	}

	trigger = {
		is_alive = yes
		#is_ai = no
	}

	option = {
		name = ev5.1.0.a
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
	}
	option = {
		name = ev5.1.0.b
		trigger = {
			NOR = {
				has_trait = compassionate
				has_trait = trusting
				has_trait = generous
				has_trait = greedy
				has_trait = paranoid
				has_trait = sadistic
				has_trait = shy
				has_trait = callous
				has_trait = sadistic
				has_trait = diligent
				has_trait = eccentric
				has_trait = ambitious
				has_trait = fickle
				has_trait = patient
				is_the_choosen_one_trigger = yes
				has_trait = calm
			}
		}
		custom_tooltip = ev2.47.a_ct
		add_magic_lifestyle_perk_points = 1
		add_learning_skill = 1
	}
	option = {
		name = ev5.1.0.c
		trigger = {
			has_trait = compassionate
			NOR = {
				has_trait = generous
				has_trait = trusting
			}
		}
		trait = compassionate
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
	}
	option = {
		name = ev5.1.0.c
		trigger = {
			NOT = {	has_trait = compassionate	}
			has_trait = trusting
		}
		trait = trusting
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
	}
	option = {
		name = ev5.1.0.c
		trigger = {
			has_trait = generous
		}
		trait = generous
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
	}
	option = {
		name = ev5.1.0.d
		trigger = {
			has_trait = greedy
		}
		trait = greedy
		gain_standard_ps_effect = yes
		add_character_modifier = greedy_power_modifier
	}
	option = {
		name = ev5.1.0.e
		trigger = {
			has_trait = paranoid
			NOT = {
				has_trait = shy
			}
		}
		trait = paranoid
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
	}
	option = {
		name = ev5.1.0.e2
		trigger = {
			has_trait = shy
		}
		trait = shy
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
	}
	option = {
		name = ev5.1.0.f
		trigger = {
			has_trait = callous
			NOR = {
				has_trait = sadistic
				has_trait = wrathful
				has_trait = ambitious
			}
		}
		trait = callous
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
	}
	option = {
		name = ev5.1.0.f
		trigger = {
			has_trait = sadistic
			NOT = {
				has_trait = ambitious
			}
		}
		trait = sadistic
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
	}
	option = {
		name = ev5.1.0.f
		trigger = {
			has_trait = wrathful
			NOR = {
				has_trait = sadistic
				has_trait = ambitious
			}
		}
		trait = wrathful
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			has_trait = ambitious
			NOT = {
				has_trait = intellect_good_3
			}
		}
		trait = ambitious
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			has_trait = intellect_good_3
			is_the_choosen_one_trigger = no
		}
		trait = intellect_good_3
		#custom_tooltip = ev5.1.0.healing_ct
		#add_character_flag = healing_spell_flag
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			is_the_choosen_one_trigger = yes
		}
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
		custom_tooltip = ev5.1.0.h_ct
		add_character_flag = hipercognition_flag
		custom_tooltip = ev5.1.0.k_ct
		add_character_flag = firestorm_spell_flag
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
		custom_tooltip = ev5.1.0.l_ct
		add_character_flag = thorn_walls_spell_flag
	}
	option = {
		#name = ev5.1.0.g
		name = ev5.1.0.j
		trigger = {
			has_trait = diligent
			NOT = {
				has_trait = patient
				is_the_choosen_one_trigger = yes
			}
		}
		trait = diligent
		custom_tooltip = ev5.1.0.j_ct
		custom_tooltip = ev5.1.0.j_ct2
		trigger_event = {
			id = magic_ev5.7
			years = { 1 3 }
		}
		#custom_tooltip = ev5.1.0.g_ct
		#add_character_flag = unlock_magical_research_flag
	}
	option = {
		name = ev5.1.0.h
		trigger = {
			has_trait = eccentric
		}
		trait = eccentric
		custom_tooltip = ev5.1.0.h_ct
		add_character_flag = hipercognition_flag
	}
	option = {
		name = ev5.1.0.h2
		trigger = {
			has_trait = calm
		}
		trait = calm
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
	}
	option = {
		name = ev5.1.0.i
		trigger = {
			has_trait = fickle
			NOT = {
				has_trait = patient
				is_the_choosen_one_trigger = yes
			}
		}
		trait = fickle
		custom_tooltip = ev5.1.0.i_ct
		hidden_effect = {
			random_list = {
				1 = {
					trigger = {
						is_landed = yes
					}
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.a_ct
					}
					add_character_flag = bless_land_flag
				}
				1 = {
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.healing_ct
					}
					add_character_flag = healing_spell_flag
				}
				1 = {
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.e_ct
					}
					add_character_flag = shadowstep_flag
				}
				1 = {
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.f_ct
					}
					add_character_flag = plague_spell_flag
				}
				1 = {
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.h_ct
					}
					add_character_flag = hipercognition_flag
				}
				1 = {
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = aura_reading_spell_got_it
					}
					add_character_flag = aura_reading_spell
				}
				1 = {
					trigger = {
						is_landed = yes
					}
					send_interface_toast = {
						title = healer_p9_perk
						custom_tooltip = ev5.1.0.l_ct
					}
					add_character_flag = thorn_walls_spell_flag
				}
			}
		}
	}
	option = {
		name = ev5.1.0.j
		trigger = {
			has_trait = patient
			is_the_choosen_one_trigger = no
		}
		trait = patient
		custom_tooltip = ev5.1.0.j_ct
		custom_tooltip = ev5.1.0.j_ct2
		trigger_event = {
			id = magic_ev5.7
			years = { 1 3 }
		}
	}
	option = {
		name = ev5.1.0.k
		trigger = {
			has_trait = lunatic_1
			is_the_choosen_one_trigger = no
		}
		trait = lunatic_1
		custom_tooltip = ev5.1.0.k_ct
		add_character_flag = firestorm_spell_flag
	}
	option = {
		name = ev5.1.0.k
		trigger = {
			has_trait = lunatic_genetic
			NOR = {
				has_trait = lunatic_1
				is_the_choosen_one_trigger = yes
			}
		}
		trait = lunatic_genetic
		custom_tooltip = ev5.1.0.k_ct
		add_character_flag = firestorm_spell_flag
	}
	option = {
		name = ev5.1.0.l
		trigger = {
			is_landed = yes
			NOT = {
				is_the_choosen_one_trigger = yes
			}
			OR = {
				has_trait = education_martial_2
				has_trait = education_martial_3
				has_trait = education_martial_4
				has_trait = education_martial_5
				has_trait = unyielding_defender
			}
		}
		custom_tooltip = ev5.1.0.l_ct
		add_character_flag = thorn_walls_spell_flag
	}
}

#plague spell effect
magic_ev5.2 = {
	title = ev5.2.title
	desc = ev5.2.desc
	theme = recovery
	left_portrait = {
		character = root
		animation = sick
	}

	trigger = {
		is_alive = yes
	}

	immediate = {
		#add_trait = great_pox
		add_character_modifier = {
			modifier = plague_spell_modifier
			years = 2
		}
		if = {
			limit = {
				is_landed = yes
			}
			capital_province = {
				create_epidemic_outbreak = {
					type = consumption
					intensity = major
				}
			}
		}
		else = {
			location = {
				create_epidemic_outbreak = {
					type = consumption
					intensity = major
				}
			}
		}
	}

	option = {
		name = ev5.2.0.a
		trigger = {
			NOT = {
				root = scope:actor
			}
		}
		add_stress = medium_stress_gain
		
	}
	option = {
		name = ev5.21.0.b
		trigger = {
			root = scope:actor
		}
	}
}
#4 suicide effect
magic_ev5.3 = {
	hidden = yes
	type = character_event
	trigger = {
		is_alive = yes
	}
	immediate = {
		committed_suicide_effect = yes
	}
}

#Power Strike - I'm hit!
magic_ev5.4 = {
	title = ev5.4.title
	desc = ev5.4.desc
	theme = realm
	left_portrait = {
		character = root
		animation = pain
	}
	right_portrait = scope:actor
	trigger = {
		is_alive = yes
	}

	immediate = {
		add_trait = wounded_3
		add_stress = massive_stress_gain
		random = {
			chance = 20
			if = {
				limit = {
					NOT = {	has_trait = disfigured	}
				}
				add_trait = disfigured
			}
		}
	}

	option = {
		name = ev5.4.0.a
		trigger = {
			OR = {
				is_vassal_of = scope:actor
				is_courtier_of = scope:actor
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = loyal
				}
			}
			if = {
				limit = {
					has_trait = disloyal
				}
				remove_trait = disloyal
			}
			scope:actor = {
				send_interface_toast = {
					title = power_strike
					root = {
						add_trait = loyal
					}
				}
			}
		}
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = humble
					has_trait = arrogant
				}
			}
			add_trait = humble
		}
	}
	option = {
		name = ev5.4.0.b
		trigger = {
			OR = {
				is_vassal_of = scope:actor
				is_courtier_of = scope:actor
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = disloyal
				}
			}
			if = {
				limit = {
					has_trait = loyal
				}
				remove_trait = loyal
			}
			scope:actor = {
				send_interface_toast = {
					title = power_strike
					root = {
						add_trait = disloyal
					}
				}
			}
		}
		add_opinion = {
			target = scope:actor
			modifier = use_magic_on_me_opinion
		}
	}
	option = {
		name = ev4.14.0.b
		trigger = {
			root = scope:owner1
		}
		set_relation_rival = scope:actor
		add_opinion = {
			target = scope:actor
			modifier = use_magic_on_me_opinion
		}
		scope:actor = {
			trigger_event = magic_ev5.5
		}
	}
	option = {
		name = ev5.4.0.a
		trigger = {
			NOR = {
				is_vassal_of = scope:actor
				is_courtier_of = scope:actor
			}
		}
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = humble
					has_trait = arrogant
				}
			}
			scope:actor = {
				send_interface_toast = {
					title = power_strike
					root = {
						add_trait = humble
					}
				}
			}
		}
	}
	option = {
		name = ev5.4.0.b
		trigger = {
			NOR = {
				is_vassal_of = scope:actor
				is_courtier_of = scope:actor
			}
		}
		if = {
			limit = {
				number_of_personality_traits < 4
				NOR = {
					has_trait = forgiving
					has_trait = vengeful
				}
			}
			add_trait = vengeful
		}
		if = {
			limit = {
				NOR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
				}
			}
			set_relation_rival = scope:actor
		}
		else_if = {
			limit = {
				has_relation_rival = scope:actor
			}
			hidden_effect = {
				remove_relation_rival = scope:actor
			}
			set_relation_nemesis = scope:actor
		}
		add_opinion = {
			target = scope:actor
			modifier = use_magic_on_me_opinion
		}
	}
}

magic_ev5.5 = {
	title = ev5.5.title
	desc = ev5.5.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:owner1
		animation = fear
	}

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev5.5.0.a
		duel = {
			skill = intrigue
			value = 18
			5 = {
				desc = ev5.5.0.a_ct
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				send_interface_toast = {
					title=ev5.5.title
					custom_tooltip = ev5.5.0.a_ct
				}
				hidden_effect = {
					scope:owner1 = {
						send_interface_toast = {
							title=ev5.5.title2
							left_icon = root
							custom_tooltip = ev5.5.0.a_ct
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title=ev5.5.title
					#imprison_character_effect = {
					#	TARGET = scope:actor
					#	IMPRISONER = scope:owner1
					#}
					scope:owner1 = {
						imprison = {
							target = scope:actor
							type = dungeon
						}
					}
				}
			}
		}
	}
	option = {
		name = ev5.5.0.b
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		custom_tooltip = ev5.5.0.b_ct
		spend_standard_ps_effect = yes
		add_dread = major_dread_gain
		every_living_character = {
			limit = {
				this.location = root.location
				NOR = {
					this = root
				}
			}
			show_as_tooltip = {
				if = {
					limit = {
						OR = {
							has_trait = sadistic
							is_a_demon_trigger = yes
						}
					}
					add_stress = medium_stress_loss
				}
				else_if = {
					limit = {
						NOR = {
							has_trait = archmage
							has_trait = true_witch
						}
					}
					add_stress = medium_stress_gain
				}
			}
			trigger_event = magic_ev5.6
		}
	}
	option = {
		name = ev5.5.0.b2
		trigger = {
			NOT = {	has_trait = archmage	}
			is_a_demon_trigger = yes
		}
		trait = demon1
		custom_tooltip = ev5.5.0.b_ct
		add_dread = major_dread_gain
		every_living_character = {
			limit = {
				this.location = root.location
				NOR = {
					this = root
				}
			}
			show_as_tooltip = {
				if = {
					limit = {
						OR = {
							has_trait = sadistic
							is_a_demon_trigger = yes
						}
					}
					add_stress = medium_stress_loss
				}
				else_if = {
					limit = {
						NOR = {
							has_trait = archmage
							has_trait = true_witch
						}
					}
					add_stress = medium_stress_gain
				}
			}
			trigger_event = magic_ev5.6
		}
	}
	option = {
		name = ev5.5.0.c
		send_interface_toast = {
			title=ev5.5.title
			#imprison_character_effect = {
			#	TARGET = scope:actor
			#	IMPRISONER = scope:owner1
			#}
			scope:owner1 = {
				imprison = {
					target = scope:actor
					type = dungeon
				}
			}
		}
	}
}
magic_ev5.6 = {
	title = power_strike
	desc = ev5.6.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:actor

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev5.6.0.a
		trigger = {
			NOR = {
				has_trait = sadistic
				is_a_demon_trigger = yes
				has_trait = archmage
				has_trait = true_witch
			}
		}
		add_stress = medium_stress_gain
	}
	option = {
		name = ev5.6.0.a
		trigger = {
			NOT = {
				is_a_demon_trigger = yes
			}
			has_trait = sadistic
		}
		trait = sadistic
		add_stress = medium_stress_loss
	}
	option = {
		name = ev5.6.0.a
		trigger = {
			is_a_demon_trigger = yes
		}
		trait = demon1
		add_stress = medium_stress_loss
	}
	option = {
		name = ev5.6.0.a
		trigger = {
			OR = {
				has_trait = true_witch
				has_trait = archmage
			}
			NOR = {
				has_trait = sadistic
				is_a_demon_trigger = yes
			}
		}

	}
}

#caster perk - patient/diligent option
magic_ev5.7 = {
	title = healer_p9_perk
	desc = ev5.1.desc
	theme = learning_scholarship_focus
	#left_portrait = root
	left_portrait = {
		character = root
		animation = chaplain
	}

	trigger = {
		is_alive = yes
		#is_ai = no
	}

	option = {
		name = ev5.1.0.a
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
	}
	option = {
		name = ev5.1.0.c
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
	}
	option = {
		name = ev5.1.0.e
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
	}
	option = {
		name = ev5.1.0.f
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			has_trait = ambitious
			NOR = {
				has_trait = intellect_good_3
				is_the_choosen_one_trigger = yes
			}
		}
		trait = ambitious
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			has_trait = intellect_good_3
			is_the_choosen_one_trigger = no
		}
		trait = intellect_good_3
		#custom_tooltip = ev5.1.0.healing_ct
		#add_character_flag = healing_spell_flag
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
	}
	option = {
		name = ev5.1.0.h
		trigger = {
			has_trait = eccentric
			NOR = {
				has_trait = ambitious
				has_trait = intellect_good_3
			}
		}
		trait = eccentric
		custom_tooltip = ev5.1.0.h_ct
		add_character_flag = hipercognition_flag
	}
	option = {
		name = ev5.1.0.h2
		trigger = {
			has_trait = calm
		}
		trait = calm
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
	}
	option = {
		name = ev5.1.0.l
		trigger = {
			OR = {
				has_trait = education_martial_2
				has_trait = education_martial_3
				has_trait = education_martial_4
				has_trait = education_martial_5
				has_trait = unyielding_defender
			}
		}
		custom_tooltip = ev5.1.0.l_ct
		add_character_flag = thorn_walls_spell_flag
	}
	option = {
		name = ev5.1.0.g1
		trigger = {
			is_the_choosen_one_trigger = yes
		}
		custom_tooltip = ev5.1.0.healing_ct
		add_character_flag = healing_spell_flag
		custom_tooltip = ev5.1.0.a_ct
		add_character_flag = bless_land_flag
		custom_tooltip = ev5.1.0.e_ct
		add_character_flag = shadowstep_flag
		custom_tooltip = ev5.1.0.f_ct
		add_character_flag = plague_spell_flag
		custom_tooltip = ev5.1.0.h_ct
		add_character_flag = hipercognition_flag
		custom_tooltip = ev5.1.0.k_ct
		add_character_flag = firestorm_spell_flag
		custom_tooltip = aura_reading_spell_got_it
		add_character_flag = aura_reading_spell
		custom_tooltip = ev5.1.0.l_ct
		add_character_flag = thorn_walls_spell_flag
	}
}

magic_ev5.8 = {
	title = archmage
	desc = ev5.8.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:actor
	lower_right_portrait = scope:recipient

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev5.8.0.a
		stress_impact = {
			sadistic = minor_stress_loss
			compassionate = minor_stress_gain
			craven = medium_stress_gain
			arrogant = minor_stress_gain
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev4.14.0.b
		trigger = {
			root = scope:owner1
		}
		scope:actor = {
			trigger_event = magic_ev5.5
		}
		stress_impact = {
			craven = major_stress_gain
			just = medium_stress_loss
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 50
				opinion = { target = scope:actor value < 0 }
			}
		}
	}
}

## ARRIVAL EVENT 4 artifacts searching
magic_ev5.9 = {
	type = activity_event
	title = ev5.9.title
	desc = ev5.9.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev2.7.a
		add_prestige = minor_prestige_gain
		stress_impact = {
			lazy = minor_stress_gain
			diligent = minor_stress_loss
			ambitious = minor_stress_loss
		}
	}
}

#artifacts searching 1. - more books
magic_ev5.10 = {
	type = activity_event
	title = ev5.10.title
	desc = ev5.10.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev2.2.a
		remove_short_term_gold = medium_gold_value
		stress_impact = {
			greedy = minor_stress_gain
		}
		random_list = {
			8 = {
				custom_tooltip = artifacts_searching_tt_positive_medium
				if = {
					limit = {
						any_character_artifact = {
							has_variable = magic1
						}
					}
					scope:activity = { activity_special_type_progression_medium = yes }
				}
				else = {
					scope:activity = { activity_special_type_progression_major = yes }
				}
				
			}
			2 = {

			}
		}
	}
	option = {
		name = ev5.10.0.a
		stress_impact = {
			ambitious = minor_stress_gain
			lazy = medium_stress_loss
		}
	}
}

#artifacts searching 2. - send my men
magic_ev5.11 = {
	type = activity_event
	title = ev5.11.title
	desc = ev5.11.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev5.11.0.a
		custom_tooltip = artifacts_searching_tt_positive_tiny
		scope:activity = { activity_special_type_progression_tiny = yes }
	}
	option = {
		name = ev5.11.0.b
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
		custom_tooltip = ev5.11.0.b_ct
		hidden_effect = {
			random = {
				chance = 5
				create_character = {
					employer = root
					template = witch_hunter_character
					save_scope_as = whunter
				}
			}
			add_character_flag = observed_by_whunters
		}
	}
	option = {
		name = ev5.11.0.c
		trigger = {
			has_trait = torturer
		}
		trait = torturer
		custom_tooltip = artifacts_searching_tt_positive_major
		custom_tooltip = ev5.11.0.b_ct
		
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { 
				change_variable = {
					name = activity_special_type_progression
					add = 10
				}
			}
		}
		else = {
			scope:activity = { 
				change_variable = {
					name = activity_special_type_progression
					add = 20
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = extorted_vassals_modifier
				}
			}
			add_character_modifier = {
				modifier = extorted_vassals_modifier
				months = 6
			}
		}
		add_tyranny = minor_tyranny_gain
		hidden_effect = {
			random = {
				chance = 20
				create_character = {
					employer = root
					template = witch_hunter_character
					save_scope_as = whunter
				}
			}
			add_character_flag = observed_by_whunters
		}
	}
}

#artifacts searching 3. - spy master
magic_ev5.12 = {
	type = activity_event
	title = councillor_spymaster
	desc = ev5.12.desc
	theme = learning_scholarship_focus

	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = cp:councillor_spymaster
		animation = spymaster
	}

	trigger = {
		exists = cp:councillor_spymaster
		cp:councillor_spymaster = {
			NOT = {
				has_character_modifier = additional_tasks_modifier
			}
		}
	}

	option = {
		name = ev5.12.0.a
		
	}
	option = {
		name = ev5.12.0.b
		cp:councillor_spymaster = {
			add_character_modifier = {
				modifier = additional_tasks_modifier
				months = 6
			}
		}
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_major = yes }
	}
}

#artifacts searching 4. - book
magic_ev5.13 = {
	type = activity_event
	title = ev5.13.title
	desc = ev5.13.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev5.13.0.a
		duel = {
			skill = learning
			value = 12
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_medium
				
				if = {
					limit = {
						any_character_artifact = {
							has_variable = magic1
						}
					}
					scope:activity = { activity_special_type_progression_medium = yes }
				}
				else = {
					scope:activity = { activity_special_type_progression_major = yes }
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				
			}
		}
	}
	option = {
		name = ev5.13.0.b
		trigger = {
			has_trait = intellect_good_2
		}
		trait = intellect_good_2
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
	}
	option = {
		name = ev5.13.0.b
		trigger = {
			has_trait = intellect_good_3
		}
		trait = intellect_good_3
		custom_tooltip = artifacts_searching_tt_positive_major
		
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { 
				change_variable = {
					name = activity_special_type_progression
					add = 10
				}
			}
		}
		else = {
			scope:activity = { 
				change_variable = {
					name = activity_special_type_progression
					add = 20
				}
			}
		}
	}
	option = {
		name = ev5.13.0.c
		trigger = {
			has_trait = patient
		}
		trait = patient
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
	}
	option = {
		name = ev5.13.0.c
		trigger = {
			has_trait = diligent
			NOT = {
				has_trait = patient
			}
		}
		trait = diligent
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
	}
	option = {
		name = ev5.13.0.d
		remove_short_term_gold = medium_gold_value
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
	}
}

#artifacts searching 5. - whunters
magic_ev5.14 = {
	type = activity_event
	title = ev30.0.title
	desc = ev5.14.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = {
		NOT = {
			has_character_flag = observed_by_whunters
		}
	}
	cooldown = {
		years = 5
	}
	option = {
		name = ev5.14.0.a
		custom_tooltip = artifacts_searching_tt_negative_medium
		scope:activity = { 
			change_variable = {
				name = activity_special_type_progression
				add = -10
			}
		}
	}
	option = {
		name = ev5.14.0.b
		custom_tooltip = ev5.11.0.c_ct
		

		hidden_effect = {
			mark_as_black_magic_caster_effect = { L = 1 }
			add_character_flag = observed_by_whunters
		}
	}
}

#artifacts searching 6. - familiar
magic_ev5.15 = {
	type = activity_event
	title = witch_familiar_perk_name1
	desc = ev5.15.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	trigger = {
		OR = {
			has_character_modifier = witch_familiar_modifier1
			has_character_modifier = witch_familiar_modifier2
			has_character_modifier = witch_familiar_modifier3
			has_character_modifier = witch_familiar_modifier4
			has_character_modifier = witch_familiar_modifier5
		}
	}
	option = {
		name = ev5.15.0.a
		if = {
			limit = {
				has_character_modifier = witch_familiar_modifier1
			}
			remove_character_modifier = witch_familiar_modifier1
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier2
			}
			remove_character_modifier = witch_familiar_modifier2
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier3
			}
			remove_character_modifier = witch_familiar_modifier3
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier4
			}
			remove_character_modifier = witch_familiar_modifier4
		}
		else_if = {
			limit = {
				has_character_modifier = witch_familiar_modifier5
			}
			remove_character_modifier = witch_familiar_modifier5
		}
		random_list = {
			1 = {
				custom_tooltip = artifacts_searching_tt_positive_tiny
				scope:activity = { activity_special_type_progression_tiny = yes }
			}
			1 = {
				custom_tooltip = artifacts_searching_tt_positive_medium
				scope:activity = { activity_special_type_progression_medium = yes }
			}
			1 = {
				custom_tooltip = artifacts_searching_tt_positive_major
				scope:activity = {
					change_variable = {
						name = activity_special_type_progression
						add = 10
					}
				}
			}
		}
		stress_impact = {
			compassionate = minor_stress_gain
		}
	}
	option = {
		name = ev2.66.a
		if = {
			limit = {
				has_trait = eccentric
			}
			stress_impact = {
				eccentric = minor_stress_loss
			}
		}
		else = {
			add_stress = minor_stress_gain
		}
		duel = {
			skill = learning
			value = 20
			5 = {
				desc = ev3.33.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_medium
				scope:activity = { activity_special_type_progression_medium = yes }
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}

			}
		}
	}
	option = {
		name = ev5.15.0.b
		remove_short_term_gold = minor_gold_min_value
		custom_tooltip = artifacts_searching_tt_positive_tiny
		scope:activity = { activity_special_type_progression_tiny = yes }
	}
}

#artifacts searching 7. - stress
magic_ev5.16 = {
	type = activity_event
	title = ev5.16.title
	desc = ev5.16.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev5.16.0.a
		stress_impact = {
			diligent = minor_stress_gain
			ambitious = medium_stress_gain
			lazy = minor_stress_loss
			impatient = minor_stress_gain
			patient = minor_stress_loss
			stubborn = minor_stress_gain
		}
	}
	option = {
		name = ev5.16.0.b
		if = {
			limit = {
				has_trait = stubborn
			}
			stress_impact = {
				stubborn = minor_stress_loss
			}
		}
		else = {
			add_stress = medium_stress_gain
		}
		custom_tooltip = artifacts_searching_tt_positive_tiny
		scope:activity = { activity_special_type_progression_tiny = yes }
	}
	option = {
		name = ev5.16.0.c
		trigger = {
			has_trait = lifestyle_mystic
		}
		trait = lifestyle_mystic
		stress_impact = {
			fickle = minor_stress_loss
		}
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_medium = yes }
	}
}

#artifacts searching 8. - realm
magic_ev5.17 = {
	type = activity_event
	title = ev5.17.title
	desc = ev5.17.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev5.17.0.a
		add_prestige = -500
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_medium = yes }
	}
	option = {
		name = ev5.17.0.b
		custom_tooltip = artifacts_searching_tt_negative_medium
		scope:activity = { 
			change_variable = {
				name = activity_special_type_progression
				add = -10
			}
		}
	}
	option = {
		name = ev5.17.0.c
		trigger = {
			diplomacy > 19
		}
		skill = diplomacy
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_medium = yes }
	}
}
#artifacts searching 9. - artifacts hunter
magic_ev5.18 = {
	type = activity_event
	title = artifact_hunter
	desc = ev5.18.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}

	option = {
		name = ev5.18.0.a
		custom_tooltip = artifacts_searching_tt_positive_major
		
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = {
				change_variable = {
					name = activity_special_type_progression
					add = 10
				}
			}
		}
		else = {
			scope:activity = {
				change_variable = {
					name = activity_special_type_progression
					add = 20
				}
			}
		}
	}
	option = {
		name = ev5.18.0.b
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_medium = yes }
		}
		else = {
			scope:activity = { activity_special_type_progression_major = yes }
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = artifact_hunter
				}
			}
			add_character_modifier = {
				modifier = artifact_hunter
				years = 5
			}
		}
	}
	option = {
		name = ev5.16.0.a
		trigger = {
			has_trait = lazy
		}
		trait = lazy
		custom_tooltip = artifacts_searching_tt_positive_tiny
		scope:activity = { activity_special_type_progression_tiny = yes }
		add_stress = medium_stress_loss
	}
}
#artifacts searching 10. - place of power
magic_ev5.19 = {
	type = activity_event
	title = ev4.82.0.b
	desc = ev5.19.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}
	trigger = {
		any_ruler = {
			NOT = {	THIS = ROOT	}
			has_power_place_trigger = yes
		}
	}
	immediate = {
		random_ruler = {
			limit = {
				NOT = {	THIS = ROOT	}
				has_power_place_trigger = yes
			}
			save_scope_as = owner_p
		}
	}
	option = {
		name = ev2.36.b
		custom_tooltip = ev5.19.0.b_ct
		trigger_event = magic_ev5.20
	}
	option = {
		name = ev5.19.0.a
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_medium = yes }
	}
}
#artifacts searching 10. - place of power, part 2.
magic_ev5.20 = {
	type = activity_event
	title = ev4.82.0.b
	desc = ev5.20.desc
	theme = learning_scholarship_focus

	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:owner_p

	immediate = {
		random_ruler = {
			limit = {
				NOT = {	THIS = ROOT	}
				has_power_place_trigger = yes
			}
			save_scope_as = owner_p
		}
		scope:owner_p = {
			random_held_county = {
				limit = {
					any_county_province = {
						OR = {
							has_building_or_higher = witch_house
							has_building_or_higher = horned_god_house
							has_building_or_higher = mage_house
						}
					}
				}
				save_scope_as = magic_t
				title_province = {
					save_scope_as = magic_p
				}
			}
		}
	}
	option = {
		name = ev2.64.a
	}
}

#artifacts searching concluded
magic_ev5.21 = {
	type = activity_event
	title = bp2_adult_education.0009.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:activity ?= {
						var:activity_special_type_progression < 50
					}
				}
				desc = ev5.21.desc
			}
			desc = ev5.21.desc2
		}
	}
	theme = learning_scholarship_focus

	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:owner_a

	immediate = {
		if = {
			limit = {
				has_character_flag = magic_arti1_selected
				scope:activity ?= {
					var:activity_special_type_progression > 49
				}
			}
			scope:activity.var:artx1.artifact_owner = {
				save_scope_as = owner_a
			}
			scope:activity.var:artx1 = {
				save_scope_as = final_arti
			}
			#scope:arti1.artifact_owner = {
			#	save_scope_as = owner_a
			#}
			#scope:arti1 = {
			#	save_scope_as = final_arti
			#}
		}
		else_if = {
			limit = {
				has_character_flag = magic_arti2_selected
				scope:activity ?= {
					var:activity_special_type_progression > 49
				}
			}
			scope:activity.var:artx2.artifact_owner = {
				save_scope_as = owner_a
			}
			scope:activity.var:artx2 = {
				save_scope_as = final_arti
			}
		}
		else_if = {
			limit = {
				has_character_flag = magic_arti3_selected
				scope:activity ?= {
					var:activity_special_type_progression > 49
				}
			}
			scope:activity.var:artx3.artifact_owner = {
				save_scope_as = owner_a
			}
			scope:activity.var:artx3 = {
				save_scope_as = final_arti
			}
		}
		artifacts_searching_completed_log_entry_effect = yes
	}
	option = {
		name = ev5.21.0.a
		trigger = {
			scope:activity ?= {
				var:activity_special_type_progression < 50
			}
		}
	}
	option = {
		name = ev5.21.0.b
		trigger = {
			scope:activity ?= {
				var:activity_special_type_progression > 49
			}
		}
		hidden_effect = {
			create_character_memory = {
				type = discovered_magical_item
				participants = {
					target0 = scope:owner_a
				}
			}
		}
	}
	after = {
		if = {
			limit = {
				has_character_flag = will_gain_claim_for_magic_item
			}
			remove_character_flag = will_gain_claim_for_magic_item
		}
	}
}

#artifacts searching - main event 1
magic_ev5.22 = {
	type = activity_event
	title = ev5.22.title
	desc = ev5.22.desc
	theme = learning_scholarship_focus

	left_portrait = {
		character = root
		animation = personality_rational
	}

	#widget = {
	#	gui = "event_window_widget_activity_intent"
	#	container = "custom_widgets_container"
	#}
	immediate = {
		hidden_effect = {
			random_list = {
				4 = {
					add_character_flag = will_gain_claim_for_magic_item
				}
				6 = {

				}
			}
		}
	}

	option = {
		name = ev5.22.0.a
		duel = {
			skill = intrigue
			value = 18
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_major
				scope:activity = {
					change_variable = {
						name = activity_special_type_progression
						add = 20
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_tiny
				scope:activity = { activity_special_type_progression_tiny = yes }
			}
		}
	}
	option = {
		name = ev5.22.0.b
		duel = {
			skill = learning
			value = 18
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_major
				scope:activity = {
					change_variable = {
						name = activity_special_type_progression
						add = 20
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				custom_tooltip = artifacts_searching_tt_positive_tiny
				scope:activity = { activity_special_type_progression_tiny = yes }
			}
		}
	}
	option = {
		name = ev5.22.0.c
		trigger = {
			has_trait = diplomat
		}
		trait = diplomat
		custom_tooltip = artifacts_searching_tt_positive_major
		scope:activity = { activity_special_type_progression_massive = yes }
		custom_tooltip = ev5.11.0.c_ct
		hidden_effect = {
			mark_as_black_magic_caster_effect = { L = 1 }
			add_character_flag = observed_by_whunters
		}
	}
	option = {
		name = ev5.22.0.d
		trigger = {
			has_trait = grandmaster_coven
		}
		trait = grandmaster_coven
		custom_tooltip = artifacts_searching_tt_positive_major
		scope:activity = { activity_special_type_progression_massive = yes }
	}
}

#artifacts searching - main event 2
magic_ev5.23 = {
	type = activity_event
	title = ev5.23.title
	desc = ev5.23.desc
	theme = learning_scholarship_focus

	left_portrait = {
		character = root
		animation = personality_rational
	}

	
	option = {
		name = ev5.23.0.a
		add_character_flag = magic_arti1_selected
		custom_tooltip = artifacts_searching_tt_positive_major
		
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = {
				change_variable = {
					name = activity_special_type_progression
					add = 15
				}
			}
		}
		else = {
			scope:activity = {
				change_variable = {
					name = activity_special_type_progression
					add = 20
				}
			}
		}

		if = {
			limit = {
				scope:arti1.artifact_owner = {
					NOT = {
						in_diplomatic_range = root
					}
				}
			}
			custom_tooltip = as_art_may_be_out_of_reach_ct
		}
	}
	option = {
		name = ev5.23.0.b
		trigger = {
			exists = scope:arti2
		}
		add_character_flag = magic_arti2_selected
		custom_tooltip = artifacts_searching_tt_positive_medium
		if = {
			limit = {
				any_character_artifact = {
					has_variable = magic1
				}
			}
			scope:activity = { activity_special_type_progression_major = yes }
		}
		else = {
			scope:activity = {
				change_variable = {
					name = activity_special_type_progression
					add = 15
				}
			}
		}
		if = {
			limit = {
				scope:arti2.artifact_owner = {
					NOT = {
						in_diplomatic_range = root
					}
				}
			}
			custom_tooltip = as_art_may_be_out_of_reach_ct
		}
	}
	option = {
		name = ev5.23.0.c
		trigger = {
			exists = scope:arti3
		}
		add_character_flag = magic_arti3_selected
		custom_tooltip = artifacts_searching_tt_positive_tiny
		scope:activity = { activity_special_type_progression_medium = yes }
		if = {
			limit = {
				scope:arti3.artifact_owner = {
					NOT = {
						in_diplomatic_range = root
					}
				}
			}
			custom_tooltip = as_art_may_be_out_of_reach_ct
		}
	}
}

#fire storm spell effect
magic_ev5.24 = {
	title = firestorm_spell
	desc = ev5.24.desc
	theme = dread
	left_portrait = {
		character = root
		animation = fear
	}

	trigger = {
		is_alive = yes
	}

	immediate = {
		if = {
			limit = {
				scope:recipient = root
			}
			every_living_character = {
				limit = {
					exists = this.location
					exists = root.location
					this.location = root.location
					is_powerful_being = no
					is_antimagic_trigger = no
				}
				random_list = {
					2 = {
						trigger = {
							NOT = {	has_character_flag = pandoras_protector	}
						}
						death = {
							death_reason = death_fire
						}
					}
					2 = {
						trigger = {
							NOR = {
								has_trait = wounded_3
								has_trait = wounded_2
								has_trait = wounded_1
								has_trait = disfigured
							}
						}
						add_trait = wounded_3
						add_trait = disfigured
					}
					2 = {
						trigger = {
							NOR = {
								has_trait = wounded_3
								has_trait = wounded_2
								has_trait = wounded_1
							}
						}
						add_trait = wounded_2
					}
					2 = {
						trigger = {
							NOR = {
								has_trait = wounded_3
								has_trait = wounded_2
								has_trait = wounded_1
							}
						}
						add_trait = wounded_1
					}
					2 = {
	
					}
				}
			}
			if = {
				limit = {
					exists = root.location.county
				}
				root.location.county = {
					add_county_modifier = {
						modifier = uncontrolled_urban_fires_modifier
						years = 4
					}
					change_county_control = major_county_control_loss
					change_development_progress = medium_development_progress_loss
				}
			}
			if = {
				limit = {
					exists = root.location
				}
				root.location = {
					every_army_in_location = {
						deplete_army_by_percentage = 0.33
					}
				}
			}
		}
		#else = {
		#	show_as_tooltip = {
		#		every_living_character = {
		#			limit = {
		#				exists = this.location
		#				exists = root.location
		#				this.location = root.location
		#				is_powerful_being = no
		#				is_antimagic_trigger = no
		#			}
		#			random_list = {
		#				2 = {
		#					death = {
		#						death_reason = death_fire
		#					}
		#				}
		#				2 = {
		#					trigger = {
		#						NOR = {
		#							has_trait = wounded_3
		#							has_trait = wounded_2
		#							has_trait = wounded_1
		#							has_trait = disfigured
		#						}
		#					}
		#					add_trait = wounded_3
		#					add_trait = disfigured
		#				}
		#				2 = {
		#					trigger = {
		#						NOR = {
		#							has_trait = wounded_3
		#							has_trait = wounded_2
		#							has_trait = wounded_1
		#						}
		#					}
		#					add_trait = wounded_2
		#				}
		#				2 = {
		#					trigger = {
		#						NOR = {
		#							has_trait = wounded_3
		#							has_trait = wounded_2
		#							has_trait = wounded_1
		#						}
		#					}
		#					add_trait = wounded_1
		#				}
		#				2 = {
		#
		#				}
		#			}
		#		}
		#	}
		#}
	}

	option = {
		name = ev5.2.0.a
		trigger = {
			NOT = {
				root = scope:actor
			}
		}
		if = {
			limit = {
				is_alive = yes
			}
			add_stress = medium_stress_gain
		}
		
	}
	option = {
		name = ev5.21.0.b
		trigger = {
			root = scope:actor
		}
	}
}

#Demon XP System - Main Event
#magic_ev5.25 = {
#	hidden = yes
#	scope = none
#
#	immediate = {
#		every_living_character = {
#					limit = {
#						is_a_demon_trigger = yes
#					}
#					trigger_event = {
#						id = magic_ev5.26
#						days = { 1 364 }
#					}
#
#		}
#	}
#}
#Demon XP System - character event
#magic_ev5.26 = {
#	hidden = yes
#	type = character_event
#
#	trigger = {
#		is_a_demon_trigger = yes
#		has_trait_xp = {
#			trait = demon
#			value < 100
#		}
#	}
#
#	immediate = {
#		if = {
#			limit = {
#				is_ai = no
#			}
#			random = {
#				chance = 75
#				if = {
#					limit = {
#						is_a_demon_trigger = yes
#					}
#					add_trait_xp = {
#						trait = demon
#						value = 1
#					}
#				}
#			}
#		}
#		else = {
#			random = {
#				chance = 25
#				if = {
#					limit = {
#						is_a_demon_trigger = yes
#					}
#					add_trait_xp = {
#						trait = demon
#						value = 1
#					}
#				}
#			}
#		}
#	}
#}

#starts duel
magic_ev5.27 = {
	title = mage_duel
	desc = ev5.27.desc
	theme = realm
	
	#left_portrait = root
	left_portrait = {
		character = scope:attacker
		animation = scheme
	}
	right_portrait = {
		character = scope:defender
		animation = scheme
	}

	trigger = {
		is_alive = yes
		is_imprisoned = no
		scope:defender = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	immediate = {
		#just in case
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						exists = scope:attacker
					}
				}
				save_scope_as = attacker
			}
			if = {
				limit = {
					NOT = {
						exists = scope:defender
					}
					exists = scope:recipient
				}
				scope:recipient = {
					save_scope_as = defender
				}
			}
		}
	}
	option = {
		name = ev5.27.0.a
		trigger = {
			NOT = {
				has_trait = callous
			}
		}
	}
	option = {
		name = ev5.27.0.a
		trigger = {
			has_trait = callous
		}
		trait = callous
		add_dread = minor_dread_gain
	}
	after = {
		#custom_tooltip = mage_duel_duel_ct
		if = {
			limit = {
				scope:attacker = {
					is_ai = no
				}
			}
			configure_start_mage_duel_effect = {
				MD_ATTACKER = scope:attacker
				MD_DEFENDER = scope:defender
			}
		}
		else = {
			configure_start_mage_duel_effect = {
				MD_ATTACKER = scope:defender
				MD_DEFENDER = scope:attacker
				#OUTPUT_EVENT = magic_ev5.26
				#OUTPUT_EVENT2 = magic_ev5.26
			}
		}
	}
}




#witch hunters trap
magic_ev5.31 = {
	title = ev5.31.title
	desc = ev5.31.desc
	theme = learning_scholarship_focus
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:whunter
		animation = assassin
	}
	trigger = {
		is_alive = yes
		is_imprisoned = no
		NOT = {
			has_character_flag = met_witch_hunters_trap_flag
		}
	}
	immediate = {
		hidden_effect = {
			create_character = {
				location = root.location
				culture = root.culture
				faith = root.faith
				template = witch_hunter_character
				save_scope_as = whunter
			}
		}
		stress_impact = {
			craven = medium_stress_gain
		}
	}

	option = {
		name = ev5.31.0.a
		stress_impact = {
			brave = minor_stress_loss
		}
		duel = {
			skill = prowess
			value = 20
			6 = {
				#desc = ev2.36.b1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				send_interface_toast = {
					title=ev5.31.title
					custom_tooltip = ev2.48.a_ct1
				}
			}
			4 = {
				#desc = ev2.36.b2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				death = {
					killer = scope:whunter
					death_reason = death_fight
				}
			}
		}
	}
	option = {
		name = ev5.31.0.b
		duel = {
			skill = intrigue
			value = 20
			5 = {
				#desc = ev2.36.b1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title=ev5.31.title
					custom_tooltip = ev5.31.0.b_ct
				}
			}
			5 = {
				#desc = ev2.36.b2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				death = {
					killer = scope:whunter
					death_reason = death_fight
				}
			}
		}
	}
	option = {
		name = ev5.31.0.c
		trigger = {
			has_trait = archmage
			can_spend_standard_ps_trigger = yes
		}
		trait = archmage
		spend_standard_ps_effect = yes
		custom_tooltip = ev2.48.a_ct1
	}
	option = {
		name = ev5.31.0.d
		trigger = {
			has_trait = paranoid
		}
		trait = paranoid
		custom_tooltip = ev2.48.a_ct1
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					is_alive = yes
				}
				add_character_flag = {
					flag = met_witch_hunters_trap_flag
					months = 2
				}
			}
			scope:whunter = {
				death = natural
			}
		}
	}
}

#mage duel from power strike
magic_ev5.32 = {
	title = ev5.32.title
	desc = ev5.32.desc
	theme = realm
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:actor
		animation = assassin
	}
	option = {
		name = ev4.36.0.a
		custom_tooltip = mage_duel_duel_ct
		hidden_effect = {
			if = {
				limit = {
					scope:actor = {
						is_ai = no
					}
				}
				configure_start_mage_duel_effect = {
					MD_ATTACKER = scope:actor
					MD_DEFENDER = scope:recipient
				}
			}
			else = {
				configure_start_mage_duel_effect = {
					MD_ATTACKER = scope:recipient
					MD_DEFENDER = scope:actor
				}
			}
		}
	}
}

#artifacts searching 11. - chance for magic
magic_ev5.33 = {
	type = activity_event
	title = ev5.33.title
	desc = ev5.33.desc
	theme = learning_scholarship_focus

	center_portrait = {
		character = root
		animation = personality_rational
	}
	
	option = {
		name = ev5.33.0.a
		stress_impact = {
			scholar = medium_stress_loss
			lifestyle_mystic = minor_stress_loss
			lazy = medium_stress_gain
			diligent = minor_stress_loss
		}
		if = {
			limit = {
				NOT = {
					has_perk = magical_experiments_p1_perk
				}
			}
			#random_list = {
			#	97 = {
			#		add_learning_skill = 1
			#	}
			#	3 = {
			#		add_perk = magical_experiments_p1_perk
			#	}
			#}
			random = {
				chance = 5
				add_perk = magical_experiments_p1_perk
			}
		}
		else_if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp2_effect = yes
		}
		else_if = {
			limit = {
				has_trait = lifestyle_mystic
				has_trait_xp = {
					trait = lifestyle_mystic
					value < 100
				}
			}
			add_trait_xp = {
				trait = lifestyle_mystic
				value = 25
			}
		}
		else = {
			add_learning_skill = 1
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev5.33.0.b
		custom_tooltip = artifacts_searching_tt_positive_medium
		scope:activity = { activity_special_type_progression_medium = yes }
		ai_chance = {
			base = 10
		}
	}
}

#pandora begins (merlin appears)
magic_ev5.34 = {
	title = yearly.1040.t
	desc = ev5.34.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = personality_bold
	}
	trigger = {
		is_landed_or_landless_administrative = yes
		NOT = {
			any_living_character = {
				exists = house
				house = {
					has_variable = pandora_var
				}
			}
		}
		NOT = {
			is_a_demon_trigger = yes
		}
		OR = {
			any_character_artifact = { has_variable = magic1 }
			AND = {
				exists = house
				house = {
					has_house_modifier = witch_coven
				}
			}
			AND = {
				exists = mother
				mother = {
					OR = {
						has_trait = witch
						has_trait = true_witch
						has_trait = archmage
						is_a_demon_trigger = yes
					}
				}
			}
			AND = {
				exists = real_father
				real_father = {
					OR = {
						has_trait = witch
						has_trait = true_witch
						has_trait = archmage
						is_a_demon_trigger = yes
					}
				}
			}
		}
		any_living_character = {
			has_character_flag = merlin_dude
			NOR = {
				has_relation_mmaster = root
				has_relation_mminion = root
				has_relation_nemesis = root
				has_relation_rival = root
				has_relation_friend = root
				has_relation_best_friend = root
				has_relation_lover = root
				has_relation_soulmate = root
				#is_vassal_or_below_of = root
				#has_relation_to = root
				#this.location = root.location
			}
			is_imprisoned = no
		}
		any_living_character = {
			has_character_flag = yaga_flag
			#NOR = {
			#	has_relation_mmaster = root
			#	has_relation_mminion = root
			#	has_relation_nemesis = root
			#	has_relation_rival = root
			#}
			is_imprisoned = no
		}
	}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					has_character_flag = merlin_dude
					NOR = {
						has_relation_mmaster = root
						has_relation_mminion = root
						has_relation_nemesis = root
						has_relation_rival = root
						has_relation_friend = root
						has_relation_best_friend = root
						has_relation_lover = root
						has_relation_soulmate = root
					}
					is_imprisoned = no
				}
				save_scope_as = merlin0
			}
		}
	}
	
	option = {
		name = ev5.34.0.a
		stress_impact = {
			paranoid = major_stress_gain
			craven = minor_stress_gain
		}
		trigger_event = magic_ev5.35
	}
	after = {
		add_character_flag = search_for_pandora
		if = {
			limit = {
				exists = house
			}
			house = {
				set_variable = pandora_var
			}
		}
	}
}
#merlin introduction
magic_ev5.35 = {
	title = yearly.1040.t
	desc = ev5.35.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = personality_bold
	}
	immediate = {
		stress_impact = {
			trusting = minor_stress_loss
			gregarious = minor_stress_loss
		}
	}
	
	option = {
		name = ev5.35.0.a
	}
	option = {
		name = ev5.35.0.b
	}
	after = {
		trigger_event = magic_ev5.36
	}
}
#merlin go on
magic_ev5.36 = {
	title = yearly.1040.t
	desc = ev5.36.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = scheme
	}
	immediate = {
		stress_impact = {
			trusting = minor_stress_loss
			gregarious = minor_stress_loss
		}
	}
	
	option = {
		name = ev5.36.0.a
	}
	after = {
		trigger_event = magic_ev5.37
	}
}
#merlins explanation
magic_ev5.37 = {
	title = yearly.1040.t
	desc = ev5.37.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = scheme
	}
	
	option = {
		name = ev5.37.0.a
		stress_impact = {
			brave = medium_stress_loss
		}
		trigger_event = magic_ev5.39
	}
	option = {
		name = ev5.37.0.b
		trigger = {
			has_trait = greedy
		}
		trait = greedy
		stress_impact = {
			greedy = medium_stress_loss
		}
		trigger_event = magic_ev5.39
	}
	option = {
		name = ev5.37.0.c
		stress_impact = {
			trusting = medium_stress_gain
		}
		trigger_event = magic_ev5.38
	}
	option = {
		name = ev5.37.0.d
		stress_impact = {
			paranoid = medium_stress_loss
			craven = minor_stress_loss
			content = minor_stress_loss
		}
		custom_tooltip = ev5.37.0.d_ct
		hidden_effect = {
			if = {
				limit = {
					any_living_character = {
						NOR = {
							THIS = ROOT
							has_character_flag = special_magic_character
							has_character_flag = search_for_pandora
						}
						OR = {
							has_trait = true_witch
							has_trait = archmage
						}
						is_landed_or_landless_administrative = yes
					}
				}
				random_living_character = {
					limit = {
						NOR = {
							THIS = ROOT
							has_character_flag = special_magic_character
							has_character_flag = search_for_pandora
						}
						OR = {
							has_trait = true_witch
							has_trait = archmage
						}
						is_landed_or_landless_administrative = yes
					}
					trigger_event = {
						id = magic_ev5.40
						months = { 3 6 }
					}
				}
			}
		}
	}
}

#merlins explanation2
magic_ev5.38 = {
	title = yearly.1040.t
	desc = ev5.38.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = scheme
	}
	
	option = {
		name = ev5.37.0.a
		stress_impact = {
			brave = medium_stress_loss
			craven = minor_stress_gain
		}
		trigger_event = magic_ev5.39
	}
	option = {
		name = ev5.37.0.b
		trigger = {
			has_trait = greedy
		}
		trait = greedy
		stress_impact = {
			greedy = medium_stress_loss
			craven = minor_stress_gain
		}
		trigger_event = magic_ev5.39
	}
	option = {
		name = ev5.37.0.d
		stress_impact = {
			paranoid = medium_stress_loss
			craven = minor_stress_loss
			content = minor_stress_loss
			shy = minor_stress_loss
		}
		custom_tooltip = ev5.37.0.d_ct
		hidden_effect = {
			if = {
				limit = {
					any_living_character = {
						NOR = {
							THIS = ROOT
							has_character_flag = special_magic_character
							has_character_flag = search_for_pandora
						}
						OR = {
							has_trait = true_witch
							has_trait = archmage
						}
						is_landed_or_landless_administrative = yes
					}
				}
				random_living_character = {
					limit = {
						NOR = {
							THIS = ROOT
							has_character_flag = special_magic_character
							has_character_flag = search_for_pandora
						}
						OR = {
							has_trait = true_witch
							has_trait = archmage
						}
						is_landed_or_landless_administrative = yes
					}
					trigger_event = {
						id = magic_ev5.40
						months = { 3 6 }
					}
				}
			}
		}
	}
}
#merlins explanation3 - accepted
magic_ev5.39 = {
	title = yearly.1040.t
	desc = ev5.39.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:merlin0
		animation = personality_bold
	}
	
	option = {
		name = ev5.39.0.a
		custom_tooltip = ev5.39.0.a_ct
		custom_tooltip = ev5.39.0.a_ct2
		trigger_event = {
			id = magic_ev5.40
			months = { 3 6 }
		}
	}
}

#pandora search
magic_ev5.40 = {
	title = ev5.40.title
	desc = ev5.40.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	
	option = {
		name = ev5.40.0.a
		remove_short_term_gold = medium_gold_value
		trigger_event = {
			id = magic_ev5.41
			months = 1
		}
	}
	option = {
		name = ev5.40.0.b
		trigger = {
			exists = cp:councillor_spymaster
		}
		cp:councillor_spymaster = {
			add_character_modifier = {
				modifier = additional_tasks_modifier
				months = 12
			}
		}
		remove_short_term_gold = minor_gold_value
		trigger_event = {
			id = magic_ev5.41
			months = 1
		}
	}
	option = {
		name = ev5.40.0.c
		custom_tooltip = ev5.40.0.c_ct
		add_character_flag = stops_pandora_searching
		trigger_event = {
			id = magic_ev5.41
			months = 1
		}
	}
}

#yaga says hello
magic_ev5.41 = {
	type = letter_event
	#opening = diplomacy_foreign.3001.opening
	opening = ev5.41.opening
	desc = ev5.41.desc
	sender = scope:yaga0

	trigger = {
		any_living_character = {
			has_character_flag = yaga_flag
			NOR = {
				has_relation_mmaster = root
				has_relation_mminion = root
				has_relation_nemesis = root
				has_relation_rival = root
			}
			is_imprisoned = no
		}
	}
	immediate = {
		random_living_character = {
			limit = {
				has_character_flag = yaga_flag
				NOR = {
					has_relation_mmaster = root
					has_relation_mminion = root
					has_relation_nemesis = root
					has_relation_rival = root
				}
				is_imprisoned = no
			}
			save_scope_as = yaga0
		}
	}

	option = {
		name = ev5.41.0.a
		trigger = {
			NOT = {
				has_character_flag = stops_pandora_searching
			}
		}
		trigger_event = {
			id = magic_ev5.42
			days = 12
		}
	}
	option = {
		name = ev5.41.0.b
		trigger = {
			has_character_flag = stops_pandora_searching
		}
		custom_tooltip = ev5.41.0.b_ct
		trigger_event = {
			id = magic_ev5.42
			days = 12
		}
		remove_character_flag = stops_pandora_searching
	}
	option = {
		name = ev5.41.0.c
		trigger = {
			has_character_flag = stops_pandora_searching
		}
		remove_character_flag = stops_pandora_searching
	}
}

#mefisto!
magic_ev5.42 = {
	title = ev5.42.title
	desc = ev5.42.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:mefisto0
		animation = eyeroll
	}
	#trigger = {
	#	is_imprisoned = no
	#	is_alive = yes
	#	OR = {
	#		any_living_character = {
	#			has_character_flag = mefisto_devil
	#			is_imprisoned = no
	#			NOR = {
	#				is_vassal_or_below_of = root
	#				has_relation_to = root
	#				this.location = root.location
	#			}
	#		}
	#		NOT = {
	#			any_living_character = {
	#				has_character_flag = mefisto_devil
	#			}
	#		}
	#	}
	#}
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					has_character_flag = mefisto_devil
					#is_imprisoned = no
					#NOR = {
					#	is_vassal_or_below_of = root
					#	has_relation_to = root
					#	this.location = root.location
					#}
				}
				save_scope_as = mefisto0
			}
			if = {
				limit = {
					NOT = {
						exists = scope:mefisto0
					}
				}
				create_mefisto_effect = yes
				scope:demon = {
					save_scope_as = mefisto0
				}
				#clear_saved_scope = demon
			}
			if = {
				limit = {
					exists = scope:mefisto0
					scope:mefisto0 = {
						is_imprisoned = yes
					}
				}
				scope:mefisto0 = {
					release_from_prison = yes
				}
			}
		}
	}
	option = {
		name = ev5.42.0.a
		if = {
			limit = {
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			add_stress = minor_stress_gain
		}
		else = {
			stress_impact = {
				craven = medium_stress_gain
			}
		}
		trigger_event = magic_ev5.43
	}
}

#mefisto 2
magic_ev5.43 = {
	title = ev5.42.title
	desc = ev5.43.desc
	theme = witchcraft
	left_portrait = {
		character = root
		#animation = scheme
		animation = personality_rational
	}
	right_portrait = {
		character = scope:mefisto0
		animation = drink
	}
	option = {
		name = ev5.43.0.a
		trigger_event = magic_ev5.44
	}
}
#mefisto 3
magic_ev5.44 = {
	title = ev5.42.title
	desc = ev5.44.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = scheme
	}
	right_portrait = {
		character = scope:mefisto0
		animation = flirtation
	}
	lower_right_portrait = scope:rrruler
	immediate = {
		random_neighboring_top_liege_realm_owner = {
			limit = { NOT = { THIS = ROOT } }
			save_scope_as = rrruler
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			random_neighboring_and_across_water_realm_same_rank_owner = {
				limit = { NOT = { THIS = ROOT } }
				save_scope_as = rrruler
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			random_neighboring_and_across_water_top_liege_realm_owner = {
				limit = { NOT = { THIS = ROOT } }
				save_scope_as = rrruler
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			liege = {
				if = {
					limit = {
						exists = this
						NOT = { THIS = ROOT }
					}
					save_scope_as = rrruler
				}
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			random_vassal_or_below = {
				limit = { NOT = { THIS = ROOT } }
				save_scope_as = rrruler
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
				#is_landed = yes
				#is_landless_administrative = yes
				is_landless_adventurer = yes
			}
			location = {
				random_character_in_location = {
					limit = {
						NOT = { THIS = ROOT }
						#1030_appropriate_noble_trigger = yes
						is_landed_or_landless_administrative = yes	
						is_adult = yes	
					}
					save_scope_as = rrruler
				}
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			random_ruler = {
				limit = {
					NOT = { THIS = ROOT }
					in_diplomatic_range = ROOT
				}
				save_scope_as = rrruler
			}
		}
		scope:rrruler = {
			add_character_flag = pandoras_protector
			capital_county = {
				save_scope_as = rrrcounty
				set_variable = pandoras_hideout
			}
		}
	}
	option = {
		name = ev5.44.0.a
		trigger_event = magic_ev5.45
	}
}
#mefisto 4
magic_ev5.45 = {
	title = ev5.42.title
	desc = ev5.45.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:mefisto0
		animation = ecstasy
	}
	lower_right_portrait = scope:rrruler

	option = {
		name = ev5.45.0.a
		custom_tooltip = ev5.45.0.a_ct
		add_character_flag = pandora_stage1
		show_as_tooltip = {
			add_pressed_claim = scope:rrrcounty
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_claim_on = scope:rrrcounty
					}
				}
				add_pressed_claim = scope:rrrcounty
			}
		}
		trigger_event = {
			id = magic_ev5.46
			months = 1
		}
	}
}
#castle captured
magic_ev5.46 = {
	hidden = yes
	type = character_event

	trigger = {
		is_alive = yes
		has_character_flag = pandora_stage1
	}

	immediate = {
		if = {
			limit = {
				any_held_title = {
					this = scope:rrrcounty
				}
			}
			add_character_flag = pandora_from_castle
			trigger_event = magic_ev5.47
			scope:rrrcounty = {
				remove_variable = pandoras_hideout
			}
		}
		else = {
			trigger_event = {
				id = magic_ev5.46
				months = 1
			}
		}
	}
}

#pandora conversation
magic_ev5.47 = {
	title = ev5.40.title
	#desc = ev5.47.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = pandora_from_castle
				}
				desc = ev5.47.desc
			}
			desc = ev5.47.desc2
		}
	}
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:pandora0
		animation = worry
	}
	#lower_right_portrait = scope:merlin0
	#lower_left_portrait = scope:yaga0
	immediate = {
		create_pandora_effect = yes
		scope:demon = {
			save_scope_as = pandora0
		}
	}
	option = {
		name = ev5.47.0.a
		remove_character_flag = pandora_stage1
		if = {
			limit = {
				has_character_flag = pandora_from_castle
			}
			remove_character_flag = pandora_from_castle
		}
		trigger_event = magic_ev5.49
	}
}
#Targets killed
magic_ev5.48 = {
	hidden = yes
		
	immediate = {
		save_scope_as = pprotector
		random_living_character = {
			limit = {
				has_character_flag = pandora_stage1
				#any_killed_character = {
				#	#has_character_flag = pandoras_protector
				#	this = root
				#}
			}
			trigger_event = {
				id = magic_ev5.480
				days = 3
			}
		}
	}
}

magic_ev5.480 = {
	hidden = yes
		
	immediate = {
		if = {
			limit = {
				OR = {
					any_killed_character = {
						this = scope:pprotector
					}
					exists = scope:killer
					scope:pprotector = {
						death_reason = death_murder
					}
					scope:pprotector = {
						death_reason = death_duel
					}
					scope:pprotector = {
						death_reason = death_plotting
					}
					scope:pprotector = {
						death_reason = death_battle
					}
					scope:pprotector = {
						death_reason = death_fight
					}
					scope:pprotector = {
						death_reason = death_fight_killer
					}
				}
			}
			trigger_event = magic_ev5.47
		}
	}
}
#pandora conversation 2
magic_ev5.49 = {
	title = pandora_name
	desc = ev5.49.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:pandora0
		animation = worry
	}
	option = {
		name = ev5.49.0.a
		trigger_event = magic_ev5.50
	}
	option = {
		name = ev5.49.0.b
		trigger_event = magic_ev5.50
	}
}
#pandora conversation 3 - choosing
magic_ev5.50 = {
	title = pandora_name
	desc = ev5.50.desc
	theme = realm
	left_portrait = root
	right_portrait = {
		character = scope:pandora0
		animation = worry
	}
	immediate = {
		random_living_character = {
			limit = {
				has_character_flag = merlin_dude
				is_imprisoned = no
			}
			save_scope_as = merlin0
		}
		random_living_character = {
			limit = {
				has_character_flag = yaga_flag
				is_imprisoned = no
			}
			save_scope_as = yaga0
		}
	}
	lower_right_portrait = scope:merlin0
	lower_left_portrait = scope:yaga0
	option = {
		name = ev5.50.0.a
		scope:pandora0 = {
			death = {
				death_reason = death_murder
				killer = root
			}
		}
		stress_impact = {
			compassionate = massive_stress_gain
			sadistic = medium_stress_loss
			callous = minor_stress_loss
		}
		if = {
			limit = {
				exists = scope:merlin0
			}
			scope:merlin0 = {
				add_opinion = {
					modifier = disappointed_opinion
					target = root
					opinion = -60
				}
			}
		}
		
		if = {
			limit = {
				exists = scope:yaga0
			}
			scope:yaga0 = {
				add_opinion = {
					modifier = disappointed_opinion
					target = root
					opinion = -60
				}
			}
		}
		trigger_event = {
			id = magic_ev5.57
			days = 2
		}
	}
	option = {
		name = ev5.50.0.b
		custom_tooltip = ev5.50.0.b_ct
		stress_impact = {
			compassionate = medium_stress_loss
			sadistic = medium_stress_gain
		}
		scope:pandora0 = {
			add_opinion = {
				modifier = grateful_opinion
				target = root
				opinion = 60
			}
		}
		if = {
			limit = {
				exists = scope:merlin0
			}
			scope:merlin0 = {
				add_opinion = {
					modifier = disappointed_opinion
					target = root
					opinion = -80
				}
			}
		}
		if = {
			limit = {
				exists = scope:yaga0
			}
			scope:yaga0 = {
				add_opinion = {
					modifier = disappointed_opinion
					target = root
					opinion = -80
				}
			}
		}
		trigger_event = {
			id = magic_ev5.57
			days = 2
		}
		hidden_effect = {
			scope:pandora0 = {
				death = natural
			}
		}
	}
	option = {
		name = ev5.50.0.c
		custom_tooltip = ev5.50.0.c_ct
		stress_impact = {
			compassionate = medium_stress_loss
			gregarious = medium_stress_loss
			lustful = minor_stress_loss
			ambitious = medium_stress_loss
		}
		scope:pandora0 = {
			add_opinion = {
				modifier = grateful_opinion
				target = root
				opinion = 60
			}
		}
		if = {
			limit = {
				exists = scope:merlin0
			}
			scope:merlin0 = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -100
				}
			}
		}
		if = {
			limit = {
				exists = scope:yaga0
			}
			scope:yaga0 = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -100
				}
			}
		}
		
	}
	option = {
		name = ev5.50.0.d
		trigger = {
			exists = scope:merlin0
		}
		custom_tooltip = ev5.50.0.d_ct
		stress_impact = {
			ambitious = minor_stress_gain
		}
		trigger_event = magic_ev5.51
		scope:merlin0 = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 60
			}
		}
		if = {
			limit = {
				exists = scope:yaga0
			}
			scope:yaga0 = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -120
				}
				random = {
					chance = 10
					set_relation_rival = root
				}
			}
		}
		
	}
	option = {
		name = ev5.50.0.e
		trigger = {
			exists = scope:yaga0
		}
		custom_tooltip = ev5.50.0.e_ct
		stress_impact = {
			ambitious = minor_stress_gain
		}
		trigger_event = magic_ev5.54
		scope:yaga0 = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 60
			}
		}
		if = {
			limit = {
				exists = scope:merlin0
			}
			scope:merlin0 = {
				add_opinion = {
					modifier = angry_opinion
					target = root
					opinion = -120
				}
				random = {
					chance = 10
					set_relation_rival = root
				}
			}
		}
	}
}
#picked Merlin - epilog1
magic_ev5.51 = {
	title = pandora_name
	desc = ev5.51.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:merlin0
	lower_right_portrait = scope:pandora0

	option = {
		name = ev5.51.0.a
		trigger_event = magic_ev5.52
		stress_impact = {
			compassionate = minor_stress_loss
		}
	}
	option = {
		name = ev5.51.0.b
		trigger_event = magic_ev5.53
		stress_impact = {
			greedy = minor_stress_loss
		}
	}
}
#picked Merlin - epilog2
magic_ev5.52 = {
	title = pandora_name
	desc = ev5.52.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:merlin0
	lower_right_portrait = scope:pandora0

	option = {
		name = ev5.52.0.a
		trigger_event = magic_ev5.53
	}
}
#picked Merlin - epilog3
magic_ev5.53 = {
	title = pandora_name
	desc = ev5.53.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:merlin0
	lower_right_portrait = scope:pandora0

	option = {
		name = ev5.53.0.a
		trigger = {
			NOR = {
				has_relation_friend = scope:merlin0
				has_relation_best_friend = scope:merlin0
			}
		}
		add_diplomacy_skill = 1
		set_relation_friend = scope:merlin0
		add_prestige = medium_prestige_gain
	}
	option = {
		name = ev5.53.0.b
		if = {
			limit = {
				#NOR = {
				#	has_trait = source
				#	any_character_artifact = {
				#		has_variable = magic1
				#	}
				#	has_perk = magical_experiments_p1_perk
				#	has_power_place_trigger = yes
				#}
				can_unlock_arcane_focus_trigger = no
			}
			add_perk = magical_experiments_p1_perk
			add_learning_skill = 1
			add_prestige = medium_prestige_gain
			if = {
				limit = {
					NOT = {
						has_character_modifier = mage_guidance
					}
				}
				add_character_modifier = {
					modifier = mage_guidance
					years = 5
				}
			}
		}
		else_if = {
			limit = {
				has_focus = arcane_focus
			}
			custom_tooltip = ev2.47.a_ct
			add_learning_skill = 2
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
			gain_huge_ps_effect = yes
			if = {
				limit = {
					NOT = {
						has_character_modifier = mage_guidance
					}
				}
				add_character_modifier = {
					modifier = mage_guidance
					years = 5
				}
			}
		}
		else_if = {
			limit = {
				has_trait = archmage
			}
			gain_sc_xp2_effect = yes
			gain_standard_ps_effect = yes
			hidden_effect = {
				random_list = {
					5 = {
						trigger = {
							NOT = {
								has_character_flag = bless_land_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.a_ct
						}
						add_character_flag = bless_land_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = healing_spell_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = healer_p9_perk_eff
						}
						add_character_flag = healing_spell_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = shadowstep_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.e_ct
						}
						add_character_flag = shadowstep_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = plague_spell_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.f_ct
						}
						add_character_flag = plague_spell_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = hipercognition_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.h_ct
						}
						add_character_flag = hipercognition_flag
					}
					5 = {
						trigger = {
							NOR = {
								has_character_flag = firestorm_spell_flag
								is_a_demon_trigger = yes
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.k_ct
						}
						add_character_flag = firestorm_spell_flag
					}
					1 = {

					}
				}
			}
		}
		else = {
			gain_huge_ps_effect = yes
			add_learning_skill = 5
			add_prestige = medium_prestige_gain
		}
	}
	option = {
		name = ev5.53.0.c
		add_gold = greedy_gold_value
		add_stewardship_skill = 1
	}
	after = {
		hidden_effect = {
			scope:pandora0 = {
				death = natural
			}
		}
	}
}
#picked Yaga - epilog1
magic_ev5.54 = {
	title = pandora_name
	desc = ev5.54.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:yaga0
	lower_right_portrait = scope:pandora0

	option = {
		name = ev5.51.0.a
		trigger_event = magic_ev5.55
		stress_impact = {
			compassionate = minor_stress_loss
		}
	}
	option = {
		name = ev5.54.0.a
		trigger_event = magic_ev5.56
		stress_impact = {
			greedy = minor_stress_loss
		}
	}
}
#picked Yaga - epilog2
magic_ev5.55 = {
	title = pandora_name
	desc = ev5.55.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:yaga0
	lower_right_portrait = scope:pandora0

	option = {
		name = ev4.23.0.a
		trigger_event = magic_ev5.56
	}
}
#picked Yaga - epilog3
magic_ev5.56 = {
	title = pandora_name
	desc = ev5.56.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:yaga0
	lower_right_portrait = scope:pandora0

	immediate = {
		random_artifact = {
			limit = {
				has_variable = magic1
				NOT = {
					artifact_owner = root
				}
			}
			save_scope_as = arttt
		}
		hidden_effect = {
			create_character = {
				employer = scope:yaga0
				gender = female
				template = yaga_d_character
				mother = scope:yaga0
				dynasty_house = scope:yaga0.house
				save_scope_as = dou
			}
			scope:dou = {
				add_secret = {
					type = secret_witch
					target = scope:dou
				}
				add_min_source_trait = yes
				random_secret = {
					limit = {
						secret_type = secret_witch
					}
					reveal_to = scope:yaga0
				}
			}
		}
	}

	option = {
		name = ev5.56.0.a
		
		if = {
			limit = {
				exists = scope:arttt
			}
			show_as_tooltip = {
				add_personal_artifact_claim = scope:arttt
			}
			hidden_effect = {
				if = {
					limit = {
						NOT = {
							has_personal_artifact_claim = scope:arttt
						}
					}
					add_personal_artifact_claim = scope:arttt
				}
			}
		}
		custom_tooltip = gain_pot1_ct
		custom_tooltip = gain_pot2_ct
		custom_tooltip = gain_pot3_ct
		hidden_effect = {
			create_artifact = {	
				name = pot1
				description = pot1_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot1
			}
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact2
			}
			scope:newly_created_artifact2={
				set_variable=pot2
			}
			create_artifact = {	
				name = pot3
				description = pot3_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact3
			}
			scope:newly_created_artifact3={
				set_variable=pot3
			}
		}
	}
	option = {
		name = ev5.56.0.b
		add_courtier = scope:dou
		scope:dou = {
			add_opinion = {
				modifier = pleased_opinion
				target = root
				opinion = 50
			}
		}
	}
	after = {
		hidden_effect = {
			scope:pandora0 = {
				add_trait = infertile
				add_character_modifier = infertile_modifier
			}
			if = {
				limit = {
					scope:yaga0 = {
						is_landed_or_landless_administrative = yes
					}
				}
				scope:yaga0 = {
					add_courtier = scope:pandora0
				}
			}
			else = {
				random_ruler = {
					add_courtier = scope:pandora0
				}
			}
		}
	}
}
#Mefisto - epilog1
magic_ev5.57 = {
	title = pandora_name
	desc = ev5.57.desc
	theme = realm
	left_portrait = root
	right_portrait = scope:mefisto0
	trigger = {
		any_living_character = {
			has_character_flag = mefisto_devil
		}
	}
	immediate = {
		random_living_character = {
			limit = {
				has_character_flag = mefisto_devil
			}
			save_scope_as = mefisto0
		}
		random_artifact = {
			limit = {
				has_variable = magic1
				NOT = {
					artifact_owner = root
				}
				artifact_owner = {
					is_ai = yes
				}
			}
			save_scope_as = arttt
		}
	}

	option = {
		name = ev5.56.0.a
		trigger = {
			exists = scope:arttt
		}
		scope:arttt.artifact_owner = {
			random_character_artifact = {
				limit = {
					has_variable = magic1
				}
				set_owner = {
					target = root
					history = {
						type = stolen
						actor = scope:arttt.artifact_owner
						recipient = root
						location = scope:arttt.artifact_owner.location
					}
				}
			}
		}
	}
	option = {
		name = ev5.53.0.b
		if = {
			limit = {
				NOR = {
					has_trait = source
					any_character_artifact = {
						has_variable = magic1
					}
					has_perk = magical_experiments_p1_perk
					has_power_place_trigger = yes
				}
			}
			add_perk = magical_experiments_p1_perk
			add_learning_skill = 1
		}
		else_if = {
			limit = {
				has_focus = arcane_focus
			}
			custom_tooltip = ev2.47.a_ct
			add_learning_skill = 2
			hidden_effect = {
				add_magic_lifestyle_perk_points = 1
			}
			gain_huge_ps_effect = yes
			add_2_magic_potential = yes
		}
		else_if = {
			limit = {
				has_trait = archmage
			}
			add_2_magic_potential = yes
			gain_sc_xp2_effect = yes
			gain_huge_ps_effect = yes
			hidden_effect = {
				random_list = {
					5 = {
						trigger = {
							NOT = {
								has_character_flag = bless_land_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.a_ct
						}
						add_character_flag = bless_land_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = healing_spell_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = healer_p9_perk_eff
						}
						add_character_flag = healing_spell_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = shadowstep_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.e_ct
						}
						add_character_flag = shadowstep_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = plague_spell_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.f_ct
						}
						add_character_flag = plague_spell_flag
					}
					5 = {
						trigger = {
							NOT = {
								has_character_flag = hipercognition_flag
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.h_ct
						}
						add_character_flag = hipercognition_flag
					}
					5 = {
						trigger = {
							NOR = {
								has_character_flag = firestorm_spell_flag
								is_a_demon_trigger = yes
							}
						}
						send_interface_toast = {
							title = learn_new_spell_decision
							custom_tooltip = ev5.1.0.k_ct
						}
						add_character_flag = firestorm_spell_flag
					}
					1 = {

					}
				}
			}
		}
		else = {
			gain_huge_ps_effect = yes
			add_learning_skill = 5
			add_2_magic_potential = yes
		}
	}
	option = {
		name = ev5.57.0.a
		add_gold = greedy_gold_value2
		add_stewardship_skill = 1
	}
	option = {
		name = ev5.57.0.b
		add_stress = major_stress_loss
	}
}

#additional to grand rite: seek the power/heresiarch
magic_ev5.58 = {
	type = activity_event
	title = ev5.58.title
	desc = ev5.58.desc
	theme = witchcraft
	override_background = {
		reference = bp1_bonfire
	}
	left_portrait = root
	trigger = {
		can_be_power_saturated_trigger = yes
		#has_trait = archmage
		NOT = {
			has_character_modifier = magic_flu_modifier
		}
	}
	immediate = {
		#if = {
		#	limit = {
		#		exists = scope:activity
		#		exists = scope:activity.activity_location
		#		scope:activity.activity_location = {
		#			is_power_place_trigger = yes
		#		}
		#	}
		#	gain_standard_ps_effect = yes
		#}
		#else = {
		#	gain_source_ps_effect = yes
		#}
		
	}
	option = {
		name = ev5.58.0.a
		gain_standard_ps_effect = yes
		
	}
}

#Abraxas management
magic_ev5.59 = {
	hidden = yes
	orphan = yes
	type = character_event
	trigger = {
		is_alive = yes
		is_landed_or_landless_administrative = yes
		any_held_title = {
			tier = tier_kingdom
		}
		NOT = {
			has_game_rule = never_magic_bael
		}
		NOT = {
			exists = global_var:us_magic_barrier_var
		}
		is_imprisoned = no
		is_independent_ruler = yes
	}
	immediate = {
		#random_held_title = {
		#	limit = {
		#		tier = tier_kingdom
		#	}
		#	save_scope_as = kkkingdom
		#}
		primary_title = {
			save_scope_as = kkkingdom
		}
		random_neighboring_and_across_water_realm_same_rank_owner = {
			save_scope_as = rrruler
		}
		if = {
			limit = {
				NOT = {
					exists = scope:rrruler
				}
			}
			random_ruler = {
				limit = {
					is_landed_or_landless_administrative = yes
					is_ai = no
				}
				save_scope_as = rrruler
			}
		}
		create_character = {
			name = abraxas_name
			location = scope:rrruler.capital_province
			gender = male
			template = abraxas_demon_character
			culture = root.culture
			save_scope_as = demon
		}
		scope:demon = {
			set_sexuality = bisexual
			give_witch_secret_or_trait_effect2 = yes
			add_character_flag = abraxas
			add_trait_xp = {
				trait = source
				track = magic_potentiall
				value = 80
			}
			turn_into_greater_demon = yes
			add_trait_xp = {
				trait = demon2
				track = hell_powers
				value = 40
			}
			add_trait_xp = {
				trait = demon2
				track = demon_reputation
				value = 40
			}
			turn_into_mage_effect = yes
			add_trait_xp = {
				trait = archmage
				track = secret_knowledge
				value = 80
			}
			add_trait_xp = {
				trait = archmage
				track = combat_magic
				value = 80
			}
			add_trait_xp = {
				trait = archmage
				track = alchemy
				value = 25
			}
			add_trait_xp = {
				trait = archmage
				track = demonology
				value = 70
			}
			add_trait_xp = {
				trait = archmage
				track = power_saturation
				value = 100
			}
			create_dynamic_title = {
				tier = kingdom
				name = DEMON_ARMY_NAME
			}
			create_title_and_vassal_change = {
				type = created
				save_scope_as = change
				add_claim_on_loss = no
			}
			scope:new_title = {
				set_capital_county = scope:rrruler.capital_county
				set_landless_title = yes
				set_destroy_on_gain_same_tier = yes
				set_no_automatic_claims = yes
				set_can_be_named_after_dynasty = no
				change_title_holder = {
					holder = scope:demon
					change = scope:change
				}
			}
			resolve_title_and_vassal_change = scope:change
			scope:new_title = {
				#generate_coa = yes
				set_coa = b_demonic
				set_variable = {
					name = temporary_title
					value = yes
				}
			}
			add_pressed_claim = root.primary_title
		}
		trigger_event = magic_ev5.60
	}
}

#Abraxas welcome
magic_ev5.60 = {
	type = letter_event
	#opening = diplomacy_foreign.3001.opening
	opening = ev5.60.opening
	desc = ev5.60.desc
	sender = scope:demon

	option = {
		name = ev5.60.0.a
	}
	after = {
		hidden_effect = {
			scope:demon = {
				start_war = {
					casus_belli = demon_conquest
					#casus_belli = fp1_scandi_adventurer_conquest
					target = root
					target_title = scope:kkkingdom
				}
				if = {
					limit = {
						root = {
							max_military_strength < 3000
						}
					}
					spawn_army = {
						name = demonic_knights
						men_at_arms = {
							type = demonic_knights
							stacks = 7
						}
						inheritable = no
						uses_supply = no
						location = scope:rrruler.capital_province
					}
				}
				else_if = {
					limit = {
						root = {
							max_military_strength < 7000
						}
					}
					spawn_army = {
						name = demonic_knights
						men_at_arms = {
							type = demonic_knights
							stacks = 12
						}
						inheritable = no
						uses_supply = no
						location = scope:rrruler.capital_province
					}
				}
				else_if = {
					limit = {
						root = {
							max_military_strength < 12000
						}
					}
					spawn_army = {
						name = demonic_knights
						men_at_arms = {
							type = demonic_knights
							stacks = 28
						}
						inheritable = no
						uses_supply = no
						location = scope:rrruler.capital_province
					}
				}
				else = {
					spawn_army = {
						name = demonic_knights
						men_at_arms = {
							type = demonic_knights
							stacks = 40
						}
						inheritable = no
						uses_supply = no
						location = scope:rrruler.capital_province
					}
				}
				random_courtier = {
					make_demon_effect = yes
					add_trait = source
					set_source4demon = yes
				}
			}
		}
	}
}
