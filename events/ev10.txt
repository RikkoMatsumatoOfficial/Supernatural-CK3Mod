namespace = magic_ev10
magic_ev10.1 = {
	window = mage_duel_event
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = md_winner
				}
				desc = mage_duel_won
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_loser
				}
				desc = mage_duel_lost
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_not_concluded
				}
				desc = ev5.29.title
			}
			triggered_desc = {
				trigger = {
					var:nrround < 7
				}
				desc = mage_duel_round_counter
			}
			triggered_desc = {
				trigger = {
					var:nrround = 7
				}
				desc = mage_duel7
			}
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = md_not_concluded
				}
				desc = ev5.29.desc
			}
			triggered_desc = {
				trigger = {
					var:nrround = 1
				}
				desc = ev5.28.desc
			}
			#triggered_desc = {
			#	trigger = {
			#		has_character_flag = md_winner
			#		var:dspell > 13
			#	}
			#	desc = ev5.28.desc_won1
			#}
			triggered_desc = {
				trigger = {
					has_character_flag = md_winner
				}
				desc = ev5.28.desc_won2
			}
			#triggered_desc = {
			#	trigger = {
			#		has_character_flag = md_loser
			#		scope:char2.var:dspell > 13
			#	}
			#	desc = ev5.28.desc_lost1
			#}
			triggered_desc = {
				trigger = {
					has_character_flag = dies_in_md
				}
				desc = ev5.28.desc_lost2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = spared_in_md
				}
				desc = ev5.28.desc_lost3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = spared_in_md_but_items_lost
				}
				desc = ev5.28.desc_lost4
			}
			triggered_desc = {
				trigger = {
					has_character_flag = spared_in_md_but_war_is_lost
				}
				desc = ev5.28.desc_lost5
			}
			triggered_desc = {
				trigger = {
					has_character_flag = spared_in_md_but_title_is_lost
				}
				desc = ev5.28.desc_lost6
			}
			triggered_desc = {
				trigger = {
					exists = scope:char2
					scope:char2 = {
						is_false_mage = yes
					}
				}
				desc = ev5.28.desc0
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc1
				}
				desc = ev5.28.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc2
				}
				desc = ev5.28.desc2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc3
				}
				desc = ev5.28.desc3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc4
				}
				desc = ev5.28.desc4
			}
			#triggered_desc = {
			#	trigger = {
			#		has_character_flag = md_desc5
			#	}
			#	desc = ev5.28.desc5
			#}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc6
				}
				desc = ev5.28.desc6
			}
			triggered_desc = {
				trigger = {
					has_character_flag = md_desc7
				}
				desc = ev5.28.desc7
			}
			desc = ev5.28.desc
		}
	}
	theme = rival_relation
	left_portrait = {
		character = root
		#animation = scheme
		triggered_animation = {
			trigger = {
				has_character_flag = md_winner
			}
			animation = war_over_win
		}
		triggered_animation = {
			trigger = {
				has_character_flag = md_loser
			}
			animation = shock
		}
		animation = war_attacker
	}
	right_portrait = {
		character = scope:char2
		#animation = assassin
		triggered_animation = {
			trigger = {
				has_character_flag = md_winner
			}
			animation = war_over_win
		}
		triggered_animation = {
			trigger = {
				has_character_flag = md_loser
			}
			animation = shock
		}
		animation = war_attacker
	}
	trigger = {
		is_alive = yes
	}
	on_trigger_fail = {
		if = {
			limit = {
				exists = scope:char1
				scope:char1 = {
					is_alive = yes
				}
			}
			scope:char1 = {
				clear_all_md_staff_effect = yes
			}
		}
		if = {
			limit = {
				exists = scope:char2
				scope:char2 = {
					is_alive = yes
				}
			}
			scope:char2 = {
				clear_all_md_staff_effect = yes
			}
		}
	}
	immediate = {
		display_mage_duel_correctly = yes
		win_or_lose_notification_effect = yes
		select_mage_duel_moves = yes
		select_ai_strategy_effect = yes
		remove_mana_after_md_effect = yes
		add_proper_prize_when_no_resolution_effect = yes
	}
	widgets = {
		widget = {
			gui = "event_window_widget_mage_duel_new"
			container = "custom_widgets_container"
		}
		widget = {
			gui = "event_window_widget_mage_duel_stats1"
			container = "custom_widgets_container2"
		}
		widget = {
			gui = "event_window_widget_mage_duel_room1"
			container = "custom_widgets_container3"
		}
		widget = {
			gui = "event_window_widget_mage_duel_stats2"
			container = "custom_widgets_container4"
		}
		widget = {
			gui = "event_window_widget_mage_duel_room2"
			container = "custom_widgets_container5"
		}
	}
	#Banishment
	option = {
		name = ev3.6.d
		trigger = {
			can_use_banish_spell = yes
			scope:char2 = {
				has_trait = demon1
				NOR = {
					has_character_flag = summoned_by_abdul_flag
					any_equipped_character_artifact = {
						has_artifact_modifier = hells_scepter_base_modifier
					}
				}
			}
			OR = {
				has_character_flag = mage_duel_type1
				has_character_flag = mage_duel_type2
				has_character_flag = mage_duel_type3
				has_character_flag = mage_duel_type4
				has_character_flag = mage_duel_type5
				has_character_flag = mage_duel_type6
				has_character_flag = mage_duel_type7
				has_character_flag = mage_duel_type8
			}
			NOR = {
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
				any_secret = {	secret_type = secret_false_mage	}
			}
		}
		use_magic_special_effect = { T = 10 S = 1 }
		hidden_effect = {
			add_character_flag = banisher_punisher_flag
		}
		ai_chance = {
			base = 1000
		}
	}
	#False Mage 1.
	option = {
		name = ev10.1.0.z8
		trigger = {
			any_secret = {	secret_type = secret_false_mage	}
			OR = {
				has_character_flag = mage_duel_type1
				has_character_flag = mage_duel_type2
				has_character_flag = mage_duel_type3
				has_character_flag = mage_duel_type4
			}
			NOR = {
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		prepare_spell_slot = yes
		ai_chance = {
			base = 1
		}
	}
	#False Mage 2.
	option = {
		name = ev10.1.0.z9
		trigger = {
			any_secret = {	secret_type = secret_false_mage	}
			OR = {
				has_character_flag = mage_duel_type5
				has_character_flag = mage_duel_type6
				has_character_flag = mage_duel_type7
				has_character_flag = mage_duel_type8
			}
			NOR = {
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		prepare_spell_slot = yes
		ai_chance = {
			base = 1
		}
	}
	#type 0.a - AS
	option = {
		name = ev5.28.0.f2	#AS
		trigger = {
			OR = {
				has_character_flag = mage_duel_type1
				has_character_flag = mage_duel_type2
				has_character_flag = mage_duel_type3
				has_character_flag = mage_duel_type4
				has_character_flag = mage_duel_type5
				has_character_flag = mage_duel_type6
				has_character_flag = mage_duel_type7
				has_character_flag = mage_duel_type8
			}
			has_character_flag = may_use_singularity_md_flag
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 4 }
		use_magic_special_effect = { T = 9 S = 2 }
		add_internal_flag = special
		hidden_effect = {
			remove_character_flag = may_use_singularity_md_flag
		}
		ai_chance = {
			base = 100
		}
	}
	#type 1.a
	option = {
		#name = ev10.1.0.a
		name = ev5.28.0.x2 	#See the master of magic...
		trigger = {
			has_character_flag = mage_duel_type1
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		use_fire_damage_effect = { T = 2 }
		#stress_impact = {
		#	arrogant = minor_stress_loss
		#	humble = minor_stress_gain
		#}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
			}
		}
		#use_kinetic_damage_effect = { T = 3 }
		#use_shadow_damage_effect = { T = 1 }
		#use_necrotic_damage_effect = { T = 2 }
	}
	#type 1.b
	option = {
		name = ev10.1.0.a 	#I've got something for you!
		trigger = {
			has_character_flag = mage_duel_type1
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 1 }
		use_kinetic_damage_effect = { T = 2 }
		#use_magic_shield_effect = { S = 1 }
		#use_magic_special_effect = { T = 1 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
			}
		}
	}
	#type 1.c
	option = {
		name = ev10.1.0.b	#How about a fire shield?
		trigger = {
			has_character_flag = mage_duel_type1
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_fire_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
				var:nrround > 1
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
			modifier = {
				add = -80
				var:lpower = 0
				scope:char2.var:dendurance < 2
			}
		}
	}
	#type 1.d
	option = {
		name = ev10.1.0.z1 	#Time for a death missile.
		trigger = {
			has_character_flag = mage_duel_type1
			var:lnecrotic > 0
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_kinetic_damage_effect = { T = 1 }
		use_necrotic_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash
			}
			modifier = {
				add = -200
				scope:char2 = {
					has_trait = necromancer
				}
			}
		}
	}
	#type 1.e
	option = {
		name = ev10.1.0.z4	#You have no idea what I'm capable of.
		trigger = {
			has_character_flag = mage_duel_type1
			has_trait = yaga
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 6 }
		if = {
			limit = {
				var:lnecrotic > 0
				scope:char2 = {
					NOT = {
						has_trait = necromancer
					}
				}
			}
			use_necrotic_damage_effect = { T = 2 }
		}
		else = {
			use_fire_damage_effect = { T = 2 }
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
			}
		}
	}
	#type 2.d
	option = {
		name = ev10.1.0.z2	#This will weaken him.
		trigger = {
			has_character_flag = mage_duel_type2
			var:lnecrotic > 0
			scope:char2 = {
				NOR = {
					has_trait = weak
					has_trait = physique_good_1
					has_trait = physique_good_2
					has_trait = physique_good_3
				}
			}
			
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_necrotic_damage_effect = { T = 3 }
		use_magic_special_effect = { T = 8 S = 2 }
		ai_chance = {
			base = 1
		}
	}
	#type 2.a
	option = {
		name = ev5.28.0.a	#Power Strike, Now!
		trigger = {
			has_character_flag = mage_duel_type2
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 4 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
			}
			modifier = {
				add = 99
				scope:char2.var:lshadow > 2
				var:lpower > 1
			}
			modifier = {
				add = -90
				var:lpower < 2
			}
		}
	}
	#type 2.b
	option = {
		name = ev10.1.0.c	#He will certainly feel this one!
		trigger = {
			has_character_flag = mage_duel_type2
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_fire_damage_effect = { T = 1 }
		use_kinetic_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 2.c
	option = {
		name = ev10.1.0.d	#Darkness will consume him.
		trigger = {
			has_character_flag = mage_duel_type2
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 4 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
			}
			modifier = {
				add = 99
				var:lshadow > 2
				var:dendurance > 2
				var:pclash > 10
				scope:char2.var:dendurance > 1
			}
		}
	}
	#type 2.e
	option = {
		name = ev10.1.0.z3	#I will confuse him with an illusion.
		trigger = {
			has_character_flag = mage_duel_type2
			intrigue > 19
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_shield
				var:nrround > 1
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash2
				var:nrround > 1
			}
		}
	}
	#type 3.e
	option = {
		#custom spell
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							exists = var:cs_predef_name
						}
						desc = ev10.1.0.z5a
					}
					desc = ev10.1.0.z5b
				}
			}
		}
		trigger = {
			OR = {
				has_character_flag = mage_duel_type3
				var:nrround = 1
			}
			exists = var:my_cs_slot1
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		add_internal_flag = special
		prepare_custom_spell_effect = yes
		ai_chance = {
			base = 200
		}
	}
	#type 3.a
	option = {
		name = ev5.28.0.x3	#Adaptation is the key to victory.
		trigger = {
			has_character_flag = mage_duel_type3
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
				var:nrround > 1
			}
		}
	}
	#type 3.b
	option = {
		name = ev5.28.0.k	#Burn!
		trigger = {
			has_character_flag = mage_duel_type3
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_fire_damage_effect = { T = 4 }
		#stress_impact = {
		#	sadistic = minor_stress_loss
		#	compassionate = minor_stress_gain
		#}
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash
				var:lfire > 1
			}
		}
	}
	#type 3.c
	option = {
		name = ev10.1.0.e	#Catch this!
		trigger = {
			has_character_flag = mage_duel_type3
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 1 }
		use_fire_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash2
			}
			modifier = {
				add = 50
				OR = {
					has_character_flag = md_ai_strat_clash2
					has_character_flag = md_ai_strat_endurance
				}
				var:lshadow > 2
			}
		}
	}
	#type 3.d
	option = {
		name = ev10.1.0.z 	#Taste the warp-fire.
		trigger = {
			has_character_flag = mage_duel_type3
			var:lnecrotic > 0
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_fire_damage_effect = { T = 1 }
		use_necrotic_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = -200
				scope:char2 = {
					has_trait = necromancer
				}
			}
		}
	}
	#type 4.d
	option = {
		name = ev10.1.0.t 	#I will plan simultaneous attack and defence.
		trigger = {
			has_trait = strategist
			has_character_flag = mage_duel_type4
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 4 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				var:lpower > 2
			}
			modifier = {
				add = 99
				scope:char2.var:lshadow > 2
				var:lpower > 1
			}
		}
	}
	#type 4.f
	option = {
		name = ev10.1.0.z7 	#I will try this.
		trigger = {
			NOT = {
				has_trait = strategist
			}
			has_character_flag = mage_duel_type4
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		if = {
			limit = {
				var:lnecrotic > 0
				scope:char2 = {
					NOT = {
						has_trait = necromancer
					}
				}
			}
			use_necrotic_damage_effect = { T = 2 }
		}
		else = {
			use_shadow_damage_effect = { T = 2 }
		}
		
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				var:lpower > 2
			}
			modifier = {
				add = 50
				var:lpower > 1
				has_character_flag = md_ai_strat_clash
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash
				var:lpower > 0
			}
			modifier = {
				add = 50
				var:lpower > 2
				var:lnecrotic > 0
			}
		}
	}
	#type 4.a
	option = {
		name = ev10.1.0.f	#I'll summon shadow arrows.
		trigger = {
			has_character_flag = mage_duel_type4
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 1 }
		use_kinetic_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
			}
		}
	}
	#type 4.b
	option = {
		name = ev10.1.0.g	#I will focus on full defence.
		trigger = {
			has_character_flag = mage_duel_type4
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_magic_shield_effect = { S = 1 }
		use_magic_special_effect = { T = 2 S = 2 }
		#stress_impact = {
		#	craven = minor_stress_loss
		#	brave = minor_stress_gain
		#}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				has_trait = craven
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
			modifier = {
				add = 49
				var:pclash > 9
				var:nrround > 4
			}
			modifier = {
				add = -1000
				var:lpower = 0
			}
			modifier = {
				add = -1000
				var:pclash < 9
				var:nrround > 6
			}
		}
	}
	#type 4.c
	option = {
		name = ev10.1.0.k	#I will create a vortex of blades.
		trigger = {
			has_character_flag = mage_duel_type4
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_kinetic_damage_effect = { T = 3 }
		use_magic_special_effect = { T = 1 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 4.e
	option = {
		name = ev10.1.0.y	#I will use pure necrotic energy.
		trigger = {
			has_character_flag = mage_duel_type4
			var:lnecrotic > 0
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_necrotic_damage_effect = { T = 4 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				var:lnecrotic > 1
				OR = {
					has_character_flag = md_ai_strat_clash
					has_character_flag = md_ai_strat_clash2
				}
			}
			modifier = {
				add = -300
				scope:char2 = {
					has_trait = necromancer
				}
			}
		}
	}
	#type 5.e
	option = {
		name = ev5.28.0.s6	#firestorm
		trigger = {
			has_character_flag = mage_duel_type5
			can_cast_firestorm_trigger = yes
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		add_internal_flag = special
		use_fire_damage_effect = { T = 4 }
		use_magic_special_effect = { T = 5 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 49
				OR = {
					AND = {
						has_character_flag = md_ai_strat_clash
						var:lfire > 1
					}
					scope:char2.var:lshadow > 2
				}
			}
		}
	}
	#type 5.a
	option = {
		name = ev5.28.0.p	#Mental strike
		#name = ev10.1.0.i
		trigger = {
			has_character_flag = mage_duel_type5
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 3 }
		use_magic_special_effect = { T = 3 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash
				var:lpower >= scope:char2.var:lpower
			}
		}
	}
	#type 5.b
	option = {
		name = ev10.1.0.h	#A bursting spell will get the job done.
		trigger = {
			has_character_flag = mage_duel_type5
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_kinetic_damage_effect = { T = 4 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 5.c
	option = {
		name = ev10.1.0.j	#I will hide in the shadows.
		trigger = {
			has_character_flag = mage_duel_type5
			NOR = {
				has_character_flag = shadowstep_flag
				AND = {
					has_trait = archmage
					any_equipped_character_artifact = {
						has_variable = magic_crown
					}
				}
			}
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
				var:lpower > 0
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#type 5.d
	option = {
		name = ev5.28.0.s2	#Shadowstep
		trigger = {
			has_character_flag = mage_duel_type5
			OR = {
				has_character_flag = shadowstep_flag
				AND = {
					has_perk = mage_p4_perk
					any_equipped_character_artifact = {
						has_variable = magic_crown
					}
				}
			}
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 3 }
		use_magic_special_effect = { T = 6 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
				var:lpower > 0
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#type 6.f
	option = {
		#custom spell
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							exists = var:cs_predef_name2
						}
						desc = ev10.1.0.z6a
					}
					desc = ev10.1.0.z6b
				}
			}
		}
		trigger = {
			has_character_flag = mage_duel_type6
			exists = var:my_cs_slot1b
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		add_internal_flag = special
		prepare_custom_spell2_effect = yes
		ai_chance = {
			base = 200
		}
	}
	#type 6.e
	option = {
		name = ev5.28.0.o	#do you need a break?
		trigger = {
			has_trait = arrogant
			has_character_flag = mage_duel_type6
			var:nrround > 1
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		add_stress = minor_stress_loss
		add_prestige = medium_prestige_gain
		ai_chance = {
			base = 0
		}
	}
	#type 6.a
	option = {
		name = ev10.1.0.i	#This will be a solid blow.
		trigger = {
			has_character_flag = mage_duel_type6
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		use_kinetic_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 6.b
	option = {
		#name = ev5.28.0.y	#I will continue to push forward.
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							var:nrround < 2
						}
						desc = ev10.1.0.p	#This will be a good opening.
					}
					desc = ev5.28.0.y	#I will continue to push forward.
				}
			}
		}
		trigger = {
			has_character_flag = mage_duel_type6
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		if = {
			limit = {
				OR = {
					AND = {
						var:lnecrotic > 0
						var:lfire < 3
					}
					var:lnecrotic > 1
				}
				scope:char2 = {
					NOT = {
						has_trait = necromancer
					}
				}
			}
			use_necrotic_damage_effect = { T = 2 }
		}
		else = {
			use_fire_damage_effect = { T = 2 }
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				OR = {
					AND = {
						var:lnecrotic > 0
						var:lfire < 3
					}
					var:lnecrotic > 1
				}
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 6.c
	option = {
		#name = ev5.28.0.f	#I will conjure up a stream of blinding light!
		name = ev10.1.0.l	#Time for a light shield.
		trigger = {
			has_character_flag = mage_duel_type6
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		
		use_magic_shield_effect = { S = 1 }
		use_magic_special_effect = { T = 4 S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 49
				scope:char2.var:lshadow > 2
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#type 6.d
	option = {
		name = ev5.28.0.s3	#plague
		trigger = {
			has_character_flag = mage_duel_type6
			has_character_flag = plague_spell_flag
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		add_internal_flag = special
		use_shadow_damage_effect = { T = 1 }
		use_necrotic_damage_effect = { T = 2 }
		use_magic_special_effect = { T = 7 S = 2 }
		ai_chance = {
			base = 0
			modifier = {
				add = 49
				var:lnecrotic > 1
			}
			modifier = {
				add = 49
				has_character_flag = md_ai_strat_clash2
			}
			modifier = {
				add = -100
				scope:char2 = {
					has_trait = necromancer
				}
			}
		}
	}
	#type 7.a
	option = {
		name = ev10.1.0.m	#I will use the seventh power flow alteration.
		trigger = {
			has_character_flag = mage_duel_type7
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		use_shadow_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
				var:lpower > var:lshadow
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
				var:lpower > var:lshadow
			}
		}
	}
	#type 7.b
	option = {
		name = ev10.1.0.n	#I'm going to try a reverse flow ribbon.
		trigger = {
			has_character_flag = mage_duel_type7
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_shadow_damage_effect = { T = 1 }
		use_power_damage_effect = { T = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
				var:lpower <= var:lshadow
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
				var:lpower <= var:lshadow
			}
		}
	}
	#type 7.c
	option = {
		name = ev10.1.0.o	#A multi-stage kinetic progression will work in my favour.
		trigger = {
			has_character_flag = mage_duel_type7
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_kinetic_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
				var:lpower > 0
				OR = {
					var:nrround > 1
					has_character_flag = may_use_magic_shield_free_flag
				}
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#type 7.e
	option = {
		name = ev10.1.0.s	#Accelerated higher order progression with double amplification!
		trigger = {
			learning > 59
			has_character_flag = mage_duel_type7
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_kinetic_damage_effect = { T = 4 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				var:lpower > 0
			}
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_endurance
				var:lpower > 0
			}
			modifier = {
				add = 199
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#type 7.d
	option = {
		name = ev10.1.0.r	#...maybe simply a fireball?
		trigger = {
			OR = {
				has_trait = shrewd
				has_trait = fickle
			}
			has_character_flag = mage_duel_type7
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_fire_damage_effect = { T = 4 }
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
		}
	}
	#type 8.a
	option = {
		name = ev10.1.0.u	#This is what the end looks like.
		trigger = {
			has_character_flag = mage_duel_type8
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_necrotic_damage_effect = { T = 1 }
		use_shadow_damage_effect = { T = 2 }
		ai_chance = {
			base = 10
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash2
			}
		}
	}
	#type 8.b
	option = {
		name = ev5.28.0.n	#Doom is coming.
		trigger = {
			has_character_flag = mage_duel_type8
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_necrotic_damage_effect = { T = 4 }
		ai_chance = {
			base = 10
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_endurance
			}
			modifier = {
				add = 99
				var:lnecrotic > 1
				has_character_flag = md_ai_strat_clash
			}
		}
	}
	#type 8.c
	option = {
		name = ev10.1.0.w 	#You cannot resist my power.
		trigger = {
			has_character_flag = mage_duel_type8
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_power_damage_effect = { T = 1 }
		use_necrotic_damage_effect = { T = 2 }
		ai_chance = {
			base = 10
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_clash
			}
		}
	}
	#type 8.d
	option = {
		name = ev10.1.0.x	#I like to see your powerlessness.
		trigger = {
			has_character_flag = mage_duel_type8
			NOR = {
				any_secret = {	secret_type = secret_false_mage	}
				has_character_flag = md_winner
				has_character_flag = md_loser
				has_character_flag = md_not_concluded
			}
		}
		use_necrotic_damage_effect = { T = 3 }
		use_magic_shield_effect = { S = 2 }
		ai_chance = {
			base = 10
			modifier = {
				add = 99
				has_character_flag = md_ai_strat_shield
			}
		}
	}
	#no resolution
	option = {
		name = ev5.29.0.a
		trigger = {
			has_character_flag = md_not_concluded
			NOR = {
				has_relation_nemesis = scope:char2
				has_relation_rival = scope:char2
			}
		}
		if = {
			limit = {
				is_ai = no
				scope:char2 = {
					is_ai = yes
				}
			}
			if = {
				limit = {
					NOR = {
						has_relation_nemesis = scope:char2
						has_relation_rival = scope:char2
						has_relation_friend = scope:char2
						has_relation_best_friend = scope:char2
					}
				}
				set_relation_friend = scope:char2
			}
		}
		else = {
			add_dread = minor_dread_gain
		}
	}
	#no resolution
	option = {
		name = ev5.29.0.b
		trigger = {
			has_character_flag = md_not_concluded
		}
		if = {
			limit = {
				is_ai = no
				scope:char2 = {
					is_ai = yes
				}
			}
			if = {
				limit = {
					NOR = {
						has_relation_nemesis = scope:char2
						has_relation_rival = scope:char2
						has_relation_friend = scope:char2
						has_relation_best_friend = scope:char2
					}
				}
				set_relation_rival = scope:char2
			}
		}
		else = {
			add_dread = medium_stress_loss
		}
	}

	option = {
		#end - die!
		name = ev5.28.0.z1
		trigger = {
			has_character_flag = md_winner
		}
		add_proper_prize_for_md_winner_effect = yes
		add_dread = major_dread_gain
		if = {
			limit = {
				scope:char2 = {
					is_a_demon_trigger = yes
					OR = {
						has_character_flag = special_magic_character
						has_character_flag = bael_flag
					}
				}
			}
			consider_demonslayer_nickname = yes
		}
		scope:char2 = {
			add_character_flag = dies_in_md
			show_as_tooltip = {
				death = {
					death_reason = death_duel
					killer = root
				}
				every_character_artifact = {
					limit = {
						has_variable = magic1
					}
					set_owner = {
						target = root
						history = {
							type = stolen
							actor = scope:char2
							recipient = root
							location = scope:char2.location
						}
					}
				}
			}
		}
		
		if = {
			limit = {
				exists = house
				exists = scope:char2.house
				house = scope:char2.house
				scope:char2 = {
					has_trait = grandmaster_coven
				}
			}
			add_trait = grandmaster_coven
		}
		show_as_tooltip = {
			if = {
				limit = {
					exists = house
					exists = scope:char2.house
					house = scope:char2.house
					house.house_head = scope:char2
				}
				house = {
					set_house_head = root
				}
			}
		}
		if = {
			limit = {
				culture = {
					has_cultural_tradition = mage_rulership_tradition
				}
				is_landed_or_landless_administrative = yes
				any_claim = {
					holder = scope:char2
				}
			}
			show_as_tooltip = {
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change
						add_claim_on_loss = yes
					}
		
					every_held_title = {
						limit = {
							any_claimant = {
								this = root
							}
						}
						change_title_holder_include_vassals = {
							holder = root
							change = scope:title_change
						}
					}
					resolve_title_and_vassal_change = scope:title_change
				}
			}
		}
		else_if = {
			limit = {
				culture = {
					has_cultural_tradition = mage_rulership_tradition
				}
				exists = liege
				liege = scope:char2
			}
			show_as_tooltip = {
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change
						add_claim_on_loss = yes
					}
					primary_title = {
						change_title_holder_include_vassals = {
							holder = root
							change = scope:title_change
						}
					}
					change_liege = {
						liege = root
						change = scope:title_change
					}
					resolve_title_and_vassal_change = scope:title_change
				}
			}
		}
		stress_impact = {
			vengeful = medium_stress_loss
			sadistic = medium_stress_loss
			forgiving = medium_stress_gain
			compassionate = medium_stress_gain
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 100
				OR = {
					is_a_demon_trigger = yes
					has_trait = sadistic
					has_trait = callous
					has_trait = vengeful
					has_trait = wrathful
					AND = {
						has_trait = greedy
						exists = scope:char2
						scope:char2 = {
							is_alive = yes
							any_character_artifact = {
								has_variable = magic1
							}
						}
					}
				}
			}
			modifier = {
				add = 50
				has_trait = fickle
			}
			modifier = {
				add = 100
				is_a_demon_trigger = yes
				scope:char2 = {
					has_character_flag = no_soul
				}
			}
			modifier = {
				add = 9999
				OR = {
					exists = scope:demon_annihilator
					has_character_flag = blob_flag
					has_character_flag = asmodeus
					AND = {
						exists = scope:bmage
						ROOT = scope:bmage
					}
					AND = {
						exists = scope:ecommander
						NOR = {
							any_character_war = {
								primary_attacker = ROOT
								primary_defender = scope:char2
							}
							any_character_war = {
								primary_defender = ROOT
								primary_attacker = scope:char2
							}
						}
					}
				}
			}
			modifier = {
				add = -100
				OR = {
					has_trait = forgiving
					has_trait = compassionate
				}
			}
			modifier = {
				add = 100
				has_relation_rival = scope:char2
			}
			modifier = {
				add = 1000
				has_relation_nemesis = scope:char2
			}
		}
	}
	option = {
		#end - I spare you
		name = ev5.28.0.z2
		trigger = {
			has_character_flag = md_winner
			NOT = {
				exists = scope:demon_annihilator
			}
		}
		add_proper_prize_for_md_winner_effect = yes
		add_dread = medium_dread_gain
		show_as_tooltip = {
			if = {
				limit = {
					exists = house
					exists = scope:char2.house
					house = scope:char2.house
					house.house_head = scope:char2
				}
				house = {
					set_house_head = root
				}
			}
		}
		show_as_tooltip = {
			add_hook = {
				type = loyalty_hook
				target = scope:char2
			}
			if = {
				limit = {
					exists = house
					exists = scope:char2.house
					house = scope:char2.house
					scope:char2 = {
						has_trait = grandmaster_coven
					}
				}
				add_trait = grandmaster_coven
				scope:char2 = {
					remove_trait = grandmaster_coven
				}
			}
		}
		scope:char2 = {
			add_character_flag = spared_in_md
			show_as_tooltip = {
				if = {
					limit = {
						has_relation_nemesis = root
					}
					remove_relation_nemesis = root
				}
				else_if = {
					limit = {
						has_relation_rival = root
					}
					remove_relation_rival = root
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 100
				OR = {
					has_trait = compassionate
					has_trait = trusting
					has_trait = calm
					has_trait = forgiving
					has_trait = humble
				}
			}
			modifier = {
				add = 50
				has_trait = fickle
			}
			modifier = {
				add = 200
				OR = {
					has_relation_friend = scope:char2
					has_relation_best_friend = scope:char2
					has_relation_lover = scope:char2
					has_relation_best_friend = scope:char2
					has_relation_mmaster = scope:char2
				}
			}
		}
	}
	option = {
		#end - I will take your items
		name = ev5.28.0.z3
		trigger = {
			has_character_flag = md_winner
			NOT = {
				exists = scope:demon_annihilator
			}
			scope:char2 = {
				any_character_artifact = {
					has_variable=magic1
				}
			}
		}
		add_proper_prize_for_md_winner_effect = yes
		add_dread = medium_dread_gain
		scope:char2 = {
			add_character_flag = spared_in_md_but_items_lost
			show_as_tooltip = {
				every_character_artifact = {
					limit = {
						has_variable = magic1
					}
					set_owner = {
						target = root
						history = {
							type = stolen
							actor = scope:char2
							recipient = root
							location = scope:char2.location
						}
					}
				}
			}
		}
		ai_chance = {
			base = 10
			modifier = {
				add = 100
				OR = {
					has_trait = compassionate
					has_trait = trusting
					has_trait = calm
					has_trait = forgiving
					has_trait = humble
				}
				has_trait = greedy
			}
			modifier = {
				add = 50
				has_trait = fickle
			}
			modifier = {
				add = 200
				OR = {
					has_relation_friend = scope:char2
					has_relation_best_friend = scope:char2
					has_relation_lover = scope:char2
					has_relation_best_friend = scope:char2
					has_relation_mmaster = scope:char2
				}
			}
		}
	}
	option = {
		#end - you surrender in your war
		name = ev5.28.0.z3b
		trigger = {
			has_character_flag = md_winner
			any_character_war = {
				OR = {
					AND = {
						primary_attacker = root
						primary_defender = scope:char2
					}
					AND = {
						primary_attacker = scope:char2
						primary_defender = root
					}
				}
			}
		}
		add_proper_prize_for_md_winner_effect = yes
		add_dread = medium_dread_gain
		if = {
			limit = {
				scope:char2 = {
					is_a_demon_trigger = yes
					has_character_flag = special_magic_character
				}
			}
			consider_demonslayer_nickname = yes
		}
		scope:char2 = {
			add_character_flag = spared_in_md_but_war_is_lost
		}
		show_as_tooltip = {
			every_character_war = {
				limit = {
					OR = {
						AND = {
							primary_attacker = root
							primary_defender = scope:char2
						}
						AND = {
							primary_attacker = scope:char2
							primary_defender = root
						}
					}
				}
				if = {
					limit = {
						primary_attacker = root
					}
					end_war = attacker
				}
				else_if = {
					limit = {
						primary_defender = root
					}
					end_war = defender
				}
			}
		}
		ai_chance = {
			base = 5000
			modifier = {
				add = 50
				has_trait = fickle
			}
		}
	}
	option = {
		#end - I take your titles
		name = ev5.28.0.z3bb
		trigger = {
			has_character_flag = md_winner
			NOT = {
				exists = scope:demon_annihilator
			}
			culture = {
				has_cultural_tradition = mage_rulership_tradition
			}
			is_landed_or_landless_administrative = yes
			OR = {
				any_claim = {
					holder = scope:char2
				}
				AND = {
					exists = liege
					liege = scope:char2
				}
			}
		}
		show_as_tooltip = {
			if = {
				limit = {
					exists = house
					exists = scope:char2.house
					house = scope:char2.house
					house.house_head = scope:char2
				}
				house = {
					set_house_head = root
				}
			}
		}
		if = {
			limit = {
				culture = {
					has_cultural_tradition = mage_rulership_tradition
				}
				any_claim = {
					holder = scope:char2
				}
			}
			show_as_tooltip = {
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change
						add_claim_on_loss = yes
					}
		
					every_held_title = {
						limit = {
							any_claimant = {
								this = root
							}
						}
						change_title_holder_include_vassals = {
							holder = root
							change = scope:title_change
						}
					}
					resolve_title_and_vassal_change = scope:title_change
				}
			}
		}
		else_if = {
			limit = {
				culture = {
					has_cultural_tradition = mage_rulership_tradition
				}
				exists = liege
				liege = scope:char2
			}
			show_as_tooltip = {
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change
						add_claim_on_loss = yes
					}
					primary_title = {
						change_title_holder_include_vassals = {
							holder = root
							change = scope:title_change
						}
					}
					change_liege = {
						liege = root
						change = scope:title_change
					}
					resolve_title_and_vassal_change = scope:title_change
				}
			}
		}
		add_proper_prize_for_md_winner_effect = yes
		add_dread = medium_dread_gain
		scope:char2 = {
			add_character_flag = spared_in_md_but_title_is_lost
		}
		ai_chance = {
			base = 300
		}
	}
	option = {
		#end - I am died
		name = ev5.28.0.z4
		trigger = {
			has_character_flag = dies_in_md
		}
		if = {
			limit = {
				exists = house
				exists = scope:char2.house
				house = scope:char2.house
				house.house_head = root
			}
			house = {
				set_house_head = scope:char2
			}
		}
		if = {
			limit = {
				scope:char2 = {
					culture = {
						has_cultural_tradition = mage_rulership_tradition
					}
					any_claim = {
						holder = root
					}
				}
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = yes
			}

			every_held_title = {
				limit = {
					any_claimant = {
						this = scope:char2
					}
				}
				change_title_holder_include_vassals = {
					holder = scope:char2
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
		}
		else_if = {
			limit = {
				scope:char2 = {
					culture = {
						has_cultural_tradition = mage_rulership_tradition
					}
					exists = liege
					liege = root
				}
			}
			liege = {
				save_scope_as = liege0
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = yes
			}
			primary_title = {
				change_title_holder_include_vassals = {
					holder = scope:char2
					change = scope:title_change
				}
			}
			change_liege = {
				liege = scope:char2
				change = scope:title_change
			}
			resolve_title_and_vassal_change = scope:title_change
			if = {
				limit = {
					exists = scope:liege0
				}
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change2
						add_claim_on_loss = no
					}
					change_liege = {
						liege = scope:liege0
						change = scope:title_change2
					}
					resolve_title_and_vassal_change = scope:title_change2
				}
			}
		}
		show_as_tooltip = {
			death = {
				death_reason = death_duel
				killer = scope:char2
			}
			if = {
				limit = {
					exists = house
					exists = scope:char2.house
					house = scope:char2.house
					has_trait = grandmaster_coven
				}
				scope:char2 = {
					add_trait = grandmaster_coven
				}
			}
		}
		if = {
			limit = {
				scope:char2 = {
					NOT = {
						has_character_flag = asmodeus
					}
				}
			}
			every_character_artifact = {
				limit = {
					has_variable = magic1
				}
				set_owner = {
					target = scope:char2
					history = {
						type = stolen
						actor = root
						recipient = scope:char2
						location = root.location
					}
				}
			}
			if = {
				limit = {
					any_character_artifact = {
						has_artifact_modifier = artifact_ring_of_dead_modifier
					}
					scope:char2 = {
						NOT = {
							any_character_artifact = {
								has_artifact_modifier = artifact_ring_of_dead_modifier
							}
						}
					}
				}
				every_character_artifact = {
					limit = {
						has_artifact_modifier = artifact_ring_of_dead_modifier
					}
					set_owner = {
						target = scope:char2
						history = {
							type = stolen
							actor = root
							recipient = scope:char2
							location = root.location
						}
					}
				}
			}
		}
		
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = asmodeus
				}
				set_global_variable = asmodeus_lost
			}
		}
		#remove_character_flag = dies_in_md
	}
	option = {
		#end - I am spared
		name = ev5.28.0.z5
		trigger = {
			has_character_flag = spared_in_md
		}
		add_stress = medium_stress_loss
		gain_cm_xp5_effect = yes
		if = {
			limit = {
				exists = house
				exists = scope:char2.house
				house = scope:char2.house
				house.house_head = root
			}
			house = {
				set_house_head = scope:char2
			}
		}
		if = {
			limit = {
				has_relation_nemesis = scope:char2
			}
			remove_relation_nemesis = scope:char2
		}
		else_if = {
			limit = {
				has_relation_rival = scope:char2
			}
			remove_relation_rival = scope:char2
		}
		scope:char2 = {
			hidden_effect_new_object = {
				if = {
					limit = {
						has_hook = root
					}
					remove_hook = {
						target = root
					}
				}
			}
			add_hook = {
				type = loyalty_hook
				target = root
			}
		}
		if = {
			limit = {
				exists = house
				exists = scope:char2.house
				house = scope:char2.house
				has_trait = grandmaster_coven
			}
			remove_trait = grandmaster_coven
			scope:char2 = {
				add_trait = grandmaster_coven
			}
		}
		remove_character_flag = spared_in_md
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = asmodeus
				}
				set_global_variable = asmodeus_lost
			}
		}
	}
	option = {
		#end - I lost my items
		name = ev5.28.0.z6
		trigger = {
			has_character_flag = spared_in_md_but_items_lost
			#any_character_artifact = {
			#	has_variable=magic1
			#}
		}
		add_stress = medium_stress_gain
		gain_cm_xp5_effect = yes
		every_character_artifact = {
			limit = {
				has_variable = magic1
			}
			set_owner = {
				target = scope:char2
				history = {
					type = stolen
					actor = root
					recipient = scope:char2
					location = root.location
				}
			}
		}
		remove_character_flag = spared_in_md_but_items_lost
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = asmodeus
				}
				set_global_variable = asmodeus_lost
			}
		}
	}
	option = {
		#end - I lost my war
		name = ev5.28.0.z6
		trigger = {
			has_character_flag = spared_in_md_but_war_is_lost
		}
		add_stress = medium_stress_gain
		gain_cm_xp5_effect = yes
		every_character_war = {
			limit = {
				OR = {
					AND = {
						primary_attacker = root
						primary_defender = scope:char2
					}
					AND = {
						primary_attacker = scope:char2
						primary_defender = root
					}
				}
			}
			if = {
				limit = {
					primary_attacker = root
				}
				end_war = defender
			}
			else_if = {
				limit = {
					primary_defender = root
				}
				end_war = attacker
			}
		}
		remove_character_flag = spared_in_md_but_war_is_lost
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = asmodeus
				}
				set_global_variable = asmodeus_lost
			}
		}
	}
	option = {
		#end - I lost my title
		name = ev5.28.0.z6
		trigger = {
			has_character_flag = spared_in_md_but_title_is_lost
		}
		if = {
			limit = {
				exists = house
				exists = scope:char2.house
				house = scope:char2.house
				house.house_head = root
			}
			house = {
				set_house_head = scope:char2
			}
		}
		if = {
			limit = {
				scope:char2 = {
					culture = {
						has_cultural_tradition = mage_rulership_tradition
					}
					any_claim = {
						holder = root
					}
				}
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = yes
			}

			every_held_title = {
				limit = {
					any_claimant = {
						this = scope:char2
					}
				}
				change_title_holder_include_vassals = {
					holder = scope:char2
					change = scope:title_change
				}
			}
			resolve_title_and_vassal_change = scope:title_change
		}
		else_if = {
			limit = {
				scope:char2 = {
					culture = {
						has_cultural_tradition = mage_rulership_tradition
					}
					exists = liege
					liege = root
				}
			}
			liege = {
				save_scope_as = liege0
			}
			create_title_and_vassal_change = {
				type = granted
				save_scope_as = title_change
				add_claim_on_loss = yes
			}
			primary_title = {
				change_title_holder_include_vassals = {
					holder = scope:char2
					change = scope:title_change
				}
			}
			change_liege = {
				liege = scope:char2
				change = scope:title_change
			}
			resolve_title_and_vassal_change = scope:title_change
			if = {
				limit = {
					exists = scope:liege0
				}
				scope:char2 = {
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change2
						add_claim_on_loss = no
					}
					change_liege = {
						liege = scope:liege0
						change = scope:title_change2
					}
					resolve_title_and_vassal_change = scope:title_change2
				}
			}
		}
		gain_cm_xp5_effect = yes
		
		remove_character_flag = spared_in_md_but_title_is_lost
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = asmodeus
				}
				set_global_variable = asmodeus_lost
			}
		}
	}
	after = {
		hidden_effect_new_object = {
			if = {
				limit = {
					NOT = {
						has_character_flag = banisher_punisher_flag
					}
				}
				clear_ai_strategy_effect = yes
				resolve_md_round_effect = yes
				consider_end_of_duel = yes
				if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_winner
						has_character_flag = md_winner2
					}
					#end of the duel-chain for winner-defender
					show_duel_conclusion_effect = { WINNER = ROOT LOSER = scope:char2 }
					extra_output_event_effect = yes
					if = {
						limit = {
							scope:char2 = {
								is_alive = no
							}
						}
						clear_all_md_staff_effect = yes
					}
					else = {
						scope:char2 = {
							trigger_event = magic_ev10.1
						}
					}
				}
				else_if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_winner	
					}
					add_character_flag = md_winner2
					scope:char2 = {
						md_increas_magic_injury_effect = yes
					}
					trigger_event = magic_ev10.1
				}
				else_if = {
					limit = {
						this = scope:md_attacker
						has_character_flag = md_loser
					}
					
					clear_all_md_staff_effect = yes
					#end of the duel-chain for loser-attacker
					if = {
						limit = {
							exists = scope:char2
							scope:char2 = {
								is_alive = yes
							}
						}
						scope:char2 = {
							clear_all_md_staff_effect = yes
						}
					}
					if = {
						limit = {
							has_character_flag = dies_in_md
						}
						hidden_effect = {
							remove_character_flag = dies_in_md
							death = {
								death_reason = death_duel
								killer = scope:char2
							}
						}
					}
				}
				else_if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_loser
						has_character_flag = md_loser2
					}
					#end of the duel-chain for loser-defender
					if = {
						limit = {
							exists = scope:char2
							scope:char2 = {
								is_alive = yes
							}
						}
						scope:char2 = {
							clear_all_md_staff_effect = yes
						}
					}
					if = {
						limit = {
							has_character_flag = dies_in_md
						}
						hidden_effect = {
							remove_character_flag = dies_in_md
							death = {
								death_reason = death_duel
								killer = scope:char2
							}
						}
					}
				}
				else_if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_loser
					}
					add_character_flag = md_loser2
					md_increas_magic_injury_effect = yes
					scope:char2 = {
						trigger_event = magic_ev10.1
					}
				}
				else_if = {
					limit = {
						this = scope:md_attacker
						has_character_flag = md_winner
					}
					#end of the duel-chain for winner-defender
					show_duel_conclusion_effect = { WINNER = ROOT LOSER = scope:char2 }
					extra_output_event_effect = yes
					if = {
						limit = {
						scope:char2 = {
								is_alive = no
							}
						}
						clear_all_md_staff_effect = yes
					}
					else = {
						scope:char2 = {
							trigger_event = magic_ev10.1
						}
					}
				}
				else_if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_not_concluded
						has_character_flag = md_not_concluded2
					}
					#end of the duel-chain for defender if no resolution
					show_duel_conclusion_effect2 = yes
					clear_all_md_staff_effect = yes
					if = {
						limit = {
							exists = scope:char2
							scope:char2 = {
								is_alive = yes
							}
						}
						scope:char2 = {
							clear_all_md_staff_effect = yes
						}
					}
				}
				else_if = {
					limit = {
						this = scope:md_defender
						has_character_flag = md_not_concluded
					}
					add_character_flag = md_not_concluded2
					scope:char2 = {
						trigger_event = magic_ev10.1
					}
				}
				else_if = {
					limit = {
						this = scope:md_attacker
						has_character_flag = md_not_concluded
					}
					#end of the duel-chain for attacker if no resolution
					scope:char2 = {
						trigger_event = magic_ev10.1
					}
				}
				else = {
					if = {
						limit = {
							NOT = {
								has_character_flag = md_not_concluded
							}
						}
						change_variable = {
							name = mdmana
								add = 10
						}
					}
					scope:char2 = {
						trigger_event = magic_ev10.1
					}
				}
			}
			else = {
				trigger_event = magic_ev10.146
			}
		}
	}
}
#magic epic - custom spell - 1.
magic_ev10.2 = {
	type = character_event
	title = me_custom_spell_option
	desc = ev10.2.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	option = {
		name = e_power_terrain_advantage
		custom_tooltip = spell_will_include_ct1
		hidden_effect = {
			set_variable = {
				name = my_cs_slot1
				value = 1
			}
		}
	}
	option = {
		name = e_fire_terrain_advantage
		custom_tooltip = spell_will_include_ct2
		hidden_effect = {
			set_variable = {
				name = my_cs_slot1
				value = 2
			}
		}
	}
	option = {
		name = e_kinetic_terrain_advantage
		custom_tooltip = spell_will_include_ct3
		hidden_effect = {
			set_variable = {
				name = my_cs_slot1
				value = 3
			}
		}
	}
	option = {
		name = e_shadow_terrain_advantage
		custom_tooltip = spell_will_include_ct4
		hidden_effect = {
			set_variable = {
				name = my_cs_slot1
				value = 4
			}
		}
	}
	option = {
		trigger = {
			duel_necrotic_level_value > 0
		}
		name = e_necrotic_terrain_advantage
		custom_tooltip = spell_will_include_ct5
		hidden_effect = {
			set_variable = {
				name = my_cs_slot1
				value = 5
			}
		}
	}
	after = {
		trigger_event = magic_ev10.3
	}
}
#magic epic - custom spell - 2.
magic_ev10.3 = {
	type = character_event
	title = ev10.3.title
	desc = ev10.3.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	immediate = {
		if = {
			limit = {
				var:my_cs_slot1 = 1
			}
			custom_tooltip = spell_includes_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 2
			}
			custom_tooltip = spell_includes_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 3
			}
			custom_tooltip = spell_includes_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 4
			}
			custom_tooltip = spell_includes_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 5
			}
			custom_tooltip = spell_includes_ct5
		}
	}
	option = {
		name = e_power_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 1
		}
		custom_tooltip = spell_will_include_ct1
		hidden_effect = {
			set_variable = {
				name = my_cs_slot2
				value = 1
			}
		}
	}
	option = {
		name = e_fire_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 2
		}
		custom_tooltip = spell_will_include_ct2
		hidden_effect = {
			set_variable = {
				name = my_cs_slot2
				value = 2
			}
		}
	}
	option = {
		name = e_kinetic_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 3
		}
		custom_tooltip = spell_will_include_ct3
		hidden_effect = {
			set_variable = {
				name = my_cs_slot2
				value = 3
			}
		}
	}
	option = {
		name = e_shadow_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 4
		}
		custom_tooltip = spell_will_include_ct4
		hidden_effect = {
			set_variable = {
				name = my_cs_slot2
				value = 4
			}
		}
	}
	option = {
		trigger = {
			duel_necrotic_level_value > 0
			var:my_cs_slot1 != 5
		}
		name = e_necrotic_terrain_advantage
		custom_tooltip = spell_will_include_ct5
		hidden_effect = {
			set_variable = {
				name = my_cs_slot2
				value = 5
			}
		}
	}
	after = {
		trigger_event = magic_ev10.4
	}
}
#magic epic - custom spell - 3.
magic_ev10.4 = {
	type = character_event
	title = ev10.4.title
	desc = ev10.4.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	immediate = {
		if = {
			limit = {
				var:my_cs_slot1 = 1
			}
			custom_tooltip = spell_includes_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 2
			}
			custom_tooltip = spell_includes_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 3
			}
			custom_tooltip = spell_includes_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 4
			}
			custom_tooltip = spell_includes_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 5
			}
			custom_tooltip = spell_includes_ct5
		}
		if = {
			limit = {
				var:my_cs_slot2 = 1
			}
			custom_tooltip = spell_includes_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 2
			}
			custom_tooltip = spell_includes_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 3
			}
			custom_tooltip = spell_includes_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 4
			}
			custom_tooltip = spell_includes_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 5
			}
			custom_tooltip = spell_includes_ct5
		}
	}
	option = {
		name = ev10.4.a
		custom_tooltip = spell_will_include_ct6
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 6
			}
		}
	}
	option = {
		name = e_power_terrain_advantage
		trigger = {
			#NOR = {
			#	var:my_cs_slot2 = 1
			#	var:my_cs_slot1 = 1
			#}
			var:my_cs_slot1 != 1
		}
		custom_tooltip = spell_will_include_ct1
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 1
			}
		}
	}
	option = {
		name = e_fire_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 2
		}
		custom_tooltip = spell_will_include_ct2
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 2
			}
		}
	}
	option = {
		name = e_kinetic_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 3
		}
		custom_tooltip = spell_will_include_ct3
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 3
			}
		}
	}
	option = {
		name = e_shadow_terrain_advantage
		trigger = {
			var:my_cs_slot1 != 4
		}
		custom_tooltip = spell_will_include_ct4
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 4
			}
		}
	}
	option = {
		trigger = {
			duel_necrotic_level_value > 0
			var:my_cs_slot1 != 5
		}
		name = e_necrotic_terrain_advantage
		custom_tooltip = spell_will_include_ct5
		hidden_effect = {
			set_variable = {
				name = my_cs_slot3
				value = 5
			}
		}
	}
	after = {
		trigger_event = magic_ev10.5
	}
}
#magic epic - custom spell - 4.
magic_ev10.5 = {
	type = character_event
	title = ev10.5.title
	desc = ev10.5.desc
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_imprisoned = no
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	widget = {
		gui = "event_window_widget_enter_text"
		container = "dynamic_birth_name"
		controller = {
			type = text
			data = {
				key = my_custom_spell_name
				#default = my_custom_spell_name_default
				default = {
					localization_key = my_custom_spell_name_default
				}
				default = {
					localization_key = my_custom_spell_name_default2
				}
				default = {
					localization_key = my_custom_spell_name_default3
				}
			}
		}
		setup_scope = {
			root = { save_scope_as = text_target }
		}
	}
	immediate = {
		hidden_effect = {
			save_scope_as = this_is_me
			#set_variable = {
			#	name = tmptmp
			#	value = ROOT
			#}
		}
		if = {
			limit = {
				var:my_cs_slot1 = 1
			}
			custom_tooltip = spell_includes2_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 2
			}
			custom_tooltip = spell_includes2_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 3
			}
			custom_tooltip = spell_includes2_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 4
			}
			custom_tooltip = spell_includes2_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot1 = 5
			}
			custom_tooltip = spell_includes2_ct5
		}
		if = {
			limit = {
				var:my_cs_slot2 = 1
			}
			custom_tooltip = spell_includes2_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 2
			}
			custom_tooltip = spell_includes2_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 3
			}
			custom_tooltip = spell_includes2_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 4
			}
			custom_tooltip = spell_includes2_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot2 = 5
			}
			custom_tooltip = spell_includes2_ct5
		}
		if = {
			limit = {
				var:my_cs_slot3 = 1
			}
			custom_tooltip = spell_includes2_ct1
		}
		else_if = {
			limit = {
				var:my_cs_slot3 = 2
			}
			custom_tooltip = spell_includes2_ct2
		}
		else_if = {
			limit = {
				var:my_cs_slot3 = 3
			}
			custom_tooltip = spell_includes2_ct3
		}
		else_if = {
			limit = {
				var:my_cs_slot3 = 4
			}
			custom_tooltip = spell_includes2_ct4
		}
		else_if = {
			limit = {
				var:my_cs_slot3 = 5
			}
			custom_tooltip = spell_includes_ct5
		}
		else_if = {
			limit = {
				var:my_cs_slot3 = 6
			}
			custom_tooltip = spell_includes2_ct6
		}
	}
	
	option = {
		name = EXCELLENT
		#name = my_custom_spell_name_default4
		custom_tooltip = ev3.28.a_ct
		add_learning_skill = 1
		gain_sc_xp10_effect = yes
		custom_tooltip = ev10.5.completed
	}
	after = {
		hidden_effect = {
			me_clear_progress_flags_effect = yes
			add_character_flag = me_custom_spell_project_done
			#if = {
			#	limit = { NOT = { has_variable = my_custom_spell_name } }
			#	set_variable = {
			#		name = my_custom_spell_name
			#		value = flag:custom
			#	}
			#}
			random_province = {
				save_scope_as = rpro
			}
			create_character = {
				location = scope:rpro
				faith = root.faith
				culture = root.culture
				gender = male
				save_scope_as = temp_spell_host
			}
			if = {
				limit = { NOT = { has_variable = my_custom_spell_name } }
				
				scope:temp_spell_host = {
					copy_localized_text = {
						key = my_custom_spell_name
						target = ROOT
					}
					store_localized_text_in_death = my_custom_spell_name
					#change_first_name = my_custom_spell_name
					#change_first_name = my_custom_spell_name_final
				}
			}
			else_if = {
				limit = {
					exists = var:my_custom_spell_name
					var:my_custom_spell_name = flag:my_custom_spell_name_default
				}
				
				set_variable = {
					name = cs_predef_name
					value = 1
				}
			}
			else_if = {
				limit = {
					exists = var:my_custom_spell_name
					var:my_custom_spell_name = flag:my_custom_spell_name_default2
				}
				set_variable = {
					name = cs_predef_name
					value = 2
				}
			}
			else_if = {
				limit = {
					exists = var:my_custom_spell_name
					var:my_custom_spell_name = flag:my_custom_spell_name_default3
				}
				set_variable = {
					name = cs_predef_name
					value = 3
				}
			}
			else = {
				scope:temp_spell_host = {
					change_first_name = var:my_custom_spell_name
				}
			}
			set_variable = {
				name = my_custom_spell
				value = scope:temp_spell_host
			}
			scope:temp_spell_host = {
				death = natural
			}
		}
	}
}

#teach sorcery - transfer custom spell
magic_ev10.6 = {
	type = character_event
	title = ev10.6.title
	desc = ev10.6.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:disciple
	trigger = {
		is_imprisoned = no
		exists = var:my_cs_slot1
		scope:disciple = {
			is_imprisoned = no
		}
	}
	
	immediate = {
		hidden_effect_new_object = {
			if = {
				limit = {
					exists = var:my_custom_spell
				}
				if = {
					limit = {
						exists = scope:my_custom_spell
					}
					clear_saved_scope = my_custom_spell
				}
				var:my_custom_spell = {
					save_scope_as = my_custom_spell
				}
			}
			random_province = {
				save_scope_as = rpro
			}
			create_character = {
				location = scope:rpro
				faith = root.faith
				culture = root.culture
				gender = male
				save_scope_as = temp_spell_host2
			}
		}
	}
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							exists = var:cs_predef_name
						}
						desc = ev10.6.a1
					}
					desc = ev10.6.a2
				}
			}
		}
		custom_tooltip = ev10.6.a_ct
		scope:disciple = {
			add_prestige = minor_prestige_gain
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 50
			}
		}
		hidden_effect_new_object = {
			scope:disciple = {
				set_variable = {
					name = my_cs_slot1b
					value = root.var:my_cs_slot1
				}
				set_variable = {
					name = my_cs_slot2b
					value = root.var:my_cs_slot2
				}
				set_variable = {
					name = my_cs_slot3b
					value = root.var:my_cs_slot3
				}
				set_variable = {
					name = my_custom_spell2
					value = scope:temp_spell_host2
				}
				set_variable = {
					name = my_custom_spell2_author
					value = root
				}
			}
			if = {
				limit = { NOT = { has_variable = my_custom_spell_name } }
				scope:temp_spell_host2 = {
					copy_localized_text = {
						key = my_custom_spell_name
						target = ROOT
						#target = ROOT.var:my_custom_spell
					}
					store_localized_text_in_death = my_custom_spell_name
				}
				scope:disciple = {
					send_interface_toast = {
						title = ev10.6.a2_notif
						left_icon = this
						right_icon = root
					}
				}
			}
			else = {
				scope:disciple = {
					set_variable = {
						name = cs_predef_name2
						value = root.var:cs_predef_name
					}
					send_interface_toast = {
						title = ev10.6.a1_notif
						left_icon = this
						right_icon = root
					}
				}
			}
		}

		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev10.6.b
		add_stress = minor_stress_loss
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect_new_object = {
			scope:temp_spell_host2 = {
				death = natural
			}
		}
		clear_saved_scope = disciple
		clear_saved_scope = mteacher
	}
}
#add obstacles for stealing artifacts
magic_ev10.7 = {
	hidden = yes
	trigger = {
		has_game_rule = adjusted_magic_schemes
		exists = scope:my_stealing_scheme
		scope:my_stealing_scheme = {
			has_scheme_modifier = magic_stealing_equipped_modifier
		}
		#exists = scope:my_stealing_scheme.scheme_owner
		#scope:my_stealing_scheme.scheme_owner = {
		#	is_alive = yes
		#}
	}
	immediate = {
		scope:my_stealing_scheme = {
			if = {
				limit = {
					exists = var:target_artifact
				}
				if = {
					limit = {
						var:target_artifact = {
							OR = {
								is_equipped = no
								NOT = { category = inventory }
							}
						}
					}
					#add_scheme_modifier = {
					#	type = magic_stealing_equipped_modifier
					#}
					remove_scheme_modifier = magic_stealing_equipped_modifier
				}
			}
			else = {
				scheme_owner = {
					trigger_event = {
						id = magic_ev10.7
						days = 2
					}
				}
			}
		}
	}
}
#counter-spells
magic_ev10.8 = {
	type = character_event
	title = ev10.8.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = root
				}
				desc = ev10.8.desc1b
			}
			desc = ev10.8.desc1a
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						is_legendary_mage_trigger = yes
						AND = {
							is_legendary_mage_trigger = no
							scope:actor = {
								is_legendary_mage_trigger = no
							}
						}
					}
				}
				desc = ev10.8.desc2a
			}
			desc = ev10.8.desc2b
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = root
				}
				desc = ev10.8.desc3a
			}
			desc = ev10.8.desc3b
		}
	}
	theme = witchcraft
	left_portrait = root
	lower_left_portrait = {
		trigger = {
			NOT = {
				ROOT = scope:recipient
			}
		}
		character = scope:recipient
	}
	lower_right_portrait = {
		trigger = {
			OR = {
				AND = {
					is_legendary_mage_trigger = yes
					scope:actor = {
						is_legendary_mage_trigger = yes
					}
				}
				scope:actor = {
					is_legendary_mage_trigger = no
				}
			}
		}
		character = scope:actor
	}
	trigger = {
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:recipient
					OR = {
						AND = {
							is_legendary_mage_trigger = yes
							scope:actor = {
								is_legendary_mage_trigger = yes
							}
						}
						scope:actor = {
							is_legendary_mage_trigger = no
						}
					}
				}
				add_opinion = {
					target = scope:actor
					modifier = use_magic_on_me_opinion2
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:magic_counterer
					}
				}
				save_scope_as = magic_counterer
			}
		}
	}
	option = {
		name = ev10.8.e
		trigger = {
			is_legendary_mage_trigger = yes
			scope:actor = {
				is_legendary_mage_trigger = no
			}
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			trigger_if = {
				limit = { NOT = { scope:recipient = ROOT } }
				scope:actor = { NOT = { has_strong_hook = ROOT } }
			}
		}
		show_as_unavailable = {
			is_legendary_mage_trigger = yes
			scope:actor = {
				is_legendary_mage_trigger = no
			}
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
		}
		custom_tooltip = ev10.8.b_ct
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = spell_countered
					left_icon = ROOT
					custom_tooltip = spell_countered_ct
				}
			}
			if = {
				limit = {
					is_independent_ruler = no
					exists = liege
					exists = scope:recipient.liege
					NOT = {
						ROOT = scope:recipient
					}
					scope:recipient.liege = ROOT.liege
				}
				if = {
					limit = {
						has_character_flag = cm_busy_flag
					}
					remove_character_flag = cm_busy_flag
				}
				add_character_flag = {
					flag = cm_busy_flag
					years = 2
				}
			}
		}
		ai_chance = {
			base = 1000
			modifier = {
				add = -50000
				NOT = {
					ROOT = scope:recipient
				}
				OR = {
					has_relation_rival = scope:recipient
					has_relation_nemesis = scope:recipient
					is_at_war_with = scope:recipient
				}
			}
		}
	}
	option = {
		name = ev10.8.a
		trigger = {
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
			trigger_if = {
				limit = { NOT = { scope:recipient = ROOT } }
				scope:actor = { NOT = { has_strong_hook = ROOT } }
			}
		}
		show_as_unavailable = {
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
		}
		duel = {
			skill = learning
			value = scope:actor.learning
			6 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev10.8.b_ct
				hidden_effect = {
					scope:actor = {
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
							custom_tooltip = spell_countered_ct
						}
					}
					if = {
						limit = {
							OR = {
								is_legendary_mage_trigger = yes
								AND = {
									is_legendary_mage_trigger = no
									scope:actor = {
										is_legendary_mage_trigger = no
									}
								}
							}
						}
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
							right_icon = scope:actor
						}
					}
					else = {
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
						}
					}
					if = {
						limit = {
							is_independent_ruler = no
							exists = liege
							exists = scope:recipient.liege
							NOT = {
								ROOT = scope:recipient
							}
							scope:recipient.liege = ROOT.liege
						}
						if = {
							limit = {
								has_character_flag = cm_busy_flag
							}
							remove_character_flag = cm_busy_flag
						}
						add_character_flag = {
							flag = cm_busy_flag
							years = 2
						}
					}
				}
			}
			4 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev10.8.c_ct
				}
				hidden_effect = {
					scope:actor = {
						send_interface_toast = {
							title = spell_not_countered
							left_icon = scope:recipient
						}
					}
				}
				execute_spells_effect = { ID = scope:actor.var:spell_id }
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 199
				learning > scope:actor.learning
			}
		}
	}
	option = {
		name = ev10.8.a
		trigger = {
			scope:actor = {
				any_equipped_character_artifact = {	has_variable = catalyst	}
			}
			trigger_if = {
				limit = { NOT = { scope:recipient = ROOT } }
				scope:actor = { NOT = { has_strong_hook = ROOT } }
			}
		}
		show_as_unavailable = {
			scope:actor = {
				any_equipped_character_artifact = {	has_variable = catalyst	}
			}
		}
		duel = {
			skill = learning
			value = scope:actor.learning
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				custom_tooltip = ev10.8.b_ct
				hidden_effect = {
					scope:actor = {
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
							custom_tooltip = spell_countered_ct
						}
					}
					if = {
						limit = {
							OR = {
								is_legendary_mage_trigger = yes
								AND = {
									is_legendary_mage_trigger = no
									scope:actor = {
										is_legendary_mage_trigger = no
									}
								}
							}
						}
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
							right_icon = scope:actor
						}
					}
					else = {
						send_interface_toast = {
							title = spell_countered
							left_icon = ROOT
						}
					}
					if = {
						limit = {
							is_independent_ruler = no
							exists = liege
							exists = scope:recipient.liege
							NOT = {
								ROOT = scope:recipient
							}
							scope:recipient.liege = ROOT.liege
						}
						if = {
							limit = {
								has_character_flag = cm_busy_flag
							}
							remove_character_flag = cm_busy_flag
						}
						add_character_flag = {
							flag = cm_busy_flag
							years = 2
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev10.8.c_ct
				}
				hidden_effect = {
					scope:actor = {
						send_interface_toast = {
							title = spell_not_countered
							left_icon = scope:recipient
						}
					}
				}
				execute_spells_effect = { ID = scope:actor.var:spell_id }
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				learning > scope:actor.learning
			}
		}
	}
	option = {
		name = ev10.8.b
		trigger = {
			#has_trait = archmage
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			trigger_if = {
				limit = { NOT = { scope:recipient = ROOT } }
				scope:actor = { NOT = { has_strong_hook = ROOT } }
			}
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
		}
		show_as_unavailable = {
			scope:actor = {
				NOT = {
					any_equipped_character_artifact = {	has_variable = catalyst	}
				}
			}
		}
		spend_standard_ps_effect = yes
		custom_tooltip = ev10.8.b_ct
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = spell_countered
					left_icon = ROOT
					custom_tooltip = spell_countered_ct
				}
			}
			if = {
				limit = {
					is_independent_ruler = no
					exists = liege
					exists = scope:recipient.liege
					NOT = {
						ROOT = scope:recipient
					}
					scope:recipient.liege = ROOT.liege
				}
				if = {
					limit = {
						has_character_flag = cm_busy_flag
					}
					remove_character_flag = cm_busy_flag
				}
				add_character_flag = {
					flag = cm_busy_flag
					years = 2
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				learning <= scope:actor.learning
			}
			modifier = {
				add = 299
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 20
				}
			}
		}
	}
	option = {
		name = ev10.8.b
		trigger = {
			#has_trait = archmage
			custom_description = {
				text = power_needed_custom3
				can_spend_huge_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			trigger_if = {
				limit = { NOT = { scope:recipient = ROOT } }
				scope:actor = { NOT = { has_strong_hook = ROOT } }
			}
			scope:actor = {
				any_equipped_character_artifact = {	has_variable = catalyst	}
			}
		}
		show_as_unavailable = {
			scope:actor = {
				any_equipped_character_artifact = {	has_variable = catalyst	}
			}
		}
		spend_huge_ps_effect = yes
		custom_tooltip = ev10.8.b_ct
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = spell_countered
					left_icon = ROOT
					custom_tooltip = spell_countered_ct
				}
			}
			if = {
				limit = {
					is_independent_ruler = no
					exists = liege
					exists = scope:recipient.liege
					NOT = {
						ROOT = scope:recipient
					}
					scope:recipient.liege = ROOT.liege
				}
				if = {
					limit = {
						has_character_flag = cm_busy_flag
					}
					remove_character_flag = cm_busy_flag
				}
				add_character_flag = {
					flag = cm_busy_flag
					years = 2
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 99
				learning <= scope:actor.learning
			}
			modifier = {
				add = 299
				has_trait_xp = {
					trait = archmage
					track = power_saturation
					value > 19
				}
			}
		}
	}
	option = {
		name = {
			text = {
				first_valid = {
					triggered_desc = {
						trigger = {
							ROOT = scope:recipient
						}
						desc = ev10.8.d
					}
					desc = ev10.8.c
				}
			}
		}
		custom_tooltip = ev10.8.c_ct
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = spell_not_countered
					left_icon = scope:recipient
				}
			}
		}
		execute_spells_effect = { ID = scope:actor.var:spell_id }
		ai_chance = {
			base = 0
			modifier = {
				add = 50000
				NOT = {
					ROOT = scope:recipient
				}
				OR = {
					has_relation_rival = scope:recipient
					has_relation_nemesis = scope:recipient
					is_at_war_with = scope:recipient
				}
			}
		}
	}
}

#AS hit
magic_ev10.9 = {
	type = character_event
	title = ev10.9.title
	desc = ev10.9.desc
	theme = realm
	left_portrait = {
		character = root
		animation = fear
	}
	option = {
		name = ev10.9.d
		trigger = {
			has_trait = demon2
			NOT = {
				has_trait = wounded_3
			}
		}
		if = {
			limit = {
				NOR = {
					has_trait = wounded_1
					has_trait = wounded_2
				}
			}
			add_trait = wounded_1
		}
		else_if = {
			limit = {
				has_trait = wounded_1
			}
			hidden_effect = {
				remove_trait = wounded_1
			}
			add_trait = wounded_2
		}
		else_if = {
			limit = {
				has_trait = wounded_2
			}
			hidden_effect = {
				remove_trait = wounded_2
			}
			add_trait = wounded_3
		}
		custom_tooltip = ev10.9.a_ct
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev10.9.c
		trigger = {
			is_antimagic_trigger = yes
		}
		custom_tooltip = ev10.9.a_ct
		exclusive = yes
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev10.9.a
		trigger = {
			has_perk = mage_p4_perk
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		spend_standard_ps_effect = yes
		show_as_unavailable = {
			is_true_mage = yes
			is_imprisoned = no
		}
		custom_tooltip = ev10.9.a_ct
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev10.9.b
		random_list = {
			80 = {
				show_as_tooltip = {
					death = natural
				}
				hidden_effect = {
					death = {
						death_reason = death_murder
						killer = scope:actor
					}
				}
			}
			20 = {
				trigger = {
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				add_trait = wounded_2
				hidden_effect = {
					if = {
						limit = {
							NOT = {
								has_trait = cancer
							}
						}
						add_trait = cancer
					}
				}
			}
		}
		custom_tooltip = ev10.9.a_ct
		ai_chance = {
			base = 0
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = bael_flag
					is_alive = yes
				}
				di_reveal_astaroth = yes
			}
		}
	}
}

#scrying 4. - schemes
magic_ev10.10 = {
	title = ev4.44.title
	desc = ev10.10.desc
	theme = witchcraft
	left_portrait = root
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			random_character_artifact = {
				limit = {
					has_variable = magic_orb
				}
				save_scope_as = morb
			}
		}
	}
	option = {
		name = ev10.10.a
		every_targeting_scheme = {
			limit = {
				is_type_secret = yes
				is_scheme_exposed = no
			}
			expose_scheme = yes
		}
		custom_tooltip = ev10.10.a_ct
		trigger_event = magic_ev10.11
	}
}
#scrying 5. - the orb
magic_ev10.11 = {
	title = ev4.44.title
	desc = ev10.11.desc
	theme = witchcraft
	left_portrait = root
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						exists = scope:morb
					}
				}
				random_character_artifact = {
					limit = {
						has_variable = magic_orb
					}
					save_scope_as = morb
				}
			}
			if = {
				limit = {
					any_scheme = {
						is_hostile = yes
						NOT = {
							has_scheme_modifier = useful_intel_modifier
						}
					}
				}
				random_scheme = {
					limit = {
						exists = scheme_target_character
						is_hostile = yes
						NOT = {
							has_scheme_modifier = useful_intel_modifier
						}
					}
					save_scope_as = my_scheme
					scheme_target_character = {
						save_scope_as = starget
					}
				}
			}
		}
	}
	option = {
		name = ev10.11.e
		trigger = {
			exists = scope:my_scheme
			exists = scope:starget
		}
		scope:my_scheme = {
			add_scheme_modifier = {
				type = useful_intel_modifier
			}
		}
	}
	option = {
		name = ev10.11.d
		trigger = {
			is_at_war = yes
			NOT = {
				has_character_modifier = war_intel_modifier
			}
		}
		add_character_modifier = {
			modifier = war_intel_modifier
			years = 2
		}
	}
	option = {
		name = ev10.11.a
		trigger = {
			is_landed = yes
		}
		trigger_event = magic_ev10.12
		custom_tooltip = ev10.11.a_ct
	}
	option = {
		name = ev10.11.b
		trigger_event = magic_ev10.13
		custom_tooltip = ev10.11.a_ct
	}
	option = {
		name = ev10.11.c
		trigger = {
			NOT = {
				has_character_modifier = looked_to_the_future
			}
		}
		add_character_modifier = {
			modifier = looked_to_the_future
			years = 2
		}
		
		random = {
			chance = 10
			custom_tooltip = ev10.11.c_ct
			trigger_event = magic_ev10.14
		}
	}
}
#scrying 5. - the orb A
magic_ev10.12 = {
	title = ev4.44.title
	desc = ev10.12.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = {
		trigger = {
			exists = scope:ss1
			exists = scope:ss1.secret_owner
		}
		character = scope:ss1.secret_owner
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:ss2
			exists = scope:ss2.secret_owner
		}
		character = scope:ss2.secret_owner
	}
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			random_character_artifact = {
				limit = {
					has_variable = magic_orb
				}
				save_scope_as = morb
			}
			random_courtier_or_guest = {
				limit = {
					any_secret = {
						NOT = {
							is_known_by = ROOT
						}
					}
				}
				random_secret = {
					limit = {
						NOT = {
							is_known_by = ROOT
						}
					}
					save_scope_as = ss1
				}
			}
			if = {
				limit = {
					exists = scope:ss1
				}
				random_courtier_or_guest = {
					limit = {
						any_secret = {
							NOR = {
								is_known_by = ROOT
								THIS = scope:ss1
							}
						}
					}
					random_secret = {
						limit = {
							NOR = {
								is_known_by = ROOT
								THIS = scope:ss1
							}
						}
						save_scope_as = ss2
					}
				}
			}
			else = {
				random_councillor = {
					limit = {
						any_secret = {
							NOT = {
								is_known_by = ROOT
							}
						}
					}
					random_secret = {
						limit = {
							NOT = {
								is_known_by = ROOT
							}
						}
						save_scope_as = ss1
					}
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:ss1
					}
				}
				capital_province = {
					random_character_in_location = {
						limit = {
							NOT = {
								THIS = ROOT
							}
							any_secret = {
								NOT = {
									is_known_by = ROOT
								}
							}
						}
						random_secret = {
							limit = {
								NOT = {
									is_known_by = ROOT
								}
							}
							save_scope_as = ss1
						}
					}
				}
			}
		}
	}
	option = {
		name = bp2_adult_education.0009.a
		if = {
			limit = {
				exists = scope:ss1
			}
			scope:ss1 = {
				reveal_to = ROOT
			}
		}
		else = {
			add_intrigue_skill = 1
		}
		if = {
			limit = {
				exists = scope:ss2
			}
			scope:ss2 = {
				reveal_to = ROOT
			}
		}
	}
}
#scrying 5. - the orb B
magic_ev10.13 = {
	title = ev4.44.title
	desc = ev10.13.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = {
		trigger = {
			exists = scope:ss1
			exists = scope:ss1.secret_owner
		}
		character = scope:ss1.secret_owner
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:ss2
			exists = scope:ss2.secret_owner
		}
		character = scope:ss2.secret_owner
	}
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					is_landless_adventurer = yes
				}
				if = {
					limit = {
						exists = location
						location = {
							exists = province_owner
						}
					}
					if = {
						limit = {
							location.province_owner = {
								exists = top_liege
							}
						}
						location.province_owner.top_liege = {
							save_scope_as = ref
						}
					}
					else = {
						location.province_owner = {
							save_scope_as = ref
						}
					}
				}
				else = {
					random_ruler = {
						limit = {
							NOT = {
								THIS = ROOT
							}
							any_secret = {
								NOT = {
									is_known_by = ROOT
								}
							}
						}
						save_scope_as = ref
					}
				}
			}
			else_if = {
				limit = {
					is_landed_or_landless_administrative = yes
					is_landed = no
				}
				if = {
					limit = {
						exists = top_liege
						NOT = {
							top_liege = ROOT
						}
					}
					top_liege = {
						#random_neighboring_and_across_water_top_liege_realm_owner = {
						#	save_scope_as = ref
						#}
						random_vassal = {
							limit = {
								NOT = {
									THIS = ROOT
								}
								is_powerful_vassal = yes
							}
							save_scope_as = ref
						}
						if = {
							limit = {
								NOT = {
									exists = scope:ref
								}
							}
							random_neighboring_and_across_water_top_liege_realm_owner = {
								save_scope_as = ref
							}
						}
					}
				}
				else = {
					random_neighboring_and_across_water_top_liege_realm_owner = {
						save_scope_as = ref
					}
				}
			}
			else = {
				random_neighboring_and_across_water_top_liege_realm_owner = {
					save_scope_as = ref
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:ref
					}
				}
				random_ruler = {
					limit = {
						NOT = {
							THIS = ROOT
						}
						any_secret = {
							NOT = {
								is_known_by = ROOT
							}
						}
					}
					save_scope_as = ref
				}
			}
			scope:ref = {
				random_secret = {
					limit = {
						NOT = {
							is_known_by = ROOT
						}
					}
					save_scope_as = ss1
				}
				random_vassal = {
					limit = {
						any_secret = {
							NOT = {
								is_known_by = ROOT
							}
						}
					}
					random_secret = {
						limit = {
							NOT = {
								is_known_by = ROOT
							}
						}
						save_scope_as = ss2
					}
				}
				if = {
					limit = {
						NOT = {
							exists = scope:ss1
						}
					}
					random_courtier_or_guest = {
						limit = {
							any_secret = {
								NOT = {
									is_known_by = ROOT
								}
							}
						}
						random_secret = {
							limit = {
								NOT = {
									is_known_by = ROOT
								}
							}
							save_scope_as = ss1
						}
					}
				}
				if = {
					limit = {
						NOT = {
							exists = scope:ss2
						}
					}
					random_relation = {
						type = friend
						limit = {
							any_secret = {
								NOT = {
									is_known_by = ROOT
								}
							}
						}
						random_secret = {
							limit = {
								NOT = {
									is_known_by = ROOT
								}
							}
							save_scope_as = ss2
						}
					}
				}
			}
		}
	}
	option = {
		#name = ev10.13.a
		name = bp2_adult_education.0009.a
		if = {
			limit = {
				exists = scope:ss1
			}
			scope:ss1 = {
				reveal_to = ROOT
			}
		}
		else = {
			add_intrigue_skill = 1
		}
		if = {
			limit = {
				exists = scope:ss2
			}
			scope:ss2 = {
				reveal_to = ROOT
			}
		}
	}
}

#scrying 5. - the orb C
magic_ev10.14 = {
	title = ev4.44.title
	desc = ev10.14.desc
	theme = witchcraft
	left_portrait = root
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		gain_sc_xp1_effect = yes
	}
	option = {
		name = ev10.14.a
		trigger = {
			NOT = {
				has_character_modifier = war_preparation_modifier
			}
		}
		add_character_modifier = {
			modifier = war_preparation_modifier
			years = 2
		}
	}
	option = {
		name = ev10.14.b
		trigger = {
			NOT = {
				has_character_modifier = travel_down_to_earth_modifier
			}
		}
		add_character_modifier = {
			modifier = travel_down_to_earth_modifier
			years = 2
		}
	}
	option = {
		name = ev10.14.c
		add_piety = medium_piety_gain
		stress_impact = {
			humble = medium_stress_loss
			cynical = medium_stress_gain
		}
	}
	option = {
		name = ev10.14.d
		trigger = {
			OR = {
				has_trait = sadistic
				has_trait = callous
			}
		}
		add_stress = major_stress_loss
	}
}
#scrying 6A. - the orb...
magic_ev10.15 = {
	title = ev4.44.title
	desc = ev10.15.desc
	theme = witchcraft
	left_portrait = root
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			random_character_artifact = {
				limit = {
					has_variable = magic_orb
				}
				save_scope_as = morb
			}
		}
	}
	option = {
		name = ev10.15.a
	}
	option = {
		name = ev10.15.b
	}
	after = {
		trigger_event = magic_ev10.16
	}
}
#scrying 6B. - the orb
magic_ev10.16 = {
	title = ev4.44.title
	desc = ev10.16.desc
	theme = witchcraft
	left_portrait = root
	artifact = {
        target = scope:morb
        position = lower_left_portrait
    }
	
	option = {
		name = ev10.16.a
		add_stress = medium_stress_gain
		if = {
			limit = {
				has_trait = archmage
				has_trait_xp = {
					trait = archmage
					track = secret_knowledge
					value < 100
				}
			}
			gain_sc_xp1_effect = yes
		}
		else = {
			add_learning_skill = 1
		}
		hidden_effect = {
			add_character_flag = met_hundred_handed_flag
		}
	}
}
#AS new form
magic_ev10.17 = {
	title = singularity_name
	desc = ev10.17.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = schadenfreude
	}
	artifact = {
        target = scope:ancsin
        position = lower_left_portrait
    }
	immediate = {
		hidden_effect = {
			scope:ancsin = {
				reforge_artifact = { visuals = ancient_singularity2 type = miscellaneous }
			}
		}
	}
	
	option = {
		name = EXCELLENT
	}
}
#cut schemes
magic_ev10.18 = {
	title = cut_schemes_decision_title
	desc = ev10.18.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	lower_left_portrait = {
		trigger = {
			exists = cp:councillor_spymaster
		}
		character = cp:councillor_spymaster
	}
	trigger = {
		any_targeting_scheme = {
			is_scheme_exposed = yes
			is_hostile = yes
		}
		is_imprisoned = no
	}
	immediate = {
		hidden_effect = {
			random_targeting_scheme = {
				limit = {
					is_scheme_exposed = yes
					is_hostile = yes
				}
				save_scope_as = hscheme
				random_scheme_agent_character = {
					limit = {
						is_ruler = no
						NOT = {
							is_a_demon_trigger = yes
						}
					}
					save_scope_as = hagent
				}
			}
			random_targeting_scheme = {
				limit = {
					is_scheme_exposed = no
					is_hostile = yes
				}
				save_scope_as = hscheme2
			}
		}
	}
	
	option = {
		name = ev10.18.a
		duel = {
			skill = intrigue
			value = scope:hscheme.scheme_owner.intrigue
			5 = {
				desc = board_games.0001.tt.success	#Success
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = ev10.18.a_ct1
				custom_tooltip = ev10.18.a_ct2
				hidden_effect = {
					add_opinion = {
						target = scope:hscheme.scheme_owner
						modifier = plotting_against_me_opinion
					}
					scope:hscheme.scheme_owner = {
						send_interface_toast = {
							title = cut_schemes_decision_title
							left_icon = this
							right_icon = root
							custom_tooltip = ev10.18.a_ct3
						}
					}
					if = {
						limit = {
							exists = scope:hagent
						}
						scope:hscheme = {
							expose_scheme_agent = scope:hagent
						}
					}
					send_interface_toast = {
						title = cut_schemes_decision_title
						scope:hscheme = {
							end_scheme = yes
						}
						if = {
							limit = {
								exists = scope:hagent
							}
							imprison = {
								target = scope:hagent
								type = dungeon
							}
						}
					}
				}
			}
			5 = {
				desc = board_games.0001.tt.failure	#Failure
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				hidden_effect = {
					send_interface_toast = {
						title = cut_schemes_decision_title
						custom_tooltip = ev3.52.a_2
					}
				}
			}
		}
	}
	option = {
		name = ev10.18.b
		trigger = {
			exists = cp:councillor_spymaster
		}
		cp:councillor_spymaster = {
			duel = {
				skill = intrigue
				value = scope:hscheme.scheme_owner.intrigue
				6 = {
					desc = board_games.0001.tt.success	#Success
					compare_modifier = {
						value = scope:duel_value
						multiplier = 1
						min = 0
					}
					ROOT = {
						custom_tooltip = ev10.18.a_ct1
						custom_tooltip = ev10.18.a_ct2
						hidden_effect = {
							add_opinion = {
								target = scope:hscheme.scheme_owner
								modifier = plotting_against_me_opinion
							}
							scope:hscheme.scheme_owner = {
								send_interface_toast = {
									title = cut_schemes_decision_title
									left_icon = this
									right_icon = root
									custom_tooltip = ev10.18.a_ct3
								}
							}
							if = {
								limit = {
									exists = scope:hagent
								}
								scope:hscheme = {
									expose_scheme_agent = scope:hagent
								}
							}
							send_interface_toast = {
								title = cut_schemes_decision_title
								scope:hscheme = {
									end_scheme = yes
								}
								if = {
									limit = {
										exists = scope:hagent
									}
									imprison = {
										target = scope:hagent
										type = dungeon
									}
								}
							}
						}
					}
				}
				4 = {
					desc = board_games.0001.tt.failure	#Failure
					compare_modifier = {
						value = scope:duel_value
						multiplier = -1
						min = 0
					}
					hidden_effect = {
						ROOT = {
							send_interface_toast = {
								title = cut_schemes_decision_title
								#custom_tooltip = ev3.52.a_2
								custom_tooltip = ev10.18.b_ct
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.18.c
		trigger = {
			is_true_mage = yes
			has_character_modifier = mind_reader_modifier
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			is_true_mage = yes
			has_character_modifier = mind_reader_modifier
		}
		custom_tooltip = ev10.18.c_ct
		spend_standard_ps_effect = yes
		custom_tooltip = ev10.18.a_ct1
		custom_tooltip = ev10.18.a_ct2
		custom_tooltip = ev10.18.a_ct4
		hidden_effect = {
			add_opinion = {
				target = scope:hscheme.scheme_owner
				modifier = plotting_against_me_opinion
			}
			scope:hscheme.scheme_owner = {
				send_interface_toast = {
					title = cut_schemes_decision_title
					left_icon = this
					right_icon = root
					custom_tooltip = ev10.18.a_ct3
				}
			}
			if = {
				limit = {
					exists = scope:hscheme2
				}
				scope:hscheme2 = {
					expose_scheme = yes
				}
			}
			if = {
				limit = {
					exists = scope:hagent
				}
				scope:hscheme = {
					expose_scheme_agent = scope:hagent
				}
			}
			send_interface_toast = {
				title = cut_schemes_decision_title
				left_icon = ROOT
				right_icon = scope:hscheme.scheme_owner
				scope:hscheme = {
					end_scheme = yes
				}
				if = {
					limit = {
						exists = scope:hagent
					}
					imprison = {
						target = scope:hagent
						type = dungeon
					}
				}
			}
		}
	}
}
#Aspects of Hell
magic_ev10.19 = {
	title = aspects_of_hell_perk_name
	desc = ev10.19.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	trigger = {
		NOR = {
			has_character_modifier = succubus_modifier
			has_character_modifier = incubus_modifier
			has_character_modifier = hezrou_modifier
			has_character_modifier = whisperer_modifier
		}
	}
	option = {
		name = ev10.19.a
		if = {
			limit = {
				is_male = no
			}
			add_character_modifier = {
				modifier = succubus_modifier
			}
		}
		else = {
			add_character_modifier = {
				modifier = incubus_modifier
			}
		}
	}
	option = {
		name = ev10.19.b
		add_character_modifier = {
			modifier = hezrou_modifier
		}
	}
	option = {
		name = ev10.19.c
		add_character_modifier = {
			modifier = whisperer_modifier
		}
		if = {
			limit = {
				is_witch_trigger = no
			}
			give_witch_secret_or_trait_effect = yes
		}
	}
}
#Demonic Rage - 1.
magic_ev10.20 = {
	title = demonic_rage_perk_name
	desc = ev10.20.desc
	theme = healthcare
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	lower_left_portrait = scope:rc1
	lower_center_portrait = scope:rc2
	lower_right_portrait = scope:rc3
	immediate = {
		hidden_effect_new_object = {
			random_courtier_or_guest = {
				limit = {
					is_adult = yes
					is_powerful_being = no
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
					}
				}
				save_scope_as = rc1
			}
			if = {
				limit = {
					NOT = {
						exists = scope:rc1
					}
				}
				create_character = {
					template = soldier_friend_character
					culture = root.culture
					faith = root.faith
					gender = root
					location = root.location
					save_scope_as = rc1
				}
			}
			random_courtier_or_guest = {
				limit = {
					is_adult = yes
					is_powerful_being = no
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
						THIS = scope:rc1
					}
				}
				save_scope_as = rc2
			}
			if = {
				limit = {
					NOT = {
						exists = scope:rc2
					}
				}
				create_character = {
					template = generic_peasant_character
					gender_female_chance = root_soldier_female_chance
					location = root.location
					culture = root.culture
					faith = root.faith
					dynasty = none
					save_scope_as = rc2
				}
			}
			random_courtier_or_guest = {
				limit = {
					is_adult = yes
					is_powerful_being = no
					NOR = {
						has_trait = wounded_1
						has_trait = wounded_2
						has_trait = wounded_3
						THIS = scope:rc1
						THIS = scope:rc2
					}
				}
				save_scope_as = rc3
			}
			if = {
				limit = {
					NOT = {
						exists = scope:rc3
					}
				}
				create_character = {
					template = generic_peasant_character
					gender_female_chance = root_soldier_female_chance
					location = root.location
					culture = root.culture
					faith = root.faith
					dynasty = none
					save_scope_as = rc3
				}
			}
		}
		hidden_effect = {
			scope:rc1 = {
				add_trait = wounded_3
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
			scope:rc2 = {
				add_trait = wounded_3
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
			scope:rc3 = {
				add_trait = wounded_2
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
		}
		add_dread = medium_dread_gain
	}
	option = {
		name = ev10.20.a
		add_stress = massive_stress_loss
		show_as_tooltip = {
			scope:rc1 = {
				add_trait_force_tooltip = wounded_3
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
			scope:rc2 = {
				add_trait_force_tooltip = wounded_3
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
			scope:rc3 = {
				add_trait_force_tooltip = wounded_2
				add_opinion = {
					target = root
					modifier = cruelty_opinion
					opinion = -60
				}
			}
		}
	}
}
#Demonic Rage - 2. - imprisoned
magic_ev10.21 = {
	title = demonic_rage_perk_name
	desc = ev10.21.desc
	theme = dungeon
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	right_portrait = {
		character = scope:imp
		animation = fear
	}
	lower_left_portrait = scope:rc3
	lower_center_portrait = scope:rc1
	lower_right_portrait = scope:rc2
	immediate = {
		hidden_effect = {
			imprisoner = {
				save_scope_as = imp
				random_courtier_or_guest = {
					limit = {
						is_adult = yes
						is_male = yes
						is_powerful_being = no
						NOR = {
							has_trait = wounded_1
							has_trait = wounded_2
							has_trait = wounded_3
						}
					}
					save_scope_as = rc1
				}
				if = {
					limit = {
						NOT = {
							exists = scope:rc1
						}
					}
					create_character = {
						template = soldier_friend_character
						culture = scope:imp.culture
						faith = scope:imp.faith
						gender = male
						employer = scope:imp
						save_scope_as = rc1
					}
				}
				create_character = {
					template = soldier_friend_character
					culture = scope:imp.culture
					faith = scope:imp.faith
					gender = male
					employer = scope:imp
					save_scope_as = rc2
				}
				create_character = {
					template = soldier_friend_character
					culture = scope:imp.culture
					faith = scope:imp.faith
					gender = male
					employer = scope:imp
					save_scope_as = rc3
				}
			}
			
		}
		scope:imp = {
			add_opinion = {
				target = root
				modifier = cruelty_opinion
				opinion = -50
			}
			hidden_effect = {
				send_interface_toast = {
					title = demonic_rage_perk_name
					left_icon = scope:imp
					right_icon = ROOT
					custom_tooltip = ev10.21.a_cct
				}
			}
		}
		scope:rc3 = {
			death = {
				death_reason = death_chopped_to_pieces
				killer = root
			}
		}
		scope:rc1 = {
			death = {
				death_reason = death_cloven_in_half
				killer = root
			}
		}
		scope:rc2 = {
			death = {
				death_reason = death_skull_cracked_open
				killer = root
			}
		}
		add_dread = medium_dread_gain
		release_from_prison = yes
	}
	option = {
		name = ev10.21.a
		add_stress = medium_stress_loss
	}
}
#Demonic Rage - 3.
magic_ev10.22 = {
	title = demonic_rage_perk_name
	desc = ev10.22.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	option = {
		name = ev10.22.a
		add_stress = major_stress_loss
		if = {
			limit = { is_valid_for_legitimacy_change = yes }
			add_legitimacy = medium_legitimacy_loss
		}
		else = {
			add_prestige = -100
		}
	}
	option = {
		name = ev10.22.b
		add_stress = massive_stress_loss
		add_dread = massive_dread_gain
		if = {
			limit = {
				NOT = {
					has_trait = murderer
				}
			}
			add_trait = murderer
		}
		add_tyranny = major_tyranny_gain
	}
}
#annihilation setup
magic_ev10.23 = {
	hidden = yes
	trigger = {
		scope:actor.location = scope:recipient.location
		is_alive = yes
		is_imprisoned = no
		scope:recipient = {
			is_alive = yes
			is_imprisoned = no
		}
	}
	on_trigger_fail = {
		if = {
			limit = {
				NOT = {
					scope:actor.location = scope:recipient.location
				}
			}
			trigger_event = magic_ev10.24
		}
	}
	immediate = {
		if = {
			limit = {
				scope:recipient = {
					is_ruler = yes
				}
			}
			scope:recipient = {
				trigger_event = magic_ev10.27
			}
		}
		else = {
			if = {
				limit = {
					scope:recipient = {
						OR = {
							is_courtier = yes
							is_foreign_court_guest = yes
						}
						exists = liege
						NOT = {
							liege = scope:actor
						}
						location = liege.location
					}
				}
				scope:recipient = {
					liege = {
						save_scope_as = liege0
						trigger_event = magic_ev10.27
					}
				}
			}
			else = {
				if = {
					limit = {
						scope:recipient = {
							OR = {
								is_powerful_being = yes
								prowess > 20
							}
						}
					}
					trigger_event = magic_ev10.26
				}
				else = {
					trigger_event = magic_ev10.25
				}
			}
		}
	}
}
#annihilation - failure
magic_ev10.24 = {
	title = demon_annihilation
	desc = ev10.24.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = disappointed
	}
	lower_right_portrait = scope:recipient
	immediate = {
		location = {
			random_character_in_location = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					is_powerful_being = no
					is_adult = yes
					is_ai = yes
					is_travel_entourage_character = no
				}
				save_scope_as = rvic
			}
		}
	}
	option = {
		name = ev5.21.0.a	#Damn!
		remove_interaction_cooldown_against = { interaction = demon_annihilation target = scope:recipient }
	}
	option = {
		name = ev10.24.a
		trigger = {
			exists = scope:rvic
		}
		scope:rvic = {
			death = {
				death_reason = death_chopped_to_pieces
				killer = ROOT
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = murderer
				}
			}
			add_trait = murderer
		}
		add_dread = medium_dread_gain
	}
}
#annihilation - easy case
magic_ev10.25 = {
	title = demon_annihilation
	desc = ev10.25.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	right_portrait = scope:recipient
	immediate = {
		scope:recipient = {
			death = {
				death_reason = death_murder
				killer = root
			}
		}
		add_secret = {
			type = secret_murder
			target = scope:recipient
		}
	}
	option = {
		name = ev10.21.a
	}
}
#annihilation - landless figter/mage
magic_ev10.26 = {
	title = demon_annihilation
	desc = ev10.26.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	right_portrait = {
		character = scope:recipient
		animation = war_over_win
	}
	trigger = {
		exists = scope:recipient
		scope:recipient = {
			is_alive = yes
		}
	}
	option = {
		name = ev10.26.a
		if = {
			limit = {
				scope:recipient = {
					is_powerful_being = yes
					is_antimagic_trigger = no
				}
			}
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:recipient
			}
		}
		else = {
			custom_tooltip = start_duel_ct
			configure_start_single_combat_effect = {
				SC_INITIATOR = root
				SC_ATTACKER = root
				SC_DEFENDER = scope:recipient
				FATALITY = always
				FIXED = no
				LOCALE = alley_night
				OUTPUT_EVENT = single_combat.1006
				INVALIDATION_EVENT = fp1_tbc.0021
			}
		}
	}
	option = {
		name = ev10.26.b
		custom_tooltip = ev10.26.b_ct
	}
}
#annihilation - courtier (liege POV)
magic_ev10.27 = {
	title = demon_annihilation
	desc = ev10.27.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = {
		character = scope:actor
		animation = aggressive_sword
	}
	immediate = {
		hidden_effect = {
			random_character_war = {
				limit = {
					OR = {
						AND = {
							primary_attacker = ROOT
							primary_defender = scope:actor
						}
						AND = {
							primary_attacker = scope:actor
							primary_defender = ROOT
						}
					}
				}
				save_scope_as = my_war
			}
			if = {
				limit = {
					NOT = {
						exists = scope:my_war
					}
				}
				random_character_war = {
					limit = {
						OR = {
							AND = {
								primary_attacker = ROOT
								any_war_defender = {
									THIS = scope:actor
								}
							}
							AND = {
								any_war_attacker = {
									THIS = scope:actor
								}
								primary_defender = ROOT
							}
						}
					}
					save_scope_as = my_war
				}
			}
		}
	}
	option = {
		name = ev10.27.a	#I will face him.
		if = {
			limit = {
				ROOT = scope:recipient
			}
			scope:actor = {
				save_scope_as = demon_annihilator
				trigger_event = magic_ev10.29
			}
		}
		else = {
			save_scope_as = aprotector
			scope:actor = {
				trigger_event = magic_ev10.28
			}
		}
		
	}
	option = {
		name = ev10.27.b	#Cover my escape!
		scope:actor = {
			save_scope_as = demon_annihilator
			trigger_event = magic_ev10.29
		}
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:recipient
				}
				send_interface_toast = {
					title = ev10.27.b_ct
					left_icon = ROOT
					right_icon = scope:actor
				}
			}
		}
	}
	option = {
		name = ev10.27.c	#Summon the court mage.
		trigger = {
			employs_court_position = mage_court_position
			NOT = {
				any_court_position_holder = {
					type = mage_court_position
					NOT = { is_at_war_with = root }
					is_imprisoned = no
				}
			}
		}
		random_court_position_holder = {
			type = mage_court_position
			limit = {
				NOT = { is_at_war_with = root }
				is_imprisoned = no
			}
			trigger_event = magic_ev10.30
		}
	}
	option = {
		name = ev10.27.d	#Tell him ... that I surrender.
		trigger = {
			ROOT = scope:recipient
			exists = scope:my_war
		}
		custom_tooltip = ev10.27.d_ct
		scope:actor = {
			trigger_event = magic_ev10.31
		}
	}
}

#annihilation - demon - they are trying to resist
magic_ev10.28 = {
	title = demon_annihilation
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:liege0 = {
						is_landed_or_landless_administrative = yes
					}
				}
				desc = ev10.28.desc1
			}
			desc = ev10.28.desc2
		}
		desc = ev10.28.desc3
	}
	theme = dread
	override_background = { reference = courtyard_location }
	left_portrait = {
		character = ROOT
		animation = aggressive_unarmed
	}
	right_portrait = {
		character = scope:aprotector
		animation = war_over_win
	}
	lower_center_portrait = scope:recipient
	immediate = {
		location = {
			if = {
				limit = {
					any_character_in_location = {
						is_ai = yes
						is_travel_entourage_character = no
						is_powerful_being = no
						is_knight = yes
						NOR = {
							THIS = scope:actor
							THIS = scope:recipient
							trigger_if = {
								limit = {
									exists = scope:aprotector
								}
								THIS = scope:aprotector
							}
							trigger_if = {
								limit = {
									exists = scope:liege0
								}
								THIS = scope:liege0
							}
						}
					}
				}
				scope:actor = {
					if = {
						limit = {
							NOR = {
								has_trait = murderer
								is_at_war_with = scope:recipient
							}
						}
						add_trait = murderer
					}
				}
				random_character_in_location = {
					limit = {
						is_ai = yes
						is_travel_entourage_character = no
						is_powerful_being = no
						is_knight = yes
						NOR = {
							THIS = scope:actor
							THIS = scope:recipient
							trigger_if = {
								limit = {
									exists = scope:aprotector
								}
								THIS = scope:aprotector
							}
						}
					}
					death = {
						death_reason = death_chopped_to_pieces
						killer = scope:actor
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = magic_slaughterer_modifier
				}
			}
			add_character_modifier = {
				modifier = magic_slaughterer_modifier
				years = 3
			}
		}
		stress_impact = {
			sadistic = major_stress_loss
			callous = minor_stress_loss
			compassionate = major_stress_gain
		}

	}
	option = {
		name = ev10.28.a
		save_scope_as = demon_annihilator
		if = {
			limit = {
				scope:aprotector = {
					is_powerful_being = yes
				}
			}
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:aprotector
			}
		}
		else = {
			custom_tooltip = start_duel_ct
			configure_start_single_combat_effect = {
				SC_INITIATOR = root
				SC_ATTACKER = root
				SC_DEFENDER = scope:aprotector
				FATALITY = always
				FIXED = no
				LOCALE = alley_night
				OUTPUT_EVENT = magic_ev10.29
				INVALIDATION_EVENT = fp1_tbc.0021
			}
		}
	}
}
#annihilation - demon - after first obstacle
magic_ev10.29 = {
	title = demon_annihilation
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:aprotector
				}
				desc = ev10.29.desc1
			}
			triggered_desc = {
				trigger = {
					scope:recipient = {
						is_landed_or_landless_administrative = yes
					}
				}
				desc = ev10.28.desc1
			}
			desc = ev10.28.desc2
		}
		triggered_desc = {
			trigger = {
				NOT = {
					exists = scope:aprotector
				}
			}
			desc = ev10.29.desc2
		}
	}
	theme = dread
	override_background = { reference = courtyard_location }
	cooldown = {
		days = 7
	}
	left_portrait = {
		character = ROOT
		#animation = personality_bold
		animation = aggressive_unarmed
	}
	right_portrait = {
		character = scope:recipient
		animation = fear
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:liege0
			NOT = { ROOT = scope:liege0 }
		}
		character = scope:liege0
	}
	trigger = {
		exists = scope:demon_annihilator
		THIS = scope:demon_annihilator
	}
	immediate = {
		if = {
			limit = {
				exists = scope:liege0
			}
			scope:liege0 = {
				random_courtier_or_guest = {
					limit = {
						is_adult = yes
						is_powerful_being = no
					}
					show_as_tooltip = {
						death = {
							death_reason = death_cloven_in_half
							killer = scope:actor
						}
					}
					save_scope_as = dvic1
				}
				random_courtier = {
					limit = {
						is_adult = yes
						is_powerful_being = no
						NOR = {
							has_trait = wounded_1
							has_trait = wounded_2
							has_trait = wounded_3
						}
						trigger_if = {
							limit = { exists = scope:dvic1 }
							NOT = { THIS = scope:dvic1 }
						}
					}
					add_trait = wounded_3
				}
			}
		}
		
		location = {
			random_character_in_location = {
				limit = {
					is_adult = yes
					is_alive = yes
					is_powerful_being = no
					is_travel_entourage_character = no
					NOR = {
						THIS = ROOT
						THIS = scope:recipient
						THIS = scope:actor
					}
				}
				show_as_tooltip = {
					death = {
						death_reason = death_cloven_in_half
						killer = scope:actor
					}
				}
				save_scope_as = dvic2
			}
		}
		if = {
			limit = {
				exists = scope:demon_annihilator
			}
			clear_saved_scope = demon_annihilator
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = magic_slaughterer_modifier
				}
			}
			add_character_modifier = {
				modifier = magic_slaughterer_modifier
				years = 3
			}
		}
	}
	option = {
		name = ev10.29.a
		
		if = {
			limit = {
				scope:recipient = {
					is_powerful_being = yes
				}
			}
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:recipient
			}
		}
		else_if = {
			limit = {
				scope:recipient = {
					OR = {
						prowess > 20
						prowess >= root.prowess
						is_ai = no
					}
				}
			}
			custom_tooltip = start_duel_ct
			configure_start_single_combat_effect = {
				SC_INITIATOR = root
				SC_ATTACKER = root
				SC_DEFENDER = scope:recipient
				FATALITY = always
				FIXED = no
				LOCALE = alley_night
				OUTPUT_EVENT = magic_ev10.29
				INVALIDATION_EVENT = fp1_tbc.0021
			}
		}
		else = {
			scope:recipient = {
				send_interface_toast = {
					title = ev10.29.a_ct
					left_icon = ROOT
					right_icon = scope:recipient
					death = {
						death_reason = death_chopped_to_pieces
						killer = root
					}
				}
			}
			hidden_effect = {
				send_interface_toast = {
					title = demon_annihilation
					left_icon = ROOT
					right_icon = scope:recipient
					show_as_tooltip = {
						scope:recipient = {
							death = {
								death_reason = death_chopped_to_pieces
								killer = root
							}
						}
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					exists = scope:liege0
					scope:liege0 = {
						is_alive = yes
					}
					NOT = {
						scope:liege0 = scope:recipient
					}
				}
				scope:liege0 = {
					trigger_event = {
						id = magic_ev10.61
						days = 1
					}
				}
			}
			else = {
				if = {
					limit = {
						exists = scope:dvic1
					}
					scope:dvic1 = {
						death = {
							death_reason = death_cloven_in_half
							killer = scope:actor
						}
					}
				}
				if = {
					limit = {
						exists = scope:dvic2
					}
					scope:dvic2 = {
						death = {
							death_reason = death_cloven_in_half
							killer = scope:actor
						}
					}
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.29.b
		custom_tooltip = ev10.26.b_ct
		hidden_effect = {
			if = {
				limit = {
					exists = scope:liege0
					scope:liege0 = {
						is_alive = yes
					}
				}
				scope:liege0 = {
					trigger_event = magic_ev10.61
					#send_interface_toast = {
					#	title = ev10.29.b_it
					#	left_icon = scope:liege0
					#	right_icon = ROOT
					#	add_prestige = -100
					#}
				}
			}
			else = {
				scope:recipient = {
					trigger_event = magic_ev10.61
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					exists = scope:aprotector
				}
				clear_saved_scope = aprotector
			}
		}
	}
}
#annihilation - court mage
magic_ev10.30 = {
	title = demon_annihilation
	desc = ev10.30.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = aggressive_sword
	}
	right_portrait = {
		character = scope:liege0
		animation = personality_coward
	}
	lower_center_portrait = scope:actor
	option = {
		name = ev10.30.a
		custom_tooltip = ev10.30.a_ct
		hidden_effect = {
			save_scope_as = aprotector
			scope:actor = {
				trigger_event = magic_ev10.28
			}
		}
	}
	option = {
		name = ev10.30.b
		scope:liege0 = {
			add_opinion = {
				target = ROOT
				modifier = betrayal_opinion
				opinion = -100
			}
			hidden_effect = {
				send_interface_toast = {
					title = mage_court_position
					custom_tooltip = ev10.30.b_ct
				}
			}
		}
		hidden_effect = {
			scope:actor = {
				if = {
					limit = {
						NOT = {
							exists = scope:demon_annihilator
						}
					}
					save_scope_as = demon_annihilator
				}
				trigger_event = magic_ev10.29
			}
		}
	}
}
#annihilation - negotiations
magic_ev10.31 = {
	title = demon_annihilation
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:recipient = {
						is_landed_or_landless_administrative = yes
					}
				}
				desc = ev10.28.desc1
			}
			desc = ev10.28.desc2
		}
		desc= ev10.29.desc2
		desc = ev10.31.desc
	}
	theme = dread
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	right_portrait = {
		character = scope:recipient
		animation = fear
	}
	option = {
		name = ev10.31.a	#No... you will die here and now.
		if = {
			limit = {
				exists = scope:demon_annihilator
			}
			clear_saved_scope = demon_annihilator
		}
		if = {
			limit = {
				scope:recipient = {
					is_powerful_being = yes
				}
			}
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:recipient
			}
		}
		else = {
			custom_tooltip = start_duel_ct
			configure_start_single_combat_effect = {
				SC_INITIATOR = root
				SC_ATTACKER = root
				SC_DEFENDER = scope:recipient
				FATALITY = always
				FIXED = no
				LOCALE = alley_night
				OUTPUT_EVENT = magic_ev10.29
				INVALIDATION_EVENT = fp1_tbc.0021
			}
		}
		hidden_effect = {
			scope:recipient = {
				send_interface_toast = {
					title = ev10.31.a_ct
					left_icon = ROOT
					right_icon = scope:recipient
				}
			}
		}
	}
	option = {
		name = ev54.0.a		#Let it be.
		scope:my_war = {
			if = {
				limit = {
					any_war_attacker = {
						THIS = ROOT
					}
				}
				end_war = attacker
			}
			else = {
				end_war = defender
			}
		}
		hidden_effect = {
			scope:recipient = {
				send_interface_toast = {
					title = ev10.31.b_ct
					left_icon = ROOT
					right_icon = scope:recipient
				}
			}
		}
	}
}
#demonic perk
magic_ev10.32 = {
	title = ev10.32.title
	desc = ev10.32.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	trigger = {
		OR = {
			has_focus = manipulation_focus
			has_focus = destruction_focus
		}
		NOR = {
			has_trait = leper
			has_trait = scaly
			has_character_flag = special_magic_character
		}
	}
	option = {
		name = ev10.32.a
		hidden_effect = {
			add_demon_lifestyle_perk_points = 1
		}
		custom_tooltip = ev10.32.a_ct
		if = {
			limit = {
				has_focus = manipulation_focus
			}
			add_trait = scaly
		}
		if = {
			limit = {
				has_focus = destruction_focus
			}
			add_trait = leper
		}
	}
	option = {
		name = ev10.32.b
		stress_impact = {
			demon1 = minor_stress_gain
			patient = medium_stress_loss
		}
	}
}
#demonic perk 2
magic_ev10.33 = {
	title = manipulation_focus
	desc = ev10.33.desc
	theme = secret
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	lower_left_portrait = scope:truler
	lower_right_portrait = scope:truler2
	trigger = {
		has_focus = manipulation_focus
		OR = {
			is_landed_or_landless_administrative = yes
			AND = {
				exists = location
				location = {
					exists = county_controller
					county_controller = {
						exists = top_liege
					}
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					is_landed_or_landless_administrative = yes
				}
				if = {
					limit = {
						is_independent_ruler = yes
					}
					random_neighboring_and_across_water_top_liege_realm_owner = {
						limit = {
							is_powerful_being = no
							is_adult = yes
							is_ai = yes
						}
						save_scope_as = truler
					}
					#random_vassal = {
					#	limit = {
					#		is_powerful_being = no
					#		is_adult = yes
					#	}
					#	save_scope_as = truler
					#}
				}
				else = {
					top_liege = {
						if = {
							limit = {
								is_powerful_being = no
								is_adult = yes
								is_ai = yes
							}
							save_scope_as = truler
						}
						else = {
							random_neighboring_and_across_water_top_liege_realm_owner = {
								limit = {
									is_powerful_being = no
									is_adult = yes
									is_ai = yes
								}
								save_scope_as = truler
							}
						}
					}
				}
			}
			else = {
				location = {
					county_controller = {
						top_liege = {
							save_scope_as = truler
						}
					}
				}
			}
			scope:truler = {
				random_neighboring_and_across_water_top_liege_realm_owner = {
					limit = {
						is_powerful_being = no
						NOR = {
							THIS = scope:truler
							THIS = ROOT
							is_at_war_with = scope:truler
							is_allied_to = scope:truler
							has_truce = scope:truler
						}
					}
					save_scope_as = truler2
				}
				if = {
					limit = {
						NOT = {
							exists = scope:truler2
						}
					}
					random_ruler = {
						limit = {
							is_landed = yes
							in_diplomatic_range = scope:truler
							is_powerful_being = no
							NOR = {
								THIS = scope:truler
								THIS = ROOT
								is_at_war_with = scope:truler
								is_allied_to = scope:truler
								has_truce = scope:truler
							}
						}
						save_scope_as = truler2
					}
				}
			}
			scope:truler2 = {
				random_held_title = {
					limit = {
						is_titular = no
					}
					save_scope_as = ttitle
				}
			}
		}
	}
	option = {
		name = ev10.33.a
		hidden_effect = {
			add_demon_lifestyle_perk_points = 1
		}
		custom_tooltip = ev10.32.a_ct
		scope:truler = {
			hidden_effect = {
				if = {
					limit = {
						NOT = {
							has_claim_on = scope:ttitle
						}
					}
					add_pressed_claim = scope:ttitle
				}
			}
			start_war = {
				cb = claim_cb
				target = scope:truler2.top_liege
				claimant = scope:truler
				target_title = scope:ttitle
			}
		}
	}
	option = {
		name = ev10.33.b
		add_intrigue_skill = 1
	}
}

#demonic perk 3
magic_ev10.34 = {
	title = destruction_focus
	desc = ev10.34.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = personality_callous
	}
	lower_center_portrait = scope:vvic1
	lower_right_portrait = scope:vvic2
	trigger = {
		has_focus = destruction_focus
		exists = location
		location = {
			any_character_in_location = {
				is_powerful_being = no
				is_ruler = no
				is_adult = yes
				count > 1
			}
		}
	}
	immediate = {
		hidden_effect = {
			location = {
				random_character_in_location = {
					limit = {
						is_powerful_being = no
						is_ruler = no
						is_adult = yes
					}
					save_scope_as = vvic1
				}
				random_character_in_location = {
					limit = {
						is_powerful_being = no
						is_ruler = no
						is_adult = yes
						trigger_if = {
							limit = {
								exists = scope:vvic1
							}
							NOT = {
								THIS = scope:vvic1
							}
						}
					}
					save_scope_as = vvic2
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:vvic1
					}
				}
				create_character = {
					template = soldier_friend_character
					culture = root.culture
					faith = root.faith
					gender = root
					location = root.location
					save_scope_as = vvic1
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:vvic2
					}
				}
				create_character = {
					template = soldier_friend_character
					culture = root.culture
					faith = root.faith
					gender = root
					location = root.location
					save_scope_as = vvic2
				}
			}
		}
	}
	option = {
		name = ev10.34.a
		hidden_effect = {
			add_demon_lifestyle_perk_points = 1
		}
		custom_tooltip = ev10.32.a_ct
		if = {
			limit = {
				is_ruler = no
				exists = liege
			}
			send_interface_toast = {
				title = demonic_rage_perk_name
				left_icon = ROOT
				show_as_tooltip = {
					scope:vvic1 = {
						death = {
							death_reason = death_cloven_in_half
							killer = root
						}
					}
					scope:vvic2 = {
						death = {
							death_reason = death_skull_cracked_open
							killer = root
						}
					}
					if = {
						limit = {
							NOT = {
								has_character_modifier = magic_slaughterer_modifier
							}
						}
						ROOT = {
							add_character_modifier = {
								modifier = magic_slaughterer_modifier
								years = 4
							}
						}
					}
				}
			}
		}
		scope:vvic1 = {
			death = {
				death_reason = death_cloven_in_half
				killer = root
			}
		}
		scope:vvic2 = {
			death = {
				death_reason = death_skull_cracked_open
				killer = root
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = murderer
				}
			}
			add_trait = murderer
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = magic_slaughterer_modifier
				}
			}
			add_character_modifier = {
				modifier = magic_slaughterer_modifier
				years = 4
			}
		}
		if = {
			limit = {
				NOR = {
					has_trait = compassionate
					has_trait = sadistic
					has_trait = callous
				}
			}
			stress_impact = {
				compassionate = major_stress_gain
				sadistic = major_stress_loss
				callous = medium_stress_loss
			}
		}
		else = {
			add_stress = minor_stress_loss
		}
	}
	option = {
		name = ev10.34.b
	}
}

#false mage - becoming
magic_ev10.35 = {
	title = secret_false_mage
	desc = ev10.35.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = personality_cynical
	}
	cooldown = {
		years = 100
	}
	trigger = {
		is_imprisoned = no
		can_unlock_arcane_focus_trigger = no
		is_false_mage = no
		NOT = {
			has_character_modifier = liar_liar_modifier
		}
		NOT = {
			has_trait = honest
		}
	}
	immediate = {
		save_scope_as = just_me
	}
	option = {
		name = ev10.35.a
		become_false_mage_effect = yes
		stress_impact = {
			deceitful = medium_stress_loss
			honest = medium_stress_gain
		}
		add_prestige = minor_prestige_gain
		hidden_effect = {
			trigger_event = {
				id = magic_ev10.36
				years = { 1 3 }
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1000
				has_character_flag = special_magic_character
			}
			modifier = {
				add = -1000
				OR = {
					has_trait = honest
					has_trait = just
					has_trait = calm
				}
			}
			modifier = {
				add = 2
				OR = {
					has_trait = arrogant
					has_trait = deceitful
				}
			}
		}
	}
	option = {
		name = ev10.35.b
		stress_impact = {
			deceitful = medium_stress_gain
			honest = medium_stress_loss
		}
		ai_chance = {
			base = 2
		}
	}
}
#false mage - continue
magic_ev10.36 = {
	title = secret_false_mage
	desc = ev10.36.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = scheme
	}
	trigger = {
		is_imprisoned = no
		is_false_mage = yes
	}
	option = {
		name = char_interaction.0220.a	#Good.
		add_dread = minor_dread_gain
		add_prestige = medium_prestige_gain
	}
}

#witch contract #12 - lift the curse - 1.
magic_ev10.37 = {
	title = laamp_magic_1012_desc_title
	desc = ev10.37.desc
	theme = intrigue
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
				if = {
					limit = {
						NOT = {
							has_character_modifier = cursed_modifier
						}
					}
					add_character_modifier = {
						modifier = cursed_modifier
						months = 20
					}
				}
			}
		}
	}
	option = {
		name = ev10.37.a
		trigger_event = magic_ev10.38
	}
}
#witch contract #12 - lift the curse - 2.
magic_ev10.38 = {
	title = laamp_magic_1012_desc_title
	desc = ev10.38.desc
	theme = intrigue
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
	}
	option = {
		name = ev10.38.a
		trigger_event = magic_ev10.39
	}
	option = {
		name = ev10.38.b
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			invalidate_contract = yes
		}
	}
}
#witch contract #12 - lift the curse - 3.
magic_ev10.39 = {
	title = laamp_magic_1012_desc_title
	#desc = ev10.39.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						OR = {
							is_powerful_being = yes
							has_trait = true_witch
							has_perk = magical_senses_perk
							has_perk = healer_p9_perk
						}
					}
				}
				desc = ev10.39.desc2
			}
			desc = ev10.39.desc1
		}
	}
	theme = intrigue
	override_background = { reference = throne_room }
	left_portrait = {
		character = root
		animation = personality_rational
	}
	right_portrait = {
		character = scope:employer
	}
	option = {
		name = ev10.39.a
		trigger = {
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
		}
		add_internal_flag = special
		stress_impact = {
			lifestyle_mystic = minor_stress_loss
			compassionate = minor_stress_loss
		}
		scope:employer = {
			remove_character_modifier = cursed_modifier
		}
		scope:task_contract = {
			complete_task_contract = success_critical
		}
	}
	option = {
		name = ev10.39.c
		stress_impact = {
			deceitful = medium_stress_loss
			honest = medium_stress_gain
		}
		duel = {
			skill = intrigue
			target = scope:employer
			5 = {
				desc = ev9.27.0.c1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:task_contract = {
						complete_task_contract = success_standard
					}
				}
				hidden_effect = {
					random = {
						chance = 40
						trigger_event = {
							id = magic_ev10.35
							days = 2
						}
					}
				}
			}
			5 = {
				desc = ev9.27.0.c2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
				if = {
					limit = {
						NOT = {
							has_trait = gallowsbait
						}
					}
					add_trait = gallowsbait
				}
				add_trait_xp = {
					trait = gallowsbait
					track = trickster
					value = 20
				}
			}
		}
	}
	option = {
		name = ev10.39.b
		trigger = {
			OR = {
				has_trait = true_witch
				has_perk = magical_senses_perk
			}
			NOR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
		}
		stress_impact = {
			lifestyle_mystic = minor_stress_loss
		}
		scope:employer = {
			add_opinion = {
				target = ROOT
				modifier = impressed_opinion
				opinion = 10
			}
		}
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			invalidate_contract = yes
		}
	}
	option = {
		name = ev10.38.b
		custom_tooltip = ev9.27.0.c_ct
		scope:task_contract = {
			invalidate_contract = yes
		}
	}
}

#proposal for landless mages
magic_ev10.40 = {
	type = letter_event
	opening = ev10.40.opening
	desc = ev10.40.desc
	sender = scope:ruler
	trigger = {
		has_trait = archmage
		NOT = {
			has_character_flag = got_court_mage_proposal_flag
		}
		OR = {
			is_landless_adventurer = yes
			is_pool_character = yes
		}
		exists = location
		exists = location.province_owner
		exists = location.province_owner.top_liege
		location.province_owner.top_liege = {
			is_ai = yes
			highest_held_title_tier >= tier_kingdom
			any_held_county = {
				exists = title_province
				count > 1
			}
			is_powerful_being = no
			NOR = {
				has_trait = paranoid
				has_trait = zealous
				has_trait = cynical
				has_relation_rival = ROOT
				has_relation_nemesis = ROOT
			}
			OR = {
				has_trait = ambitious
				has_trait = scholar
				has_trait = lifestyle_mystic
				has_trait = lifestyle_herbalist
				has_trait = avaricious
				has_trait = architect
				has_trait = callous
				has_trait = craven
				is_witch_trigger = yes
			}
			NOT = {
				any_court_position_holder = {
					type = mage_court_position
					has_trait = archmage
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			location.province_owner.top_liege = {
				save_scope_as = ruler
			}
		}
	}
	option = {
		name = ev10.40.a
		trigger = {
			any_secret = {
				secret_type = secret_false_mage
			}
		}
		custom_tooltip = ev10.40.a_ct
		add_prestige = minor_prestige_gain
		stress_impact = {
			deceitful = minor_stress_loss
			greedy = minor_stress_loss
		}
		hidden_effect = {
			scope:ruler = {
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 10
				}
			}
			trigger_event = {
				id = magic_ev10.41
				days = 7
			}
		}
	}
	option = {
		name = ev10.40.b
		add_prestige = minor_prestige_gain
		scope:ruler = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 20
			}
		}
		hidden_effect = {
			trigger_event = {
				id = magic_ev10.41
				days = 7
			}
		}
	}
	option = {
		name = ev10.40.c
		scope:ruler = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -10
			}
		}
		stress_impact = {
			paranoid = major_stress_loss
			shy = minor_stress_loss
		}
	}
	after = {
		hidden_effect = {
			add_character_flag = {
				flag = got_court_mage_proposal_flag
				years = 100
			}
		}
	}
}


#proposal for landless mages - 2
magic_ev10.41 = {
	type = letter_event
	opening = ev10.40.opening
	desc = ev10.41.desc
	sender = scope:ruler
	trigger = {
		has_trait = archmage
		OR = {
			is_landless_adventurer = yes
			is_pool_character = yes
		}
		scope:ruler = {
			is_ai = yes
			highest_held_title_tier >= tier_kingdom
			any_held_county = {
				exists = title_province
				count > 1
			}
			is_powerful_being = no
			NOR = {
				has_trait = paranoid
				has_trait = zealous
				has_trait = cynical
				has_relation_rival = ROOT
				has_relation_nemesis = ROOT
				has_character_flag = distrusts_mages_flag
			}
			OR = {
				has_trait = ambitious
				has_trait = scholar
				has_trait = lifestyle_mystic
				has_trait = lifestyle_herbalist
				has_trait = avaricious
				has_trait = architect
				has_trait = callous
				has_trait = craven
				is_witch_trigger = yes
			}
			NOT = {
				any_court_position_holder = {
					type = mage_court_position
					has_trait = archmage
				}
			}
		}
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					scope:ruler = {
						government_has_flag = government_is_administrative
					}
				}
				save_scope_as = adventurer
				save_scope_as = actor
				scope:ruler = {
					save_scope_as = recipient
				}
			}
			else = {
				save_scope_as = recipient
				scope:ruler = {
					save_scope_as = actor
					random_held_county = {
						limit = {
							NOT = {
								THIS = scope:ruler.capital_county
							}
						}
						add_to_list = offered_titles
						save_scope_as = new_primary_title
					}
				}
			}
		}
	}
	option = {
		name = ev10.41.a
		stress_impact = {
			greedy = medium_stress_loss
			ambitious = medium_stress_loss
		}
		if = {
			limit = {
				is_ruler = yes
			}
			if = {
				limit = {
					scope:ruler = {
						government_has_flag = government_is_administrative
					}
				}
				hidden_effect = {
					save_scope_value_as = { name = piety_option value = no }
					save_scope_value_as = { name = gold_option value = no }
					save_scope_value_as = { name = hook value = no }
				}
				procure_estate_interaction_effect = yes
			}
			else = {
				hidden_effect = {
					save_scope_value_as = {
						name = negotiate_settlement_legitimacy_cost
						value = 0
					}
				}
				negotiate_settlement_interaction_effect = yes
			}
			hidden_effect = {
				every_held_title = {
					limit = {
						any_claimant = {
							THIS = scope:ruler
						}
					}
					scope:ruler = {
						remove_claim = PREV
					}
				}
			}
		}
		else = {
			scope:ruler = {
				add_courtier = ROOT
			}
		}
		
		hidden_effect = {
			scope:ruler = {
				add_opinion = {
					target = ROOT
					modifier = friendliness_opinion
					opinion = 50
				}
				if = {
					limit = {
						any_court_position_holder = {
							type = mage_court_position
						}
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
				
				#if = {
				#	limit = {
				#		any_court_position_holder = {
				#			type = mage_court_position
				#		}
				#	}
				#	random_court_position_holder = {
				#		type = mage_court_position
				#		add_opinion = {
				#			target = ROOT
				#			modifier = hate_opinion
				#			opinion = -50
				#		}
				#		revoke_court_position = mage_court_position
				#	}
				#}
			}
		}
		scope:ruler = {
			appoint_court_position = {
				recipient = ROOT
				court_position = mage_court_position
			}
		}
	}
	option = {
		name = ev10.41.b
		add_prestige = minor_prestige_gain
		scope:ruler = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -10
			}
		}
		stress_impact = {
			greedy = medium_stress_gain
			ambitious = minor_stress_gain
		}
	}
}

#court mage - alchemy research
magic_ev10.42 = {
	type = character_event
	title = ev10.42.title
	desc = ev10.42.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = liege
	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_court_position = mage_court_position
		has_character_flag = cm_task_1_flag
		NOT = {
			has_character_flag = cm_busy_flag
		}
		exists = liege
		liege = {
			is_imprisoned = no
		}
		NOT = {
			has_strong_hook = liege
		}
		NOT = {
			is_at_war_with = liege
		}
	}
	immediate = {
		hidden_effect = {
			scope:liege = {
				save_scope_as = liege0
			}
		}
	}
	option = {
		name = ev10.42.a
		trigger = {
			trigger_if = {
				limit = { is_ai = yes }
			}
			gold > major_gold_value_check
		}
		show_as_tooltip = {
			add_prestige = medium_prestige_gain
		}
		pay_short_term_gold = {
			target = scope:liege0
			gold = major_gold_value_check
		}
		hidden_effect = {
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = ROOT
					show_as_tooltip = {
						ROOT = {
							pay_short_term_gold = {
								target = scope:liege0
								gold = major_gold_value_check
							}
						}
					}
				}
			}
			send_interface_toast = {
				title = ev10.42.a_ct
				scope:liege0 = {
					add_opinion = {
						target = ROOT
						modifier = pleased_opinion
						opinion = 10
					}
				}
				add_prestige = medium_prestige_gain
			}
		}
		stress_impact = {
			greedy = major_stress_gain
			generous = major_stress_loss
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 5
				opinion = {
					target = scope:liege0
					value > 50
				}
			}
			modifier = {
				add = -5
				opinion = {
					target = scope:liege0
					value < 0
				}
			}
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = generous
			}
			modifier = {
				add = 2
				has_character_flag = cm_yellow_card_flag
			}
		}
	}
	option = {
		name = ev10.42.e
		trigger = {
			has_trait = archmage
			has_trait_xp = {
				trait = archmage
				track = alchemy
				value >= 100
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			has_trait = archmage
			has_trait_xp = {
				trait = archmage
				track = alchemy
				value >= 100
			}
		}
		show_as_tooltip = {
			add_prestige = medium_prestige_gain
		}
		
		hidden_effect = {
			set_spell_id = { ID = 22 }
			send_message_4_magic_sense_effect = yes
		}
		custom_tooltip = use_magic_custom_tooltip
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		scope:liege0 = {
			add_gold = root.greedy_gold_value
		}
		hidden_effect = {
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = ROOT
					show_as_tooltip = {
						add_gold = root.greedy_gold_value
					}
				}
			}
			send_interface_toast = {
				title = ev10.42.a_ct
				scope:liege0 = {
					add_opinion = {
						target = ROOT
						modifier = pleased_opinion
						opinion = 10
					}
				}
				add_prestige = medium_prestige_gain
			}
		}
		stress_impact = {
			greedy = minor_stress_gain
			generous = major_stress_loss
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 20
				opinion = {
					target = scope:liege0
					value > 20
				}
			}
			modifier = {
				add = -200
				opinion = {
					target = scope:liege0
					value < -10
				}
			}
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 10
				has_trait = generous
			}
			modifier = {
				add = 20
				has_character_flag = cm_yellow_card_flag
			}
		}
	}
	option = {
		name = ev10.42.b
		show_as_tooltip = {
			pay_short_term_gold = {
				target = scope:liege0
				gold = 5
			}
		}
		if = {
			limit = {
				has_character_flag = cm_yellow_card_flag
			}
			if = {
				limit = {
					is_false_mage = no
					NOT = {
						has_trait = deceitful
					}
				}
				add_stress = minor_stress_gain
			}
			
			custom_tooltip = ev10.42.b_ct
			custom_tooltip = ev2.61.e_ct
		}
		else = {
			custom_tooltip = ev10.42.b_ct2
		}
		hidden_effect = {
			add_character_flag = {
				flag = cm_poduced_5_gold_flag
				months = 1
			}
			scope:liege0 = {
				trigger_event = magic_ev10.43
			}
		}
		if = {
			limit = {
				is_false_mage = yes
			}
			stress_impact = {
				deceitful = minor_stress_loss
				honest = minor_stress_gain
			}
		}
		ai_chance = {
			base = 2
			
		}
	}
	option = {
		name = ev10.42.c
		liege = {
			add_opinion = {
				target = root
				modifier = lazy_court_mage_modifier
				years = 4
			}
		}
		custom_tooltip = ev2.61.e_ct
		liege = {
			trigger_event = magic_ev10.43
		}
		if = {
			limit = {
				NOR = {
					has_trait = callous
					has_trait = content
					has_trait = calm
				}
			}
			add_stress = minor_stress_gain
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = lazy
			}
		}
	}
	option = {
		name = ev10.42.d
		trigger = {
			learning > 24
			liege = {
				NOT = {
					has_character_modifier = cm_research_notes_modifier
				}
			}
		}
		gain_al_xp_small_effect = yes
		stress_impact = {
			diligent = minor_stress_loss
			scholar = medium_stress_loss
		}
		liege = {
			send_interface_toast = {
				title = ev10.42.title_ct
				add_character_modifier = {
					modifier = cm_research_notes_modifier
					years = 4
				}
				gain_al_xp_small_effect = yes
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = lazy
			}
		}
	}
	option = {
		name = ev10.50.h
		trigger = {
			can_use_healing_spell = yes
			liege = {
				OR = {
					has_trait = ill
					has_trait = pneumonic
					has_trait = great_pox
					has_trait = early_great_pox
					has_trait = lovers_pox
					has_trait = leper
					has_trait = wounded_1
					has_trait = wounded_2
					has_trait = wounded_3
					has_trait = maimed
					has_trait = infirm
					has_trait = incapable
					has_trait = gout_ridden
					has_trait = consumption
					has_trait = cancer
					has_trait = typhus
					has_trait = bubonic_plague
					has_trait = smallpox
					has_trait = sickly
					has_trait = blind
					has_trait = disfigured
					has_character_modifier = chronic_headaches_modifier
					has_character_modifier = infected_wound_modifier
					has_character_modifier = gangrene_modifier
					has_trait = measles
					has_trait = dysentery
					has_trait = ergotism
					has_trait = scarred
					has_trait = beardless_eunuch
					has_trait = eunuch_1
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			liege = {
				custom_description = {
					text = has_magic_immunity
					is_antimagic_trigger = no
				}
			}
		}
		trait = archmage
		show_as_unavailable = {
			can_use_healing_spell = yes
			liege = {
				OR = {
					has_trait = ill
					has_trait = pneumonic
					has_trait = great_pox
					has_trait = early_great_pox
					has_trait = lovers_pox
					has_trait = leper
					has_trait = wounded_1
					has_trait = wounded_2
					has_trait = wounded_3
					has_trait = maimed
					has_trait = infirm
					has_trait = incapable
					has_trait = gout_ridden
					has_trait = consumption
					has_trait = cancer
					has_trait = typhus
					has_trait = bubonic_plague
					has_trait = smallpox
					has_trait = sickly
					has_trait = blind
					has_trait = disfigured
					has_character_modifier = chronic_headaches_modifier
					has_character_modifier = infected_wound_modifier
					has_character_modifier = gangrene_modifier
					has_trait = measles
					has_trait = dysentery
					has_trait = ergotism
					has_trait = scarred
					has_trait = beardless_eunuch
					has_trait = eunuch_1
				}
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 4 }
			save_scope_as = magic_user
			send_message_4_magic_sense_effect = yes
		}
		spend_standard_ps_effect = yes
		custom_tooltip = use_magic_custom_tooltip1
		liege = {
			send_interface_toast = {
				title = ev10.42.title_ct
				full_healing_effect = yes
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 2
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 50
				opinion = {
					target = scope:liege0
					value > 0
				}
			}
			modifier = {
				add = 10
				has_trait = compassionate
			}
		}
	}
}

#court mage - alchemy research - liege's POV
magic_ev10.43 = {
	type = character_event
	title = lazy_court_mage_modifier
	#desc = ev10.43.desc
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:cmage = {
						has_character_flag = cm_need_more_time_flag
					}
				}
				desc = ev10.43.desc
				#desc = ev2.65.desc
			}
			triggered_desc = {
				trigger = {
					exists = scope:tchar0
				}
				desc = ev10.43.desc3
			}
			triggered_desc = {
				trigger = {
					scope:cmage = {
						has_character_flag = cm_poduced_5_gold_flag
					}
				}
				desc = ev10.43.desc2
			}
			desc = ev10.43.desc1
		}
	}
	theme = realm
	left_portrait = root
	right_portrait = scope:cmage

	immediate = {
		scope:cmage = {
			if = {
				limit = {
					has_character_flag = cm_poduced_5_gold_flag
				}
				pay_short_term_gold = {
					target = scope:liege0
					gold = 5
				}
			}
		}
	}
	option = {
		name = ev10.43.a
		custom_tooltip = ev10.43.a_ct
		hidden_effect = {
			scope:cmage = {
				if = {
					limit = {
						has_character_flag = cm_busy_flag
					}
					remove_character_flag = cm_busy_flag
				}
				add_character_flag = {
					flag = cm_busy_flag
					years = 3
				}
				send_interface_toast = {
					title = ev2.61.title
					left_icon = ROOT
					custom_tooltip = ev10.43.a
				}
			}
		}
		scope:cmage = {
			if = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							modifier = pleased_opinion
							target = ROOT
						}
					}
				}
				add_opinion = {
					target = ROOT
					modifier = pleased_opinion
					opinion = 20
				}
			}
		}
		stress_impact = {
			generous = minor_stress_loss
			trusting = minor_stress_loss
			patient = medium_stress_loss
			impatient = medium_stress_gain
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 5
				OR = {
					has_trait = content
					has_trait = trusting
				}
			}
			modifier = {
				add = 5
				has_trait = patient
				scope:cmage = {
					has_character_flag = cm_poduced_5_gold_flag
				}
			}
		}
	}
	option = {
		name = ev2.65.a	#You have more time
		hidden_effect = {
			scope:cmage = {
				if = {
					limit = {
						NOT = {
							has_character_flag = cm_yellow_card_flag
						}
					}
					add_character_flag = {
						flag = cm_yellow_card_flag
						years = 5
					}
				}
				send_interface_toast = {
					title = ev2.61.title
					left_icon = ROOT
					custom_tooltip = ev2.65.a_ct
				}
			}
		}
		stress_impact = {
			patient = minor_stress_loss
			impatient = minor_stress_gain
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 8
				scope:cmage = {
					has_character_flag = cm_poduced_5_gold_flag
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = patient
					has_trait = trusting
				}
			}
		}
	}
	option = {
		trigger = {
			intrigue >20
			NOT = { has_hook = scope:cmage }
			NOT = {
				scope:cmage = {
					has_character_flag = cm_poduced_5_gold_flag
				}
			}
		}
		skill = intrigue
		name = ev2.65.c	#I'll use you anyway
		add_hook = {
			type = manipulation_hook
			target = scope:cmage
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev2.65.b	#You are useless
		revoke_court_position = {
			court_position = mage_court_position
		}
		scope:cmage = {
			add_character_flag = {
				flag = revoked_cmage
				years = 10
			}
		}
		hidden_effect = {
			add_opinion = {
				target = scope:cmage
				modifier = disappointed_opinion
				opinion = -20
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1
				scope:cmage = {
					has_character_flag = cm_poduced_5_gold_flag
				}
			}
			modifier = {
				add = 10
				scope:cmage = {
					has_character_flag = cm_yellow_card_flag
				}
			}
			modifier = {
				add = -1
				scope:cmage = {
					has_character_flag = cm_task_2_flag
					NOT = {
						has_character_flag = cm_yellow_card_flag
					}
				}
			}
			modifier = {
				add = 1
				has_trait = impatient
				scope:cmage = {
					has_character_flag = cm_yellow_card_flag
				}
			}
			modifier = {
				add = -100
				scope:cmage = {
					is_ai = yes
					is_true_mage = yes
				}
			}
		}
	}
}
#court mage - after transmutation
magic_ev10.44 = {
	type = character_event
	title = ev10.42.title
	desc = ev10.44.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = liege
	trigger = {
		exists = liege
		liege = {
			is_imprisoned = no
		}
		NOT = {
			has_strong_hook = liege
		}
		NOT = {
			is_at_war_with = liege
		}
	}

	option = {
		name = ev10.44.a
		trait = archmage
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		liege = {
			add_gold = root.greedy_gold_value
			add_opinion = {
				target = ROOT
				modifier = pleased_opinion
				opinion = 50
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = ROOT
					show_as_tooltip = {
						add_gold = root.greedy_gold_value
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 4
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = liege
					value > 20
				}
			}
		}
	}
	option = {
		name = ev10.44.c
		trigger = {
			diplomacy > 20
			liege = {
				is_powerful_being = no
				is_ai = yes
			}
			NOT = {
				has_hook = liege
			}
		}
		trait = archmage
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		liege = {
			add_gold = root.greedy_gold_value
			hidden_effect = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = ROOT
					show_as_tooltip = {
						add_gold = root.greedy_gold_value
					}
				}
			}
		}
		add_hook = {
			type = favor_hook
			target = liege
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.44.b
		ai_chance = {
			base = 2
			modifier = {
				add = 1000
				OR = {
					has_relation_rival = liege
					has_relation_nemesis = liege
				}
			}
		}
	}
}
#court mage - after creating potion
magic_ev10.45 = {
	type = character_event
	title = ev10.42.title
	desc = ev10.45.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = liege
	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_court_position = mage_court_position
		has_character_flag = cm_task_1_flag
		exists = liege
		liege = {
			is_imprisoned = no
		}
		NOT = {
			has_strong_hook = liege
		}
		NOT = {
			is_at_war_with = liege
		}
	}

	option = {
		name = ev10.45.a
		liege = {
			send_interface_toast = {
				title = ev10.42.title_ct
				left_icon = root
				scope:newly_created_artifact = {
					set_owner = {
						target = PREV
						history = {
							type = given
							actor = root
							recipient = PREV
							location = PREV.location
						}
					}
				}
			}
			add_opinion = {
				target = ROOT
				modifier = pleased_opinion
				opinion = 20
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 4
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = liege
					value > 20
				}
			}
		}
	}
	option = {
		name = ev10.45.b
		trigger = {
			liege = {
				NOR = {
					has_character_modifier = health_potion_modifier
					has_character_modifier = intoxicating_perfume_modifier
					has_character_modifier = intrigue_risky_poison_experimentation_modifier
				}
			}
			trigger_if = {
				limit = { is_ai = yes }
				gold > potion_gold_value2
			}
		}
		remove_short_term_gold = potion_gold_value2
		liege = {
			random_list = {
				1 = {
					send_interface_toast = {
						title = ev10.42.title_ct
						left_icon = ROOT
						add_character_modifier = {
							modifier = health_potion_modifier
							years = 3
						}
					}
				}
				1 = {
					send_interface_toast = {
						title = ev10.42.title_ct
						left_icon = ROOT
						add_character_modifier = {
							modifier = intoxicating_perfume_modifier
							years = 3
						}
					}
				}
				1 = {
					send_interface_toast = {
						title = ev10.42.title_ct
						left_icon = ROOT
						add_character_modifier = {
							modifier = intrigue_risky_poison_experimentation_modifier
							years = 3
						}
					}
				}
			}
			add_opinion = {
				target = ROOT
				modifier = pleased_opinion
				opinion = 20
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.45.c
		ai_chance = {
			base = 1
			modifier = {
				add = 1000
				OR = {
					has_relation_rival = liege
					has_relation_nemesis = liege
				}
			}
		}
	}
}

#Lilith and her dresses
magic_ev10.46 = {
	title = ev10.46.title
	desc = ev10.46.desc
	theme =  mental_health
	override_background = { reference = bedchamber }
	left_portrait = {
		character = ROOT
		animation = eyeroll
	}
	right_portrait = {
		character = scope:target
		animation = personality_rational
	}
	option = {
		name = ev10.46.a
		stress_impact = {
			impatient = major_stress_gain
			wrathful = major_stress_gain
			irritable = major_stress_gain
		}
	}
	option = {
		name = ev10.46.b
		stress_impact = {
			impatient = major_stress_gain
			wrathful = major_stress_gain
			irritable = major_stress_gain
		}
	}
	option = {
		name = ev10.46.c
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -20
			}
		}
	}
	option = {
		name = ev10.46.d
		trigger = {
			OR = {
				has_trait = lustful
				has_trait = rakish
				has_trait = shrewd
			}
		}
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = flattered_opinion
				opinion = 20
			}
		}
		had_sex_with_effect = {
			CHARACTER = scope:target
			PREGNANCY_CHANCE = pregnancy_chance
		}
		if = {
			limit = {
				NOT = {
					has_trait = chaste
				}
			}
			add_stress = minor_stress_loss
		}
		stress_impact = {
			chaste = minor_stress_gain
		}
	}
}

#Lilith and dungeons, part 1.
magic_ev10.47 = {
	title = ev10.47.title
	desc = ev10.47.desc
	theme =  mental_health
	override_background = { reference = bedchamber }
	left_portrait = {
		character = ROOT
		animation = interested
	}
	right_portrait = {
		character = scope:target
		animation = flirtation
	}
	cooldown = {
		years = 100
	}
	option = {
		name = ev10.47.a
		trigger = {
			NOR = {
				has_trait = lustful
				has_trait = rakish
				has_trait = eccentric
			}
		}
		stress_impact = {
			chaste = medium_stress_gain
		}
		if = {
			limit = {
				any_prisoner = {
					is_adult = yes
				}
			}
			show_as_tooltip = {
				had_sex_with_effect = {
					CHARACTER = scope:target
					PREGNANCY_CHANCE = pregnancy_chance
				}
			}
			trigger_event = magic_ev10.48
		}
		else = {
			had_sex_with_effect = {
				CHARACTER = scope:target
				PREGNANCY_CHANCE = pregnancy_chance
			}
		}
	}
	option = {
		name = ev10.47.b
		trigger = {
			OR = {
				has_trait = lustful
				has_trait = rakish
				has_trait = eccentric
			}
		}
		add_stress = medium_stress_loss
		if = {
			limit = {
				any_prisoner = {
					is_adult = yes
					is_powerful_being = no
				}
			}
			show_as_tooltip = {
				had_sex_with_effect = {
					CHARACTER = scope:target
					PREGNANCY_CHANCE = pregnancy_chance
				}
			}
			trigger_event = magic_ev10.48
		}
		else = {
			had_sex_with_effect = {
				CHARACTER = scope:target
				PREGNANCY_CHANCE = pregnancy_chance
			}
		}
	}
	option = {
		name = ev10.47.c
		if = {
			limit = { has_character_modifier = joy_with_lilith_modifier }
			remove_character_modifier = joy_with_lilith_modifier
		}
		hidden_effect = {
			add_character_flag = {
				flag = failed_lilith_flag
				years = 6
			}
		}
	}
}
#Lilith and dungeons, part 2.
magic_ev10.48 = {
	title = ev10.47.title
	desc = ev10.48.desc
	theme =  mental_health
	override_background = { reference = dungeon }
	left_portrait = {
		character = ROOT
	}
	right_portrait = {
		character = scope:target
		animation = happiness
	}
	lower_center_portrait = scope:vic1
	immediate = {
		hidden_effect = {
			random_prisoner = {
				limit = {
					is_adult = yes
					is_powerful_being = no
				}
				save_scope_as = vic1
			}
		}
	}
	option = {
		name = ev10.48.a
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = love_opinion
				opinion = 20
			}
			add_stress = massive_stress_loss
		}
		had_sex_with_effect = {
			CHARACTER = scope:target
			PREGNANCY_CHANCE = pregnancy_chance
		}
		trigger_event = magic_ev10.49
	}
	option = {
		name = ev10.48.b
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -20
			}
		}
		if = {
			limit = { has_character_modifier = joy_with_lilith_modifier }
			remove_character_modifier = joy_with_lilith_modifier
		}
		hidden_effect = {
			add_character_flag = {
				flag = failed_lilith_flag
				years = 6
			}
		}
	}
}
#Lilith and dungeons, part 3.
magic_ev10.49 = {
	title = ev10.47.title
	desc = ev10.49.desc
	theme =  mental_health
	override_background = { reference = dungeon }
	left_portrait = {
		character = ROOT
		animation = shock
		outfit_tags = { no_clothes }
	}
	right_portrait = {
		character = scope:target
		animation = ecstasy
		outfit_tags = { no_clothes }
	}
	lower_center_portrait = scope:vic1
	immediate = {
		scope:vic1 = {
			death = {
				death_reason = death_murder
				killer = scope:target
			}
		}
		scope:target = {
			add_secret = {
				type = secret_murder
				target = scope:vic1
			}
		}
	}
	option = {
		name = ev10.49.b
		add_stress = minor_stress_gain
		stress_impact = {
			compassionate = medium_stress_gain
			just = minor_stress_gain
		}
	}
	option = {
		name = ev10.49.a
		trigger = {
			OR = {
				has_trait = patient
				has_trait = calm
			}
		}
	}
	option = {
		name = ev10.49.c
		trigger = {
			OR = {
				has_trait = sadistic
				has_trait = callous
				has_trait = torturer
			}
		}
		scope:target = {
			add_opinion = {
				target = ROOT
				modifier = love_opinion
				opinion = 50
			}
		}
		add_stress = major_stress_loss
	}
	option = {
		name = ev10.49.d
		trigger = {
			OR = {
				has_trait = eccentric
				has_trait = fickle
			}
		}
		add_stress = minor_stress_loss
	}
}

#court mage - magic
magic_ev10.50 = {
	type = character_event
	title = ev10.42.title
	desc = ev10.50.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = liege
	lower_left_portrait = {
		trigger = {
			exists = scope:tchar1
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
				any_secret = {
					secret_type = secret_false_mage
				}
				has_trait = deceitful
				AND = {
					has_perk = healer_p9_perk
					can_spend_standard_ps_trigger = no
				}
			}
		}
		character = scope:tchar1
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:tchar2
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
		}
		character = scope:tchar2
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:tchar3
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
		}
		character = scope:tchar3
	}
	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_court_position = mage_court_position
		has_character_flag = cm_task_2_flag
		NOT = {
			has_character_flag = cm_busy_flag
		}
		exists = liege
		liege = {
			is_imprisoned = no
		}
		NOT = {
			has_strong_hook = liege
		}
		NOT = {
			is_at_war_with = liege
		}
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					is_ai = yes
					is_ruler = no
					can_be_power_saturated_trigger = yes
					is_true_mage = yes
				}
				gain_standard_ps_effect = yes
			}
			save_scope_as = actor
			liege = {
				save_scope_as = liege0
				if = {
					limit = {
						exists = capital_county
						capital_county = {
							NOT = {
								has_county_modifier = blessed_land_modifier
							}
						}
					}
					capital_county = {
						save_scope_as = tcounty
					}
				}
				else_if = {
					limit = {
						any_held_county = {
							NOT = {
								has_county_modifier = blessed_land_modifier
							}
						}
					}
					random_held_county = {
						limit = {
							NOT = {
								has_county_modifier = blessed_land_modifier
							}
						}
						save_scope_as = tcounty
					}
				}
				if = {
					limit = {
						any_relation = {
							type = nemesis
							NOT = { THIS = ROOT }
						}
					}
					random_relation = {
						type = nemesis
						limit = { NOT = { THIS = ROOT } }
						save_scope_as = tchar1
					}
				}
				if = {
					limit = {
						any_relation = {
							type = rival
							NOT = { THIS = ROOT }
							trigger_if = {
								limit = {
									exists = scope:tchar1
								}
								NOT = {
									THIS = scope:tchar1
								}
							}
						}
					}
					random_relation = {
						type = rival
						limit = { NOT = { THIS = ROOT } }
						if = {
							limit = {
								exists = scope:tchar1
							}
							save_scope_as = tchar2
						}
						else = {
							save_scope_as = tchar1
						}
					}
				}
				if = {
					limit = {
						NOT = {
							exists = scope:tchar2
						}
					}
					random_relation = {
						type = rival
						limit = {
							NOT = {
								THIS = scope:tchar1
							}
							NOT = { THIS = ROOT }
						}
						save_scope_as = tchar2
					}
				}
				if = {
					limit = {
						is_at_war = yes
					}
					random_war_enemy = {
						limit = {
							is_adult = yes
							NOT = { THIS = ROOT }
							trigger_if = {
								limit = {
									exists = scope:tchar1
								}
								NOT = { THIS = scope:tchar1 }
							}
							trigger_if = {
								limit = {
									exists = scope:tchar2
								}
								NOT = { THIS = scope:tchar2 }
							}
						}
						save_scope_as = tchar3
					}
				}
			}
		}
	}
	option = {
		name = ev10.50.a
		trigger = {
			exists = scope:tchar1
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
			scope:tchar1 = {
				custom_description = {
					text = has_magic_immunity
					has_immunity_for_regular_curse = no
				}
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			exists = scope:tchar1
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 2 }
			save_scope_as = magic_user
			scope:tchar1 = {
				save_scope_as = recipient
				save_scope_as = potential_tar
			}
			scope:liege0 = {
				trigger_event = {
					id = magic_ev2.63
					days = 1
				}
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		stress_impact = {
			compassionate = medium_stress_impact_gain
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}
		execute_or_counter_spell_effect = { SID = 2 }
		send_message_4_magic_sense_effect = yes
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1000
				opinion = {
					target = scope:tchar1
					value > 30
				}
			}
		}
	}
	option = {
		name = ev10.50.b
		trigger = {
			exists = scope:tchar2
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
			scope:tchar2 = {
				custom_description = {
					text = has_magic_immunity
					has_immunity_for_regular_curse = no
				}
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			exists = scope:tchar2
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 2 }
			save_scope_as = magic_user
			scope:tchar2 = {
				save_scope_as = recipient
				save_scope_as = potential_tar
			}
			scope:liege0 = {
				trigger_event = {
					id = magic_ev2.63
					days = 1
				}
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		stress_impact = {
			compassionate = medium_stress_impact_gain
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}
		execute_or_counter_spell_effect = { SID = 2 }
		send_message_4_magic_sense_effect = yes
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1000
				opinion = {
					target = scope:tchar2
					value > 30
				}
			}
		}
	}
	option = {
		name = ev10.50.c
		trigger = {
			exists = scope:tchar3
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
			scope:tchar3 = {
				custom_description = {
					text = has_magic_immunity
					has_immunity_for_regular_curse = no
				}
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			exists = scope:tchar3
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 2 }
			save_scope_as = magic_user
			scope:tchar3 = {
				save_scope_as = recipient
				save_scope_as = potential_tar
			}
			scope:liege0 = {
				trigger_event = {
					id = magic_ev2.63
					days = 1
				}
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		stress_impact = {
			compassionate = medium_stress_impact_gain
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}
		display_extended_duration_spell_catalyst = yes
		execute_or_counter_spell_effect = { SID = 2 }
		send_message_4_magic_sense_effect = yes
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1000
				opinion = {
					target = scope:tchar3
					value > 30
				}
			}
		}
	}
	option = {
		name = ev10.50.d
		trigger = {
			exists = scope:tcounty
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			exists = scope:tcounty
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
		}
		set_spell_id = { ID = 11 }
		gain_sc_xp1_effect = yes
		spend_standard_ps_effect = yes
		if = {
			limit = {
				root = {
					any_equipped_character_artifact = {
						has_variable = catalyst
					}
				}
			}
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					scope:tcounty = {
						add_county_modifier = {
							modifier = blessed_land_modifier
							years = 20
						}
					}
				}
			}
		}
		else = {
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					scope:tcounty = {
						add_county_modifier = {
							modifier = blessed_land_modifier
							years = 10
						}
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 3
		}
	}
	option = {
		name = ev10.50.i
		trigger = {
			has_character_flag = thorn_walls_spell_flag
			scope:liege0 = {
				is_at_war = yes
			}
			exists = scope:liege0.capital_county
			scope:liege0.capital_county = {
				NOT = {
					has_county_modifier = thorn_walls_modifier
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			has_character_flag = thorn_walls_spell_flag
			scope:liege0 = {
				is_at_war = yes
			}
			exists = scope:liege0.capital_county
			scope:liege0.capital_county = {
				NOT = {
					has_county_modifier = thorn_walls_modifier
				}
			}
		}
		set_spell_id = { ID = 34 }
		gain_sc_xp1_effect = yes
		spend_standard_ps_effect = yes
		if = {
			limit = {
				root = {
					any_equipped_character_artifact = {
						has_variable = catalyst
					}
				}
			}
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					capital_county = {
						add_county_modifier = {
							modifier = thorn_walls_modifier
							years = 10
						}
					}
				}
			}
		}
		else = {
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					capital_county = {
						add_county_modifier = {
							modifier = thorn_walls_modifier
							years = 5
						}
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 3
		}
	}
	option = {
		name = ev10.50.e
		trigger = {
			scope:liege0 = {
				NOR = {
					has_character_modifier = aura_boost1_modifier
					has_character_modifier = aura_boost2_modifier
				}
			}
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			scope:liege0 = {
				NOR = {
					has_character_modifier = aura_boost1_modifier
					has_character_modifier = aura_boost2_modifier
				}
			}
			OR = {
				is_true_mage = yes
				has_perk = healer_p9_perk
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 10 }
			save_scope_as = magic_user
			send_message_4_magic_sense_effect = yes
		}
		spend_standard_ps_effect = yes
		custom_tooltip = use_magic_custom_tooltip1
		if = {
			limit = {
				any_equipped_character_artifact = {
					has_variable = catalyst
				}
			}
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					add_character_modifier = {
						modifier = aura_boost1_modifier
						years = 50
					}
				}
			}
		}
		else = {
			scope:liege0 = {
				send_interface_toast = {
					title = ev10.42.title_ct
					add_character_modifier = {
						modifier = aura_boost1_modifier
						years = 50
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 3
		}
	}
	option = {
		name = ev10.50.h
		trigger = {
			can_use_healing_spell = yes
			liege = {
				OR = {
					has_trait = ill
					has_trait = pneumonic
					has_trait = great_pox
					has_trait = early_great_pox
					has_trait = lovers_pox
					has_trait = leper
					has_trait = wounded_1
					has_trait = wounded_2
					has_trait = wounded_3
					has_trait = maimed
					has_trait = infirm
					has_trait = incapable
					has_trait = gout_ridden
					has_trait = consumption
					has_trait = cancer
					has_trait = typhus
					has_trait = bubonic_plague
					has_trait = smallpox
					has_trait = sickly
					has_trait = blind
					has_trait = disfigured
					has_character_modifier = chronic_headaches_modifier
					has_character_modifier = infected_wound_modifier
					has_character_modifier = gangrene_modifier
					has_trait = measles
					has_trait = dysentery
					has_trait = ergotism
					has_trait = scarred
					has_trait = beardless_eunuch
					has_trait = eunuch_1
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		trait = archmage
		show_as_unavailable = {
			can_use_healing_spell = yes
			liege = {
				OR = {
					has_trait = ill
					has_trait = pneumonic
					has_trait = great_pox
					has_trait = early_great_pox
					has_trait = lovers_pox
					has_trait = leper
					has_trait = wounded_1
					has_trait = wounded_2
					has_trait = wounded_3
					has_trait = maimed
					has_trait = infirm
					has_trait = incapable
					has_trait = gout_ridden
					has_trait = consumption
					has_trait = cancer
					has_trait = typhus
					has_trait = bubonic_plague
					has_trait = smallpox
					has_trait = sickly
					has_trait = blind
					has_trait = disfigured
					has_character_modifier = chronic_headaches_modifier
					has_character_modifier = infected_wound_modifier
					has_character_modifier = gangrene_modifier
					has_trait = measles
					has_trait = dysentery
					has_trait = ergotism
					has_trait = scarred
					has_trait = beardless_eunuch
					has_trait = eunuch_1
				}
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 4 }
			save_scope_as = magic_user
			send_message_4_magic_sense_effect = yes
		}
		spend_standard_ps_effect = yes
		custom_tooltip = use_magic_custom_tooltip1
		liege = {
			send_interface_toast = {
				title = ev10.42.title_ct
				left_icon = ROOT
				right_icon = THIS
				full_healing_effect = yes
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 3
		}
	}
	option = {
		name = ev10.50.g
		trigger = {
			exists = scope:tchar1
			OR = {
				AND = {
					NOR = {
						has_trait = true_witch
						has_perk = evil_eye_perk
					}
					OR = {
						any_secret = {
							secret_type = secret_false_mage
						}
						has_trait = deceitful
						AND = {
							has_perk = healer_p9_perk
							can_spend_standard_ps_trigger = no
						}
					}
				}
				is_antimagic_trigger = yes
			}
		}
		stress_impact = {
			honest = medium_stress_gain
			deceitful = medium_stress_loss
		}
		duel = {
			skill = intrigue
			target = scope:liege0
			5 = {
				desc = ev9.41.0.c_ct1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					scope:liege0 = {
						add_opinion = {
							target = ROOT
							modifier = trust_opinion
							opinion = 5
						}
					}
				}
				hidden_effect = {
					if = {
						limit = {
							has_character_flag = cm_busy_flag
						}
						remove_character_flag = cm_busy_flag
					}
					add_character_flag = {
						flag = cm_busy_flag
						years = 3
					}
					if = {
						limit = {
							has_character_flag = cm_yellow_card_flag
						}
						remove_character_flag = cm_yellow_card_flag
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				
				if = {
					limit = {
						any_secret = {
							secret_type = secret_false_mage
						}
					}
					send_interface_toast = {
						title = ev3.52.a_2
						random_secret = {
							limit = {
								secret_type = secret_false_mage
							}
							expose_secret = root
						}
					}
				}
				else = {
					send_interface_toast = {
						title = ev3.52.a_2
						add_prestige = medium_prestige_loss
						scope:liege0 = {
							add_opinion = {
								target = ROOT
								modifier = distrustful
							}
						}
					}
					hidden_effect = {
						if = {
							limit = {
								NOT = {
									has_character_flag = cm_yellow_card_flag
								}
							}
							add_character_flag = {
								flag = cm_yellow_card_flag
								years = 3
							}
						}
						add_character_flag = {
							flag = cm_need_more_time_flag
							days = 7
						}
						scope:liege0 = {
							trigger_event = magic_ev10.43
						}
					}
				}
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1000
				opinion = {
					target = scope:tchar1
					value > 30
				}
			}
		}
	}
	option = {
		name = ev10.50.f
		if = {
			limit = {
				has_character_flag = cm_yellow_card_flag
			}
			liege = {
				add_opinion = {
					target = root
					modifier = lazy_court_mage_modifier
					years = 4
				}
			}
			custom_tooltip = ev2.61.e_ct
		}
		hidden_effect = {
			add_character_flag = {
				flag = cm_need_more_time_flag
				days = 7
			}
		}
		liege = {
			trigger_event = magic_ev10.43
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1000
				opinion = {
					target = liege
					value < -10
				}
			}
		}
	}
}
#court mage - magic - 2. (Liege POV)
magic_ev10.51 = {
	type = character_event
	title = ev10.51.title
	desc = ev10.51.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:cmage
	lower_left_portrait = {
		trigger = {
			exists = scope:tchar1
		}
		character = scope:tchar1
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:tchar2
		}
		character = scope:tchar2
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:tchar4
		}
		character = scope:tchar4
	}
	trigger = {
		is_alive = yes
		is_imprisoned = no
		OR = {
			is_at_war = yes
			any_relation = {
				type = rival
			}
		}
		employs_court_position = mage_court_position
		#has_court_position = mage_court_position
		court_position:mage_court_position = {
			has_character_flag = cm_task_2_flag
			NOT = {
				has_character_flag = cm_busy_flag
			}
			is_imprisoned = no
			NOT = {
				has_strong_hook = ROOT
			}
		}
		NOT = {
			is_at_war_with = court_position:mage_court_position
		}
	}
	immediate = {
		hidden_effect = {
			random_relation = {
				type = nemesis
				limit = {
					is_imprisoned = no
				}
				save_scope_as = tchar1
			}
			random_relation = {
				type = rival
				limit = {
					is_imprisoned = no
					NOT = { THIS = scope:cmage }
					trigger_if = {
						limit = {
							exists = scope:tchar1
						}
						NOT = { THIS = scope:tchar1 }
					}
				}
				if = {
					limit = {
						exists = scope:tchar1
					}
					save_scope_as = tchar2
				}
				else = {
					save_scope_as = tchar1
				}
			}
			random_relation = {
				type = rival
				limit = {
					is_imprisoned = no
					NOT = { THIS = scope:cmage }
					trigger_if = {
						limit = {
							exists = scope:tchar1
						}
						NOT = { THIS = scope:tchar1 }
					}
					trigger_if = {
						limit = {
							exists = scope:tchar2
						}
						NOT = { THIS = scope:tchar2 }
					}
				}
				if = {
					limit = {
						exists = scope:tchar1
						exists = scope:tchar2
					}
					save_scope_as = tchar3
				}
				else_if = {
					limit = {
						exists = scope:tchar1
					}
					save_scope_as = tchar2
				}
				else = {
					save_scope_as = tchar1
				}
			}
			if = {
				limit = {
					any_character_war = {
						primary_defender = ROOT
						trigger_if = {
							limit = {
								exists = scope:tchar1
							}
							NOT = { primary_attacker = scope:tchar1 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar2
							}
							NOT = { primary_attacker = scope:tchar2 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar3
							}
							NOT = { primary_attacker = scope:tchar3 }
						}
					}
				}
				random_character_war = {
					limit = {
						primary_defender = ROOT
					}
					primary_attacker = {
						if = {
							limit = {
								exists = scope:tchar1
								exists = scope:tchar2
								exists = scope:tchar3
							}
							save_scope_as = tchar4
						}
						else_if = {
							limit = {
								exists = scope:tchar1
								exists = scope:tchar2
							}
							save_scope_as = tchar3
						}
						else_if = {
							limit = {
								exists = scope:tchar1
							}
							save_scope_as = tchar2
						}
						else = {
							save_scope_as = tchar1
						}
					}
				}
			}
			else_if = {
				limit = {
					any_character_war = {
						primary_attacker = ROOT
						trigger_if = {
							limit = {
								exists = scope:tchar1
							}
							NOT = { primary_defender = scope:tchar1 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar2
							}
							NOT = { primary_defender = scope:tchar2 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar3
							}
							NOT = { primary_defender = scope:tchar3 }
						}
					}
				}
				random_character_war = {
					limit = {
						primary_attacker = ROOT
					}
					primary_defender = {
						if = {
							limit = {
								exists = scope:tchar1
								exists = scope:tchar2
								exists = scope:tchar3
							}
							save_scope_as = tchar4
						}
						else_if = {
							limit = {
								exists = scope:tchar1
								exists = scope:tchar2
							}
							save_scope_as = tchar3
						}
						else_if = {
							limit = {
								exists = scope:tchar1
							}
							save_scope_as = tchar2
						}
						else = {
							save_scope_as = tchar1
						}
					}
				}
			}
			else = {
				random_war_enemy = {
					limit = {
						age > 0	#whatever
						trigger_if = {
							limit = {
								exists = scope:tchar1
							}
							NOT = { THIS = scope:tchar1 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar2
							}
							NOT = { THIS = scope:tchar2 }
						}
						trigger_if = {
							limit = {
								exists = scope:tchar3
							}
							NOT = { THIS = scope:tchar3 }
						}
					}
					if = {
						limit = {
							exists = scope:tchar1
							exists = scope:tchar2
							exists = scope:tchar3
						}
						save_scope_as = tchar4
					}
					else_if = {
						limit = {
							exists = scope:tchar1
							exists = scope:tchar2
						}
						save_scope_as = tchar3
					}
					else_if = {
						limit = {
							exists = scope:tchar1
						}
						save_scope_as = tchar2
					}
					else = {
						save_scope_as = tchar1
					}
				}
			}
		}
	}
	option = {
		name = ev10.51.a
		trigger = {
			exists = scope:tchar1
		}
		custom_tooltip = ev10.51.a_ct
		scope:tchar1 = {
			save_scope_as = tchar0
		}
		stress_impact = {
			compassionate = minor_stress_gain
			sadistic = minor_stress_loss
		}
		if = {
			limit = {
				OR = {
					has_relation_rival = scope:tchar1
					has_relation_nemesis = scope:tchar1
				}
			}
			stress_impact = {
				vengeful = minor_stress_loss
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
			}
		}
		scope:cmage = {
			trigger_event = magic_ev10.52
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.51.b
		trigger = {
			exists = scope:tchar2
		}
		custom_tooltip = ev10.51.a_ct
		scope:tchar2 = {
			save_scope_as = tchar0
		}
		stress_impact = {
			compassionate = minor_stress_gain
			sadistic = minor_stress_loss
		}
		if = {
			limit = {
				OR = {
					has_relation_rival = scope:tchar2
					has_relation_nemesis = scope:tchar2
				}
			}
			stress_impact = {
				vengeful = minor_stress_loss
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
			}
		}
		scope:cmage = {
			trigger_event = magic_ev10.52
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.51.c
		trigger = {
			exists = scope:tchar3
		}
		custom_tooltip = ev10.51.a_ct
		scope:tchar3 = {
			save_scope_as = tchar0
		}
		stress_impact = {
			compassionate = minor_stress_gain
			sadistic = minor_stress_loss
		}
		if = {
			limit = {
				OR = {
					has_relation_rival = scope:tchar3
					has_relation_nemesis = scope:tchar3
				}
			}
			stress_impact = {
				vengeful = minor_stress_loss
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
			}
		}
		scope:cmage = {
			trigger_event = magic_ev10.52
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.51.d
		trigger = {
			exists = scope:tchar4
		}
		custom_tooltip = ev10.51.a_ct
		scope:tchar4 = {
			save_scope_as = tchar0
		}
		stress_impact = {
			compassionate = minor_stress_gain
			sadistic = minor_stress_loss
		}
		if = {
			limit = {
				OR = {
					has_relation_rival = scope:tchar4
					has_relation_nemesis = scope:tchar4
				}
			}
			stress_impact = {
				vengeful = minor_stress_loss
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
			}
		}
		scope:cmage = {
			trigger_event = magic_ev10.52
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.51.e
		ai_chance = {
			base = 0
		}
	}
}
#court mage - magic - 2b. (court mage POV)
magic_ev10.52 = {
	type = character_event
	title = ev2.61.title
	desc = ev10.52.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = liege
	lower_center_portrait = {
		character = scope:tchar0
	}
	trigger = {
		exists = scope:tchar0
	}
	immediate = {
		save_scope_as = actor
	}
	option = {
		name = ev10.52.a
		trigger = {
			OR = {
				has_trait = true_witch
				has_perk = evil_eye_perk
			}
			scope:tchar0 = {
				custom_description = {
					text = has_magic_immunity
					has_immunity_for_regular_curse = no
				}
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 2 }
			save_scope_as = magic_user
			scope:tchar0 = {
				save_scope_as = recipient
				save_scope_as = potential_tar
			}
			scope:liege0 = {
				trigger_event = {
					id = magic_ev2.63
					days = 1
				}
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		stress_impact = {
			compassionate = medium_stress_impact_gain
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}
		execute_or_counter_spell_effect = { SID = 2 }
		send_message_4_magic_sense_effect = yes
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 2
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
			liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = scope:cmage
					right_icon = scope:tchar0
					custom_tooltip = ev10.52.x_ct
				}
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.52.b
		trigger = {
			OR = {
				is_true_mage = yes
				has_perk = fate_weaver_p10_perk
			}
			scope:tchar0 = {
				custom_description = {
					text = has_magic_immunity
					has_immunity_for_powerful_curse = no
				}
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			OR = {
				is_true_mage = yes
				has_perk = fate_weaver_p10_perk
			}
		}
		hidden_effect = {
			scope:tchar0 = {
				save_scope_as = recipient
				scope:recipient = {
					save_scope_as = reci
				}
			}
		}
		trigger_event = magic_ev.10
		scope:recipient = {
			if = {
				limit = {
					has_perk = mage_tower_p2_perk
					is_imprisoned = no
				}
				scope:actor = {
					custom_tooltip = spell_may_be_countered
				}
			}
			else_if = {
				limit = {
					is_courtier = yes
					exists = liege
					NOT = {
						liege = scope:actor
					}
					liege = {
						has_perk = mage_tower_p2_perk
						is_imprisoned = no
					}
				}
				scope:actor = {
					custom_tooltip = spell_may_be_countered
				}
			}
			else_if = {
				limit = {
					is_courtier = yes
					exists = liege
					NOT = {
						liege = scope:actor
					}
					liege = {
						employs_court_position = mage_court_position
						any_court_position_holder = {
							type = mage_court_position
							has_perk = mage_tower_p2_perk
							is_imprisoned = no
							NOT = {
								THIS = scope:actor
							}
						}
					}
				}
				scope:actor = {
					custom_tooltip = spell_may_be_countered
				}
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		custom_tooltip = ev2.61.d_ct
		#show_as_tooltip = {
		#	if = {
		#		limit = {	NOT = {	has_trait = yaga	}	}
		#		spend_standard_ps_effect = yes
		#	}
		#	gain_sc_xp1_effect = yes
		#}
		stress_impact = {
			compassionate = medium_stress_impact_gain
			honest = medium_stress_impact_gain
			just = medium_stress_impact_gain
		}
		scope:recipient = {
			custom_tooltip = cast_powerfull_curse_ct
			custom_description_no_bullet = {
				text = empty_description1
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
			liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = scope:cmage
					right_icon = scope:tchar0
					custom_tooltip = ev10.52.x_ct
				}
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.52.c
		trigger = {
			has_character_flag = plague_spell_flag
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			scope:tchar0 = {
				custom_description = {
					text = has_magic_immunity
					is_antimagic_trigger = no
				}
			}
		}
		trait = archmage
		show_as_unavailable = {
			has_character_flag = plague_spell_flag
		}
		hidden_effect = {
			set_spell_id = { ID = 13 }
			save_scope_as = magic_user
			scope:tchar0 = {
				save_scope_as = recipient
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		gain_sc_xp1_effect = yes
		spend_standard_ps_effect = yes
				
		stress_impact = {
			compassionate = medium_stress_impact_gain
		}
		execute_or_counter_spell_effect = { SID = 13 }
		hidden_effect = {
			send_message_4_magic_sense_effect = yes
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
			liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = scope:cmage
					right_icon = scope:tchar0
					custom_tooltip = ev10.52.x_ct
				}
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.52.d
		trigger = {
			can_cast_firestorm_trigger = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
			scope:tchar0 = {
				custom_description = {
					text = has_magic_immunity
					is_antimagic_trigger = no
				}
			}
		}
		
		show_as_unavailable = {
			can_cast_firestorm_trigger = yes
		}
		hidden_effect = {
			set_spell_id = { ID = 15 }
			save_scope_as = magic_user
			scope:tchar0 = {
				save_scope_as = recipient
			}
			send_message_4_magic_sense_effect = yes
		}
		custom_tooltip = use_magic_custom_tooltip
		gain_cm_xp1_effect = yes
		spend_standard_ps_effect = yes
		stress_impact = {
			compassionate = medium_stress_impact_gain
		}
		execute_or_counter_spell_effect = { SID = 15 }
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 4
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
			liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = scope:cmage
					right_icon = scope:tchar0
					custom_tooltip = ev10.52.x_ct
				}
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.52.e
		trigger = {
			any_character_artifact = {
				has_variable = singularity
				OR = {
					has_artifact_modifier = singularity_modifier5
					has_artifact_modifier = singularity_modifierX
				}
			}
			is_true_mage = yes
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			any_character_artifact = {
				has_variable = singularity
				OR = {
					has_artifact_modifier = singularity_modifier5
					has_artifact_modifier = singularity_modifierX
				}
			}
			is_true_mage = yes
		}
		hidden_effect = {
			set_spell_id = { ID = 7 }
			scope:tchar0 = {
				save_scope_as = recipient
				location = {
					save_scope_as = target
					save_scope_as = ttile
				}
			}
			send_message_4_magic_sense_effect = yes
		}
		add_dread = 50
		gain_cm_xp5_effect = yes
		spend_standard_ps_effect = yes
		stress_impact = {
			compassionate = massive_stress_gain
			sadistic = major_stress_loss
			callous = minor_stress_loss
		}
		scope:target = {
			change_development_level = -50
		}
		custom_tooltip = spell_cannot_be_countered
		custom_tooltip = use_singularity_ct
		custom_tooltip = use_singularity_agains_army_ct
		scope:target.title_province = {
			add_province_modifier = {
				modifier = magical_radiation_modifier
				years = 50
			}
			if = {
				limit = {
					NOT = {
						has_province_modifier = magic_damaged_walls_modifier
					}
				}
				add_province_modifier = {
					modifier = magic_damaged_walls_modifier
					years = 10
				}
			}
		}
		hidden_effect_new_object = {
			scope:target.title_province = {
				every_army_in_location = {
					deplete_army_by_percentage = 0.99
				}
				every_character_in_location = {
					limit = {
						exists = location
						location = scope:target.title_province
					}
					if = {
						limit = {
							has_perk = mage_tower_p2_perk
						}
						trigger_event = magic_ev10.9
					}
					else = {
						random_list = {
							80 = {
								death = {
									death_reason = death_murder
									killer = scope:actor
								}
							}
							5 = {
								add_trait = incapable
							}
							5 = {
								add_trait = cancer
								add_trait = wounded_2
								add_trait = infertile
							}
							3 = {
								add_trait = cancer
								add_trait = wounded_1
								add_trait = disfigured
								add_trait = infertile
							}
							2 = {
								add_trait = cancer
								add_trait = wounded_1
								add_trait = lunatic_1
								add_trait = infertile
							}
							5 = {
								add_trait = cancer
								add_trait = wounded_1
								add_trait = blind
								add_trait = infertile
							}
						}
					}
				}
			}
			scope:actor = {
				save_scope_as = magic_user
				send_message_4all_magic_sense_effect = yes
			}
			every_ruler = {
				limit = {
					is_ai = no
				}
				trigger_event = {
					id = magic_ev2.74
					days = { 2 6 }
				}
			}
			
			scope:actor = {
				if = {
					limit = {
						has_game_rule = high_whunters
						NOT = {
							has_character_flag = abdul_dude
						}
					}
					random = {
						chance = 50
						spawn_witch_hunter_full_chance_effect = { EMPL = scope:actor }
					}
				}
				else_if = {
					limit = {
						NOT = {
							any_courtier_or_guest = {
								has_trait = witch_hunter
							}
						}
						NOT = {
							has_character_flag = abdul_dude
						}
					}
					random = {
						chance = 25
						spawn_witch_hunter_full_chance_effect = { EMPL = scope:actor }
					}
				}
				metamagic_effect = yes
			}
			if = {
				limit = {
					scope:recipient = {
						NOT = {
							has_character_flag = abdul_dude
						}
					}
				}
				trigger_event = {
					id = magic_ev2.77
					days = { 7 12 }
				}
			}
			else_if = {
				limit = {
					scope:recipient = {
						is_ai = yes
						any_character_artifact = {
							has_variable = singularity2
						}
						is_imprisoned = no
					}
				}
				scope:actor = {
					trigger_event = {
						id = magic_ev6.64
						days = { 7 12 }
					}
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 4
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
			liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = scope:cmage
					right_icon = scope:tchar0
					custom_tooltip = ev10.52.x_ct
				}
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.52.f
		trigger = {
			any_secret = {
				secret_type = secret_false_mage
			}
			has_trait = deceitful
			can_spend_standard_ps_trigger = no
		}
		stress_impact = {
			deceitful = minor_stress_loss
			honest = medium_stress_gain
		}
		scope:liege = {
			random = {
				chance = 25
				add_opinion = {
					target = ROOT
					modifier = suspicion_opinion
					opinion = -20
				}
				custom_tooltip = ev2.61.e_ct
				hidden_effect = {
					add_character_flag = {
						flag = cm_yellow_card_flag
						years = 5
					}
				}
			}
		}
		hidden_effect = {
			add_character_flag = {
				flag = cm_need_more_time_flag
				days = 7
			}
			scope:liege0 = {
				trigger_event = magic_ev10.43
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				any_secret = {
					secret_type = secret_false_mage
				}
			}
		}
	}
	option = {
		name = ev10.52.g
		stress_impact = {
			lazy = major_stress_loss
			diligent = major_stress_gain
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = cm_yellow_card_flag
				}
			}
			scope:liege = {
				add_opinion = {
					target = ROOT
					modifier = disappointed_opinion
					opinion = -10
				}
			}
		}
		else = {
			custom_tooltip = ev2.61.e_ct
		}
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_character_flag = cm_yellow_card_flag
					}
				}
				add_character_flag = {
					flag = cm_yellow_card_flag
					years = 3
				}
			}
			add_character_flag = {
				flag = cm_need_more_time_flag
				days = 7
			}
			scope:liege = {
				trigger_event = magic_ev10.43
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 999
				OR = {
					opinion = {
						target = liege
						value < -20
					}
					opinion = {
						target = scope:tchar0
						value > 30
					}
				}
			}
		}
	}
}
#court mage - rituals - 3. (court mage POV)
magic_ev10.53 = {
	type = character_event
	title = ev10.42.title
	desc = ev10.53.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = liege
	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_court_position = mage_court_position
		has_character_flag = cm_task_3_flag
		NOT = {
			has_character_flag = cm_busy_flag
		}
		is_witch_trigger = yes
		OR = {
			has_trait = true_witch
			is_true_mage = yes
			has_focus = arcane_focus
		}
		exists = liege
		liege = {
			is_imprisoned = no
			OR = {
				is_witch_trigger = no
				has_focus = witch_focus
				has_focus = arcane_focus
			}
		}
		NOT = {
			has_strong_hook = liege
		}
		NOT = {
			is_at_war_with = liege
		}
		NOT = {
			any_secret = {
				secret_type = secret_false_mage
			}
		}
	}
	option = {
		name = ev10.53.a
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
				has_focus = arcane_focus
			}
		}
		stress_impact = {
			gregarious = minor_stress_loss
			trusting = minor_stress_loss
		}
		if = {
			limit = {
				liege = {
					OR = {
						has_focus = witch_focus
						has_focus = arcane_focus
					}
				}
			}
			hidden_effect = {
				random_secret = {
					limit = { secret_type = secret_witch NOT = { is_known_by = liege } }
					reveal_to = liege
				}
				scope:liege = {
					random_secret = {
						limit = { secret_type = secret_witch NOT = { is_known_by = ROOT } }
						reveal_to = ROOT
					}
				}
			}
			scope:liege = {
				send_interface_toast = {
					title = ev10.42.title_ct
					left_icon = ROOT
					custom_tooltip = ev2.47.a_ct
					custom_description_no_bullet = {
						text = empty_description1
					}
					hidden_effect = {
						add_magic_lifestyle_perk_points = 1
					}
				}
			}
		}
		else = {
			show_as_tooltip = {
				random_list = {
					1 = {
						desc = ev10.53.a_ct
						show_chance = no
						liege = {
							give_witch_secret_or_trait_effect = yes
						}
						if = {
							limit = {
								NOT = {
									has_hook = liege
								}
							}
							add_hook = {
								type = favor_hook
								target = liege
							}
						}
					}
					1 = {
						desc = ev10.53.a_ct2
						show_chance = no
					}
				}
				random_secret = {
					limit = { secret_type = secret_witch NOT = { is_known_by = liege } }
					reveal_to = liege
				}
			}
			liege = {
				trigger_event = magic_ev10.54
			}
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = cm_busy_flag
				}
				remove_character_flag = cm_busy_flag
			}
			add_character_flag = {
				flag = cm_busy_flag
				years = 3
			}
			if = {
				limit = {
					has_character_flag = cm_yellow_card_flag
				}
				remove_character_flag = cm_yellow_card_flag
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = arrogant
			}
			modifier = {
				add = 1
				OR = {
					has_trait = gregarious
					has_trait = trusting
				}
			}
			modifier = {
				add = 100
				OR = {
					has_relation_best_friend = liege
					has_relation_friend = liege
					has_relation_lover = liege
					has_relation_soulmate = liege
					has_relation_mmaster = liege
					has_relation_mminion = liege
				}
			}
		}
	}
	option = {
		name = ev10.53.b
		stress_impact = {
			shy = minor_stress_loss
			paranoid = minor_stress_loss
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				OR = {
					has_trait = shy
					has_trait = paranoid
				}
			}
			modifier = {
				add = 100
				OR = {
					has_relation_rival = liege
					has_relation_nemesis = liege
				}
			}
		}
	}
	option = {
		name = ev10.53.c
		trigger = {
			OR = {
				has_relation_rival = liege
				has_relation_nemesis = liege
			}
			scope:liege = {
				OR = {
					has_focus = witch_focus
					has_focus = arcane_focus
				}
				NOT = {
					has_character_modifier = something_has_gone_wrong_modifier
				}
			}
		}
		stress_impact = {
			vengeful = major_stress_loss
			arbitrary = minor_stress_loss
			deceitful = minor_stress_loss
			just = medium_stress_gain
		}
		scope:liege = {
			add_character_modifier = {
				modifier = something_has_gone_wrong_modifier
				years = 1
			}
		}
		ai_chance = {
			base = 50
			modifier = {
				add = -50
				has_trait = just
			}
			modifier = {
				add = 100
				OR = {
					has_trait = vengeful
					has_trait = arbitrary
					has_trait = deceitful
				}
			}
		}
	}
}
#court mage - rituals - 3b. (liege POV)
magic_ev10.54 = {
	type = character_event
	title = ev10.42.title_ct
	desc = ev10.54.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = scope:cmage
	immediate = {
		random_secret = {
			limit = { secret_type = secret_witch NOT = { is_known_by = liege } }
			reveal_to = ROOT
		}
	}
	option = {
		name = ev10.54.a
		scope:cmage = {
			send_interface_toast = {
				title = ev10.54.a_title
				left_icon = ROOT
				ROOT = {
					give_witch_secret_or_trait_effect = yes
				}
			}
		}
		scope:cmage = {
			if = {
				limit = {
					NOT = {
						has_hook = ROOT
					}
				}
				add_hook = {
					type = favor_hook
					target = ROOT
				}
			}
		}
		hidden_effect = {
			random_secret = {
				limit = { secret_type = secret_witch NOT = { is_known_by = scope:cmage } }
				reveal_to = scope:cmage
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.54.b
		hidden_effect = {
			scope:cmage = {
				send_interface_toast = {
					title = ev10.53.a_ct2
					left_icon = ROOT
				}
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 5
				OR = {
					has_trait = cynical
					has_trait = zealous
					has_trait = humble
					has_trait = content
				}
			}
		}
	}
}
#court mage - forbidden ritual - failed
magic_ev10.55 = {
	type = character_event
	title = ev10.55.title
	desc = ev10.55.desc
	theme = witchcraft
	left_portrait = root
	lower_center_portrait = court_position:mage_court_position
	trigger = {
		exists = court_position:mage_court_position
		court_position:mage_court_position = {
			has_character_flag = cm_task_3_flag
			is_false_mage = yes
			any_secret = {
				secret_type = secret_false_mage
				NOT = { is_known_by = ROOT }
			}
		}
	}
	on_trigger_fail = {
		trigger_event = magic_ev.8
	}
	immediate = {
		custom_tooltip = ev10.55.title
		stress_impact = {
			ambitious = minor_stress_gain
			paranoid = minor_stress_gain
		}
	}
	option = {
		name = ev10.55.a
		stress_impact = {
			calm = minor_stress_loss
			content = minor_stress_loss
		}
	}
	option = {
		name = ev2.36.b
		stress_impact = {
			lazy = medium_stress_gain
			diligent = medium_stress_loss
		}
		duel = {
			skill = learning
			value = court_position:mage_court_position.learning
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				custom_tooltip = ev10.55.b_ct1
				trigger_event = magic_ev10.56
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					custom_tooltip = ev10.55.b_ct2
				}
			}
		}
	}
}
#court mage - forbidden ritual - failed - discovered the reason
magic_ev10.56 = {
	type = character_event
	title = secret_false_mage
	desc = ev10.56.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:cmage
		animation = grief
	}
	immediate = {
		court_position:mage_court_position = {
			save_scope_as = cmage
			send_interface_toast = {
				title = ev10.56.desc_title
			}
			random_secret = {
				limit = {
					secret_type = secret_false_mage
				}
				expose_secret = ROOT
			}
		}
	}
	option = {
		name = ev10.56.a
		add_stress = medium_stress_gain
	}
	option = {
		name = ev10.56.b
		trigger = {
			scope:cmage = {
				is_imprisoned = no
				is_ruler = no
			}
		}
		if = {
			limit = {
				NOT = {
					has_trait = wrathful
				}
			}
			add_stress = minor_stress_gain
		}
		else = {
			stress_impact = {
				wrathful = minor_stress_loss
			}
		}
		imprison = {
			target = scope:cmage
			type = dungeon
		}
	}
}

#court mage - ask for funds (mage POV)
magic_ev10.57 = {
	type = character_event
	title = ev10.57.title
	desc = ev10.57.desc
	theme = witchcraft
	left_portrait = {
		character = root
		triggered_animation = {
			trigger = {
				OR = {
					is_false_mage = yes
					has_trait = greedy
				}
			}
			animation = personality_greedy
		}
		triggered_animation = {
			trigger = {
				NOR = {
					is_false_mage = yes
					has_trait = greedy
				}
			}
			animation = personality_rational
		}
	}
	lower_right_portrait = liege
	trigger = {
		is_alive = yes
		is_imprisoned = no
		has_court_position = mage_court_position
		exists = liege
		liege = {
			is_imprisoned = no
		}
		NOT = {
			is_at_war_with = liege
		}
		NOT = {
			has_character_modifier = liar_liar_modifier
		}
	}
	immediate = {
		hidden_effect = {
			liege = {
				save_scope_as = liege0
			}
			add_character_flag = {
				flag = cm_ask_for_gold_flag
				years = 10
			}
		}
	}
	option = {
		name = ev10.57.a
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = ev3.52.a_1
					show_chance = no
					add_character_modifier = {
						modifier = additional_magic_funds_modifier
						years = 3
					}
					liege = {
						pay_short_term_gold = {
							target = ROOT
							gold = root.medium_gold_value
						}
					}
				}
				1 = {
					desc = ev3.52.a_2
					show_chance = no
					liege = {
						add_opinion = {
							target = ROOT
							modifier = irritated_opinion
							opinion = -10
						}
					}
				}
			}
		}
		scope:liege0 = {
			trigger_event = magic_ev10.58
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.57.b
		stress_impact = {
			content = minor_stress_loss
			greedy = minor_stress_gain
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = content
				gold > 0
			}
			modifier = {
				add = 2
				gold < minor_gold_min_value
			}
		}
	}
}
#court mage - ask for funds (liege POV)
magic_ev10.58 = {
	type = character_event
	title = additional_magic_funds_modifier
	desc = ev10.58.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = scope:cmage
	option = {
		name = ev10.58.a
		scope:cmage = {
			send_interface_toast = {
				title = additional_magic_funds_modifier
				ROOT = {
					pay_short_term_gold = {
						target = scope:cmage
						gold = scope:cmage.medium_gold_value
					}
				}
				add_character_modifier = {
					modifier = additional_magic_funds_modifier
					years = 3
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1000
				OR = {
					gold < scope:cmage.medium_gold_value
					has_trait = greedy
					has_relation_nemesis = scope:cmage
					has_relation_rival = scope:cmage
				}
			}
			modifier = {
				add = 1
				has_trait = generous
			}
			modifier = {
				add = 1
				has_trait = patient
			}
			modifier = {
				add = 2
				gold > major_gold_value_check
			}
			modifier = {
				add = 1
				opinion = {
					target = scope:cmage
					value > 10
				}
			}
		}
	}
	option = {
		name = ev10.58.b
		scope:cmage = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -10
			}
		}
		hidden_effect = {
			scope:cmage = {
				send_interface_toast = {
					title = additional_magic_funds_modifier
					left_icon = ROOT
					ROOT = {
						add_opinion = {
							target = scope:cmage
							modifier = irritated_opinion
							opinion = -10
						}
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				opinion = {
					target = scope:cmage
					value < -10
				}
			}
		}
	}
}
#court mage - influences
magic_ev10.59 = {
	type = character_event
	title = ev3.72.title
	desc = ev10.59.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = liege
	trigger = {
		is_alive = yes
		has_trait = archmage
		has_court_position = mage_court_position
		is_imprisoned = no
		exists = liege
	}
	immediate = {
		hidden_effect = {
			liege = {
				save_scope_as = liege0
				random_vassal = {
					limit = {
						is_adult = yes
						is_ai = yes
						is_powerful_being = no
						NOT = { THIS = ROOT }
					}
					save_scope_as = v1
				}
				random_vassal = {
					limit = {
						is_adult = yes
						is_ai = yes
						is_powerful_being = no
						NOT = { THIS = ROOT }
						NOT = { THIS = scope:v1 }
					}
					save_scope_as = v2
				}
			}
		}
	}
	option = {
		name = ev10.59.a
		trigger = {
			#government_allows = administrative
			government_has_flag = government_is_administrative
		}
		#change_influence = major_influence_gain
		change_influence = massive_influence_gain
		if = {
			limit = {
				exists = scope:v1
				NOT = {
					has_hook = scope:v1
				}
			}
			add_hook = {
				type = favor_hook
				target = scope:v1
			}
		}
		stress_impact = {
			ambitious = medium_stress_loss
		}
	}
	option = {
		name = ev10.59.b
		add_gold = minor_gold_max_value_static
		stress_impact = {
			greedy = medium_stress_loss
		}
	}
	option = {
		name = ev10.59.c
		add_prestige = medium_prestige_gain
		if = {
			limit = {
				exists = scope:v1
			}
			scope:v1 = {
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 20
				}
			}
		}
		if = {
			limit = {
				exists = scope:v2
			}
			scope:v2 = {
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 20
				}
			}
		}
		
		stress_impact = {
			arrogant = medium_stress_loss
		}
	}
	option = {
		name = ev10.59.d
		add_dread = medium_dread_gain
		if = {
			limit = {
				exists = scope:v2
				NOT = {
					has_hook = scope:v2
				}
			}
			add_hook = {
				type = threat_hook
				target = scope:v2
			}
		}
		else_if = {
			limit = {
				exists = scope:v1
				NOT = {
					has_hook = scope:v1
				}
			}
			add_hook = {
				type = threat_hook
				target = scope:v1
			}
		}
		stress_impact = {
			callous = medium_stress_loss
		}
	}
}
#conditional/one off ask for gold (court mage)
magic_ev10.60 = {
	hidden = yes
	trigger = {
		has_court_position = mage_court_position
		NOR = {
			has_character_flag = cm_task_1_flag
			has_character_flag = cm_task_2_flag
			has_character_flag = cm_task_3_flag
		}
	}
	immediate = {
		save_scope_as = cmage
		trigger_event = magic_ev10.57
	}
}

#demonic rage - demon escaped
magic_ev10.61 = {
	type = character_event
	title = ev10.29.b_it
	desc = ev10.61.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_vengeful
	}
	lower_right_portrait = scope:actor
	immediate = {
		add_prestige = medium_prestige_loss
		if = {
			limit = {
				exists = scope:dvic1
			}
			scope:dvic1 = {
				death = {
					death_reason = death_cloven_in_half
					killer = scope:actor
				}
			}
		}
		if = {
			limit = {
				exists = scope:dvic2
			}
			scope:dvic2 = {
				death = {
					death_reason = death_cloven_in_half
					killer = scope:actor
				}
			}
		}
	}
	option = {
		name = ev10.61.a
	}
	option = {
		name = ev10.61.b
		start_scheme = {
			type = murder
			target_character = scope:actor
		}
		stress_impact = {
			vengeful = medium_stress_loss
			forgiving = medium_stress_gain
		}
	}
}

#Mage Summit - begining - the election
magic_ev10.62 = {
	type = activity_event
	title = ev10.62.title
	desc = ev10.62.desc
	theme = feast_activity
	left_portrait = root

	trigger = {
		is_alive = yes
	}

	option = {
		name = ev10.62.a	#I will put forward my candidacy.
		trigger = {
			has_trait = archmage
		}
		custom_tooltip = ev10.62.a_ct
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						ROOT = scope:host
					}
				}
				scope:activity = {
					add_to_variable_list ={
						name = ms_election_list
						target = ROOT
					}
				}
			}
			add_character_flag = arch_wannabe_flag
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = fp2_other_decisions.0704.a	#Interesting.
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:host
				}
				scope:activity = {
					remove_list_variable ={
						name = ms_election_list
						target = ROOT
					}
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
}
#Mage Summit - begining - the election - candidates
magic_ev10.63 = {
	type = activity_event
	title = ev10.62.title
	desc = {
		desc = ev10.63.desc
		triggered_desc = {
			trigger = {
				exists = scope:ms_cand1
			}
			desc = ev10.63.cand1
		}
		triggered_desc = {
			trigger = {
				exists = scope:ms_cand2
			}
			desc = ev10.63.cand2
		}
		triggered_desc = {
			trigger = {
				exists = scope:ms_cand3
			}
			desc = ev10.63.cand3
		}
		triggered_desc = {
			trigger = {
				exists = scope:ms_cand4
			}
			desc = ev10.63.cand4
		}
	}
	theme = feast_activity
	left_portrait = root
	lower_left_portrait = {
		trigger = {
			exists = scope:ms_cand1
			NOT = {
				ROOT = scope:ms_cand1
			}
		}
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:ms_cand2
			NOT = {
				ROOT = scope:ms_cand2
			}
		}
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:ms_cand3
			NOT = {
				ROOT = scope:ms_cand3
			}
		}
	}

	trigger = {
		is_alive = yes
	}
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:host
				}
				select_archmage_candidates_effect = yes
			}
		}
	}

	option = {
		name = ev10.63.a
		trigger = {
			OR = {
				AND = {
					has_character_flag = arch_wannabe_flag
					OR = {
						trigger_if = {
							limit = { exists = scope:ms_cand1 }
							ROOT = scope:ms_cand1
						}
						trigger_if = {
							limit = { exists = scope:ms_cand2 }
							ROOT = scope:ms_cand2
						}
						trigger_if = {
							limit = { exists = scope:ms_cand3 }
							ROOT = scope:ms_cand3
						}
						trigger_if = {
							limit = { exists = scope:ms_cand4 }
							ROOT = scope:ms_cand4
						}
						#AND = {
						#	exists = scope:ms_cand1
						#	ROOT = scope:ms_cand1
						#}
						#AND = {
						#	exists = scope:ms_cand2
						#	ROOT = scope:ms_cand2
						#}
						#AND = {
						#	exists = scope:ms_cand3
						#	ROOT = scope:ms_cand3
						#}
						#AND = {
						#	exists = scope:ms_cand4
						#	ROOT = scope:ms_cand4
						#}
					}
				}
				NOT = {
					has_character_flag = arch_wannabe_flag
				}
			}
		}
		exclusive = yes
		if = {
			limit = {
				exists = scope:ms_cand1
				ROOT = scope:ms_cand1
			}
			add_prestige = minor_prestige_gain
		}
		else_if = {
			limit = {
				exists = scope:ms_cand2
				ROOT = scope:ms_cand2
			}
			add_prestige = minor_prestige_gain
		}
		else_if = {
			limit = {
				exists = scope:ms_cand3
				ROOT = scope:ms_cand3
			}
			add_prestige = minor_prestige_gain
		}
		else_if = {
			limit = {
				exists = scope:ms_cand4
				ROOT = scope:ms_cand4
			}
			add_prestige = minor_prestige_gain
		}
	}
	option = {
		name = ev5.21.0.a
		stress_impact = {
			arrogant = minor_stress_gain
			ambitious = minor_stress_gain
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = arch_wannabe_flag
				}
				remove_character_flag = arch_wannabe_flag
			}
			if = {
				limit = {
					ROOT = scope:host
				}
				scope:activity = {
					every_attending_character = {
						limit = {
							NOT = {
								THIS = scope:host
							}
						}
						trigger_event = magic_ev10.63
					}
				}
			}
		}
	}
}

#Mage Summit - begining - the election - voting
magic_ev10.64 = {
	type = activity_event
	title = ev10.62.title
	desc = ev10.64.desc
	theme = witchcraft
	override_background = {
		reference = throne_room_east
	}
	left_portrait = root
	lower_left_portrait = {
		trigger = {
			exists = scope:ms_cand1
			NOT = {
				ROOT = scope:ms_cand1
			}
		}
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:ms_cand2
			NOT = {
				ROOT = scope:ms_cand2
			}
		}
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:ms_cand3
			NOT = {
				ROOT = scope:ms_cand3
			}
		}
	}

	trigger = {
		is_alive = yes
	}
	option = {
		name = ev10.64.e
		trigger = {
			OR = {
				AND = {
					exists = scope:ms_cand1
					trigger_if = {
						limit = { exists = scope:ms_cand1 }
						ROOT = scope:ms_cand1
					}
				}
				AND = {
					exists = scope:ms_cand2
					trigger_if = {
						limit = { exists = scope:ms_cand2 }
						ROOT = scope:ms_cand2
					}
				}
				AND = {
					exists = scope:ms_cand3
					trigger_if = {
						limit = { exists = scope:ms_cand3 }
						ROOT = scope:ms_cand3
					}
				}
				AND = {
					exists = scope:ms_cand4
					trigger_if = {
						limit = { exists = scope:ms_cand4 }
						ROOT = scope:ms_cand4
					}
				}
			}
		}
		hidden_effect = {
			change_variable = {
				name = my_arch_votes
				add = 1
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev10.64.a
		trigger = {
			exists = scope:ms_cand1
			trigger_if = {
				limit = { exists = scope:ms_cand1 }
				NOT = {
					ROOT = scope:ms_cand1
				}
			}
		}
		hidden_effect = {
			scope:ms_cand1 = {
				change_variable = {
					name = my_arch_votes
					add = 1
				}
			}
		}
		ai_chance = {
			base = 1
			opinion_modifier = {
				who = ROOT
				opinion_target = scope:ms_cand1
				multiplier = 1
			}
			modifier = {
				add = -1000
				has_variable = my_arch_votes
			}
			modifier = {
				add = 500
				has_variable = ms_i_support_someone
				var:ms_i_support_someone = scope:ms_cand1
			}
			modifier = {
				add = 100
				scope:ms_cand1 = {
					has_hook = ROOT
				}
			}
		}
	}
	option = {
		name = ev10.64.b
		trigger = {
			exists = scope:ms_cand2
			trigger_if = {
				limit = { exists = scope:ms_cand2 }
				NOT = {
					ROOT = scope:ms_cand2
				}
			}
		}
		hidden_effect = {
			scope:ms_cand2 = {
				change_variable = {
					name = my_arch_votes
					add = 1
				}
			}
		}
		ai_chance = {
			base = 1
			opinion_modifier = {
				who = ROOT
				opinion_target = scope:ms_cand2
				multiplier = 1
			}
			modifier = {
				add = -1000
				has_variable = my_arch_votes
			}
			modifier = {
				add = 500
				has_variable = ms_i_support_someone
				var:ms_i_support_someone = scope:ms_cand2
			}
			modifier = {
				add = 100
				scope:ms_cand2 = {
					has_hook = ROOT
				}
			}
		}
	}
	option = {
		name = ev10.64.c
		trigger = {
			exists = scope:ms_cand3
			trigger_if = {
				limit = { exists = scope:ms_cand3 }
				NOT = {
					ROOT = scope:ms_cand3
				}
			}
		}
		hidden_effect = {
			scope:ms_cand3 = {
				change_variable = {
					name = my_arch_votes
					add = 1
				}
			}
		}
		ai_chance = {
			base = 1
			opinion_modifier = {
				who = ROOT
				opinion_target = scope:ms_cand3
				multiplier = 1
			}
			modifier = {
				add = -1000
				has_variable = my_arch_votes
			}
			modifier = {
				add = 500
				has_variable = ms_i_support_someone
				var:ms_i_support_someone = scope:ms_cand3
			}
			modifier = {
				add = 100
				scope:ms_cand3 = {
					has_hook = ROOT
				}
			}
		}
	}
	option = {
		name = ev10.64.d
		trigger = {
			exists = scope:ms_cand4
			trigger_if = {
				limit = { exists = scope:ms_cand4 }
				NOT = {
					ROOT = scope:ms_cand4
				}
			}
		}
		hidden_effect = {
			scope:ms_cand4 = {
				change_variable = {
					name = my_arch_votes
					add = 1
				}
			}
		}
		ai_chance = {
			base = 1
			opinion_modifier = {
				who = ROOT
				opinion_target = scope:ms_cand4
				multiplier = 1
			}
			modifier = {
				add = -1000
				has_variable = my_arch_votes
			}
			modifier = {
				add = 500
				has_variable = ms_i_support_someone
				var:ms_i_support_someone = scope:ms_cand4
			}
			modifier = {
				add = 100
				scope:ms_cand4 = {
					has_hook = ROOT
				}
			}
		}
	}
}

#high council invitation
magic_ev10.65 = {
	type = character_event
	title = invite_to_council_position_interaction
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = mc_prop_o1
				}
				desc = MC_INV_PROPOSAL1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = mc_prop_o2
				}
				desc = MC_INV_PROPOSAL2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = mc_prop_o3
				}
				desc = MC_INV_PROPOSAL3
			}
		}
	}
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	lower_right_portrait = global_var:current_archmage_global
	trigger = {
		is_alive = yes
		is_imprisoned = no
		exists = global_var:current_archmage_global
		OR = {
			NOT = { exists = global_var:current_loremaster_global }
			NOT = { exists = global_var:current_black_mage_global }
			NOT = { exists = global_var:current_admin_global }
		}
		global_var:current_archmage_global = {
			is_alive = yes
			is_ai = yes
			is_imprisoned = no
			NOR = {
				has_relation_rival = ROOT
				has_relation_nemesis = ROOT
				is_at_war_with = ROOT
			}
		}
	}
	immediate = {
		hidden_effect = {
			random_list = {
				1 = {
					trigger = {
						NOT = { exists = global_var:current_loremaster_global }
					}
					add_character_flag = {
						flag = mc_prop_o1
						days = 7
					}
				}
				1 = {
					trigger = {
						NOT = { exists = global_var:current_black_mage_global }
					}
					add_character_flag = {
						flag = mc_prop_o2
						days = 7
					}
				}
				1 = {
					trigger = {
						NOT = { exists = global_var:current_admin_global }
					}
					add_character_flag = {
						flag = mc_prop_o3
						days = 7
					}
				}
			}
		}
	}
	
	option = {
		name = ev10.65.a
		if = {
			limit = { has_character_flag = mc_prop_o1 }
			appoint_to_mc1_effect = yes
		}
		else_if = {
			limit = { has_character_flag = mc_prop_o2 }
			appoint_to_mc2_effect = yes
		}
		else_if = {
			limit = { has_character_flag = mc_prop_o3 }
			appoint_to_mc3_effect = yes
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.65.b
		global_var:current_archmage_global = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -20
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 1000
				has_character_flag = abdul_dude
			}
		}
	}
}
#Mage Summit - seeking suppor (election)
magic_ev10.66 = {
	type = activity_event
	title = ev7.111.title
	desc = ev10.66.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = scope:guest0

	trigger = {
		is_alive = yes
		has_ms_political_matters_intent_trigger = yes
		has_variable = my_arch_votes
		scope:activity = {
			has_variable = elections
		}
		scope:activity = {
			any_attending_character = {
				is_ai = yes
				NOR = {
					THIS = ROOT
					has_relation_nemesis = ROOT
					has_relation_rival = ROOT
					has_relation_mminion = ROOT
					has_relation_mmaster = ROOT
					has_variable = my_arch_votes
					has_hook = ROOT
					has_variable = ms_i_support_someone
				}
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = ROOT
							has_relation_nemesis = ROOT
							has_relation_rival = ROOT
							has_relation_mminion = ROOT
							has_relation_mmaster = ROOT
							has_variable = my_arch_votes
							has_hook = ROOT
							has_variable = ms_i_support_someone
						}
					}
					save_scope_as = guest0
				}
			}
		}
	}
	option = {
		name = ev10.66.a
		scope:guest0 = {
			add_hook = {
				type = favor_hook
				target = THIS
			}
			hidden_effect = {
				set_variable = {
					name = ms_i_support_someone
					value = ROOT
				}
			}
		}
		custom_tooltip = ev10.66.a_ct
	}
	option = {
		name = ev10.66.b
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 20
			}
		}
		stress_impact = {
			shy = medium_stress_gain
			gregarious = medium_stress_gain
		}
	}
	option = {
		name = court.8199.c	#Why not both?
		reason = activity_intent
		scope:guest0 = {
			add_hook = {
				type = favor_hook
				target = THIS
			}
			hidden_effect = {
				set_variable = {
					name = ms_i_support_someone
					value = ROOT
				}
			}
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 20
			}
		}
		stress_impact = {
			shy = medium_stress_gain
			gregarious = medium_stress_gain
		}
		custom_tooltip = ev10.66.a_ct
	}
}

#Mage Summit - ongoing election
magic_ev10.67 = {
	type = activity_event
	title = ev7.111.title
	desc = ev10.67.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = scope:guest0
	lower_center_portrait = scope:guest1

	trigger = {
		is_alive = yes
		has_variable = my_arch_votes
		scope:activity = {
			has_variable = elections
		}
		scope:activity = {
			any_attending_character = {
				is_ai = yes
				NOR = {
					THIS = ROOT
					has_relation_nemesis = ROOT
					has_relation_rival = ROOT
					has_relation_mminion = ROOT
					has_relation_mmaster = ROOT
					has_variable = my_arch_votes
					has_variable = ms_i_support_someone
				}
				count > 1
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = ROOT
							has_relation_nemesis = ROOT
							has_relation_rival = ROOT
							has_relation_mminion = ROOT
							has_relation_mmaster = ROOT
							has_variable = my_arch_votes
							has_variable = ms_i_support_someone
						}
					}
					save_scope_as = guest0
				}
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = ROOT
							has_relation_nemesis = ROOT
							has_relation_rival = ROOT
							has_relation_mminion = ROOT
							has_relation_mmaster = ROOT
							has_variable = my_arch_votes
							has_variable = ms_i_support_someone
							THIS = scope:guest0
						}
					}
					save_scope_as = guest1
				}
			}
		}
	}
	option = {
		name = ev10.67.a
		pay_short_term_gold = {
			target = scope:guest0
			gold = medium_gold_min_value
		}
		custom_tooltip = ev10.66.a_ct
		pay_short_term_gold = {
			target = scope:guest1
			gold = medium_gold_min_value
		}
		custom_tooltip = ev10.67.a_ct
		hidden_effect = {
			scope:guest0 = {
				set_variable = {
					name = ms_i_support_someone
					value = ROOT
				}
			}
			scope:guest1 = {
				set_variable = {
					name = ms_i_support_someone
					value = ROOT
				}
			}
		}
	}
	option = {
		name = ev10.67.b
		duel = {
			skill = diplomacy
			value = 30
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					custom_tooltip = ev10.66.a_ct
					custom_tooltip = ev10.67.a_ct
				}
				hidden_effect = {
					scope:guest0 = {
						set_variable = {
							name = ms_i_support_someone
							value = ROOT
						}
					}
					scope:guest1 = {
						set_variable = {
							name = ms_i_support_someone
							value = ROOT
						}
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:guest0 = {
						add_opinion = {
							target = ROOT
							modifier = irritated_opinion
							opinion = -20
						}
					}
					scope:guest1 = {
						add_opinion = {
							target = ROOT
							modifier = irritated_opinion
							opinion = -20
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.67.c
		add_stress = minor_stress_loss
	}
}
#Mage Summit - ongoing election 2
magic_ev10.68 = {
	type = activity_event
	title = ev10.68.title
	desc = ev10.68.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = scope:guest1
	center_portrait = scope:guest0
	right_portrait = scope:guest2

	trigger = {
		is_alive = yes
		scope:activity = {
			has_variable = elections
			any_attending_character = {
				has_variable = my_arch_votes
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						NOT = {
							THIS = ROOT
						}
						has_variable = my_arch_votes
					}
					save_scope_as = guest0
				}
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = scope:guest0
							THIS = ROOT
						}
					}
					save_scope_as = guest1
				}
				random_attending_character = {
					limit = {
						is_ai = yes
						NOR = {
							THIS = scope:guest0
							THIS = scope:guest1
							THIS = ROOT
						}
					}
					save_scope_as = guest2
				}
			}
		}
	}
	option = {
		name = ev10.68.a
		trigger = {
			has_variable = my_arch_votes
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = irritated_opinion
				opinion = -20
			}
		}
		random = {
			chance = 50
			scope:guest1 = {
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 20
				}
			}
			scope:guest2 = {
				add_opinion = {
					target = ROOT
					modifier = respect_opinion
					opinion = 20
				}
			}
		}
	}
	option = {
		name = ev10.68.b
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = irritated_opinion
				opinion = -20
			}
			add_stress = minor_stress_gain
		}
		scope:guest1 = {
			add_opinion = {
				target = scope:guest0
				modifier = disrespect_opinion
				opinion = -20
			}
		}
	}
	option = {
		name = ev10.68.c
		trigger = {
			NOT = { has_variable = my_arch_votes }
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 20
			}
		}
		scope:guest1 = {
			add_opinion = {
				target = scope:guest0
				modifier = respect_opinion
				opinion = 10
			}
		}
		scope:guest2 = {
			add_opinion = {
				target = scope:guest0
				modifier = respect_opinion
				opinion = 10
			}
		}
	}
	option = {
		name = ev10.68.d
	}
	option = {
		name = ev10.68.e
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
		}
		reason = activity_intent
		add_prestige = minor_prestige_gain
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = irritated_opinion
				opinion = -30
			}
		}
		scope:guest1 = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -10
			}
		}
		scope:guest2 = {
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = -10
			}
		}
	}
}
#Mage Summit - ongoing election 3
magic_ev10.69 = {
	type = activity_event
	title = ev10.68.title
	desc = ev10.69.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = root
	right_portrait = scope:guest0

	trigger = {
		is_alive = yes
		scope:activity = {
			has_variable = elections
		}
		NOR = {
			has_variable = my_arch_votes
			has_variable = ms_i_support_someone
		}
		scope:activity = {
			any_attending_character = {
				has_variable = my_arch_votes
				is_ai = yes
				NOT = {
					THIS = ROOT
				}
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						is_ai = yes
						NOT = {
							THIS = ROOT
						}
						has_variable = my_arch_votes
					}
					save_scope_as = guest0
				}
			}
		}
	}
	option = {
		name = ev10.69.a
		scope:guest0 = {
			pay_short_term_gold = {
				target = ROOT
				gold = medium_gold_min_value
			}
		}
		custom_tooltip = ev10.69.a_ct
		hidden_effect = {
			set_variable = {
				name = ms_i_support_someone
				value = scope:guest0
			}
		}
	}
	option = {
		name = ev10.69.b
		trigger = {
			NOT = {
				has_hook = scope:guest0
			}
		}
		add_hook = {
			type = favor_hook
			target = scope:guest0
		}
		custom_tooltip = ev10.69.a_ct
		hidden_effect = {
			set_variable = {
				name = ms_i_support_someone
				value = scope:guest0
			}
		}
	}
	option = {
		name = ev10.69.c
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 40
			}
		}
		custom_tooltip = ev10.69.a_ct
		hidden_effect = {
			set_variable = {
				name = ms_i_support_someone
				value = scope:guest0
			}
		}
	}
	option = {
		name = ev10.69.d
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -40
			}
		}
	}
}
#Manage Council Funds
magic_ev10.70 = {
	title = mc_manage_funds_decision_name
	desc = ev10.70.desc
	theme =  stewardship
	left_portrait = {
		character = ROOT
		animation = personality_greedy
	}
	option = {
		name = ev10.42.e
		trigger = {
			has_trait = archmage
			has_trait_xp = {
				trait = archmage
				track = alchemy
				value >= 100
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			has_trait = archmage
			has_trait_xp = {
				trait = archmage
				track = alchemy
				value >= 100
			}
		}
		hidden_effect = {
			set_spell_id = { ID = 22 }
			send_message_4_magic_sense_effect = yes
		}
		custom_tooltip = use_magic_custom_tooltip
		spend_standard_ps_effect = yes
		gain_sc_xp1_effect = yes
		scope:liege0 = {
			add_gold = root.greedy_gold_value
		}
		increase_mc_funds_effect = {
			VALUE = root.greedy_gold_value
		}
		stress_impact = {
			greedy = minor_stress_gain
			generous = major_stress_loss
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 20
				opinion = {
					target = scope:liege0
					value > 20
				}
			}
			modifier = {
				add = -200
				opinion = {
					target = scope:liege0
					value < -10
				}
			}
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 10
				has_trait = generous
			}
			modifier = {
				add = 20
				has_character_flag = cm_yellow_card_flag
			}
		}
	}
	option = {
		name = ev10.70.a
		stress_impact = {
			lazy = major_stress_gain
			diligent = medium_stress_loss
		}
		duel = {
			skill = stewardship
			value = 25
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					increase_mc_funds_effect = {
						VALUE = root.my_stewardship_x4_value
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					increase_mc_funds_effect = {
						VALUE = root.stewardship
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				stewardship > 25
			}
		}
	}
	option = {
		name = ev10.70.b
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		random = {
			chance = 95
			send_interface_toast = {
				title = ev3.52.a_1
				increase_mc_funds_effect = {
					VALUE = mc_minor_gold_value
				}
			}
		}
		ai_chance = {
			base = 30
			modifier = {
				add = 20
				exists = global_var:mc_gold_global
				global_var:mc_gold_global > 300
			}
		}
	}
	option = {
		name = ev10.70.c
		trigger = {
			OR = {
				has_trait = avaricious
				has_trait = administrator
				AND = {
					has_trait = governor
					has_trait_xp = {
						trait = governor
						value > 74
					}
				}
			}
		}
		if = {
			limit = {
				100 > mc_normal_gold_value
			}
			increase_mc_funds_effect = {
				VALUE = 100
			}
		}
		else = {
			increase_mc_funds_effect = {
				VALUE = mc_normal_gold_value
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev10.70.d
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		duel = {
			skill = stewardship
			value = 30
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_1
					increase_mc_funds_effect = {
						VALUE = mc_huge_gold_value
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -2
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					decrease_mc_funds_effect = {
						VALUE = mc_huge_gold_value
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 50
				stewardship > 35
			}
		}
	}
	option = {
		name = ev10.70.e
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		if = {
			limit = {
				exists = global_var:current_archmage_global
			}
			give_or_update_embezzler_secret_effect = {
				TARGET = global_var:current_archmage_global
				STAKE = mc_minor_gold_value
			}
		}
		else_if = {
			limit = {
				exists = global_var:current_black_mage_global
			}
			give_or_update_embezzler_secret_effect = {
				TARGET = global_var:current_black_mage_global
				STAKE = mc_minor_gold_value
			}
		}
		take_from_mc_funds_effect = {
			RECEIVER = ROOT
			VALUE = mc_minor_gold_value
		}
		stress_impact = {
			greedy = major_stress_loss
			arbitrary = minor_stress_loss
			generous = minor_stress_gain
			honest = major_stress_gain
			just = medium_stress_gain
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 20
				has_trait = greedy
			}
			modifier = {
				add = 20
				has_trait = deceitful
			}
			modifier = {
				add = -100
				OR = {
					has_trait = just
					has_trait = honest
					has_trait = generous
				}
			}
		}
	}
}

#Mage Summit - archmage special
magic_ev10.71 = {
	type = activity_event
	title = ev6.43.title
	desc = ev10.71.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = {
		character = scope:guest1
		animation = admiration
	}
	right_portrait = {
		character = scope:guest0
		animation = beg
	}
	center_portrait = root

	trigger = {
		is_alive = yes
		has_character_modifier = mc_archmage_modifier
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						has_trait = archmage
						NOT = {
							THIS = ROOT
						}
					}
					save_scope_as = guest0
				}
				random_attending_character = {
					limit = {
						NOR = {
							THIS = ROOT
							THIS = scope:guest0
						}
					}
					save_scope_as = guest1
				}
			}
		}
	}
	option = {
		name = ev10.71.a
		trigger = {
			has_ms_knowledge_sharing_intent_trigger = yes
		}
		reason = activity_intent
		scope:activity = {
			every_attending_character = {
				if = {
					limit = {
						is_true_mage = yes
						has_trait_xp = {
							trait = archmage
							track = secret_knowledge
							value < 100
						}
					}
					gain_sc_xp2_effect = yes
				}
				else_if = {
					limit = {
						has_trait = true_witch
					}
					add_learning_skill = 1
				}
			}
		}
	}
	option = {
		name = ev10.71.b
		trigger = {
			has_ms_show_superiority_intent_trigger = yes
		}
		reason = activity_intent
		stress_impact = {
			arrogant = massive_stress_loss
		}
		add_prestige = major_prestige_gain
	}
	option = {
		name = ev10.71.c
		trigger = {
			has_ms_political_matters_intent_trigger = yes
		}
		reason = activity_intent
		stress_impact = {
			gregarious = medium_stress_loss
			shy = medium_stress_gain
		}
		progress_towards_friend_effect = {
			CHARACTER = scope:guest0
			OPINION = 20
			REASON = friend_random_m1
		}
		scope:guest1 = {
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 20
			}
		}
	}
	option = {
		name = ev10.71.d
		trigger = {
			has_ms_show_superiority_intent_trigger = no
		}
		if = {
			limit = {
				NOR = {
					has_trait = gregarious
					has_trait = shy
				}
			}
			add_stress = minor_stress_gain
		}
		else = {
			stress_impact = {
				gregarious = medium_stress_gain
				shy = medium_stress_loss
			}
		}
	}
	option = {
		name = ev10.71.e
		trigger = {
			has_trait = callous
		}
		add_stress = minor_stress_loss
		add_prestige = minor_prestige_gain
		add_dread = minor_dread_gain
	}
}
#Mage Summit - high council special
magic_ev10.72 = {
	type = activity_event
	title = ev10.72.title
	desc = ev10.72.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:guest0
		animation = beg
	}

	trigger = {
		is_alive = yes
		has_variable = mc_member_var
		scope:activity = {
			any_attending_character = {
				OR = {
					has_trait = archmage
					has_trait = true_witch
				}
				is_ai = yes
				NOR = {
					THIS = ROOT
					has_variable = mc_member_var
					has_relation_rival = ROOT
					has_relation_nemesis = ROOT
				}
			}
		}
	}
	cooldown = {
		years = 1
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						is_ai = yes
						NOR = {
							THIS = ROOT
							has_variable = mc_member_var
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
						}
					}
					save_scope_as = guest0
				}
			}
		}
	}
	option = {
		name = ev10.72.a
		trigger = {
			has_character_modifier = mc_archmage_modifier
		}
		add_prestige = minor_prestige_gain
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 20
			}
		}
	}
	option = {
		name = ev10.72.d
		trigger = {
			NOT = {
				has_character_modifier = mc_archmage_modifier
			}
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 10
			}
		}
	}
	option = {
		name = ev10.72.b
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -5
			}
		}
	}
	option = {
		name = ev10.72.c
		trigger = {
			mc_gold_global_avaiable_trigger = yes
			OR = {
				has_character_modifier = mc_archmage_modifier
				has_character_modifier = mc_admin_modifier
			}
		}
		take_from_mc_funds_effect = {
			RECEIVER = scope:guest0
			VALUE = mc_tiny_gold_value
		}
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 80
			}
		}
		stress_impact = {
			compassionate = medium_stress_loss
		}
	}
}
#Mage Summit - special against archmage
magic_ev10.73 = {
	type = activity_event
	title = ev10.73.title
	desc = ev10.73.desc
	theme = witchcraft
	override_background = {
		reference = feast
	}
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:guest0
		animation = scheme
	}
	lower_left_portrait = scope:amage

	trigger = {
		is_alive = yes
		NOT = {
			has_character_modifier = mc_archmage_modifier
		}
		scope:activity = {
			any_attending_character = {
				has_character_modifier = mc_archmage_modifier
			}
			any_attending_character = {
				has_trait = ambitious
				is_ai = yes
				NOR = {
					THIS = ROOT
					THIS = global_var:current_archmage_global
					has_relation_friend = global_var:current_archmage_global
					has_relation_soulmate = global_var:current_archmage_global
					has_relation_lover = global_var:current_archmage_global
					has_relation_best_friend = global_var:current_archmage_global
					has_relation_mmaster = global_var:current_archmage_global
					has_relation_mminion = global_var:current_archmage_global
					has_relation_rival = ROOT
					has_relation_nemesis = ROOT
				}
				can_start_scheme = {
					type = murder
					target_character = global_var:current_archmage_global
				}
			}
		}
	}
	cooldown = {
		months = 6
	}
	immediate = {
		hidden_effect = {
			scope:activity = {
				random_attending_character = {
					limit = {
						has_trait = ambitious
						is_ai = yes
						NOR = {
							THIS = ROOT
							THIS = global_var:current_archmage_global
							has_relation_friend = global_var:current_archmage_global
							has_relation_soulmate = global_var:current_archmage_global
							has_relation_lover = global_var:current_archmage_global
							has_relation_best_friend = global_var:current_archmage_global
							has_relation_mmaster = global_var:current_archmage_global
							has_relation_mminion = global_var:current_archmage_global
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
						}
						can_start_scheme = {
							type = murder
							target_character = global_var:current_archmage_global
						}
					}
					save_scope_as = guest0
				}
			}
			global_var:current_archmage_global = {
				save_scope_as = amage
			}
		}
	}
	option = {
		name = ev10.73.a
		scope:guest0 = {
			show_as_tooltip = {
				start_scheme = {
					type = murder
					target_character = scope:amage
				}
			}
			hidden_effect = {
				begin_scheme_with_agents_effect = {
					SCHEME_TYPE = murder
					TARGET_TYPE = target_character
					TARGET_SCOPE = scope:amage
					# Success.
					AGENT_1 = agent_assassin
					AGENT_2 = agent_assassin
					AGENT_3 = agent_thug
					# Speed.
					AGENT_4 = agent_infiltrator
					# Secrecy.
					AGENT_5 = agent_alibi
				}
			}
			if = {
				limit = {
					NOT = {
						exists = scope:new_scheme
					}
				}
				random_scheme = {
					limit = {
						scheme_type = murder
						scheme_target_character = scope:amage
					}
					save_scope_as = new_scheme
				}
			}
			add_opinion = {
				target = ROOT
				modifier = friendliness_opinion
				opinion = 50
			}
		}
		hidden_effect = {
			scope:new_scheme = {
				add_agent_slot = agent_assassin
			}
		}
		force_assign_character_to_random_agent_slot_effect = {
			SCHEME = scope:new_scheme
			CHAR = ROOT
			YEARS = 5
		}
		stress_impact = {
			compassionate = major_stress_gain
			sadistic = major_stress_loss
			ambitious = minor_stress_loss
			just = medium_stress_gain
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 5
				opinion = {
					target = scope:amage
					value < 0
				}
			}
			modifier = {
				add = 3
				OR = {
					has_trait = sadistic
					has_trait = arbitrary
					has_trait = deceitful
				}
			}
			modifier = {
				add = -100
				OR = {
					has_trait = just
					has_trait = honest
					has_trait = compassionate
				}
			}
			modifier = {
				add = 200
				OR = {
					has_relation_rival = scope:amage
					has_relation_nemesis = scope:amage
				}
			}
		}
	}
	option = {
		name = ev10.73.b
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -10
			}
		}
		stress_impact = {
			craven = minor_stress_loss
		}
		ai_chance = {
			base = 20
		}
	}
	option = {
		name = ev10.73.c
		scope:guest0 = {
			add_opinion = {
				target = ROOT
				modifier = irritated_opinion
				opinion = -50
			}
		}
		stress_impact = {
			craven = minor_stress_loss
		}
		ai_chance = {
			base = 0
		}
	}
}

#mage summit - cover costs of summit for high council
magic_ev10.74 = {
	title = mc_gold_desc
	desc = ev10.74.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	trigger = {
		has_variable = mc_member_var
		exists = global_var:mc_gold_global
		mage_summit_cost_final_value < global_var:mc_gold_global
	}
	option = {
		name = ep3_camp_party.1025.b	#Of course!
		take_from_mc_funds_effect = {
			RECEIVER = ROOT
			VALUE = mage_summit_cost_final_value
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev10.74.a	#Nope
		add_prestige = minor_prestige_gain
		every_living_character = {
			limit = {
				has_variable = mc_member_var
				NOT = { THIS = ROOT }
			}
			add_opinion = {
				target = ROOT
				modifier = respect_opinion
				opinion = 5
			}
		}
		ai_chance = {
			base = 1
		}
	}
}

#force mage duel
magic_ev10.75 = {
	hidden = yes
	trigger = {
		is_alive = yes
		scope:recipient = {
			is_alive = yes
		}
	}
	immediate = {
		if = {
			limit = {
				NOT = {
					exists = scope:this0
				}
			}
			scope:actor = {
				save_scope_as = this0
			}
		}
		scope:recipient = {
			trigger_event = magic_ev2.6
		}
	}
}
#demand sub from archmage - end your wars
magic_ev10.76 = {
	title = ev10.76.title
	desc = ev10.76.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	trigger = {
		any_character_war = {
			is_white_peace_possible = yes
			OR = {
				primary_attacker = ROOT
				primary_defender = ROOT
			}
		}
	}
	immediate = {
		hidden_effect = {
			save_scope_as = ruler
		}
	}
	option = {
		name = ev10.76.a
		every_character_war = {
			limit = {
				is_white_peace_possible = yes
				OR = {
					primary_attacker = ROOT
					primary_defender = ROOT
				}
			}
			if = {
				limit = {
					primary_attacker = ROOT
				}
				primary_defender = {
					custom_tooltip = ev10.76.a_ct
					trigger_event = magic_ev10.77
				}
			}
			else = {
				primary_attacker = {
					custom_tooltip = ev10.76.a_ct
					trigger_event = magic_ev10.77
				}
			}
		}
	}
}
#demand sub from archmage - end your wars 2.
magic_ev10.77 = {
	type = letter_event
	opening = ev10.40.opening
	desc = ev10.77.desc
	sender = scope:ruler
	option = {
		name = ev4.28.0.a	#Let it be.
		scope:ruler = {
			send_interface_toast = {
				title = ev10.76.title
				random_character_war = {
					limit = {
						OR = {
							AND = {
								primary_attacker = ROOT
								primary_defender = scope:ruler
							}
							AND = {
								primary_attacker = scope:ruler
								primary_defender = ROOT
							}
						}
					}
					end_war = white_peace
				}
			}
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 1000
				any_character_war = {
					primary_attacker = ROOT
					primary_defender = scope:ruler
					attacker_war_score < defender_war_score
				}
			}
			modifier = {
				add = 1000
				any_character_war = {
					primary_attacker = scope:ruler
					primary_defender = ROOT
					attacker_war_score >= defender_war_score
				}
			}
		}
	}
	option = {
		name = ev10.77.a	#There will be no status quo.
		hidden_effect = {
			scope:ruler = {
				send_interface_toast = {
					title = ev10.76.title
					left_icon = ROOT
					custom_tooltip = ev10.77.a_ct
				}
			}
		}
		stress_impact = {
			brave = minor_stress_loss
			craven = minor_stress_gain
		}
		ai_chance = {
			base = 1
		}
	}
}
#demand sub from archmage - refusal
magic_ev10.78 = {
	title = ev10.78.title
	desc = ev10.78.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	lower_right_portrait = scope:recipient
	
	option = {
		name = ev10.78.a
		trigger = {
			NOT = {
				has_character_modifier = excluded_from_magic_community
			}
		}
		scope:recipient = {
			add_prestige_level = -1
			add_character_modifier = {
				modifier = excluded_from_magic_community
				years = 10
			}
		}
	}
	option = {
		name = ev10.78.b
		stress_impact = {
			forgiving = major_stress_loss
			vengeful = major_stress_gain
		}
	}
	option = {
		trigger = {
			exists = global_var:current_black_mage_global
			global_var:current_black_mage_global = {
				is_imprisoned = no
				NOR = {
					has_trait = incapable
					has_variable = pclash
				}
			}
		}
		name = ev10.78.c
		custom_tooltip = ev10.78.c_ct
		custom_tooltip = ev10.78.c_ct2
		hidden_effect = {
			global_var:current_black_mage_global = {
				trigger_event = magic_ev10.79
			}
		}
	}
}
#demand sub from archmage - refusal - black mage
magic_ev10.79 = {
	type = letter_event
	opening = ev10.40.opening
	desc = ev10.79.desc
	sender = scope:ruler
	lower_right_portrait = scope:recipient
	immediate = {
		if = {
			limit = {
				exists = scope:ruler
			}
			clear_saved_scope = ruler
		}
		scope:actor = {
			save_scope_as = ruler
		}
		if = {
			limit = {
				NOT = {
					exists = scope:bmage
				}
			}
			save_scope_as = bmage
		}
	}
	option = {
		name = ev10.79.a
		custom_tooltip = ev10.79.a_ct
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = ev10.79.a_ct1
					show_chance = no
					scope:actor = {
						imprison = {
							target = scope:recipient
							type = dungeon
						}
					}
				}
				1 = {
					desc = ev10.79.a_ct2
					show_chance = no
					configure_start_mage_duel_effect = {
						MD_ATTACKER = root
						MD_DEFENDER = scope:recipient
					}
				}
			}
		}
		hidden_effect = {
			scope:recipient = {
				trigger_event = magic_ev10.80
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.79.b
		scope:actor = {
			send_interface_toast = {
				title = ev10.79.b_ct
				ROOT = {
					remove_from_mc_effect = yes
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}
#demand sub from archmage - refusal - recipient
magic_ev10.80 = {
	title = ev10.78.title
	desc = ev10.80.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = {
		character = scope:bmage
		animation = personality_bold
	}
	lower_right_portrait = scope:actor
	
	option = {
		name = ev10.80.a	#Calmly, I surrender.
		hidden_effect = {
			#scope:actor = {
			#	send_interface_toast = {
			#		title = ev10.79.a_ct1
			#		left_icon = scope:bmage
			#		right_icon = ROOT
			#		show_as_tooltip = {
			#			scope:actor = {
			#				imprison = {
			#					target = ROOT
			#					type = dungeon
			#				}
			#			}
			#		}
			#	}
			#}
			scope:bmage = {
				send_interface_toast = {
					title = ev10.79.a_ct1
					left_icon = ROOT
					right_icon = scope:actor
					show_as_tooltip = {
						scope:actor = {
							imprison = {
								target = ROOT
								type = dungeon
							}
						}
					}
				}
			}
			
		}
		scope:actor = {
			if = {
				limit = {
					exists = scope:troublemaker
				}
				send_interface_toast = {
					title = troublemaker_arrested
					imprison = {
						target = ROOT
						type = dungeon
					}
				}
			}
			else = {
				send_interface_toast = {
					title = demand_submission_archmage_interaction
					imprison = {
						target = ROOT
						type = dungeon
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				has_trait = craven
			}
			modifier = {
				add = 9
				has_trait = loyal
			}
			modifier = {
				add = 9
				scope:bmage.overall_magic_power_value > root.overall_magic_power_value
			}
		}
	}
	option = {
		name = ev6.49.0.a	#If so, lets fight.
		configure_start_mage_duel_effect = {
			MD_ATTACKER = scope:bmage
			MD_DEFENDER = root
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				scope:bmage.overall_magic_power_value <= root.overall_magic_power_value
			}
			modifier = {
				add = 9
				OR = {
					has_relation_rival = scope:actor
					has_relation_nemesis = scope:actor
				}
			}
			modifier = {
				add = -100
				is_powerful_being = no
			}
		}
	}
}

#secret meeting! - intro
magic_ev10.81 = {
	title = ev10.81.title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = {
						has_character_flag = already_participated_in_sm_flag
					}
				}
				desc = ev10.81.desc1
			}
			desc = ev10.81.desc0
		}
		triggered_desc = {
			trigger = {
				NOT = {
					ROOT = scope:amage
				}
			}
			desc = ev10.81.desc2
		}
	}
	theme = diplomacy
	left_portrait = {
		character = ROOT
	}
	lower_left_portrait = {
		trigger = {
			exists = scope:p3
		}
		character = scope:p3
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:p4
		}
		character = scope:p4
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:p5
		}
		character = scope:p5
	}
	immediate = {
		sm_set_portraits_effect = yes
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:admin
				}
				set_variable = {
					name = art_counter
					value = 0
				}
				every_artifact = {
					limit = {
						OR = {
							has_variable = magic1
							has_variable = magic_ring
							has_variable = magic_ring0
							has_artifact_modifier = singularity_modifierX
						}
						artifact_owner = {
							has_variable = mc_member_var
						}
					}
					ROOT = {
						change_variable = {
							name = art_counter
							add = 1
						}
					}
				}
				set_variable = {
					name = ppower_counter
					value = 0
				}
				if = {
					limit = {
						any_province = {
							has_building_or_higher = witch_house
							province_owner = {
								has_variable = mc_member_var
							}
						}
					}
					change_variable = {
						name = ppower_counter
						add = 1
					}
				}
				if = {
					limit = {
						any_province = {
							has_building_or_higher = horned_god_house
							province_owner = {
								has_variable = mc_member_var
							}
						}
					}
					change_variable = {
						name = ppower_counter
						add = 1
					}
				}
				if = {
					limit = {
						any_province = {
							has_building_or_higher = mage_house
							province_owner = {
								has_variable = mc_member_var
							}
						}
					}
					change_variable = {
						name = ppower_counter
						add = 1
					}
				}
				set_variable = {
					name = mages_counter
					value = 0
				}
				every_living_character = {
					limit = {
						is_true_mage = yes
					}
					ROOT = {
						change_variable = {
							name = mages_counter
							add = 1
						}
					}
				}
				set_variable = {
					name = demons_counter
					value = 0
				}
				every_living_character = {
					limit = {
						is_a_demon_trigger = yes
					}
					ROOT = {
						change_variable = {
							name = demons_counter
							add = 1
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.81.a
		trigger = {
			ROOT = scope:amage
		}
	}
	option = {
		name = ev10.81.b
		trigger = {
			OR = {
				ROOT = scope:bmage
				ROOT = scope:loremaster
			}
		}
	}
	option = {
		name = ev10.81.c
		trigger = {
			ROOT = scope:admin
		}
		
	}
	after = {
		hidden_effect = {
			#choose_next_mc_member_effect = { ORDER = 1234 }
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:bmage = {
					trigger_event = magic_ev10.81
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.81
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:admin = {
					trigger_event = magic_ev10.81
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:amage = {
					trigger_event = magic_ev10.82
				}
			}
		}
	}
}
#secret meeting! - Admin reports
magic_ev10.82 = {
	title = mc_admin_modifier
	desc = {
		triggered_desc = {
			trigger = {
				NOT = {
					ROOT = scope:admin
				}
			}
			desc = ev10.82.desc0
		}
		triggered_desc = {
			trigger = {
				ROOT = scope:admin
			}
			desc = ev10.82.desc1
		}
		desc = ev10.82.desc2
		desc = ev10.82.desc3
		desc = ev10.82.desc4
		desc = ev10.82.desc5
		desc = ev10.82.desc6
		triggered_desc = {
			trigger = {
				ROOT = scope:loremaster
			}
			desc = ev10.82.desc7
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:admin
	}
	lower_left_portrait = scope:bmage
	lower_center_portrait = scope:loremaster
	lower_right_portrait = scope:amage
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:loremaster
				}
				random_list = {
					1 = {
						add_character_flag = lore_rew1_flag
					}
					1 = {
						add_character_flag = lore_rew2_flag
					}
					1 = {
						add_character_flag = lore_rew3_flag
					}
					1 = {
						add_character_flag = lore_rew4_flag
					}
				}
			}
		}
	}
	
	option = {
		name = ev10.82.a
		trigger = {
			ROOT = scope:admin
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.82.b
		trigger = {
			ROOT = scope:bmage
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.82.c
		trigger = {
			ROOT = scope:amage
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.82.d
		trigger = {
			ROOT = scope:loremaster
			is_false_mage = no
			OR = {
				has_trait = scholar
				learning > 20
			}
		}
		grants_loremaster_rew_effect = yes
		show_as_tooltip = {
			scope:amage = {
				grants_loremaster_rew_effect = yes
			}
			scope:bmage = {
				grants_loremaster_rew_effect = yes
			}
			scope:admin = {
				grants_loremaster_rew_effect = yes
			}
		}
		stress_impact = {
			paranoid = medium_stress_gain
			lazy = medium_stress_gain
			scholar = minor_stress_loss
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -1
				OR = {
					has_trait = paranoid
					has_trait = lazy
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = scholar
					has_trait = diligent
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = arrogant
					has_trait = ambitious
				}
			}
		}
	}
	option = {
		name = ev10.82.e
		trigger = {
			ROOT = scope:loremaster
		}
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = lore_rew1_flag
				}
				remove_character_flag = lore_rew1_flag
			}
			if = {
				limit = {
					has_character_flag = lore_rew2_flag
				}
				remove_character_flag = lore_rew2_flag
			}
			if = {
				limit = {
					has_character_flag = lore_rew3_flag
				}
				remove_character_flag = lore_rew3_flag
			}
			if = {
				limit = {
					has_character_flag = lore_rew4_flag
				}
				remove_character_flag = lore_rew4_flag
			}
		}
		if = {
			limit = {
				NOT = {
					is_false_mage = no
					OR = {
						has_trait = scholar
						learning > 20
					}
				}
			}
			stress_impact = {
				paranoid = medium_stress_loss
				lazy = medium_stress_loss
				content = minor_stress_loss
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				OR = {
					has_trait = paranoid
					has_trait = lazy
					has_trait = content
				}
			}
		}
	}
	after = {
		hidden_effect = {
			#choose_next_mc_member_effect = { ORDER = 1423 }
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:admin = {
					trigger_event = magic_ev10.82
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:bmage= {
					trigger_event = magic_ev10.82
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.82
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:amage = {
					trigger_event = magic_ev10.83
				}
			}
		}
	}
}
#secret meeting! - Loremaster reports
magic_ev10.83 = {
	title = mc_loremaster_modifier
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:loremaster = {
						OR = {
							has_character_flag = lore_rew1_flag
							has_character_flag = lore_rew2_flag
							has_character_flag = lore_rew3_flag
							has_character_flag = lore_rew4_flag
						}
					}
				}
				desc = ev10.83.desc0
			}
			desc = ev10.83.desc1
		}
		triggered_desc = {
			trigger = {
				ROOT = scope:bmage
			}
			desc = ev10.83.desc2
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:loremaster
	}
	lower_left_portrait = scope:bmage
	lower_center_portrait = scope:admin
	lower_right_portrait = scope:amage

	immediate = {
		sm_set_portraits_effect = yes
		if = {
			limit = {
				scope:loremaster = {
					OR = {
						has_character_flag = lore_rew1_flag
						has_character_flag = lore_rew2_flag
						has_character_flag = lore_rew3_flag
						has_character_flag = lore_rew4_flag
					}
				}
			}
			grants_loremaster_rew_effect = yes
			show_as_tooltip = {
				scope:p3 = {
					grants_loremaster_rew_effect = yes
				}
				scope:p4 = {
					grants_loremaster_rew_effect = yes
				}
				scope:p5 = {
					grants_loremaster_rew_effect = yes
				}
			}
		}
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:bmage
				}
				random_known_secret = {
					limit = {
						secret_owner = {
							NOT = {
								has_variable = mc_member_var
							}
							OR = {
								highest_held_title_tier = tier_empire
								highest_held_title_tier = tier_kingdom
							}
						}
						NOR = {
							is_known_by = scope:amage
							is_known_by = scope:admin
							is_known_by = scope:loremaster
						}
					}
					save_scope_as = sec0
				}
				if = {
					limit = {
						is_ai = yes
						NOT = {
							exists = scope:sec0
						}
					}
					random_living_character = {
						limit = {
							any_secret = {
								secret_type = secret_witch_hunter
								NOR = {
									is_known_by = scope:amage
									is_known_by = scope:admin
									is_known_by = scope:loremaster
								}
							}
						}
						random_secret = {
							limit = {
								secret_type = secret_witch_hunter
								NOR = {
									is_known_by = scope:amage
									is_known_by = scope:admin
									is_known_by = scope:loremaster
								}
							}
							reveal_to = ROOT
							save_scope_as = sec0
						}
					}
				}
			}
		}
	}
	
	option = {
		name = ev10.83.a
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				OR = {
					has_character_flag = lore_rew1_flag
					has_character_flag = lore_rew2_flag
					has_character_flag = lore_rew3_flag
					has_character_flag = lore_rew4_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.83.b
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				NOR = {
					has_character_flag = lore_rew1_flag
					has_character_flag = lore_rew2_flag
					has_character_flag = lore_rew3_flag
					has_character_flag = lore_rew4_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.83.c
		trigger = {
			ROOT = scope:admin
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.83.d
		trigger = {
			ROOT = scope:bmage
		}
		custom_tooltip = ev10.83.d_ct
		add_character_flag = bmage_rep1_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				any_living_character = {
					is_witch_huter = yes
					count > 2
				}
			}
			modifier = {
				add = 3
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.83.e
		trigger = {
			ROOT = scope:bmage
		}
		custom_tooltip = ev10.83.d_ct
		add_character_flag = bmage_rep2_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				any_living_character = {
					is_a_demon_trigger = yes
					count > 2
				}
			}
			modifier = {
				add = 3
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.83.g
		trigger = {
			ROOT = scope:bmage
			exists = scope:sec0
		}
		show_as_tooltip = {
			scope:sec0 = {
				reveal_to = scope:amage
				reveal_to = scope:admin
				reveal_to = scope:loremaster
			}
		}
		add_character_flag = bmage_rep3_flag
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.83.f
		trigger = {
			ROOT = scope:bmage
		}
		show_as_tooltip = {
			scope:amage = {
				add_stress = minor_stress_loss
			}
			scope:admin = {
				add_stress = minor_stress_loss
			}
			scope:loremaster = {
				add_stress = minor_stress_loss
			}
		}
		add_character_flag = bmage_rep4_flag
		ai_chance = {
			base = 2
			modifier = {
				add = 2
				has_trait = trusting
			}
			modifier = {
				add = -2
				has_trait = paranoid
			}
			modifier = {
				add = -5
				OR = {
					exists = global_var:magic_grand_coalition_start
					any_living_character = {
						has_character_flag = abdul_dude
					}
					any_living_character = {
						has_character_flag = bael_flag
					}
				}
			}
		}
	}
	after = {
		hidden_effect = {
			#choose_next_mc_member_effect = { ORDER = 1042 }
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:admin = {
					trigger_event = magic_ev10.83
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:bmage= {
					trigger_event = magic_ev10.83
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:amage = {
					trigger_event = magic_ev10.84
				}
			}
		}
	}
}
#secret meeting! - Black mage reports
magic_ev10.84 = {
	title = mc_black_mage_modifier
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage= {
						has_character_flag = bmage_rep1_flag
					}
				}
				desc = ev10.84.desc0
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage= {
						has_character_flag = bmage_rep2_flag
					}
				}
				desc = ev10.84.desc1
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage= {
						has_character_flag = bmage_rep3_flag
					}
				}
				desc = ev10.84.desc2
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage= {
						has_character_flag = bmage_rep4_flag
					}
				}
				desc = ev10.84.desc3
			}
			desc = empty1_desc
		}
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:bmage }
			}
			desc = line_break
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:amage }
					scope:amage= {
						has_character_flag = amage_rep1_bmage_rep1_flag
					}
				}
				desc = ev10.84.desc4
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:amage }
					scope:amage= {
						has_character_flag = amage_rep2_bmage_rep1_flag
					}
				}
				desc = ev10.84.desc5
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:amage }
					scope:amage= {
						has_character_flag = amage_rep3_bmage_rep1_flag
					}
				}
				desc = ev10.84.desc6
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:amage }
					scope:amage= {
						has_character_flag = amage_rep4_bmage_rep1_flag
					}
				}
				desc = ev10.84.desc7
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:amage }
					scope:amage= {
						has_character_flag = amage_rep1_bmage_rep2_flag
					}
				}
				desc = ev10.84.desc8
			}
			desc = empty1_desc
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:bmage
	}
	lower_left_portrait = scope:loremaster
	lower_center_portrait = scope:admin
	lower_right_portrait = scope:amage
	immediate = {
		hidden_effect = {
			sm_set_portraits_effect = yes
		}
		if = {
			limit = {
				NOT = {
					ROOT = scope:amage
				}
				scope:amage = {
					has_character_flag = amage_rep1_bmage_rep3_flag
				}
				exists = scope:sec0
			}
			scope:sec0 = {
				if = {
					limit = {
						scope:sec0 = {
							NOT = {
								is_known_by = ROOT
							}
						}
					}
					reveal_to = ROOT
				}
				if = {
					limit = {
						NOT = {
							scope:p3 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p3
					}
				}
				if = {
					limit = {
						NOT = {
							scope:p4 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p4
					}
				}
				if = {
					limit = {
						NOT = {
							scope:p5 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p5
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { ROOT = scope:amage }
				scope:amage = {
					has_character_flag = amage_rep3_bmage_rep1_flag
				}
			}
			show_as_tooltip = {
				decrease_mc_funds_effect = {
					VALUE = scope:amage.var:fixed_gold_value
				}
				custom_tooltip = ev10.84.c_ct
			}
		}
		else_if = {
			limit = {
				NOT = { ROOT = scope:amage }
				scope:amage = {
					has_character_flag = amage_rep1_bmage_rep2_flag
				}
			}
			custom_tooltip = ev10.84.e_ct
		}
	}
	
	option = {
		name = ev10.84.a	#Find them and kill them. (hunters)
		trigger = {
			ROOT = scope:amage
			scope:bmage= {
				has_character_flag = bmage_rep1_flag
			}
		}
		custom_tooltip = ev10.84.a_ct
		add_character_flag = amage_rep1_bmage_rep1_flag
		ai_chance = {
			base = 2
			modifier = {
				add = 5
				has_trait = callous
			}
			modifier = {
				add = 1
				has_trait = deceitful
			}
		}
	}
	option = {
		name = ev10.84.b	#I will deal with this personally.	(hunters)
		trigger = {
			ROOT = scope:amage
			scope:bmage= {
				has_character_flag = bmage_rep1_flag
			}
		}
		add_prestige = minor_prestige_gain
		stress_impact = {
			sadistic = medium_stress_loss
			brave = minor_stress_loss
			lazy = medium_stress_gain
			craven = major_stress_gain
		}
		scope:bmage = {
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 10
			}
		}
		hidden_effect = {
			seek_and_destroy_hunters_effect = yes
		}
		add_character_flag = amage_rep2_bmage_rep1_flag
		ai_chance = {
			base = 2
			modifier = {
				add = 5
				has_trait = sadistic
			}
			modifier = {
				add = 2
				has_trait = arrogant
			}
			modifier = {
				add = 1
				has_trait = brave
			}
			modifier = {
				add = -2
				has_trait = deceitful
			}
			modifier = {
				add = -20
				has_trait = craven
			}
		}
	}
	option = {
		name = ev10.84.c	#The Council will set bounties on the heads of hunters.	(huters)
		trigger = {
			ROOT = scope:amage
			scope:bmage= {
				has_character_flag = bmage_rep1_flag
			}
			exists = global_var:mc_gold_global
			global_var:mc_gold_global > 300
		}
		set_variable = {
			name = fixed_gold_value
			value = mc_tiny_gold_value
		}
		decrease_mc_funds_effect = {
			VALUE = mc_tiny_gold_value
		}
		custom_tooltip = ev10.84.c_ct
		hidden_effect = {
			every_living_character = {
				limit = {
					is_witch_huter = yes
					is_ai = yes
					is_powerful_being = no
				}
				random = {
					chance = 7
					death = {
						death_reason = death_murder
					}
				}
			}
			add_character_flag = amage_rep3_bmage_rep1_flag
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = generous
			}
			modifier = {
				add = 1
				has_trait = deceitful
			}
			modifier = {
				add = 2
				has_trait = craven
			}
		}
	}
	option = {
		name = ev10.84.e	#I expect you all to take some action.(demons)
		trigger = {
			ROOT = scope:amage
			scope:bmage= {
				has_character_flag = bmage_rep2_flag
			}
		}
		add_character_flag = amage_rep1_bmage_rep2_flag
		custom_tooltip = ev10.84.e_ct
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_character_flag = mc_fighting_demons_flag
					}
				}
				add_character_flag = {
					flag = mc_fighting_demons_flag
					years = 3
				}
			}
			scope:bmage = {
				if = {
					limit = {
						NOT = {
							has_character_flag = mc_fighting_demons_flag
						}
					}
					add_character_flag = {
						flag = mc_fighting_demons_flag
						years = 3
					}
				}
			}
			scope:loremaster = {
				if = {
					limit = {
						NOT = {
							has_character_flag = mc_fighting_demons_flag
						}
					}
					add_character_flag = {
						flag = mc_fighting_demons_flag
						years = 3
					}
				}
			}
			scope:admin = {
				if = {
					limit = {
						NOT = {
							has_character_flag = mc_fighting_demons_flag
						}
					}
					add_character_flag = {
						flag = mc_fighting_demons_flag
						years = 3
					}
				}
			}
		}
		ai_chance = {
			base = 3
			modifier = {
				add = -3
				is_or_will_be_a_demon_trigger = yes
			}
		}
	}
	option = {
		name = ev10.84.d	#Yes, keep an eye on them for now. (hunter/demons)
		trigger = {
			ROOT = scope:amage
			scope:bmage= {
				OR = {
					has_character_flag = bmage_rep1_flag
					has_character_flag = bmage_rep2_flag
				}
			}
		}
		add_character_flag = amage_rep4_bmage_rep1_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 3
				has_trait = compassionate
			}
			modifier = {
				add = 2
				has_trait = trusting
			}
		}
	}
	option = {
		name = fp2_other_decisions.0701.c	#Good. (secret/nothing)
		trigger = {
			#OR = {
			#	ROOT = scope:amage
			#	ROOT = scope:loremaster
			#	ROOT = scope:admin
			#}
			ROOT = scope:amage
			scope:bmage= {
				OR = {
					has_character_flag = bmage_rep3_flag
					has_character_flag = bmage_rep4_flag
				}
			}
		}
		if = {
			limit = {
				scope:bmage = {
					has_character_flag = bmage_rep3_flag
				}
				exists = scope:sec0
			}
			add_character_flag = amage_rep1_bmage_rep3_flag
			scope:sec0 = {
				reveal_to = ROOT
				if = {
					limit = {
						NOT = {
							scope:p3 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p3
					}
				}
				if = {
					limit = {
						NOT = {
							scope:p4 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p4
					}
				}
				if = {
					limit = {
						NOT = {
							scope:p5 = scope:bmage
						}
					}
					show_as_tooltip = {
						reveal_to = scope:p5
					}
				}
			}
		}
		else = {
			add_character_flag = amage_rep1_bmage_rep4_flag
		}
		ai_chance = {
			base = 1
		}
	}
	#rest of the council
	option = {
		name = ev10.79.a	#As you wish, archmage.
		trigger = {
			ROOT = scope:bmage
			scope:amage= {
				has_character_flag = amage_rep1_bmage_rep1_flag
			}
		}
		hidden_effect = {
			seek_and_destroy_hunters_effect = yes
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = fp2_other_decisions.0701.c	#Good.
		trigger = {
			OR = {
				ROOT = scope:loremaster
				ROOT = scope:admin
			}
			scope:amage= {
				has_character_flag = amage_rep1_bmage_rep1_flag
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = fp2_other_decisions.0701.c	#Good.
		trigger = {
			OR = {
				ROOT = scope:loremaster
				ROOT = scope:admin
				ROOT = scope:bmage
			}
			scope:amage = {
				OR = {
					has_character_flag = amage_rep2_bmage_rep1_flag
					has_character_flag = amage_rep3_bmage_rep1_flag
					has_character_flag = amage_rep4_bmage_rep1_flag
					has_character_flag = amage_rep1_bmage_rep2_flag
					has_character_flag = amage_rep1_bmage_rep3_flag
					has_character_flag = amage_rep1_bmage_rep4_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.84.f	#Waiting can be risky...
		trigger = {
			OR = {
				ROOT = scope:loremaster
				ROOT = scope:admin
				ROOT = scope:bmage
			}
			scope:amage = {
				has_character_flag = amage_rep4_bmage_rep1_flag
			}
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					scope:bmage = {
						OR = {
							has_character_flag = bmage_rep1_flag
							has_character_flag = bmage_rep2_flag
						}
					}
				}
				#choose_next_mc_member_effect = { ORDER = 1034 }
				if = {
					limit = {
						ROOT = scope:amage
					}
					scope:loremaster = {
						trigger_event = magic_ev10.84
					}
				}
				else_if = {
					limit = {
						ROOT = scope:loremaster
					}
					scope:admin= {
						trigger_event = magic_ev10.84
					}
				}
				else_if = {
					limit = {
						ROOT = scope:admin
					}
					scope:amage = {
						trigger_event = magic_ev10.85
					}
				}
			}
			else = {
				#choose_next_mc_member_effect = { ORDER = 1234 }
				if = {
					limit = {
						ROOT = scope:amage
					}
					scope:bmage = {
						trigger_event = magic_ev10.84
					}
				}
				else_if = {
					limit = {
						ROOT = scope:bmage
					}
					scope:loremaster= {
						trigger_event = magic_ev10.84
					}
				}
				else_if = {
					limit = {
						ROOT = scope:loremaster
					}
					scope:admin = {
						trigger_event = magic_ev10.84
					}
				}
				else_if = {
					limit = {
						ROOT = scope:admin
					}
					scope:amage = {
						trigger_event = magic_ev10.85
					}
				}
			}
		}
	}
}
#secret meeting! - second part begins
magic_ev10.85 = {
	title = mc_archmage_modifier
	desc = ev10.85.desc0
	theme = diplomacy
	left_portrait = {
		character = scope:amage
	}
	lower_left_portrait = scope:loremaster
	lower_center_portrait = scope:admin
	lower_right_portrait = scope:bmage
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
				}
				if = {
					limit = {
						OR = {
							exists = global_var:magic_grand_coalition_start
							any_living_character = {
								has_character_flag = abdul_dude
							}
							any_living_character = {
								has_character_flag = bael_flag
							}
							any_living_character = {
								has_character_flag = may_has_wh_coalition_war_flag
							}
						}
					}
					add_character_flag = mc_crisises_flag
				}
			}
		}
	}
	option = {
		name = ev10.85.a
		hidden_effect = {
			scope:loremaster = {
				trigger_event = magic_ev10.86
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.85.b
		trigger = {
			has_character_flag = mc_crisises_flag
			NOT = {
				has_character_modifier = mage_council_support_modifier
			}
		}
		add_internal_flag = special
		trigger_event = magic_ev10.94
		ai_chance = {
			base = 0
		}
	}
}
#secret meeting! - loremaster proposal
magic_ev10.86 = {
	title = ev10.86.title
	desc = {
		desc = ev10.85.desc0
		desc = line_break
		desc = ev10.86.desc0
	}
	theme = diplomacy
	left_portrait = {
		character = ROOT
	}
	lower_left_portrait = scope:amage
	lower_center_portrait = scope:admin
	lower_right_portrait = scope:bmage
	immediate = {
		hidden_effect = {
			random_living_character = {
				limit = {
					has_unstable_source_trigger = yes
					age >=5
					is_adult = no
					OR = {
						NOT = {
							any_relation = {
								type = guardian
							}
						}
						any_relation = {
							type = guardian
							NOR = {
								has_trait = archmage
								has_trait = true_witch
								is_a_demon_trigger = yes
							}
						}
					}
				}
				save_scope_as = source_child
			}
			scope:loremaster = {
				set_variable = {
					name = fixed_gold_value
					value = mc_minor_gold_value
				}
			}
			if = {
				limit = {
					NOT = {
						any_living_character = {
							has_character_modifier = rector_magic_academy_modifier
						}
					}
					OR = {
						has_mage_academy_trigger = yes
						scope:amage = {
							has_mage_academy_trigger = yes
						}
						scope:bmage = {
							has_mage_academy_trigger = yes
						}
						scope:admin = {
							has_mage_academy_trigger = yes
						}
					}
				}
				add_character_flag = rector_is_valid_option_flag
			}
		}
	}
	
	option = {
		name = ev10.86.a	#I have heard of a source that may need care.
		trigger = {
			exists = scope:source_child
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					scope:source_child = {
						set_relation_guardian = scope:loremaster
					}
				}
				1 = {
					desc = mc_approval
					trigger = {
						scope:amage = {
							any_relation = {
								type = ward
								count < 2
							}
						}
					}
					show_chance = no
					scope:source_child = {
						set_relation_guardian = scope:amage
					}
				}
				1 = {
					desc = mc_approval
					trigger = {
						scope:bmage = {
							any_relation = {
								type = ward
								count < 2
							}
						}
					}
					show_chance = no
					scope:source_child = {
						set_relation_guardian = scope:bmage
					}
				}
				1 = {
					desc = mc_approval
					trigger = {
						scope:admin = {
							any_relation = {
								type = ward
								count < 2
							}
						}
					}
					show_chance = no
					scope:source_child = {
						set_relation_guardian = scope:admin
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = lore_rep1_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.87
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 5
				has_trait = compassionate
			}
			modifier = {
				add = 1
				has_trait = scholar
			}
		}
	}
	option = {
		name = ev10.86.b	#I need funds for my research.
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					take_from_mc_funds_effect = {
						RECEIVER = ROOT
						VALUE = mc_minor_gold_value
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = lore_rep2_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.87
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				gold < 300
			}
			modifier = {
				add = 5
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.86.c	#We should implement a development program.
		trigger = {
			exists = global_var:mc_gold_global
			global_var:mc_gold_global > 1000
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 1000
					}
					add_character_modifier = {
						modifier = mc_development_modifier
						years = 2
					}
					scope:amage = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
					scope:bmage = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
					scope:admin = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = lore_rep3_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.87
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = administrator
			}
			modifier = {
				add = 2
				has_trait = scholar
			}
			modifier = {
				add = 1
				has_trait = diligent
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
		}
	}
	option = {
		name = ev10.86.e	#I could produce a squad of battle golems for the Council.
		trigger = {
			exists = global_var:mc_gold_global
			global_var:mc_gold_global >= 1200
			has_character_flag = me_golem2_project_done
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 1200
					}
					custom_tooltip = ev10.86.e_ct
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = lore_rep4_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.87
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = generous
			}
			modifier = {
				add = 1
				has_trait = scholar
			}
			modifier = {
				add = 1
				has_trait = diligent
			}
			modifier = {
				add = 1
				has_trait = trusting
			}
			modifier = {
				add = -5
				has_trait = paranoid
			}
			modifier = {
				add = -20
				OR = {
					has_relation_rival = scope:amage
					has_relation_nemesis = scope:amage
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
					has_relation_rival = scope:admin
					has_relation_nemesis = scope:admin
				}
			}
		}
	}
	option = {
		name = ev10.86.f	#We should elect a rector of the magic academy.
		trigger = {
			has_character_flag = rector_is_valid_option_flag
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					add_character_modifier = {
						modifier = rector_magic_academy_modifier
					}
					add_prestige = major_prestige_gain
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = ev10.86.f_ct
				}
			}
		}
		add_character_flag = lore_rep5_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.87
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 2
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = scholar
			}
			modifier = {
				add = 1
				has_trait = diligent
			}
			modifier = {
				add = 1
				has_trait = arrogant
			}
		}
	}
	option = {
		name = ev10.86.d	#I have no proposals.
		hidden_effect = {
			scope:bmage = {
				trigger_event = magic_ev10.88
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 3
				has_trait = lazy
			}
			modifier = {
				add = -1
				has_trait = ambitious
			}
			modifier = {
				add = -1
				has_trait = diligent
			}
		}
	}
	option = {
		name = childhood.1006.c
		trigger = {
			has_trait = incapable
		}
		exclusive = yes
		hidden_effect = {
			scope:bmage = {
				trigger_event = magic_ev10.88
			}
		}
		ai_chance = {
			base = 1
		}
	}
}
#secret meeting! - loremaster proposal and amage responding
magic_ev10.87 = {
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					ROOT = scope:loremaster
				}
				desc = ev10.87.title
			}
			desc = mc_loremaster_modifier
		}
	}
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:loremaster }
					scope:loremaster = {
						has_character_flag = lore_rep1_flag
					}
				}
				desc = ev10.87.desc0
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:loremaster }
					scope:loremaster = {
						has_character_flag = lore_rep2_flag
					}
				}
				desc = ev10.87.desc1
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:loremaster }
					scope:loremaster = {
						has_character_flag = lore_rep3_flag
					}
				}
				desc = ev10.87.desc2
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:loremaster }
					scope:loremaster = {
						has_character_flag = lore_rep4_flag
					}
				}
				desc = ev10.87.desc4
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:loremaster }
					scope:loremaster = {
						has_character_flag = lore_rep5_flag
					}
				}
				desc = ev10.87.desc5
			}
			desc = empty1_desc
		}
		triggered_desc = {
			trigger = {
				NOR = { ROOT = scope:loremaster ROOT = scope:amage }
			}
			desc = line_break
		}
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:amage }
			}
			desc = ev10.87.desc3
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:s1
	}
	lower_left_portrait = scope:s2
	lower_center_portrait = scope:s3
	lower_right_portrait = scope:s4
	immediate = {
		sm_set_special_portraits_effect = { SPECIAL = 3 }
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
					scope:loremaster = {
						has_character_flag = lore_rep5_flag
					}
				}
				if = {
					limit = {
						any_relation = {
							type = soulmate
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
					}
					random_relation = {
						type = soulmate
						limit = {
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
						save_scope_as = prector
					}
				}
				else_if = {
					limit = {
						any_relation = {
							type = best_friend
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
					}
					random_relation = {
						type = best_friend
						limit = {
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
						save_scope_as = prector
					}
				}
				else_if = {
					limit = {
						any_relation = {
							type = friend
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
					}
					random_relation = {
						type = friend
						limit = {
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
						save_scope_as = prector
					}
				}
				else_if = {
					limit = {
						any_relation = {
							type = lover
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
					}
					random_relation = {
						type = lover
						limit = {
							has_trait = archmage
							NOT = { has_variable = mc_member_var }
							NOT = { has_trait = incapable }
						}
						save_scope_as = prector
					}
				}
			}
		}
		if = {
			limit = {
				NOT = { ROOT = scope:amage }
			}
			hidden_effect = {
				sm_set_portraits_effect = yes
			}
			if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_lore_rep1_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:loremaster
					}
					set_relation_ward = scope:source_child
				}
				else = {
					show_as_tooltip = {
						scope:loremaster = {
							set_relation_ward = scope:source_child
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep2_lore_rep1_flag
					}
				}
				show_as_tooltip = {
					scope:amage = {
						set_relation_ward = scope:source_child
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep3_lore_rep1_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:bmage
					}
					set_relation_ward = scope:source_child
				}
				else = {
					show_as_tooltip = {
						scope:bmage = {
							set_relation_ward = scope:source_child
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep4_lore_rep1_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:admin
					}
					set_relation_ward = scope:source_child
				}
				else = {
					show_as_tooltip = {
						scope:admin = {
							set_relation_ward = scope:source_child
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_lore_rep4_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 1200
					}
				}
				scope:s1 = {
					if = {
						limit = {
							is_ruler = yes
						}
						spawn_army = {
							name = golems_army
							men_at_arms = {
								type = golems_army
								stacks = 3
							}
							inheritable = no
							uses_supply = no
							location = root.location
						}
					}
				}
				show_as_tooltip = {
					scope:s2 = {
						if = {
							limit = {
								is_ruler = yes
							}
							spawn_army = {
								name = golems_army
								men_at_arms = {
									type = golems_army
									stacks = 3
								}
								inheritable = no
								uses_supply = no
								location = root.location
							}
						}
					}
					scope:s3 = {
						if = {
							limit = {
								is_ruler = yes
							}
							spawn_army = {
								name = golems_army
								men_at_arms = {
									type = golems_army
									stacks = 3
								}
								inheritable = no
								uses_supply = no
								location = root.location
							}
						}
					}
					scope:s4 = {
						if = {
							limit = {
								is_ruler = yes
							}
							spawn_army = {
								name = golems_army
								men_at_arms = {
									type = golems_army
									stacks = 3
								}
								inheritable = no
								uses_supply = no
								location = root.location
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						OR = {
							has_character_flag = amage_rep5_lore_rep1_flag
							has_character_flag = amage_rep2_lore_rep2_flag
							has_character_flag = amage_rep2_lore_rep3_flag
							has_character_flag = amage_rep2_lore_rep4_flag
						}
					}
				}
				custom_tooltip = sm_archmage_rejection_ct
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_lore_rep5_flag
					}
				}
				show_as_tooltip = {
					scope:loremaster = {
						add_character_modifier = {
							modifier = rector_magic_academy_modifier
						}
						add_prestige = major_prestige_gain
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep2_lore_rep5_flag
					}
				}
				show_as_tooltip = {
					scope:amage = {
						add_character_modifier = {
							modifier = rector_magic_academy_modifier
						}
						add_prestige = major_prestige_gain
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep3_lore_rep5_flag
					}
				}
				show_as_tooltip = {
					scope:bmage = {
						add_character_modifier = {
							modifier = rector_magic_academy_modifier
						}
						add_prestige = major_prestige_gain
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep4_lore_rep5_flag
					}
				}
				show_as_tooltip = {
					scope:prector = {
						add_character_modifier = {
							modifier = rector_magic_academy_modifier
						}
						add_prestige = major_prestige_gain
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_lore_rep2_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:loremaster
					}
					#set_variable = {
					#	name = fixed_gold_value
					#	value = mc_minor_gold_value
					#}
					take_from_mc_funds_effect = {
						RECEIVER = scope:loremaster
						VALUE = mc_minor_gold_value
					}
				}
				else = {
					show_as_tooltip = {
						take_from_mc_funds_effect = {
							RECEIVER = scope:loremaster
							VALUE = scope:loremaster.var:fixed_gold_value
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_lore_rep3_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 1000
					}
				}
				add_character_modifier = {
					modifier = mc_development_modifier
					years = 2
				}
				show_as_tooltip = {
					scope:p3 = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
					scope:p4 = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
					scope:p5 = {
						add_character_modifier = {
							modifier = mc_development_modifier
							years = 2
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.87.a
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep1_flag
				any_relation = {
					type = ward
					count < 2
				}
			}
		}
		show_as_tooltip = {
			scope:loremaster = {
				set_relation_ward = scope:source_child
			}
		}
		add_character_flag = amage_rep1_lore_rep1_flag
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = ev10.87.b
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep1_flag
			}
			any_relation = {
				type = ward
				count < 2
			}
		}
		set_relation_ward = scope:source_child
		add_character_flag = amage_rep2_lore_rep1_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = diligent
			}
			modifier = {
				add = -1
				has_trait = lazy
			}
			modifier = {
				add = -1
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.87.c
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep1_flag
			}
			scope:bmage = {
				any_relation = {
					type = ward
					count < 2
				}
			}
		}
		show_as_tooltip = {
			scope:bmage = {
				set_relation_ward = scope:source_child
			}
		}
		add_character_flag = amage_rep3_lore_rep1_flag
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.87.d
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep1_flag
			}
			scope:admin = {
				any_relation = {
					type = ward
					count < 2
				}
			}
		}
		show_as_tooltip = {
			scope:admin = {
				set_relation_ward = scope:source_child
			}
		}
		add_character_flag = amage_rep4_lore_rep1_flag
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.87.f
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep1_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep5_lore_rep1_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				OR = {
					has_trait = paranoid
					has_trait = callous
					has_trait = sadistic
				}
			}
			modifier = {
				add = -1
				OR = {
					has_trait = compassionate
					has_trait = just
				}
			}
		}
	}
	option = {
		name = ev10.87.e	#You will receive funding.
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				OR = {
					has_character_flag = lore_rep2_flag
					has_character_flag = lore_rep3_flag
				}
			}
		}
		if = {
			limit = {
				scope:loremaster = {
					has_character_flag = lore_rep2_flag
				}
			}
			show_as_tooltip = {
				take_from_mc_funds_effect = {
					RECEIVER = scope:loremaster
					VALUE = mc_minor_gold_value
				}
			}
			add_character_flag = amage_rep1_lore_rep2_flag
		}
		else = {
			decrease_mc_funds_effect = {
				VALUE = 1000
			}
			add_character_modifier = {
				modifier = mc_development_modifier
				years = 2
			}
			show_as_tooltip = {
				scope:loremaster = {
					add_character_modifier = {
						modifier = mc_development_modifier
						years = 2
					}
				}
				scope:bmage = {
					add_character_modifier = {
						modifier = mc_development_modifier
						years = 2
					}
				}
				scope:admin = {
					add_character_modifier = {
						modifier = mc_development_modifier
						years = 2
					}
				}
			}
			add_character_flag = amage_rep1_lore_rep3_flag
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 1
				has_trait = generous
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
		}
	}
	option = {
		name = fp3_yearly.8014.a	#What a good idea!
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep4_flag
			}
		}
		decrease_mc_funds_effect = {
			VALUE = 1200
		}
		custom_tooltip = ev10.86.e_ct
		add_character_flag = amage_rep1_lore_rep4_flag
		hidden_effect = {
			if = {
				limit = {
					is_ruler = yes
				}
				spawn_army = {
					name = golems_army
					men_at_arms = {
						type = golems_army
						stacks = 3
					}
					inheritable = no
					uses_supply = no
					location = root.location
				}
			}
		}
		ai_chance = {
			base = 4
		}
	}
	option = {
		name = ev10.87.g	#We have more important expenses.
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				OR = {
					has_character_flag = lore_rep2_flag
					has_character_flag = lore_rep3_flag
					has_character_flag = lore_rep4_flag
				}
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		if = {
			limit = {
				scope:loremaster = {
					has_character_flag = lore_rep2_flag
				}
			}
			add_character_flag = amage_rep2_lore_rep2_flag
		}
		else_if = {
			limit = {
				scope:loremaster = {
					has_character_flag = lore_rep3_flag
				}
			}
			add_character_flag = amage_rep2_lore_rep3_flag
		}
		else = {
			add_character_flag = amage_rep2_lore_rep4_flag
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = greedy
			}
			modifier = {
				add = 20
				OR = {
					has_relation_rival = scope:loremaster
					has_relation_nemesis = scope:loremaster
				}
			}
		}
	}
	
	option = {
		name = ev10.87.i	#You are obvious for this role.
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep5_flag
			}
		}
		add_character_flag = amage_rep1_lore_rep5_flag
		scope:loremaster = {
			add_character_modifier = {
				modifier = rector_magic_academy_modifier
			}
			add_prestige = major_prestige_gain
			trigger_event = {
				id = magic_ev10.159
				days = 14
			}
		}
		ai_chance = {
			base = 3
			modifier = {
				add = -2
				has_trait = ambitious
			}
			modifier = {
				add = -20
				OR = {
					has_relation_rival = scope:loremaster
					has_relation_nemesis = scope:loremaster
				}
			}
		}
	}
	option = {
		name = ev10.87.j	#I will take on this duty.
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep5_flag
			}
		}
		add_character_flag = amage_rep2_lore_rep5_flag
		add_character_modifier = {
			modifier = rector_magic_academy_modifier
		}
		add_prestige = major_prestige_gain
		trigger_event = {
			id = magic_ev10.159
			days = 14
		}
		stress_impact = {
			ambitious = medium_stress_loss
		}
		scope:loremaster = {
			if = {
				limit = {
					NOR = {
						has_relation_rival = ROOT
						has_relation_nemesis = ROOT
					}
				}
				set_relation_rival = ROOT
			}
			else = {
				add_opinion = {
					target = ROOT
					modifier = disappointed_opinion
					opinion = -30
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 3
				has_trait = ambitious
			}
			modifier = {
				add = -3
				has_trait = content
			}
		}
	}
	option = {
		name = ev10.87.k	#Black mage will make a good rector.
		trigger = {
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep5_flag
			}
		}
		add_character_flag = amage_rep3_lore_rep5_flag
		scope:bmage = {
			add_character_modifier = {
				modifier = rector_magic_academy_modifier
			}
			add_prestige = major_prestige_gain
			trigger_event = {
				id = magic_ev10.159
				days = 14
			}
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 10
			}
		}
		scope:loremaster = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -30
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -2
				has_trait = ambitious
			}
			modifier = {
				add = -20
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
				}
			}
		}
	}
	option = {
		name = ev10.87.l	#I know someone who is suitable.
		trigger = {
			exists = scope:prector
			ROOT = scope:amage
			scope:loremaster = {
				has_character_flag = lore_rep5_flag
			}
		}
		add_character_flag = amage_rep4_lore_rep5_flag
		scope:prector = {
			send_interface_toast = {
				title = ev10.87.desc3x
				left_icon = ROOT
				right_icon = scope:prector
				add_character_modifier = {
					modifier = rector_magic_academy_modifier
				}
				add_prestige = major_prestige_gain
			}
			trigger_event = {
				id = magic_ev10.159
				days = 14
			}
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 10
			}
		}
		scope:loremaster = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -30
			}
		}
		ai_chance = {
			base = 2
		}
	}
	option = {
		name = char_interaction.0220.a	#Good.
		trigger = {
			ROOT = scope:loremaster
			scope:amage = {
				OR = {
					has_character_flag = amage_rep1_lore_rep1_flag
					has_character_flag = amage_rep2_lore_rep1_flag
					has_character_flag = amage_rep3_lore_rep1_flag
					has_character_flag = amage_rep4_lore_rep1_flag
					has_character_flag = amage_rep1_lore_rep2_flag
					has_character_flag = amage_rep1_lore_rep3_flag
					has_character_flag = amage_rep1_lore_rep4_flag
					has_character_flag = amage_rep1_lore_rep5_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = tour_grounds_events.3017.a	#A pity.
		trigger = {
			ROOT = scope:loremaster
			scope:amage = {
				OR = {
					has_character_flag = amage_rep5_lore_rep1_flag
					has_character_flag = amage_rep2_lore_rep2_flag
					has_character_flag = amage_rep2_lore_rep3_flag
					has_character_flag = amage_rep2_lore_rep4_flag
					has_character_flag = amage_rep2_lore_rep5_flag
					has_character_flag = amage_rep3_lore_rep5_flag
					has_character_flag = amage_rep4_lore_rep5_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.87.h	#This is the right decision.
		trigger = {
			NOR = { ROOT = scope:amage ROOT = scope:loremaster }
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.83.c	#Hm...
		trigger = {
			NOR = { ROOT = scope:amage ROOT = scope:loremaster }
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.87
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:bmage = {
					trigger_event = magic_ev10.87
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:admin = {
					trigger_event = magic_ev10.87
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:bmage = {
					trigger_event = magic_ev10.88
				}
			}
		}
	}
}

#secret meeting! - black mage proposal
magic_ev10.88 = {
	title = ev10.86.title
	desc = ev10.88.desc
	#desc = {
	#	desc = ev10.88.desc0
	#	#desc = line_break
	#	desc = ev10.86.desc0
	#}
	theme = diplomacy
	left_portrait = {
		character = ROOT
	}
	#artifact = {
	#	trigger = {
	#		exists = scope:magic_art
	#		NOT = { exists = scope:portrait1 }
	#	}
    #   target = scope:magic_art
    #    position = lower_right_portrait
    #}
	lower_left_portrait = { trigger = { exists = scope:portrait1 } character = scope:portrait1 }
	lower_center_portrait = { trigger = { exists = scope:portrait2 } character = scope:portrait2 }
	lower_right_portrait = { trigger = { exists = scope:portrait3 } character = scope:portrait3 }
	immediate = {
		hidden_effect = {
			random_artifact = {
				limit = {
					has_variable = magic1
					NOR = {
						artifact_owner = { 
							has_variable = mc_member_var
						}
						ROOT = {
							has_personal_artifact_claim = PREV
						}
					}
				}
				save_scope_as = magic_art
			}
			random_ruler = {
				limit = {
					NOT = {
						has_variable = mc_member_var
					}
					OR = {
						highest_held_title_tier = tier_empire
						highest_held_title_tier = tier_kingdom
					}
					is_at_war = yes
					NOR = {
						is_at_war_with = scope:amage
						is_at_war_with = scope:bmage
						is_at_war_with = scope:loremaster
						is_at_war_with = scope:admin
					}
				}
				save_scope_as = war_ruler
				ordered_character_war = {
					limit = {
						OR = {
							primary_attacker = scope:war_ruler
							primary_defender = scope:war_ruler
						}
					}
					order_by = war_total_participants_current_strength_value
					position = 0
					save_scope_as = war0
					if = {
						limit = {
							primary_attacker = scope:war_ruler
						}
						primary_defender = {
							save_scope_as = war_ruler2
						}
					}
					else = {
						primary_attacker = {
							save_scope_as = war_ruler2
						}
					}
				}
				
				random_relation = {
					type = nemesis
					limit = {
						has_trait = archmage
						is_alive = yes
						is_imprisoned = no
						is_antimagic_trigger = no
						NOT = {
							has_variable = mc_member_var
						}
					}
					save_scope_as = troublemaker
				}
				if = {
					limit = {
						NOT = {
							exists = scope:troublemaker
						}
					}
					random_relation = {
						type = rival
						limit = {
							has_trait = archmage
							is_alive = yes
							is_imprisoned = no
							is_antimagic_trigger = no
							NOT = {
								has_variable = mc_member_var
							}
						}
						save_scope_as = troublemaker
					}
				}
				if = {
					limit = {
						NOT = {
							exists = scope:troublemaker
						}
					}
					random_living_character = {
						limit = {
							has_trait = archmage
							is_alive = yes
							is_imprisoned = no
							is_antimagic_trigger = no
							NOR = {
								has_variable = mc_member_var
								has_character_flag = abdul_dude
							}
							OR = {
								has_trait = lunatic_1
								has_trait = lunatic_genetic
								has_trait = paranoid
							}
						}
						save_scope_as = troublemaker
					}
				}
			}
			#if = {
			#	limit = {
			#		exists = scope:portrait1
			#	}
			#	clear_saved_scope = portrait1
			#}
			#if = {
			#	limit = {
			#		exists = scope:portrait2
			#	}
			#	clear_saved_scope = portrait2
			#}
			#if = {
			#	limit = {
			#		exists = scope:portrait3
			#	}
			#	clear_saved_scope = portrait3
			#}
			if = {
				limit = {
					exists = scope:war_ruler
				}
				scope:war_ruler = {
					save_scope_as = portrait2
				}
			}
			if = {
				limit = {
					exists = scope:troublemaker
				}
				scope:troublemaker = {
					save_scope_as = portrait3
				}
			}
			if = {
				limit = {
					NOR = {
						exists = scope:portrait2
						exists = scope:portrait3
					}
				}
				scope:amage = {
					save_scope_as = portrait1
				}
				scope:loremaster = {
					save_scope_as = portrait2
				}
				scope:admin = {
					save_scope_as = portrait3
				}
			}
		}
	}
	option = {
		name = ev10.88.a	#The artifact should be held by the council.
		trigger = {
			exists = scope:magic_art
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					add_personal_artifact_claim = scope:magic_art
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = bmage_rep5_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.89
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = ambitious
			}
			modifier = {
				add = 2
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.88.b	#The Council should support war_ruler.
		trigger = {
			mc_gold_global_avaiable_trigger = yes
			exists = scope:war_ruler
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					scope:war_ruler = {
						add_character_modifier = {
							modifier = sca_secret_suppor_modifier
							years = 2
						}
						take_from_mc_funds_effect = {
							RECEIVER = scope:war_ruler
							VALUE = mc_minor_gold_value
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = bmage_rep6_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.89
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = deceitful
			}
			modifier = {
				add = 2
				OR = {
					has_trait = lunatic_1
					has_trait = lunatic_genetic
					has_trait = fickle
				}
			}
			modifier = {
				add = 2
				opinion = {
					target = scope:war_ruler
					value > 10
				}
			}
			modifier = {
				add = -20
				OR = {
					has_relation_rival = scope:war_ruler
					has_relation_nemesis = scope:war_ruler
				}
			}
		}
	}
	option = {
		name = ev10.88.c	#I need some gold for potions.
		trigger = {
			exists = global_var:mc_gold_global
			global_var:mc_gold_global >= 200
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 200
					}
					custom_tooltip = gain_pot2_ct
					custom_tooltip = gain_pot2_ct
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = bmage_rep7_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.89
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 3
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.88.d	#X is causing problems, something needs to be done about it.
		trigger = {
			exists = scope:troublemaker
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					custom_tooltip = ev10.88.d_ct
					custom_tooltip = ev10.88.d_ct2
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = bmage_rep8_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.89
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = -2
				opinion = {
					target = scope:troublemaker
					value > 20
				}
			}
			modifier = {
				add = 4
				OR = {
					has_relation_rival = scope:troublemaker
					has_relation_nemesis = scope:troublemaker
				}
			}
			modifier = {
				add = -10
				overall_magic_power_value < scope:troublemaker.overall_magic_power_value
			}
		}
	}
	option = {
		name = ev10.86.d	#I have no proposals.
		hidden_effect = {
			scope:admin = {
				trigger_event = magic_ev10.90
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1
				has_trait = diligent
			}
			modifier = {
				add = 2
				has_trait = lazy
			}
			modifier = {
				add = 1
				has_trait = content
			}
		}
	}
	option = {
		name = childhood.1006.c
		trigger = {
			has_trait = incapable
		}
		exclusive = yes
		hidden_effect = {
			scope:admin = {
				trigger_event = magic_ev10.90
			}
		}
		ai_chance = {
			base = 1
		}
	}
}
#secret meeting! - black mage proposal - archmage decides
magic_ev10.89 = {
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					ROOT = scope:bmage
				}
				desc = ev10.87.title
			}
			desc = mc_black_mage_modifier
		}
	}
	desc = {
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:bmage }
			}
			desc = ev10.89.desc0
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage = {
						has_character_flag = bmage_rep5_flag
					}
				}
				desc = ev10.89.desc1
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage = {
						has_character_flag = bmage_rep6_flag
					}
				}
				desc = ev10.89.desc2
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage = {
						has_character_flag = bmage_rep7_flag
					}
				}
				desc = ev10.89.desc3
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:bmage }
					scope:bmage = {
						has_character_flag = bmage_rep8_flag
					}
				}
				desc = ev10.89.desc4
			}
			desc = empty1_desc
		}
		triggered_desc = {
			trigger = {
				NOR = { ROOT = scope:bmage ROOT = scope:amage }
			}
			desc = line_break
		}
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:amage }
			}
			desc = ev10.87.desc3
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:s1
	}
	#lower_left_portrait = scope:s2
	#lower_center_portrait = scope:s3
	#lower_right_portrait = scope:s4
	#artifact = {
	#	trigger = {
	#		scope:bmage = {
	#			has_character_flag = bmage_rep5_flag
	#		}
	#	}
    #   target = scope:magic_art
    #    position = lower_center_portrait
    #}

	lower_left_portrait = { trigger = { exists = scope:pb1 } character = scope:pb1 }
	lower_center_portrait = { trigger = { exists = scope:pb2 } character = scope:pb2 }
	lower_right_portrait = { trigger = { exists = scope:pb3 } character = scope:pb3 }
	immediate = {
		sm_set_special_portraits_effect = { SPECIAL = 2 }
		hidden_effect = {
			if = {
				limit = {
					scope:bmage = {
						OR = {
							has_character_flag = bmage_rep5_flag
							has_character_flag = bmage_rep7_flag
						}
					}
				}
				if = {
					limit = {
						exists = scope:pb1
					}
					clear_saved_scope = pb1
				}
				scope:s2 = {
					save_scope_as = pb1
				}
				if = {
					limit = {
						exists = scope:pb2
					}
					clear_saved_scope = pb2
				}
				scope:s3 = {
					save_scope_as = pb2
				}
				if = {
					limit = {
						exists = scope:pb3
					}
					clear_saved_scope = pb3
				}
				scope:s4 = {
					save_scope_as = pb3
				}
			}
			else_if = {
				limit = {
					NOT = { ROOT = scope:amage }
					scope:bmage = {
						has_character_flag = bmage_rep6_flag
					}
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep6_flag
					}
				}
				if = {
					limit = {
						exists = scope:pb3
					}
					clear_saved_scope = pb3
				}
			}
			else_if = {
				limit = {
					NOT = { ROOT = scope:amage }
					scope:bmage = {
						has_character_flag = bmage_rep6_flag
					}
					scope:amage = {
						has_character_flag = amage_rep2_bmage_rep6_flag
					}
				}
				if = {
					limit = {
						exists = scope:pb2
					}
					clear_saved_scope = pb2
				}
			}
			if = {
				limit = {
					ROOT = scope:amage
					scope:bmage = { NOT = { has_character_flag = bmage_rep7_flag } }
				}
				if = {
					limit = {
						scope:bmage = {
							has_character_flag = bmage_rep6_flag
						}
					}
					scope:war_ruler = {
						save_scope_as = pb2
					}
					if = {
						limit = {
							exists = scope:war_ruler2
						}
						save_scope_as = pb3
					}
				}
				else_if = {
					limit = {
						scope:bmage = {
							has_character_flag = bmage_rep8_flag
						}
					}
					scope:troublemaker = {
						save_scope_as = pb2
					}
				}
			}
		}
		
		if = {
			limit = {
				NOT = { ROOT = scope:amage }
			}
			hidden_effect = {
				sm_set_portraits_effect = yes
			}
			if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep5_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:bmage
					}
					add_personal_artifact_claim = scope:magic_art
				}
				else = {
					show_as_tooltip = {
						scope:bmage = {
							add_personal_artifact_claim = scope:magic_art
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep6_flag
					}
				}
				show_as_tooltip = {
					scope:war_ruler = {
						add_character_modifier = {
							modifier = sca_secret_suppor_modifier
							years = 2
						}
						take_from_mc_funds_effect = {
							RECEIVER = scope:war_ruler
							VALUE = scope:amage.var:fixed_gold_value
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep2_bmage_rep6_flag
					}
				}
				show_as_tooltip = {
					scope:war_ruler2 = {
						add_character_modifier = {
							modifier = sca_secret_suppor_modifier
							years = 2
						}
						take_from_mc_funds_effect = {
							RECEIVER = scope:war_ruler2
							VALUE = scope:amage.var:fixed_gold_value
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep7_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 200
					}
				}
				if = {
					limit = {
						ROOT = scope:bmage
					}
					hidden_effect = {
						create_artifact = {	
							name = pot2
							description = pot2_desc
							template=general_unique_template
							type = miscellaneous
							visuals = flask
							modifier = elixir_modifier
							rarity=illustrious
							decaying = no
							save_scope_as = newly_created_artifact
						}
						scope:newly_created_artifact = {
							set_variable=pot2
						}
						create_artifact = {	
							name = pot2
							description = pot2_desc
							template=general_unique_template
							type = miscellaneous
							visuals = flask
							modifier = elixir_modifier
							rarity=illustrious
							decaying = no
							save_scope_as = newly_created_artifact3
						}
						scope:newly_created_artifact3 = {
							set_variable=pot2
						}
					}
					custom_tooltip = gain_pot2_ct
					custom_tooltip = gain_pot2_ct
				}
				else = {
					show_as_tooltip = {
						scope:bmage = {
							custom_tooltip = gain_pot2_ct
							custom_tooltip = gain_pot2_ct
							custom_description_no_bullet = {
								text = empty_description1
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep7_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 300
					}
				}
				if = {
					limit = {
						ROOT = scope:bmage
					}
					hidden_effect = {
						create_artifact = {	
							name = pot2
							description = pot2_desc
							template=general_unique_template
							type = miscellaneous
							visuals = flask
							modifier = elixir_modifier
							rarity=illustrious
							decaying = no
							save_scope_as = newly_created_artifact
						}
						scope:newly_created_artifact = {
							set_variable=pot2
						}
						create_artifact = {	
							name = pot2
							description = pot2_desc
							template=general_unique_template
							type = miscellaneous
							visuals = flask
							modifier = elixir_modifier
							rarity=illustrious
							decaying = no
							save_scope_as = newly_created_artifact3
						}
						scope:newly_created_artifact3 = {
							set_variable=pot2
						}
					}
					custom_tooltip = gain_pot2_ct
					custom_tooltip = gain_pot2_ct
				}
				else = {
					show_as_tooltip = {
						scope:bmage = {
							custom_tooltip = gain_pot2_ct
							custom_tooltip = gain_pot2_ct
							custom_description_no_bullet = {
								text = empty_description1
							}
						}
					}
				}
				show_as_tooltip = {
					scope:amage = {
						custom_tooltip = gain_pot2_ct
						custom_description_no_bullet = {
							text = empty_description1
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_bmage_rep8_flag
					}
				}
				show_as_tooltip = {
					scope:bmage = {
						custom_tooltip = ev10.88.d_ct
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						OR = {
							has_character_flag = amage_rep2_bmage_rep5_flag
							has_character_flag = amage_rep3_bmage_rep6_flag
							has_character_flag = amage_rep3_bmage_rep7_flag
							has_character_flag = amage_rep2_bmage_rep8_flag
						}
					}
				}
				custom_tooltip = sm_archmage_rejection_ct
			}
		}
	}
	option = {
		name = ev10.89.a	#The Council supports your claims.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep5_flag
			}
		}
		show_as_tooltip = {
			scope:bmage = {
				add_personal_artifact_claim = scope:magic_art
			}
		}
		add_character_flag = amage_rep1_bmage_rep5_flag
		ai_chance = {
			base = 1
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
					any_claimed_artifact = {
						THIS = scope:magic_art
					}
					any_character_artifact = {
						THIS = scope:magic_art
					}
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = content
					has_trait = trusting
				}
			}
			modifier = {
				add = -1
				has_trait = ambitious
			}
			modifier = {
				add = 2
				opinion = {
					target = scope:bmage
					value > 50
				}
			}
		}
	}
	option = {
		name = ev10.89.b	#Well... no.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep5_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_bmage_rep5_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
					any_claimed_artifact = {
						THIS = scope:magic_art
					}
					any_character_artifact = {
						THIS = scope:magic_art
					}
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = paranoid
					has_trait = ambitious
					has_trait = arrogant
				}
			}
		}
	}
	option = {
		name = ev10.89.c	#I agree with this proposal.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep6_flag
			}
		}
		set_variable = {
			name = fixed_gold_value
			value = mc_minor_gold_value
		}
		scope:war_ruler = {
			add_character_modifier = {
				modifier = sca_secret_suppor_modifier
				years = 2
			}
			
			take_from_mc_funds_effect = {
				RECEIVER = scope:war_ruler
				VALUE = mc_minor_gold_value
			}
		}
		add_character_flag = amage_rep1_bmage_rep6_flag
		ai_chance = {
			base = 1
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:war_ruler
					has_relation_nemesis = scope:war_ruler
					is_at_war_with = scope:war_ruler
				}
			}
			modifier = {
				add = 1
				has_trait = trusting
			}
			modifier = {
				add = 1
				OR = {
					has_trait = sadistic
					has_trait = deceitful
				}
			}
			modifier = {
				add = 2
				opinion = {
					target = scope:bmage
					value > 50
				}
			}
			modifier = {
				add = -1
				opinion = {
					target = scope:war_ruler
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.89.d	#I prefer to support his enemies.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep6_flag
			}
			exists = scope:war_ruler2
		}
		set_variable = {
			name = fixed_gold_value
			value = mc_minor_gold_value
		}
		scope:war_ruler2 = {
			add_character_modifier = {
				modifier = sca_secret_suppor_modifier
				years = 2
			}
			take_from_mc_funds_effect = {
				RECEIVER = scope:war_ruler2
				VALUE = mc_minor_gold_value
			}
		}
		add_character_flag = amage_rep2_bmage_rep6_flag
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev10.89.e	#I don't see any benefit to the Council here.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep6_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep3_bmage_rep6_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				OR = {
					has_relation_rival = scope:war_ruler
					has_relation_nemesis = scope:war_ruler
					is_at_war_with = scope:war_ruler
				}
			}
			modifier = {
				add = -10
				exists = scope:war_ruler2
				OR = {
					has_relation_rival = scope:war_ruler2
					has_relation_nemesis = scope:war_ruler2
					is_at_war_with = scope:war_ruler2
				}
			}
			modifier = {
				add = 1
				has_trait = trusting
			}
			modifier = {
				add = 1
				OR = {
					has_trait = content
					has_trait = compassionate
				}
			}
			modifier = {
				add = -1
				opinion = {
					target = scope:bmage
					value > 50
				}
			}
			modifier = {
				add = 1
				opinion = {
					target = scope:war_ruler
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.87.e	#You will receive funding.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep7_flag
			}
		}
		decrease_mc_funds_effect = {
			VALUE = 200
		}
		show_as_tooltip = {
			scope:bmage = {
				custom_tooltip = gain_pot2_ct
				custom_tooltip = gain_pot2_ct
				custom_description_no_bullet = {
					text = empty_description1
				}
			}
		}
		add_character_flag = amage_rep1_bmage_rep7_flag
		ai_chance = {
			base = 2
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
				}
			}
			modifier = {
				add = 1
				opinion = {
					target = scope:bmage
					value > 50
				}
			}
			modifier = {
				add = 1
				has_trait = generous
			}
		}
	}
	option = {
		name = ev10.89.f	#Buy one for me too.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep7_flag
			}
			global_var:mc_gold_global >= 300
		}
		decrease_mc_funds_effect = {
			VALUE = 300
		}
		hidden_effect = {
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact
			}
			scope:newly_created_artifact={
				set_variable=pot2
			}
		}
		custom_tooltip = gain_pot2_ct
		show_as_tooltip = {
			scope:bmage = {
				custom_tooltip = gain_pot2_ct
				custom_tooltip = gain_pot2_ct
				custom_description_no_bullet = {
					text = empty_description1
				}
			}
		}
		add_character_flag = amage_rep2_bmage_rep7_flag
		ai_chance = {
			base = 2
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
				}
			}
			modifier = {
				add = 1
				opinion = {
					target = scope:bmage
					value > 50
				}
			}
			modifier = {
				add = 1
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = craven
			}
			modifier = {
				add = -3
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.87.g	#We have more important expenses.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep7_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep3_bmage_rep7_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
				}
			}
			modifier = {
				add = 2
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.89.h	#Fine, deal with him.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep8_flag
			}
		}
		hidden_effect = {
			add_character_flag = amage_rep1_bmage_rep8_flag
			scope:bmage = {
				set_variable = {
					name = tbmaker
					value = scope:troublemaker
				}
			}
		}
		
		custom_tooltip = ev10.88.d_ct
		custom_tooltip = ev10.88.d_ct2
		ai_chance = {
			base = 2
			modifier = {
				add = 10
				OR = {
					has_relation_rival = scope:troublemaker
					has_relation_nemesis = scope:troublemaker
				}
			}
			modifier = {
				add = -10
				opinion = {
					target = scope:troublemaker
					value > 50
				}
			}
			modifier = {
				add = 1
				has_trait = callous
			}
			modifier = {
				add = 1
				has_trait = sadistic
			}
		}
	}
	option = {
		name = ev10.89.i	#I don't see this as a problem.
		trigger = {
			ROOT = scope:amage
			scope:bmage = {
				has_character_flag = bmage_rep8_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_bmage_rep8_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 10
				OR = {
					has_relation_rival = scope:bmage
					has_relation_nemesis = scope:bmage
				}
			}
			modifier = {
				add = 2
				has_trait = compassionate
			}
			modifier = {
				add = 1
				has_trait = content
			}
		}
	}
	option = {
		name = EXCELLENT
		trigger = {
			ROOT = scope:bmage
			scope:amage = {
				OR = {
					has_character_flag = amage_rep1_bmage_rep5_flag
					has_character_flag = amage_rep1_bmage_rep6_flag
					has_character_flag = amage_rep1_bmage_rep7_flag
					has_character_flag = amage_rep2_bmage_rep7_flag
					has_character_flag = amage_rep1_bmage_rep8_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.89.g	#Well, I'll do the shopping with my own money.
		trigger = {
			ROOT = scope:bmage
			scope:amage = {
				has_character_flag = amage_rep3_bmage_rep7_flag
			}
			trigger_if = {
				limit = {
					is_ai = yes
				}
				gold >= 200
			}
		}
		stress_impact = {
			greedy = medium_stress_gain
		}
		remove_short_term_gold = 200
		custom_tooltip = gain_pot2_ct
		custom_tooltip = gain_pot2_ct
		hidden_effect = {
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact4
			}
			scope:newly_created_artifact4 = {
				set_variable=pot2
			}
			create_artifact = {	
				name = pot2
				description = pot2_desc
				template=general_unique_template
				type = miscellaneous
				visuals = flask
				modifier = elixir_modifier
				rarity=illustrious
				decaying = no
				save_scope_as = newly_created_artifact5
			}
			scope:newly_created_artifact5 = {
				set_variable=pot2
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = -1
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.83.c	#Hm...
		trigger = {
			ROOT = scope:bmage
			scope:amage = {
				OR = {
					has_character_flag = amage_rep2_bmage_rep5_flag
					has_character_flag = amage_rep2_bmage_rep6_flag
					has_character_flag = amage_rep3_bmage_rep6_flag
					has_character_flag = amage_rep3_bmage_rep7_flag
					has_character_flag = amage_rep2_bmage_rep8_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev3.17.a	#Interesting
		trigger = {
			NOR = { ROOT = scope:amage ROOT = scope:bmage }
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:bmage = {
					trigger_event = magic_ev10.89
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.89
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:admin = {
					trigger_event = magic_ev10.89
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:admin = {
					trigger_event = magic_ev10.90
				}
			}
		}
	}
}
#secret meeting! - admin proposal
magic_ev10.90 = {
	title = ev10.86.title
	desc = ev10.88.desc
	theme = diplomacy
	left_portrait = {
		character = ROOT
	}
	lower_left_portrait = scope:amage
	lower_center_portrait = scope:loremaster
	lower_right_portrait = scope:bmage
	#lower_left_portrait = { trigger = { exists = scope:portrait1 } character = scope:portrait1 }
	#lower_center_portrait = { trigger = { exists = scope:portrait2 } character = scope:portrait2 }
	#lower_right_portrait = { trigger = { exists = scope:portrait3 } character = scope:portrait3 }
	immediate = {
		hidden_effect = {
			#if = {
			#	limit = {
			#		exists = scope:portrait1
			#	}
			#	clear_saved_scope = portrait1
			#}
			#if = {
			#	limit = {
			#		exists = scope:portrait2
			#	}
			#	clear_saved_scope = portrait2
			#}
			#if = {
			#	limit = {
			#		exists = scope:portrait3
			#	}
			#	clear_saved_scope = portrait3
			#}
			random_empire = {
				limit = {
					is_landless_type_title = no
					#any_direct_de_jure_vassal_title = { is_landless_type_title = no }
					exists = holder
					holder = {
						government_has_flag = government_is_administrative
					}
				}
				holder = {
					save_scope_as = eholder
				}
				save_scope_as = target
			}
			scope:eholder = {
				random_vassal = {
					limit = {
						government_has_flag = government_is_administrative
						is_adult = yes
						is_powerful_being = no
						is_powerful_vassal = yes
						NOT = {
							scope:target.current_heir = THIS
						}
					}
					save_scope_as = pvassal
				}
			}
			random_list = {
				1 = {
					trigger = {
						any_relation = {
							type = rival
							NOT = { has_variable = mc_member_var }
							is_ruler = yes
						}
					}
					random_relation = {
						type = rival
						limit = {
							NOT = { has_variable = mc_member_var }
							is_ruler = yes
						}
						save_scope_as = admin_rival
					}
				}
				1 = {
					trigger = {
						any_relation = {
							type = nemesis
							NOT = { has_variable = mc_member_var }
							is_ruler = yes
						}
					}
					random_relation = {
						type = nemesis
						limit = {
							NOT = { has_variable = mc_member_var }
							is_ruler = yes
						}
						save_scope_as = admin_rival
					}
				}
				1 = {
					trigger = {
						any_ruler = {
							has_trait = witch_hunter
							is_imprisoned = no
							NOT = { has_variable = mc_member_var }
						}
					}
					random_ruler = {
						limit = {
							has_trait = witch_hunter
							is_imprisoned = no
							NOT = { has_variable = mc_member_var }
						}
						save_scope_as = admin_rival
					}
				}
				1 = {
					random_ruler = {
						limit = {
							NOT = { has_variable = mc_member_var }
							NOT = { has_character_modifier = mc_supporter_modifier }
							is_independent_ruler = yes
							is_imprisoned = no
						}
						save_scope_as = admin_rival
					}
				}
			}
		}
	}
	option = {
		name = ev10.90.a	#We should shore up our budget.
		trigger = {
			mc_gold_global_avaiable_trigger = no
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					transfer_to_mc_funds_effect = {
						PAYER = ROOT
						VALUE = my_gold_20p_value
					}
					transfer_to_mc_funds_effect = {
						PAYER = scope:amage
						VALUE = scope:amage.my_gold_20p_value
					}
					transfer_to_mc_funds_effect = {
						PAYER = scope:bmage
						VALUE = scope:bmage.my_gold_20p_value
					}
					transfer_to_mc_funds_effect = {
						PAYER = scope:loremaster
						VALUE = scope:loremaster.my_gold_20p_value
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep1_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev10.90.b	#The Council should reveal its existence to the rest of the world.
		trigger = {
			NOT = {
				exists = global_var:mc_revealed
			}
			has_character_flag = already_participated_in_sm_flag
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					custom_tooltip = ev10.90.b_ct
					custom_tooltip = ev10.90.b_ct2
					custom_tooltip = ev10.90.b_ct3
					scope:admin = {
						add_dread = major_dread_gain
					}
					scope:amage = {
						add_dread = major_dread_gain
					}
					scope:bmage = {
						add_dread = major_dread_gain
					}
					scope:loremaster = {
						add_dread = major_dread_gain
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep2_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 3
				OR = {
					has_trait = brave
					has_trait = eccentric
					has_trait = diplomat
					has_trait = just
					has_trait = honest
				}
			}
			modifier = {
				add = 1
				has_trait = impatient
			}
			modifier = {
				add = -3
				OR = {
					has_trait = sadistic
					has_trait = deceitful
					has_trait = arbitrary
					has_trait = schemer
					has_trait = patient
					has_trait = craven
				}
			}
		}
	}
	option = {
		name = ev10.90.c	#We need to consolidate our influence in some realm.
		trigger = {
			exists = scope:eholder
			mc_gold_global_avaiable_trigger = yes
			global_var:mc_gold_global >= 600
			OR = {
				scope:eholder = scope:amage
				scope:eholder = scope:bmage
				scope:eholder = scope:loremaster
				scope:eholder = scope:admin
				scope:target.current_heir = scope:amage
				scope:target.current_heir = scope:bmage
				scope:target.current_heir = scope:loremaster
				scope:target.current_heir = scope:admin
			}
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 600
					}
					if = {
						limit = {
							scope:amage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:amage = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:bmage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:bmage = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:loremaster = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:loremaster = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:admin = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:admin = {
							change_influence = massive_influence_gain
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep3_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 2
				OR = {
					has_trait = deceitful
					has_trait = ambitious
				}
			}
			modifier = {
				add = -2
				has_trait = lazy
			}
		}
	}
	option = {
		name = ev10.90.c	#We need to consolidate our influence in some realm.
		trigger = {
			exists = scope:eholder
			mc_gold_global_avaiable_trigger = yes
			global_var:mc_gold_global >= 600
			NOR = {
				scope:eholder = scope:amage
				scope:eholder = scope:bmage
				scope:eholder = scope:loremaster
				scope:eholder = scope:admin
				scope:target.current_heir = scope:amage
				scope:target.current_heir = scope:bmage
				scope:target.current_heir = scope:loremaster
				scope:target.current_heir = scope:admin
			}
			OR = {
				scope:amage = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:bmage = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:loremaster = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:admin = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
			}
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 600
					}
					if = {
						limit = {
							scope:admin = {
								is_ruler = yes
								exists = top_liege
								top_liege = scope:eholder
								government_has_flag = government_is_administrative
							}
						}
						scope:admin = {
							save_scope_as = actor
							save_scope_as = secondary_recipient
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:admin
								value = appointment_score_max_tt_value
							}
						}
					}
					else_if = {
						limit = {
							scope:amage = {
								is_ruler = yes
								exists = top_liege
								top_liege = scope:eholder
								government_has_flag = government_is_administrative
							}
						}
						scope:amage = {
							save_scope_as = actor
							save_scope_as = secondary_recipient
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:amage
								value = appointment_score_max_tt_value
							}
						}
					}
					else_if = {
						limit = {
							scope:bmage = {
								is_ruler = yes
								exists = top_liege
								top_liege = scope:eholder
								government_has_flag = government_is_administrative
							}
						}
						scope:bmage = {
							save_scope_as = actor
							save_scope_as = secondary_recipient
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:bmage
								value = appointment_score_max_tt_value
							}
						}
					}
					else_if = {
						limit = {
							scope:loremaster = {
								is_ruler = yes
								exists = top_liege
								top_liege = scope:eholder
								government_has_flag = government_is_administrative
							}
						}
						scope:loremaster = {
							save_scope_as = actor
							save_scope_as = secondary_recipient
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:loremaster
								value = appointment_score_max_tt_value
							}
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep4_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 2
			modifier = {
				add = 2
				OR = {
					has_trait = deceitful
					has_trait = ambitious
				}
			}
			modifier = {
				add = -2
				has_trait = lazy
			}
		}
	}
	option = {
		name = ev10.90.d	#Let's support our puppet.
		trigger = {
			exists = scope:eholder
			exists = scope:pvassal
			mc_gold_global_avaiable_trigger = yes
			global_var:mc_gold_global >= 600
			NOR = {
				scope:eholder = scope:amage
				scope:eholder = scope:bmage
				scope:eholder = scope:loremaster
				scope:eholder = scope:admin
				scope:target.current_heir = scope:amage
				scope:target.current_heir = scope:bmage
				scope:target.current_heir = scope:loremaster
				scope:target.current_heir = scope:admin
			}
			NOR = {
				scope:amage = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:bmage = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:loremaster = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
				scope:admin = {
					AND = {
						is_ruler = yes
						government_has_flag = government_is_administrative
						exists = top_liege
						top_liege = scope:eholder
					}
				}
			}
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					decrease_mc_funds_effect = {
						VALUE = 600
					}
					if = {
						limit = {
							scope:pvassal = {
								is_ai = yes
							}
						}
						if = {
							limit = {
								NOT = {
									has_strong_hook = scope:pvassal
								}
							}
							add_hook = {
								type = loyalty_hook
								target = scope:pvassal
							}
						}
						scope:amage = {
							if = {
								limit = {
									NOT = {
										has_strong_hook = scope:pvassal
									}
								}
								add_hook = {
									type = loyalty_hook
									target = scope:pvassal
								}
							}
						}
						scope:bmage = {
							if = {
								limit = {
									NOT = {
										has_strong_hook = scope:pvassal
									}
								}
								add_hook = {
									type = loyalty_hook
									target = scope:pvassal
								}
							}
						}
						scope:loremaster = {
							if = {
								limit = {
									NOT = {
										has_strong_hook = scope:pvassal
									}
								}
								add_hook = {
									type = loyalty_hook
									target = scope:pvassal
								}
							}
						}
					}
					scope:pvassal = {
						save_scope_as = actor
						save_scope_as = secondary_recipient
						change_influence = massive_influence_gain
					}
					scope:target = {
						change_appointment_investment = {
							target = scope:pvassal
							value = appointment_score_max_tt_value
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep5_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 3
			modifier = {
				add = 1
				OR = {
					has_trait = deceitful
					has_trait = schemer
				}
			}
			modifier = {
				add = -1
				has_trait = honest
			}
			modifier = {
				add = -3
				opinion = {
					target = scope:pvassal
					value < 0
				}
			}
			modifier = {
				add = 2
				opinion = {
					target = scope:pvassal
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.90.e	#We should strike at some ruler.
		trigger = {
			exists = scope:admin_rival
			OR = {
				AND = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
				AND = {
					scope:amage = {
						is_ruler = yes
						government_has_flag = government_is_administrative
					}
				}
				AND = {
					scope:bmage = {
						is_ruler = yes
						government_has_flag = government_is_administrative
					}
				}
				AND = {
					scope:loremaster = {
						is_ruler = yes
						government_has_flag = government_is_administrative
					}
				}
			}
		}
		show_as_tooltip = {
			random_list = {
				1 = {
					desc = mc_approval
					show_chance = no
					scope:admin_rival = {
						add_prestige_level = -1
						if = {
							limit = { is_valid_for_legitimacy_change = yes }
							add_legitimacy = major_legitimacy_loss
						}
					}
					if = {
						limit = {
							is_ruler = yes
							government_has_flag = government_is_administrative
						}
						change_influence = medium_influence_loss
					}
					if = {
						limit = {
							scope:amage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:amage = {
							change_influence = medium_influence_loss
						}
					}
					if = {
						limit = {
							scope:bmage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:bmage = {
							change_influence = medium_influence_loss
						}
					}
					if = {
						limit = {
							scope:loremaster = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:loremaster = {
							change_influence = medium_influence_loss
						}
					}
				}
				1 = {
					desc = mc_rejection
					show_chance = no
					custom_tooltip = sm_archmage_rejection_ct
				}
			}
		}
		add_character_flag = admin_rep6_flag
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.91
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				OR = {
					has_trait = deceitful
					has_trait = schemer
				}
			}
			modifier = {
				add = -1
				has_trait = honest
			}
			modifier = {
				add = -1
				has_trait = just
			}
			modifier = {
				add = -5
				has_trait = compassionate
			}
			modifier = {
				add = 6
				OR = {
					has_relation_rival = scope:admin_rival
					has_relation_nemesis = scope:admin_rival
				}
			}
			modifier = {
				add = -2
				opinion = {
					target = scope:admin_rival
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.86.d	#I have no proposals.
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.92
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = lazy
			}
		}
	}
	option = {
		name = childhood.1006.c	#Zzz...
		trigger = {
			has_trait = incapable
		}
		exclusive = yes
		hidden_effect = {
			scope:amage = {
				trigger_event = magic_ev10.92
			}
		}
		ai_chance = {
			base = 1
		}
	}
}
#secret meeting! - admin proposal - archmage decides
magic_ev10.91 = {
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					ROOT = scope:admin
				}
				desc = ev10.87.title
			}
			desc = mc_admin_modifier
		}
	}
	desc = {
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:admin }
			}
			desc = ev10.91.desc0
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:admin }
					scope:admin = {
						has_character_flag = admin_rep1_flag
					}
				}
				desc = ev10.91.desc1
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:admin }
					scope:admin = {
						has_character_flag = admin_rep2_flag
					}
				}
				desc = ev10.91.desc2
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:admin }
					scope:admin = {
						OR = {
							has_character_flag = admin_rep3_flag
							has_character_flag = admin_rep4_flag
						}
					}
				}
				desc = ev10.91.desc3
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:admin }
					scope:admin = {
						has_character_flag = admin_rep5_flag
					}
				}
				desc = ev10.91.desc4
			}
			triggered_desc = {
				trigger = {
					NOT = { ROOT = scope:admin }
					scope:admin = {
						has_character_flag = admin_rep6_flag
					}
				}
				desc = ev10.91.desc5
			}
			desc = empty1_desc
		}
		triggered_desc = {
			trigger = {
				NOR = { ROOT = scope:admin ROOT = scope:amage }
			}
			desc = line_break
		}
		triggered_desc = {
			trigger = {
				NOT = { ROOT = scope:amage }
			}
			desc = ev10.87.desc3
		}
	}
	theme = diplomacy
	left_portrait = {
		character = scope:s1
	}
	#lower_left_portrait = scope:s2
	#lower_center_portrait = scope:s3
	#lower_right_portrait = scope:s4
	lower_left_portrait = { trigger = { exists = scope:pc1 } character = scope:pc1 }
	lower_center_portrait = { trigger = { exists = scope:pc2 } character = scope:pc2 }
	lower_right_portrait = { trigger = { exists = scope:pc3 } character = scope:pc3 }
	immediate = {
		sm_set_special_portraits_effect = { SPECIAL = 4 }
		hidden_effect = {
			if = {
				limit = {
					scope:admin = {
						OR = {
							has_character_flag = admin_rep1_flag
							has_character_flag = admin_rep2_flag
							has_character_flag = admin_rep3_flag
						}
					}
				}
				if = {
					limit = {
						exists = scope:pc1
					}
					clear_saved_scope = pc1
				}
				if = {
					limit = {
						exists = scope:pc2
					}
					clear_saved_scope = pc2
				}
				if = {
					limit = {
						exists = scope:pc3
					}
					clear_saved_scope = pc3
				}
			}
		}
		
		if = {
			limit = {
				NOT = { ROOT = scope:amage }
			}
			hidden_effect = {
				sm_set_portraits_effect = yes
				if = {
					limit = {
						scope:admin = {
							OR = {
								has_character_flag = admin_rep1_flag
								has_character_flag = admin_rep2_flag
								has_character_flag = admin_rep3_flag
							}
						}
					}
					scope:s2 = {
						save_scope_as = pc1
					}
					scope:s3 = {
						save_scope_as = pc2
					}
					scope:s4 = {
						save_scope_as = pc3
					}
				}
			}
			if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep1_flag
					}
				}
				transfer_to_mc_funds_effect = {
					PAYER = ROOT
					VALUE = my_gold_20p_value
				}
				show_as_tooltip = {
					transfer_to_mc_funds_effect = {
						PAYER = scope:p3
						VALUE = scope:p3.my_gold_20p_value
					}
					transfer_to_mc_funds_effect = {
						PAYER = scope:p4
						VALUE = scope:p4.my_gold_20p_value
					}
					transfer_to_mc_funds_effect = {
						PAYER = scope:p5
						VALUE = scope:p5.my_gold_20p_value
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep2_flag
					}
				}
				custom_tooltip = ev10.90.b_ct
				custom_tooltip = ev10.90.b_ct2
				custom_tooltip = ev10.90.b_ct3
				show_as_tooltip = {
					scope:admin = {
						add_dread = major_dread_gain
					}
					scope:amage = {
						add_dread = major_dread_gain
					}
					scope:bmage = {
						add_dread = major_dread_gain
					}
					scope:loremaster = {
						add_dread = major_dread_gain
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep6_flag
					}
				}
				show_as_tooltip = {
					custom_tooltip = amage_rep1_admin_rep6_ct
					if = {
						limit = {
							scope:admin = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:admin = {
							change_influence = medium_influence_loss
						}
					}
					if = {
						limit = {
							scope:amage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:amage = {
							change_influence = medium_influence_loss
						}
					}
					if = {
						limit = {
							scope:bmage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:bmage = {
							change_influence = medium_influence_loss
						}
					}
					if = {
						limit = {
							scope:loremaster = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:loremaster = {
							change_influence = medium_influence_loss
						}
					}
					scope:admin_rival = {
						add_prestige_level = -1
						if = {
							limit = { is_valid_for_legitimacy_change = yes }
							add_legitimacy = major_legitimacy_loss
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep3_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 600
					}
					if = {
						limit = {
							scope:amage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:amage = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:bmage = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:bmage = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:loremaster = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:loremaster = {
							change_influence = massive_influence_gain
						}
					}
					if = {
						limit = {
							scope:admin = {
								is_ruler = yes
								government_has_flag = government_is_administrative
							}
						}
						scope:admin = {
							change_influence = massive_influence_gain
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep4_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 600
					}
				}
				if = {
					limit = {
						scope:admin = {
							is_ruler = yes
							exists = top_liege
							top_liege = scope:eholder
							government_has_flag = government_is_administrative
						}
					}
					if = {
						limit = {
							ROOT = scope:admin
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:admin
								value = appointment_score_max_tt_value
							}
						}
					}
					else = {
						show_as_tooltip = {
							scope:target = {
								change_appointment_investment = {
									target = scope:admin
									value = appointment_score_max_tt_value
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						scope:amage = {
							is_ruler = yes
							exists = top_liege
							top_liege = scope:eholder
							government_has_flag = government_is_administrative
						}
					}
					if = {
						limit = {
							ROOT = scope:admin
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:amage
								value = appointment_score_max_tt_value
							}
						}
					}
					else = {
						show_as_tooltip = {
							scope:target = {
								change_appointment_investment = {
									target = scope:amage
									value = appointment_score_max_tt_value
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						scope:bmage = {
							is_ruler = yes
							exists = top_liege
							top_liege = scope:eholder
							government_has_flag = government_is_administrative
						}
					}
					if = {
						limit = {
							ROOT = scope:admin
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:bmage
								value = appointment_score_max_tt_value
							}
						}
					}
					else = {
						show_as_tooltip = {
							scope:target = {
								change_appointment_investment = {
									target = scope:bmage
									value = appointment_score_max_tt_value
								}
							}
						}
					}
				}
				else_if = {
					limit = {
						scope:loremaster = {
							is_ruler = yes
							exists = top_liege
							top_liege = scope:eholder
							government_has_flag = government_is_administrative
						}
					}
					if = {
						limit = {
							ROOT = scope:admin
						}
						scope:target = {
							change_appointment_investment = {
								target = scope:loremaster
								value = appointment_score_max_tt_value
							}
						}
					}
					else = {
						show_as_tooltip = {
							scope:target = {
								change_appointment_investment = {
									target = scope:loremaster
									value = appointment_score_max_tt_value
								}
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = amage_rep1_admin_rep5_flag
					}
				}
				show_as_tooltip = {
					decrease_mc_funds_effect = {
						VALUE = 600
					}
				}
				show_as_tooltip = {
					if = {
						limit = {
							scope:pvassal = {
								is_ai = yes
							}
						}
						scope:admin = {
							add_hook = {
								type = loyalty_hook
								target = scope:pvassal
							}
						}
						scope:amage = {
							add_hook = {
								type = loyalty_hook
								target = scope:pvassal
							}
						}
						scope:bmage = {
							add_hook = {
								type = loyalty_hook
								target = scope:pvassal
							}
						}
						scope:loremaster = {
							add_hook = {
								type = loyalty_hook
								target = scope:pvassal
							}
						}
					}
				}
				if = {
					limit = {
						ROOT = scope:admin
					}
					scope:target = {
						change_appointment_investment = {
							target = scope:pvassal
							value = appointment_score_max_tt_value
						}
					}
				}
				else = {
					show_as_tooltip = {
						scope:target = {
							change_appointment_investment = {
								target = scope:pvassal
								value = appointment_score_max_tt_value
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						OR = {
							has_character_flag = amage_rep2_admin_rep1_flag
							has_character_flag = amage_rep2_admin_rep2_flag
							has_character_flag = amage_rep2_admin_rep3_flag
							has_character_flag = amage_rep2_admin_rep4_flag
							has_character_flag = amage_rep2_admin_rep5_flag
							has_character_flag = amage_rep2_admin_rep6_flag
						}
					}
				}
				custom_tooltip = sm_archmage_rejection_ct
			}
		}
		else = {
			if = {
				limit = {
					scope:admin = {
						OR = {
							has_character_flag = admin_rep1_flag
							has_character_flag = admin_rep2_flag
							has_character_flag = admin_rep3_flag
						}
					}
				}
				save_scope_as = pc1
				scope:bmage = {
					save_scope_as = pc2
				}
				scope:loremaster = {
					save_scope_as = pc3
				}
			}
			else_if = {
				limit = {
					has_character_flag = admin_rep4_flag
				}
				scope:pvassal = {
					save_scope_as = pc2
				}
			}
			else_if = {
				limit = {
					has_character_flag = admin_rep5_flag
				}
				scope:troublemaker = {
					save_scope_as = pc2
				}
			}
		}
	}
	option = {
		#name = ev10.91.a	#
		name = ev10.89.c	#I agree with this proposal.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep1_flag
			}
		}
		transfer_to_mc_funds_effect = {
			PAYER = scope:amage
			VALUE = my_gold_20p_value
		}
		show_as_tooltip = {
			transfer_to_mc_funds_effect = {
				PAYER = scope:admin
				VALUE = scope:admin.my_gold_20p_value
			}
			transfer_to_mc_funds_effect = {
				PAYER = scope:bmage
				VALUE = scope:bmage.my_gold_20p_value
			}
			transfer_to_mc_funds_effect = {
				PAYER = scope:loremaster
				VALUE = scope:loremaster.my_gold_20p_value
			}
		}
		add_character_flag = amage_rep1_admin_rep1_flag
		ai_chance = {
			base = 5
			modifier = {
				add = -5
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.91.a	#This is not the right moment.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep1_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep1_flag
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.89.c	#I agree with this proposal.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep2_flag
			}
		}
		custom_tooltip = ev10.90.b_ct
		custom_tooltip = ev10.90.b_ct2
		custom_tooltip = ev10.90.b_ct3
		scope:amage = {
			add_dread = major_dread_gain
		}
		scope:admin = {
			add_dread = major_dread_gain
		}
		scope:bmage = {
			add_dread = major_dread_gain
		}
		scope:loremaster = {
			add_dread = major_dread_gain
		}
		
		mc_revealing_effect = yes
		add_character_flag = amage_rep1_admin_rep2_flag
		ai_chance = {
			base = 2
			modifier = {
				add = -2
				OR = {
					has_trait = deceitful
					has_trait = schemer
				}
			}
			modifier = {
				add = 2
				OR = {
					has_trait = just
					has_trait = brave
					has_trait = diplomat
					has_trait = arrogant
				}
			}
		}
	}
	option = {
		name = ev10.91.a	#This is not the right moment.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep2_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep2_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = patient
			}
		}
	}
	option = {
		name = ev10.91.b	#Sounds good to me.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep3_flag
			}
		}
		decrease_mc_funds_effect = {
			VALUE = 600
		}
		if = {
			limit = {
				is_ruler = yes
				government_has_flag = government_is_administrative
			}
			change_influence = massive_influence_gain
		}
		if = {
			limit = {
				scope:bmage = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:bmage = {
				change_influence = massive_influence_gain
			}
		}
		if = {
			limit = {
				scope:loremaster = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:loremaster = {
				change_influence = massive_influence_gain
			}
		}
		if = {
			limit = {
				scope:admin = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:admin = {
				change_influence = massive_influence_gain
			}
		}
		
		add_character_flag = amage_rep1_admin_rep3_flag
		ai_chance = {
			base = 3
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = deceitful
			}
		}
	}
	option = {
		name = ev10.87.g	#We have more important expenses.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep3_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep3_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.91.b	#Sounds good to me.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep4_flag
			}
		}
		decrease_mc_funds_effect = {
			VALUE = 600
		}
		if = {
			limit = {
				scope:admin = {
					is_ruler = yes
					exists = top_liege
					top_liege = scope:eholder
					government_has_flag = government_is_administrative
				}
			}
			scope:admin = {
				save_scope_as = actor
				save_scope_as = secondary_recipient
			}
			show_as_tooltip = {
				scope:target = {
					change_appointment_investment = {
						target = scope:admin
						value = appointment_score_max_tt_value
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:amage = {
					is_ruler = yes
					exists = top_liege
					top_liege = scope:eholder
					government_has_flag = government_is_administrative
				}
			}
			scope:amage = {
				save_scope_as = actor
				save_scope_as = secondary_recipient
			}
			show_as_tooltip = {
				scope:target = {
					change_appointment_investment = {
						target = scope:amage
						value = appointment_score_max_tt_value
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:bmage = {
					is_ruler = yes
					exists = top_liege
					top_liege = scope:eholder
					government_has_flag = government_is_administrative
				}
			}
			scope:bmage = {
				save_scope_as = actor
				save_scope_as = secondary_recipient
			}
			show_as_tooltip = {
				scope:target = {
					change_appointment_investment = {
						target = scope:bmage
						value = appointment_score_max_tt_value
					}
				}
			}
		}
		else_if = {
			limit = {
				scope:loremaster = {
					is_ruler = yes
					exists = top_liege
					top_liege = scope:eholder
					government_has_flag = government_is_administrative
				}
			}
			scope:loremaster = {
				save_scope_as = actor
				save_scope_as = secondary_recipient
			}
			show_as_tooltip = {
				scope:target = {
					change_appointment_investment = {
						target = scope:loremaster
						value = appointment_score_max_tt_value
					}
				}
			}
		}
		add_character_flag = amage_rep1_admin_rep4_flag
		ai_chance = {
			base = 3
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = deceitful
			}
		}
	}
	option = {
		name = ev10.87.g	#We have more important expenses.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep4_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep4_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.91.b	#Sounds good to me.
		trigger = {
			exists = scope:pvassal
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep5_flag
			}
		}
		decrease_mc_funds_effect = {
			VALUE = 600
		}
		if = {
			limit = {
				scope:pvassal = {
					is_ai = yes
				}
			}
			scope:admin = {
				if = {
					limit = {
						NOT = {
							has_strong_hook = scope:pvassal
						}
					}
					hidden_effect = {
						if = {
							limit = {
								has_hook = scope:pvassal
							}
							remove_hook = {
								target = scope:pvassal
							}
						}
					}
					add_hook = {
						type = loyalty_hook
						target = scope:pvassal
					}
				}
			}
			scope:amage = {
				if = {
					limit = {
						NOT = {
							has_strong_hook = scope:pvassal
						}
					}
					hidden_effect = {
						if = {
							limit = {
								has_hook = scope:pvassal
							}
							remove_hook = {
								target = scope:pvassal
							}
						}
					}
					add_hook = {
						type = loyalty_hook
						target = scope:pvassal
					}
				}
			}
			scope:bmage = {
				if = {
					limit = {
						NOT = {
							has_strong_hook = scope:pvassal
						}
					}
					hidden_effect = {
						if = {
							limit = {
								has_hook = scope:pvassal
							}
							remove_hook = {
								target = scope:pvassal
							}
						}
					}
					add_hook = {
						type = loyalty_hook
						target = scope:pvassal
					}
				}
			}
			scope:loremaster = {
				if = {
					limit = {
						NOT = {
							has_strong_hook = scope:pvassal
						}
					}
					hidden_effect = {
						if = {
							limit = {
								has_hook = scope:pvassal
							}
							remove_hook = {
								target = scope:pvassal
							}
						}
					}
					add_hook = {
						type = loyalty_hook
						target = scope:pvassal
					}
				}
			}
		}
		scope:pvassal = {
			save_scope_as = actor
			save_scope_as = secondary_recipient
			change_influence = massive_influence_gain
		}
		show_as_tooltip = {
			scope:target = {
				change_appointment_investment = {
					target = scope:pvassal
					value = appointment_score_max_tt_value
				}
			}
		}
		add_character_flag = amage_rep1_admin_rep5_flag
		ai_chance = {
			base = 3
			modifier = {
				add = -2
				has_trait = greedy
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
			modifier = {
				add = 1
				has_trait = deceitful
			}
		}
	}

	
	option = {
		name = ev10.87.g	#We have more important expenses.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep5_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep5_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = greedy
			}
		}
	}
	option = {
		name = ev10.91.c	#Yes, we will pull the right strings.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep6_flag
			}
		}
		if = {
			limit = {
				is_ruler = yes
				government_has_flag = government_is_administrative
			}
			change_influence = medium_influence_loss
		}
		if = {
			limit = {
				scope:admin = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:admin = {
				change_influence = medium_influence_loss
			}
		}
		if = {
			limit = {
				scope:bmage = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:bmage = {
				change_influence = medium_influence_loss
			}
		}
		if = {
			limit = {
				scope:loremaster = {
					is_ruler = yes
					government_has_flag = government_is_administrative
				}
			}
			scope:loremaster = {
				change_influence = medium_influence_loss
			}
		}
		scope:admin_rival = {
			add_prestige_level = -1
			if = {
				limit = { is_valid_for_legitimacy_change = yes }
				add_legitimacy = major_legitimacy_loss
			}
		}
		add_character_flag = amage_rep1_admin_rep6_flag
		ai_chance = {
			base = 2
			modifier = {
				add = 20
				OR = {
					has_relation_rival = scope:admin_rival
					has_relation_nemesis = scope:admin_rival
				}
			}
			modifier = {
				add = 1
				opinion = {
					target = scope:admin_rival
					value < 0
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = deceitful
					has_trait = arbitrary
					has_trait = callous
					has_trait = sadistic
				}
			}
			modifier = {
				add = -1
				opinion = {
					target = scope:admin_rival
					value > 0
				}
			}
			modifier = {
				add = -2
				OR = {
					has_trait = compassionate
					has_trait = forgiving
					has_trait = just
				}
			}
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:admin
					has_relation_nemesis = scope:admin
				}
			}
		}
	}
	option = {
		name = ev10.91.d	#He is not our enemy.
		trigger = {
			ROOT = scope:amage
			scope:admin = {
				has_character_flag = admin_rep6_flag
			}
		}
		custom_tooltip = sm_archmage_rejection_ct0
		add_character_flag = amage_rep2_admin_rep6_flag
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				opinion = {
					target = scope:admin_rival
					value > 0
				}
			}
			modifier = {
				add = -1
				opinion = {
					target = scope:admin
					value > 0
				}
			}
			modifier = {
				add = 1
				OR = {
					has_trait = compassionate
					has_trait = forgiving
					has_trait = just
				}
			}
			modifier = {
				add = -10
				OR = {
					has_relation_rival = scope:admin_rival
					has_relation_nemesis = scope:admin_rival
				}
			}
		}
	}
	option = {
		name = EXCELLENT
		trigger = {
			ROOT = scope:admin
			scope:amage = {
				OR = {
					has_character_flag = amage_rep1_admin_rep1_flag
					has_character_flag = amage_rep1_admin_rep2_flag
					has_character_flag = amage_rep1_admin_rep3_flag
					has_character_flag = amage_rep1_admin_rep4_flag
					has_character_flag = amage_rep1_admin_rep5_flag
					has_character_flag = amage_rep1_admin_rep6_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = tour_grounds_events.3017.a	#A pity.
		trigger = {
			ROOT = scope:admin
			scope:amage = {
				NOR = {
					has_character_flag = amage_rep1_admin_rep1_flag
					has_character_flag = amage_rep1_admin_rep2_flag
					has_character_flag = amage_rep1_admin_rep3_flag
					has_character_flag = amage_rep1_admin_rep4_flag
					has_character_flag = amage_rep1_admin_rep5_flag
					has_character_flag = amage_rep1_admin_rep6_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev3.17.a	#Interesting
		trigger = {
			NOR = { ROOT = scope:amage ROOT = scope:admin }
			scope:amage = {
				OR = {
					has_character_flag = amage_rep1_admin_rep2_flag
					has_character_flag = amage_rep1_admin_rep3_flag
					has_character_flag = amage_rep1_admin_rep4_flag
					has_character_flag = amage_rep1_admin_rep5_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev6.66.0.a	#Well...
		trigger = {
			NOR = { ROOT = scope:amage ROOT = scope:admin }
			scope:amage = {
				OR = {
					has_character_flag = amage_rep1_admin_rep1_flag
					has_character_flag = amage_rep2_admin_rep1_flag
					has_character_flag = amage_rep2_admin_rep2_flag
					has_character_flag = amage_rep2_admin_rep3_flag
					has_character_flag = amage_rep2_admin_rep4_flag
					has_character_flag = amage_rep2_admin_rep5_flag
					has_character_flag = amage_rep1_admin_rep6_flag
					has_character_flag = amage_rep2_admin_rep6_flag
				}
			}
		}
		ai_chance = {
			base = 1
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:bmage = {
					trigger_event = magic_ev10.91
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.91
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:admin = {
					trigger_event = magic_ev10.91
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:amage = {
					trigger_event = magic_ev10.92
				}
			}
		}
	}
}
#secret meeting! - ending
magic_ev10.92 = {
	title = ev10.92.title
	desc = ev10.92.desc
	theme = diplomacy
	left_portrait = {
		character = ROOT
	}
	lower_left_portrait = scope:p3
	lower_center_portrait = scope:p4
	lower_right_portrait = scope:p5
	immediate = {
		hidden_effect = {
			sm_set_portraits_effect = yes
		}
	}
	option = {
		name = ev10.92.a
		trigger = {
			ROOT = scope:amage
		}
		custom_tooltip = ev10.92.a_ct
	}
	option = {
		name = ev10.92.b
		trigger = {
			NOT = { ROOT = scope:amage	}
		}
		custom_tooltip = ev10.92.a_ct
	}
	after = {
		hidden_effect = {
			sm_clear_flags_vars_effect = yes
			if = {
				limit = {
					NOT = {
						has_character_flag = already_participated_in_sm_flag
					}
				}
				add_character_flag = already_participated_in_sm_flag
			}
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:bmage = {
					trigger_event = magic_ev10.92
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.92
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:admin = {
					trigger_event = magic_ev10.92
				}
			}
		}
	}
}

#MC revealed
magic_ev10.93 = {
	type = character_event
	window = fullscreen_event
	title = ev10.93.title
	desc = ev10.93.desc
	theme = plague
	#theme = legend
	override_background = { reference = mc_shadows }
	#override_background = { reference = ce1_fullscreen_apocalyptic }
	#override_background = { reference = ce1_fullscreen_legitimizing_legend }
	#override_sound = { reference = "event:/DLC/FP4/SFX/UI/Unique/sfx_ui_spread_legend" }

	#left_portrait = {
	#	character = scope:amage
	#}
	#lower_left_portrait = scope:loremaster
	#lower_center_portrait = scope:admin
	#lower_right_portrait = scope:bmage
	immediate = {
		#play_music_cue = apocalyptic_plague
		play_music_cue = mx_cue_legend
		hidden_effect = {
			if = {
				limit = {
					exists = global_var:current_archmage_global
					ROOT = global_var:current_archmage_global
				}
				if = {
					limit = {
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = root.faith GENDER_CHARACTER = root }
						exists = root.faith.religious_head
						root.faith.religious_head = {
							NOT = {
								has_variable = mc_member_var
							}
						}
					}
					root.faith.religious_head = {
						add_opinion = {
							target = ROOT
							modifier = impious_opinion
							opinion = -200
						}
					}
				}
				if = {
					limit = {
						exists = global_var:current_black_mage_global
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = global_var:current_black_mage_global.faith GENDER_CHARACTER = global_var:current_black_mage_global }
						exists = global_var:current_black_mage_global.faith.religious_head
						global_var:current_black_mage_global.faith.religious_head = {
							NOT = {
								has_variable = mc_member_var
							}
						}
					}
					global_var:current_black_mage_global.faith.religious_head = {
						add_opinion = {
							target = global_var:current_black_mage_global
							modifier = impious_opinion
							opinion = -200
						}
					}
				}
				if = {
					limit = {
						exists = global_var:current_loremaster_global
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = global_var:current_loremaster_global.faith GENDER_CHARACTER = global_var:current_loremaster_global }
						exists = global_var:current_loremaster_global.faith.religious_head
						global_var:current_loremaster_global.faith.religious_head = {
							NOT = {
								has_variable = mc_member_var
							}
						}
					}
					global_var:current_loremaster_global.faith.religious_head = {
						add_opinion = {
							target = global_var:current_loremaster_global
							modifier = impious_opinion
							opinion = -200
						}
					}
				}
				if = {
					limit = {
						exists = global_var:current_admin_global
						trait_is_criminal_in_faith_trigger = { TRAIT = witch FAITH = global_var:current_admin_global.faith GENDER_CHARACTER = global_var:current_admin_global }
						exists = global_var:current_admin_global.faith.religious_head
						global_var:current_admin_global.faith.religious_head = {
							NOT = {
								has_variable = mc_member_var
							}
						}
					}
					global_var:current_admin_global.faith.religious_head = {
						add_opinion = {
							target = global_var:current_admin_global
							modifier = impious_opinion
							opinion = -200
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.93.a
		trigger = {
			has_variable = mc_member_var
		}
	}
	option = {
		name = ev10.93.b
		trigger = {
			NOT = { has_variable = mc_member_var	}
			is_witch_trigger = yes
		}
	}
	option = {
		name = ev10.93.c
		trigger = {
			NOT = { has_variable = mc_member_var	}
			is_witch_trigger = no
		}
	}
}

#secret meeting! - crisis
magic_ev10.94 = {
	title = ev10.94.title
	desc = {
		triggered_desc = {
			trigger = {
				NOT = {
					scope:amage = ROOT
				}
			}
			desc = ev10.94.desc0
		}
		desc = ev10.94.desc1
	}
	theme = diplomacy
	left_portrait = {
		character = scope:amage
	}
	lower_left_portrait = scope:bmage
	lower_center_portrait = scope:loremaster
	lower_right_portrait = scope:admin
	immediate = {
		#hidden_effect = {
		#	sm_set_portraits_effect = yes
		#}
		if = {
			limit = {
				NOT = {
					ROOT = scope:amage
				}
			}
			if = {
				limit = {
					scope:amage = {
						has_character_flag = arch_crisis_o1_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:admin
					}
					scope:amage = {
						add_character_modifier = {
							modifier = mage_council_support_modifier
							years = 10
						}
						if = {
							limit = {
								NOT = {
									has_hook = scope:bmage
								}
							}
							add_hook = {
								type = obligation_hook
								target = scope:bmage
							}
						}
						if = {
							limit = {
								NOT = {
									has_hook = scope:loremaster
								}
							}
							add_hook = {
								type = obligation_hook
								target = scope:loremaster
							}
						}
						if = {
							limit = {
								NOT = {
									has_hook = scope:admin
								}
							}
							add_hook = {
								type = obligation_hook
								target = scope:admin
							}
						}
					}
				}
				else = {
					show_as_tooltip = {
						scope:amage = {
							add_character_modifier = {
								modifier = mage_council_support_modifier
								years = 10
							}
							if = {
								limit = {
									NOT = {
										has_hook = scope:bmage
									}
								}
								add_hook = {
									type = obligation_hook
									target = scope:bmage
								}
							}
							if = {
								limit = {
									NOT = {
										has_hook = scope:loremaster
									}
								}
								add_hook = {
									type = obligation_hook
									target = scope:loremaster
								}
							}
							if = {
								limit = {
									NOT = {
										has_hook = scope:admin
									}
								}
								add_hook = {
									type = obligation_hook
									target = scope:admin
								}
							}
						}
					}
				}
			}
			else_if = {
				limit = {
					scope:amage = {
						has_character_flag = arch_crisis_o2_flag
					}
				}
				if = {
					limit = {
						ROOT = scope:admin
					}
					scope:amage = {
						take_from_mc_funds_effect = {
							RECEIVER = scope:amage
							VALUE = global_var:mc_gold_global
						}
					}
					
				}
				else = {
					show_as_tooltip = {
						scope:amage = {
							take_from_mc_funds_effect = {
								RECEIVER = scope:amage
								VALUE = global_var:mc_gold_global
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.94.a
		trigger = {
			ROOT = scope:amage
		}

		show_as_tooltip = {
			add_character_modifier = {
				modifier = mage_council_support_modifier
				years = 10
			}
			if = {
				limit = {
					NOT = {
						has_hook = scope:bmage
					}
				}
				add_hook = {
					type = obligation_hook
					target = scope:bmage
				}
			}
			if = {
				limit = {
					NOT = {
						has_hook = scope:loremaster
					}
				}
				add_hook = {
					type = obligation_hook
					target = scope:loremaster
				}
			}
			if = {
				limit = {
					NOT = {
						has_hook = scope:admin
					}
				}
				add_hook = {
					type = obligation_hook
					target = scope:admin
				}
			}
		}
		add_character_flag = arch_crisis_o1_flag
	}
	option = {
		name = ev10.94.b
		trigger = {
			ROOT = scope:amage
		}
		show_as_tooltip = {
			take_from_mc_funds_effect = {
				RECEIVER = ROOT
				VALUE = global_var:mc_gold_global
			}
		}
		add_character_flag = arch_crisis_o2_flag
	}
	option = {
		name = ev10.94.c
		trigger = {
			NOT = { ROOT = scope:amage	}
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					ROOT = scope:amage
				}
				scope:bmage = {
					trigger_event = magic_ev10.94
				}
			}
			else_if = {
				limit = {
					ROOT = scope:bmage
				}
				scope:loremaster = {
					trigger_event = magic_ev10.94
				}
			}
			else_if = {
				limit = {
					ROOT = scope:loremaster
				}
				scope:admin = {
					trigger_event = magic_ev10.94
				}
			}
			else_if = {
				limit = {
					ROOT = scope:admin
				}
				scope:amage = {
					trigger_event = magic_ev10.92
				}
			}
		}
	}
}

#ask the archmage for support - protection
magic_ev10.95 = {
	type = letter_event
	opening = ev10.40.opening
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_trait = archmage
						has_trait = true_witch
						has_focus = witch_focus
						has_focus = arcane_focus
					}
				}
				desc = ev10.95.desc
			}
			desc = ev10.95.desc1
		}
		desc = ev10.95.desc2
	}
	sender = scope:ruler
	immediate = {
		hidden_effect = {
			scope:actor = {
				save_scope_as = ruler
				if = {
					limit = {
						is_ruler = yes
					}
					random_courtier_or_guest = {
						limit = {
							any_secret = {
								NOT = {
									is_known_by = scope:recipient
								}
							}
						}
						random_secret = {
							limit = {
								NOT = {
									is_known_by = scope:recipient
								}
							}
							save_scope_as = sec1
						}
					}
				}
				else_if = {
					limit = {
						exists = liege
					}
					liege = {
						random_courtier_or_guest = {
							limit = {
								any_secret = {
									NOT = {
										is_known_by = scope:recipient
									}
								}
							}
							random_secret = {
								limit = {
									NOT = {
										is_known_by = scope:recipient
									}
								}
								save_scope_as = sec1
							}
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.95.a
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		decrease_mc_funds_effect = {
			VALUE = 50
		}
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				add_character_modifier = {
					modifier = mc_protection_modifier
					years = 3
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.95.b
		trigger = {
			mc_gold_global_avaiable_trigger = yes
			has_trait = schemer
			exists = scope:sec1
		}
		decrease_mc_funds_effect = {
			VALUE = 50
		}
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				add_character_modifier = {
					modifier = mc_protection_modifier
					years = 3
				}
			}
		}
		custom_tooltip = send_agent_cgm_interaction_ct4
		hidden_effect = {
			send_interface_toast = {
				title = intrigue_court_spies_modifier
				left_icon = scope:sec1.secret_owner
				scope:sec1 = {
					reveal_to = ROOT
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.95.c
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.95.d
		custom_tooltip = ev10.95.d_ct
		hidden_effect = {
			add_character_flag = {
				flag = archmage_busy_flag
				years = 5
			}
		}
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#ask the archmage for support - research funding
magic_ev10.96 = {
	type = letter_event
	opening = ev10.40.opening
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_focus = witch_focus
						has_focus = arcane_focus
						has_trait = archmage
						has_trait = true_witch
					}
				}
				desc = ev10.95.desc
			}
			desc = ev10.95.desc1
		}
		desc = ev10.96.desc
	}
	sender = scope:ruler
	immediate = {
		hidden_effect = {
			scope:actor = {
				save_scope_as = ruler
			}
		}
	}
	option = {
		name = ev10.87.e
		trigger = {
			mc_gold_global_avaiable_trigger = yes
		}
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				take_from_mc_funds_effect = {
					RECEIVER = scope:actor
					VALUE = mc_tiny_gold_value
				}
				add_character_modifier = {
					modifier = additional_magic_funds_modifier
					years = 3
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.87.g
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.95.d
		custom_tooltip = ev10.95.d_ct
		hidden_effect = {
			add_character_flag = {
				flag = archmage_busy_flag
				years = 5
			}
		}
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}
#ask the archmage for support - place of power
magic_ev10.97 = {
	type = letter_event
	opening = ev10.40.opening
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_focus = witch_focus
						has_focus = arcane_focus
						has_trait = archmage
						has_trait = true_witch
					}
				}
				desc = ev10.95.desc
			}
			desc = ev10.95.desc1
		}
		desc = ev10.97.desc
	}
	sender = scope:ruler
	immediate = {
		hidden_effect = {
			scope:actor = {
				save_scope_as = ruler
			}
		}
	}
	option = {
		name = ev54.0.a	#Let it be.
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				add_character_modifier = {
					modifier = mc_place_of_power_modifier
					years = 3
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ep3_decisions_event.3201.b	#No.
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.95.d
		custom_tooltip = ev10.95.d_ct
		hidden_effect = {
			add_character_flag = {
				flag = archmage_busy_flag
				years = 5
			}
		}
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}
#ask the archmage for support - court mage
magic_ev10.98 = {
	type = letter_event
	opening = ev10.40.opening
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_focus = witch_focus
						has_focus = arcane_focus
						has_trait = archmage
						has_trait = true_witch
					}
				}
				desc = ev10.95.desc
			}
			desc = ev10.95.desc1
		}
		desc = ev10.98.desc
	}
	sender = scope:ruler
	trigger = {
		scope:actor = {
			is_ruler = yes
			#NOT = {
			#	exists = court_position:mage_court_position
			#	court_position:mage_court_position = scope:recipient
			#}
		}
	}
	immediate = {
		hidden_effect = {
			scope:actor = {
				save_scope_as = ruler
				random_vassal = {
					limit = {
						NOR = {
							has_trait = incapable
							THIS = ROOT
							has_court_position = mage_court_position
						}
						has_trait = archmage
					}
					save_scope_as = c1
				}
				if = {
					limit = {
						NOT = {
							exists = scope:c1
						}
					}
					random_courtier = {
						limit = {
							NOR = {
								has_trait = incapable
								has_court_position = mage_court_position
								THIS = ROOT
							}
							has_trait = archmage
						}
						save_scope_as = c1
					}
				}
				random_living_character = {
					limit = {
						has_trait = archmage
						is_ruler = no
						is_imprisoned = no
						is_concubine = no
						NOR = {
							has_trait = incapable
							has_court_position = mage_court_position
							ROOT = THIS
							scope:actor = THIS
							scope:c1 = THIS
						}
					}
					save_scope_as = c2
				}
				if = {
					limit = {
						NOT = {
							exists = scope:c2
						}
					}
					ROOT = {
						random_courtier = {
							limit = {
								NOR = {
									has_trait = incapable
									has_court_position = mage_court_position
									THIS = ROOT
								}
								has_trait = archmage
							}
							save_scope_as = c2
						}
					}
				}
				random_living_character = {
					limit = {
						OR = {
							has_trait = archmage
							has_trait = true_witch
						}
						is_ruler = no
						is_imprisoned = no
						is_concubine = no
						NOR = {
							has_trait = incapable
							has_court_position = mage_court_position
							ROOT = THIS
							scope:actor = THIS
							scope:c1 = THIS
							scope:c2 = THIS
						}
					}
					save_scope_as = c3
				}
			}
		}
	}
	option = {
		name = ev10.98.a
		trigger = {
			liege = scope:actor
			NOT = {
				has_court_position = mage_court_position
			}
		}
		hidden_effect = {
			scope:actor = {
				if = {
					limit = {
						exists = court_position:mage_court_position
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
			}
		}
		scope:actor = {
			pay_short_term_gold = {
				target = ROOT
				gold = 250
			}
			send_interface_toast = {
				title = ev10.87.title
				appoint_court_position = {
					recipient = ROOT
					court_position = mage_court_position
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.98.b
		trigger = {
			exists = scope:c1
		}
		hidden_effect = {
			scope:actor = {
				if = {
					limit = {
						exists = court_position:mage_court_position
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
			}
		}
		if = {
			limit = {
				has_usable_hook = scope:c1
			}
			use_hook = scope:c1
		}
		else_if = {
			limit = {
				NOT = {
					has_hook = scope:c1
				}
			}
			scope:c1 = {
				add_hook = {
					type = favor_hook
					target = ROOT
				}
			}
		}
		scope:actor = {
			transfer_to_mc_funds_effect = {
				PAYER = scope:actor
				VALUE = 250
			}
			send_interface_toast = {
				title = ev10.87.title
				appoint_court_position = {
					recipient = scope:c1
					court_position = mage_court_position
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.98.c
		trigger = {
			exists = scope:c2
		}
		hidden_effect = {
			scope:actor = {
				if = {
					limit = {
						exists = court_position:mage_court_position
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
			}
		}
		if = {
			limit = {
				has_usable_hook = scope:c2
				NOT = {
					any_courtier_or_guest = {
						THIS = scope:c2
					}
				}
			}
			use_hook = scope:c2
		}
		else_if = {
			limit = {
				NOT = {
					has_hook = scope:c2
					any_courtier_or_guest = {
						THIS = scope:c2
					}
				}
			}
			scope:c2 = {
				add_hook = {
					type = favor_hook
					target = ROOT
				}
			}
		}
		scope:actor = {
			transfer_to_mc_funds_effect = {
				PAYER = scope:actor
				VALUE = 250
			}
			add_courtier = scope:c2
			send_interface_toast = {
				title = ev10.87.title
				appoint_court_position = {
					recipient = scope:c2
					court_position = mage_court_position
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.98.d
		trigger = {
			exists = scope:c3
			NOT = {
				liege = scope:actor
			}
		}
		hidden_effect = {
			scope:actor = {
				if = {
					limit = {
						exists = court_position:mage_court_position
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
			}
		}
		if = {
			limit = {
				has_usable_hook = scope:c3
				NOT = {
					any_courtier_or_guest = {
						THIS = scope:c3
					}
				}
			}
			use_hook = scope:c3
		}
		else_if = {
			limit = {
				NOT = {
					has_hook = scope:c3
					any_courtier_or_guest = {
						THIS = scope:c3
					}
				}
			}
			scope:c3 = {
				add_hook = {
					type = favor_hook
					target = ROOT
				}
			}
		}
		scope:actor = {
			transfer_to_mc_funds_effect = {
				PAYER = scope:actor
				VALUE = 250
			}
			add_courtier = scope:c3
			send_interface_toast = {
				title = ev10.87.title
				appoint_court_position = {
					recipient = scope:c3
					court_position = mage_court_position
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.98.e
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				opinion = {
					target = scope:actor
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.95.d
		custom_tooltip = ev10.95.d_ct
		hidden_effect = {
			add_character_flag = {
				flag = archmage_busy_flag
				years = 5
			}
		}
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#ask the archmage for support - war
magic_ev10.99 = {
	type = letter_event
	opening = ev10.40.opening
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					OR = {
						has_focus = witch_focus
						has_focus = arcane_focus
						has_trait = archmage
						has_trait = true_witch
					}
				}
				desc = ev10.95.desc
			}
			desc = ev10.95.desc1
		}
		desc = ev10.99.desc
	}
	sender = scope:ruler
	trigger = {
		NOT = {
			is_at_war_with = scope:actor
		}
	}
	immediate = {
		hidden_effect = {
			scope:actor = {
				save_scope_as = ruler
				random_character_war = {
					limit = {
						OR = {
							primary_attacker = scope:actor
							primary_defender = scope:actor
						}
					}
					save_scope_as = war1
					if = {
						limit = {
							primary_attacker = scope:actor
						}
						primary_defender = {
							save_scope_as = ptarget
						}
					}
					else = {
						primary_attacker = {
							save_scope_as = ptarget
						}
					}
				}
			}
		}
	}
	option = {
		name = ev10.99.a
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				take_from_mc_funds_effect = {
					RECEIVER = scope:actor
					VALUE = mc_minor_gold_value
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.99.b
		trigger = {
			exists = scope:ptarget
			is_true_mage = yes
			has_character_flag = tornado_spell_flag
			is_character_interaction_shown = {
				recipient = scope:ptarget
				interaction = tornado_spell
			}
			is_character_interaction_valid = {
				recipient = scope:ptarget
				interaction = tornado_spell
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		custom_tooltip = spell_will_be_cast_ct
		spend_standard_ps_effect = yes
		show_as_unavailable = {
			exists = scope:ptarget
			is_true_mage = yes
			has_character_flag = tornado_spell_flag
			is_character_interaction_shown = {
				recipient = scope:ptarget
				interaction = tornado_spell
			}
			is_character_interaction_valid = {
				recipient = scope:ptarget
				interaction = tornado_spell
			}
		}
		
		custom_tooltip = use_magic_custom_tooltip
		if = {
			limit = {
				scope:ptarget = {
					is_magic_protected = yes
				}
			}
			custom_tooltip = spell_may_be_countered
		}
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = ev10.87.title
					left_icon = ROOT
					right_icon = scope:ptarget
					custom_tooltip = magic_target_confirmed_ct
				}
			}
			run_interaction = {
				interaction = tornado_spell
				actor = ROOT
				recipient = scope:ptarget
				execute_threshold = accept
			}
		}
		
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.52.d
		trigger = {
			exists = scope:ptarget
			is_powerful_being = yes
			can_cast_firestorm_trigger = yes
			NOT = {
				has_character_flag = tornado_spell_flag
			}
			is_character_interaction_shown = {
				recipient = scope:ptarget
				interaction = firestorm_spell
			}
			is_character_interaction_valid = {
				recipient = scope:ptarget
				interaction = firestorm_spell
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		custom_tooltip = spell_will_be_cast_ct
		spend_standard_ps_effect = yes
		show_as_unavailable = {
			exists = scope:ptarget
			is_powerful_being = yes
			NOT = {
				has_character_flag = tornado_spell_flag
			}
			can_cast_firestorm_trigger = yes
			is_character_interaction_shown = {
				recipient = scope:ptarget
				interaction = firestorm_spell
			}
			is_character_interaction_valid = {
				recipient = scope:ptarget
				interaction = firestorm_spell
			}
		}
		custom_tooltip = use_magic_custom_tooltip
		if = {
			limit = {
				scope:ptarget = {
					is_magic_protected = yes
				}
			}
			custom_tooltip = spell_may_be_countered
		}
		hidden_effect = {
			scope:actor = {
				send_interface_toast = {
					title = ev10.87.title
					left_icon = ROOT
					right_icon = scope:ptarget
					custom_tooltip = magic_target_confirmed_ct
				}
			}
			run_interaction = {
				interaction = firestorm_spell
				actor = ROOT
				recipient = scope:ptarget
				execute_threshold = accept
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 9
				opinion = {
					target = scope:actor
					value > 0
				}
			}
		}
	}
	option = {
		name = ev10.99.c
		trigger = {
			is_at_war = no
			is_ruler = yes
			exists = scope:war1
		}
		scope:actor = {
			send_interface_toast = {
				title = ev10.87.title
				if = {
					limit = {
						scope:war1 = {
							primary_attacker = scope:actor
						}
					}
					scope:war1 = {
						add_attacker = ROOT
					}
				}
				else = {
					scope:war1 = {
						add_defender = ROOT
					}
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev10.98.d
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				opinion = {
					target = scope:actor
					value < 0
				}
			}
		}
	}
	option = {
		name = ev10.95.d
		custom_tooltip = ev10.95.d_ct
		hidden_effect = {
			add_character_flag = {
				flag = archmage_busy_flag
				years = 5
			}
		}
		scope:actor = {
			add_opinion = {
				target = ROOT
				modifier = disrespect_opinion
				opinion = -20
			}
			hidden_effect = {
				send_interface_toast = {
					title = ev10.87.title
					custom_tooltip = sm_archmage_rejection_ct1
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
}

#God-emperor
magic_ev10.100 = {
	title = {
		first_valid = {
			triggered_desc = {
				trigger = {
					is_male = yes
				}
				desc = mage6m_nickname
			}
			desc = mage6f_nickname
		}
	}
	desc = ev10.100.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	cooldown = { years = 1000 }
	trigger = {
		highest_held_title_tier > tier_kingdom
		is_imprisoned = no
		any_held_title = {
			tier = tier_empire
			is_titular = no
		}
		OR = {
			is_powerful_being = yes
			has_focus = arcane_focus
		}
	}
	option = {
		name = ev10.100.a
		if = {
			limit = {
				is_male = yes
			}
			give_nickname = mage6m_nickname
		}
		else = {
			give_nickname = mage6f_nickname
		}
		add_prestige = major_prestige_gain
		if = {
			limit = {
				exists = dynasty
			}
			dynasty = {
				add_dynasty_prestige = excessive_dynasty_prestige_value
			}
		}
		stress_impact = {
			arrogant = massive_stress_loss
			humble = major_stress_gain
		}
	}
	option = {
		name = ev10.100.b
		stress_impact = {
			arrogant = major_stress_gain
			humble = massive_stress_loss
		}
		add_diplomacy_skill = 1
		add_piety = massive_piety_gain
	}
}
#magic epic - special project - golem5
magic_ev10.101 = {
	type = character_event
	title = trait_golem
	desc = ev10.101.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = scope:golem
	trigger = {
		is_alive = yes
		is_ai = no
		is_imprisoned = no
		any_courtier = {
			is_ai = yes
			THIS = scope:golem
			is_alive = yes
			is_imprisoned = no
			NOT = {
				has_trait = intellect_bad_3
			}
		}
	}
	
	option = {
		name = ev10.101.a
		scope:golem = {
			add_opinion = {
				target = ROOT
				modifier = refusal_opinion
				opinion = -20
			}
		}
	}
	option = {
		name = ev10.101.b
		scope:golem = {
			create_landless_adventurer_title_effect = {
				REASON = flag:wanderer
				FLAVOR_CHAR = THIS
			}
			#create_landless_adventurer_title_effect = {
			#	REASON = flag:voluntary
			#	FLAVOR_CHAR = ROOT
			#}
		}
	}
	option = {
		name = ev10.101.c
		add_internal_flag = special
		scope:golem = {
			create_landless_adventurer_title_effect = {
				REASON = flag:wanderer
				FLAVOR_CHAR = THIS
			}
			hidden_effect = {
				if = {
					limit = {
						is_witch_trigger = no
					}
					give_witch_secret_or_trait_effect = yes
				}
			}
		}
		set_player_character = scope:golem
	}
}
#Hezrou - stress loss for winning battle
magic_ev10.102 = {
	hidden = yes
	scope = combat_side
	trigger = {
		any_side_commander = {
			has_character_modifier = hezrou_modifier
		}
	}
	immediate = {
		every_side_commander = {
			limit = {
				has_character_modifier = hezrou_modifier
			}
			send_interface_toast = {
				title = hezrou_modifier
				left_icon = this
				add_stress = minor_stress_loss
			}
		}
	}
}
#ultimate spell ongoing - 4 - traitor selection
magic_ev10.103 = {
	hidden = yes
	trigger = {
		NOT = {
			has_character_modifier = mage_council_support_modifier
		}
		exists = scope:scheme
		scope:scheme = {
			NOT = {
				has_variable = ultimate_traitor
			}
			any_scheme_agent_slot = {
				is_filled = yes
				is_agent_slot_type = agent_spellweaver
				count > 1
			}
			any_scheme_agent_slot = {
				is_filled = yes
				is_agent_slot_type = agent_spellweaver
				slot_character = {
					OR = {
						has_trait = ambitious
						has_trait = deceitful
						has_trait = disloyal
						has_trait = greedy
						has_trait = fickle
						has_relation_rival = ROOT
						has_relation_nemesis = ROOT
						is_ai = no
					}
					ROOT = {
						NOT = {
							has_strong_hook = PREV
						}
					}
				}
			}
		}
	}
	immediate = {
		scope:scheme = {
			set_variable = ultimate_traitor
			random_scheme_agent_slot = {
				limit = {
					is_filled = yes
					is_agent_slot_type = agent_spellweaver
					slot_character = {
						OR = {
							has_trait = ambitious
							has_trait = deceitful
							has_trait = disloyal
							has_trait = greedy
							has_trait = fickle
							has_relation_rival = ROOT
							has_relation_nemesis = ROOT
						}
						ROOT = {
							NOT = {
								has_strong_hook = PREV
							}
						}
					}
				}
				slot_character = {
					trigger_event = {
						id = magic_ev10.104
						days = { 1 14 }
					}
				}
			}
		}
	}
}
#ultimate spell ongoing - 4. traitor
magic_ev10.104 = {
	type = character_event
	title = ultimate_spell_modifier
	desc = ev10.104.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = ROOT
		animation = interested
	}
	lower_left_portrait = scope:scheme.scheme_owner
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	cooldown = { years = 1 }
	trigger = {
		exists = scope:scheme
		scope:scheme.scheme_owner = {
			NOT = {
				has_strong_hook = ROOT
			}
		}
	}
	immediate = {
		scope:scheme.scheme_owner = {
			save_scope_as = sowner
		}
	}
	option = {
		name = ev10.104.0.a
		custom_tooltip = ev10.104.0.a_ct
		custom_tooltip = ev10.104.0.a_ct2
		stress_impact = {
			deceitful = medium_stress_loss
			ambitious = major_stress_loss
			arbitrary = minor_stress_loss
			honest = medium_stress_gain
			content = major_stress_gain
			just = minor_stress_gain
		}
		hidden_effect = {
			scope:scheme = {
				set_variable = {
					name = scheme_traitor
					value = ROOT
				}
			}
			scope:sowner = {
				trigger_event = magic_ev10.105
			}
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.104.0.b
		stress_impact = {
			deceitful = medium_stress_gain
			ambitious = major_stress_gain
			arbitrary = minor_stress_gain
			honest = medium_stress_loss
			content = major_stress_loss
			just = minor_stress_loss
		}
		ai_chance = {
			base = 0
			modifier = {
				add = 1
				has_trait = honest
			}
			modifier = {
				add = 1
				has_trait = just
			}
			modifier = {
				add = 1
				has_trait = content
			}
		}
	}
}
#ultimate spell ongoing - 4. traitor - info for owner
magic_ev10.105 = {
	type = character_event
	title = ev10.105.title
	desc = ev10.105.desc
	theme = intrigue
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}
	left_portrait = {
		character = ROOT
		animation = disapproval
	}
	lower_left_portrait = {
		trigger = {
			exists = scope:sw1
		}
		character = scope:sw1
	}
	lower_center_portrait = {
		trigger = {
			exists = scope:sw2
		}
		character = scope:sw2
	}
	lower_right_portrait = {
		trigger = {
			exists = scope:sw3
		}
		character = scope:sw3
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	immediate = {
		scope:scheme = {
			random_scheme_agent_slot = {
				limit = {
					is_filled = yes
					is_agent_slot_type = agent_spellweaver
				}
				slot_character = {
					save_scope_as = sw1
				}
			}
			random_scheme_agent_slot = {
				limit = {
					is_filled = yes
					is_agent_slot_type = agent_spellweaver
					trigger_if = {
						limit = {
							exists = scope:sw1
						}
						slot_character = { NOT = { THIS = scope:sw1 } }
					}
				}
				slot_character = {
					save_scope_as = sw2
				}
			}
			random_scheme_agent_slot = {
				limit = {
					is_filled = yes
					is_agent_slot_type = agent_spellweaver
					trigger_if = {
						limit = {
							exists = scope:sw1
						}
						slot_character = { NOT = { THIS = scope:sw1 } }
					}
					trigger_if = {
						limit = {
							exists = scope:sw2
						}
						slot_character = { NOT = { THIS = scope:sw2 } }
					}
				}
				slot_character = {
					save_scope_as = sw3
				}
			}
		}
	}
	option = {
		name = ev10.105.0.a
		trigger = {
			exists = scope:sw1
		}
		scope:sw1 = {
			forbid_from_scheme = scope:scheme
		}
	}
	option = {
		name = ev10.105.0.b
		trigger = {
			exists = scope:sw2
		}
		scope:sw2 = {
			forbid_from_scheme = scope:scheme
		}
	}
	option = {
		name = ev10.105.0.c
		trigger = {
			exists = scope:sw3
		}
		scope:sw3 = {
			forbid_from_scheme = scope:scheme
		}
	}
	option = {
		#name = ev10.105.0.a
		name = ev5.1.0.j	#I have to think about it carefully.
		add_stress = minor_stress_gain
	}
}

#ultimate spell ending - traitor - info for owner
magic_ev10.106 = {
	type = character_event
	title = ev10.105.title
	desc = ev10.106.desc
	theme = intrigue
	left_portrait = {
		character = ROOT
		animation = anger
	}
	right_portrait = {
		character = scope:straitor
		animation = personality_greedy
	}
	override_icon = {
		reference = "gfx/interface/icons/event_types/pure_magic.dds" 
	}
	immediate = {
		scope:scheme = {
			var:scheme_traitor = {
				save_scope_as = straitor
			}
		}
	}
	option = {
		name = ev10.106.0.a
		stress_impact = {
			forgiving = minor_stress_loss
			vengeful = medium_stress_gain
		}
	}
	option = {
		name = ev10.106.0.b
		stress_impact = {
			vengeful = medium_stress_loss
		}
		if = {
			limit = {
				NOR = {
					has_relation_rival = scope:straitor
					has_relation_nemesis = scope:straitor
				}
			}
			set_relation_rival = scope:straitor
		}
		else_if = {
			limit = {
				has_relation_rival = scope:straitor
			}
			set_relation_nemesis = scope:straitor
		}
		hidden_effect = {
			add_opinion = {
				target = scope:straitor
				modifier = hate_opinion
				opinion = -200
			}
		}
	}
	after = {
		show_as_tooltip = {
			scope:scheme = {
				end_scheme = yes
			}
		}
		hidden_effect = {
			scope:scheme = {
				scope:straitor = {
					trigger_event = magic_ev7.129
				}
			}
		}
	}
}
#Demonic Rage - 4.
magic_ev10.107 = {
	title = demonic_rage_perk_name
	desc = ev10.107.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = personality_callous
	}
	lower_center_portrait = scope:vic1
	lower_right_portrait = scope:vic2
	trigger = {
		exists = location
		location = {
			is_sea_province = no
			exists = province_owner
		}
	}
	immediate = {
		hidden_effect = {
			save_scope_as = demon
			if = {
				limit = {
					is_landed_or_landless_administrative = yes
					is_travelling = no
				}
				if = {
					limit = {
						exists = liege
						NOT = { ROOT = liege }
					}
					save_scope_as = truler
				}
				else_if = {
					limit = {
						any_vassal = {
							any_courtier = {
								is_powerful_being = no
								count > 2
							}
						}
					}
					random_vassal = {
						limit = {
							any_courtier = {
								is_powerful_being = no
								count > 2
							}
						}
						save_scope_as = truler
					}
				}
				else = {
					random_neighboring_and_across_water_top_liege_realm_owner = {
						limit = {
							any_courtier = {
								is_powerful_being = no
								count > 2
							}
						}
						save_scope_as = truler
					}
				}
			}
			else = {
				location = {
					province_owner = {
						if = {
							limit = {
								exists = top_liege
								NOT = { top_liege = ROOT }
								top_liege = {
									any_courtier = {
										is_powerful_being = no
										count > 2
									}
								}
							}
							top_liege = {
								save_scope_as = truler
							}
						}
						else_if = {
							limit = {
								NOT = { top_liege = ROOT }
								any_courtier = {
									is_powerful_being = no
									count > 2
								}
							}
							save_scope_as = truler
						}
						else = {
							random_ruler = {
								limit = {
									in_diplomatic_range = ROOT
									NOT = { THIS = ROOT }
									any_courtier = {
										is_powerful_being = no
										count > 2
									}
								}
								save_scope_as = truler
							}
						}
					}
				}
			}
			scope:truler = {
				random_courtier = {
					limit = {
						is_powerful_being = no
						NOT = { THIS = ROOT }
					}
					save_scope_as = vic1
				}
				random_courtier = {
					limit = {
						is_powerful_being = no
						NOT = { THIS = scope:vic1 }
						NOT = { THIS = ROOT }
					}
					save_scope_as = vic2
				}
			}
		}
		scope:vic1 = {
			death = {
				death_reason = death_murder
				killer = ROOT
			}
		}
		add_secret = {
			type = secret_murder
			target = scope:vic1
		}
		scope:vic2 = {
			death = {
				death_reason = death_murder
				killer = ROOT
			}
		}
		add_secret = {
			type = secret_murder
			target = scope:vic2
		}
		add_stress = major_stress_loss
	}
	option = {
		name = ev10.107.a
		hidden_effect = {
			if = {
				limit = {
					NOT = { ROOT = scope:truler }
				}
				scope:truler = {
					trigger_event = magic_ev10.108
				}
			}
		}
	}
}
#Demonic Rage - 4. - info for the ruler
magic_ev10.108 = {
	title = ev2.32.title
	desc = ev10.108.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = interested
	}
	lower_center_portrait = scope:vic1
	lower_right_portrait = scope:vic2
	immediate = {
		show_as_tooltip = {
			scope:vic1 = {
				death = {
					death_reason = death_murder
				}
			}
			scope:vic2 = {
				death = {
					death_reason = death_murder
				}
			}
		}
	}
	option = {
		name = ev10.108.a
		trigger = {
			NOR = {
				is_true_mage = yes
				has_trait = true_witch
			}
		}
		stress_impact = {
			compassionate = medium_stress_gain
		}
	}
	option = {
		name = ev10.108.b
		trigger = {
			OR = {
				is_true_mage = yes
				has_trait = true_witch
			}
		}
	}
}
#Harmonius 1.
magic_ev10.109 = {
	title = harmonius_name
	desc = ev10.109.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = interested
	}
	right_portrait = {
		character = scope:demon
		animation = personality_honorable
	}
	option = {
		name = ev10.109.a
		trigger_event = magic_ev10.110
	}
}
#Harmonius 2.
magic_ev10.110 = {
	title = harmonius_name
	desc = ev10.110.desc
	theme = witchcraft
	left_portrait = {
		character = ROOT
		animation = thinking
	}
	right_portrait = {
		character = scope:demon
		#animation = ecstasy
		animation = admiration
	}
	option = {
		name = ev10.110.a
		trigger_event = magic_ev10.111
	}
	option = {
		name = ev10.110.b
		add_character_flag = {
			flag = harmonius_must_serve_me
			days = 12
		}
		trigger_event = magic_ev10.111
	}
}
#Harmonius 3.
magic_ev10.111 = {
	title = harmonius_name
	desc = {
		triggered_desc = {
			trigger = {
				has_character_flag = harmonius_must_serve_me
			}
			desc = ev10.111.desc0
		}
		desc = ev10.111.desc
	}
	theme = dread
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = {
		character = scope:demon
		#animation = personality_honorable
		animation = dancing
	}
	immediate = {
		play_music_cue = "mx_magic_harmonius_call_01"
	}
	option = {
		name = ev10.111.a
		trigger = {
			NOR = {
				has_trait = demon1
				has_trait = demon2
				has_trait = eccentric
				has_trait = sadistic
				has_trait = lunatic_1
				has_trait = lunatic_genetic
				has_trait = torturer
			}
		}
		add_stress = medium_stress_gain
	}
	option = {
		name = ep3_laamp_decision_event.1136.a	#Amazing!
		trigger = {
			OR = {
				has_trait = demon1
				has_trait = demon2
				has_trait = eccentric
				has_trait = sadistic
				has_trait = lunatic_1
				has_trait = lunatic_genetic
				has_trait = torturer
			}
		}
	}
	after = {
		trigger_event = magic_ev10.112
	}
}
#Harmonius 4.
magic_ev10.112 = {
	title = harmonius_name
	desc = ev10.112.desc
	theme = dread
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = {
		character = scope:demon
		#animation = personality_honorable
		animation = admiration
	}
	option = {
		name = ev10.112.a
	}
	option = {
		name = ev10.112.b
		trigger = {
			OR = {
				has_trait = callous
				has_trait = eccentric
				has_trait = torturer
			}
		}
	}
	option = {
		name = ev10.112.c
		trigger = {
			OR = {
				has_trait = lunatic_1
				has_trait = lunatic_genetic
				has_trait = sadistic
				has_trait = demon1
				has_trait = demon2
			}
		}
	}
	after = {
		trigger_event = magic_ev10.113
	}
}
#Harmonius 5.
magic_ev10.113 = {
	title = harmonius_name
	desc = ev10.113.desc
	theme = dread
	left_portrait = {
		character = ROOT
	}
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	immediate = {
		hidden_effect = {
			random_relation = {
				type = nemesis
				limit = {
					is_ai = yes
					is_imprisoned = no
				}
				save_scope_as = riv
			}
			if = {
				limit = {
					NOT = {
						exists = scope:riv
					}
				}
				random_relation = {
					type = rival
					limit = {
						is_ai = yes
						is_imprisoned = no
					}
					save_scope_as = riv
				}
			}
		}
	}
	option = {
		name = ev10.113.a
		trigger_event = magic_ev.18
	}
	option = {
		name = ev10.113.b
		trigger = {
			OR = {
				has_trait = lunatic_1
				has_trait = lunatic_genetic
				has_trait = sadistic
			}
			highest_held_title_tier >= tier_kingdom
			NOT = { government_has_flag = government_is_landless_adventurer }
			has_ep1_court_positions_dlc_trigger = yes
		}
		stress_impact = {
			lunatic_1 = medium_stress_loss
			lunatic_genetic = medium_stress_loss
			sadistic = medium_stress_loss
		}
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		add_courtier = scope:demon
		if = {
			limit = {
				NOT = { employs_court_position = court_musician_court_position }
			}
			appoint_court_position = {
				recipient = scope:demon
				court_position = court_musician_court_position
			}
		}
		else_if = {
			limit = {
				employs_court_position = court_musician_court_position
			}
			replace_court_position = {
				recipient = scope:demon
				holder = court_position:court_musician_court_position
				court_position = court_musician_court_position
			}
		}
	}
	option = {
		name = ev10.113.c
		trigger = {
			exists = scope:riv
		}
		custom_tooltip = ev10.113.c_ct
		if = {
			limit = {
				scope:riv = {
					is_ruler = yes
				}
			}
			scope:riv = {
				add_courtier = scope:demon
			}
		}
		else = {
			hidden_effect = {
				scope:demon = {
					move_to_pool = yes
				}
			}
		}
		trigger_event = {
			id = magic_ev10.114
			days = 3
		}
	}
	option = {
		name = ev10.113.d
		trigger = {
			OR = {
				has_trait = demon1
				has_trait = demon2
				has_trait = eccentric
			}
		}
		stress_impact = {
			eccentric = medium_stress_loss
		}
		hidden_effect = {
			scope:demon = {
				move_to_pool = yes
			}
		}
		add_courtier = scope:demon
	}
}
#Harmonius ends (your rival writes the letter)
magic_ev10.114 = {
	type = letter_event
	opening = ev10.114.opening
	desc = ev10.114.desc
	sender = scope:riv
	trigger = {
		scope:riv = {
			is_alive = yes
		}
	}
	immediate = {
		scope:riv = {
			add_stress = major_stress_gain
		}
	}
	option = {
		name = ev10.114.a
		stress_impact = {
			vengeful = massive_stress_loss
		}
	}
}
#demoooons
magic_ev10.115 = {
	hidden = yes
	trigger = {
		is_a_demon_trigger = yes
		is_ai = yes
		is_alive = yes
		NOT = {
			has_character_flag = special_magic_character
		}
		NOT = {
			has_trait = compassionate
		}
	}
	immediate = {
		if = {
			limit = {
				is_imprisoned = yes
				has_perk = demonic_rage_perk
			}
			trigger_event = magic_ev10.21
		}
		else_if = {
			limit = {
				is_imprisoned = no
			}
			random_list = {
				2 = {
					trigger = {
						exists = location
						location = {
							is_sea_province = no
							exists = province_owner
						}
					}
					trigger_event = {
						id = magic_ev10.107
					}
				}
				2 = {
					trigger = {
						exists = location
					}
					scope:demon1 = {
						add_stress = major_stress_loss
					}
					location = {
						random_character_in_location = {
							limit = {
								is_powerful_being = no
								is_ai = yes
								is_adult = yes
							}
							death = {
								death_reason = death_murder
								killer = ROOT
							}
							ROOT = {
								add_secret = {
									type = secret_murder
									target = PREV
								}
							}
						}
					}
				}
				2 = {
					trigger = {
						exists = location
						exists = location.province_owner
						location.province_owner = {
							is_powerful_being = no
						}
						exists = location.county
						location.county = {
							development_level > 0
						}
					}
					scope:demon1 = {
						add_stress = major_stress_loss
					}
					location.county = {
						save_scope_as = tprov
					}
					location.province_owner = {
						trigger_event = magic_ev10.116
					}
				}
				2 = {
					trigger = {
						exists = liege
						NOT = {
							ROOT = liege
						}
						is_ruler = yes
						OR = {
							has_trait = callous
							has_trait = sadistic
							has_trait = torturer
							has_trait = wrathful
							has_trait = irritable
							has_trait = eccentric
						}
					}
					scope:demon1 = {
						add_stress = major_stress_loss
					}
					liege = {
						trigger_event = magic_ev10.118
					}
				}
				2 = {
					trigger = {
						exists = liege
						NOT = {
							ROOT = liege
						}
						is_ruler = no
						is_courtier = yes
					}
					scope:demon1 = {
						add_stress = major_stress_loss
					}
					liege = {
						trigger_event = magic_ev10.119
					}
				}
				1 = {
					trigger = {
						exists = liege
						NOT = {
							ROOT = liege
						}
						is_ruler = no
						is_courtier = yes
						has_perk = depravity_perk
					}
					scope:demon1 = {
						add_stress = major_stress_loss
					}
					liege = {
						random_courtier_or_guest = {
							limit = {
								is_powerful_being = no
								is_antimagic_trigger = no
								is_or_will_be_a_demon_trigger = no
								NOT = { has_trait = corrupted }
								is_adult = yes
							}
							add_trait = corrupted
							save_scope_as = corcourt
							if = {
								limit = {
									is_witch_trigger = no
								}
								random = {
									chance = 50
									give_witch_secret_or_trait_effect = yes
								}
							}
						}
					}
					if = {
						limit = {
							exists = scope:corcourt
						}
						add_hook = {
							type = loyalty_hook
							target = scope:corcourt
						}
					}
				}
				1 = {
					trigger = {
						exists = liege
						NOT = {
							ROOT = liege
						}
						liege = {
							is_a_demon_trigger = no
						}
						has_trait = loyal
					}
					remove_trait = loyal
					add_trait = disloyal
				}
				1 = {

				}
			}
		}
		
	}
}
#demon destroy villige
magic_ev10.116 = {
	title = ev10.116.title
	desc = ev10.116.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	cooldown = {
		years = 2
	}
	immediate = {
		scope:tprov = {
			change_development_progress = medium_development_progress_loss
		}
		if = {
			limit = { is_valid_for_legitimacy_change = yes }
			add_legitimacy = minor_legitimacy_loss
		}
		else = {
			add_prestige = -100
		}
	}
	option = {
		name = ev10.83.c
		trigger = {
			NOR = {
				has_trait = true_witch
				is_true_mage = yes
			}
		}
		stress_impact = {
			craven = medium_stress_gain
			paranoid = minor_stress_gain
		}
	}
	option = {
		name = ev10.116.a
		trigger = {
			has_trait = zealous
		}
		add_piety = minor_piety_gain
	}
	option = {
		name = ev10.116.b
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
			}
			NOT = {
				any_character_artifact = {
					has_variable = magic_orb
				}
			}
		}
	}
	option = {
		name = ev10.116.c
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
			}
			any_character_artifact = {
				has_variable = magic_orb
			}
		}
		trigger_event = magic_ev10.117
	}
}
#demon destroy villige 2. (the orb)
magic_ev10.117 = {
	title = ev10.116.title
	desc = ev10.117.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	lower_right_portrait = scope:demon1
	option = {
		name = ev10.117.a
		stress_impact = {
			craven = minor_stress_gain
		}
		hidden_effect = {
			add_opinion = {
				target = scope:demon1
				modifier = murdered_my_vassal_crime
			}
		}
	}
}
#demonic vassal
magic_ev10.118 = {
	title = ev10.118.title
	desc = ev10.118.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	lower_right_portrait = scope:demon1
	cooldown = {
		years = 4
	}
	trigger = {
		exists = scope:demon1
		scope:demon1 = {
			OR = {
				has_trait = callous
				has_trait = sadistic
				has_trait = torturer
				has_trait = wrathful
				has_trait = irritable
				has_trait = eccentric
			}
		}
		any_vassal = {
			THIS = scope:demon1
		}
	}
	immediate = {
		scope:demon1 = {
			add_dread = medium_dread_gain
		}
	}
	option = {
		name = ev10.118.a
		trigger = {
			NOR = {
				has_trait = true_witch
				is_true_mage = yes
			}
		}
		stress_impact = {
			craven = minor_stress_gain
			sadistic = minor_stress_loss
		}
		hidden_effect = {
			add_opinion = {
				target = scope:demon1
				modifier = suspicion_opinion
				opinion = -40
			}
		}
	}
	option = {
		name = ev10.118.b
		trigger = {
			NOR = {
				has_trait = true_witch
				is_true_mage = yes
			}
		}
	}
}
#demonic courtier
magic_ev10.119 = {
	title = ev10.119.title
	desc = ev10.119.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	lower_right_portrait = scope:demon1
	cooldown = {
		years = 2
	}
	trigger = {
		is_ai = no
		exists = scope:demon1
		scope:demon1 = {
			is_courtier_of = ROOT
		}
	}
	option = {
		name = ev10.119.a
		if = {
			limit = {
				scope:demon1 = {
					NOT = {
						has_trait = murderer
					}
				}
			}
			scope:demon1 = {
				add_trait = murderer
			}
		}
		duel = {
			skill = intrigue
			target = scope:demon1
			5 = {
				desc = ev10.119.a1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				send_interface_toast = {
					title=ev10.119.a1
					imprison = {
						target = scope:demon1
						type = dungeon
					}
				}
			}
			5 = {
				desc = ev10.119.a2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title=ev10.119.a2
				}
				hidden_effect = {
					scope:demon1 = {
						move_to_pool = yes
					}
				}
			}
		}
		stress_impact = {
			just = major_stress_loss
			arbitrary = medium_stress_gain
		}
	}
	option = {
		name = ev10.119.b
		if = {
			limit = { is_valid_for_legitimacy_change = yes }
			add_legitimacy = medium_legitimacy_loss
		}
		else = {
			add_prestige = -100
		}
		stress_impact = {
			sadistic = medium_stress_loss
			just = major_stress_gain
			arbitrary = medium_stress_loss
		}
	}
	option = {
		name = ev10.84.b
		trigger = {
			is_true_mage = yes
			scope:demon1 = {
				is_powerful_being = yes
			}
		}
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon1
		}
		stress_impact = {
			brave = medium_stress_loss
			craven = massive_stress_gain
			just = medium_stress_loss
		}
	}
}
#Bael runs
magic_ev10.120 = {
	hidden = yes
	trigger = {
		is_alive = yes
		is_ai = no
		is_imprisoned = no
		is_true_mage = yes
		NOT = {
			has_trait = incapable
		}
	}
	immediate = {
		random_ruler = {
			limit = {
				is_ai = yes
				highest_held_title_tier > tier_kingdom
				NOT = {
					government_has_flag = government_is_administrative
				}
				is_landed = yes
				is_independent_ruler = yes
				any_vassal = {
					is_powerful_vassal = yes
					is_powerful_being = no
					is_ai = yes
					highest_held_title_tier >= tier_county
					count > 1
				}
				trigger_if = {
					limit = {
						exists = faith.religious_head
					}
					NOT = {
						THIS = faith.religious_head
					}
				}
			}
			save_scope_as = target_ruler
		}
		if = {
			limit = {
				NOT = {
					exists = scope:target_ruler
				}
			}
			random_ruler = {
				limit = {
					is_ai = yes
					highest_held_title_tier >= tier_kingdom
					NOT = {
						government_has_flag = government_is_administrative
					}
					is_landed = yes
					is_independent_ruler = yes
					any_vassal = {
						is_powerful_vassal = yes
						is_powerful_being = no
						is_ai = yes
						highest_held_title_tier >= tier_county
						count > 1
					}
					trigger_if = {
						limit = {
							exists = faith.religious_head
						}
						NOT = {
							THIS = faith.religious_head
						}
					}
				}
				save_scope_as = target_ruler
			}
		}
		if = {
			limit = {
				NOT = {
					exists = scope:target_ruler
				}
			}
			random_ruler = {
				limit = {
					is_ai = yes
					highest_held_title_tier >= tier_kingdom
					NOT = {
						government_has_flag = government_is_administrative
					}
					is_landed = yes
					is_independent_ruler = yes
					any_vassal = {
						is_powerful_vassal = yes
						is_powerful_being = no
						is_ai = yes
						highest_held_title_tier >= tier_county
						count > 1
					}
				}
				save_scope_as = target_ruler
			}
		}
		
		if = {
			limit = {
				exists = scope:target_ruler
			}
			add_character_flag = bael_target
			if = {
				limit = {
					any_living_character = {
						has_character_flag = mammon
					}
				}
				random_living_character = {
					limit = {
						has_character_flag = mammon
					}
					death = {
						death_reason = death_mysterious
						killer = scope:target_ruler
					}
				}
			}
			if = {
				limit = {
					any_living_character = {
						has_character_flag = abraxas
					}
				}
				random_living_character = {
					limit = {
						has_character_flag = abraxas
					}
					death = {
						death_reason = death_mysterious
						killer = scope:target_ruler
					}
				}
			}
			if = {
				limit = {
					any_living_character = {
						has_character_flag = astaroth_flag
					}
				}
				random_living_character = {
					limit = {
						has_character_flag = astaroth_flag
					}
					if = {
						limit = {
							any_character_artifact = {
								has_artifact_modifier = artifact_ring_of_dead_modifier
							}
						}
						random_character_artifact = {
							limit = {
								has_artifact_modifier = artifact_ring_of_dead_modifier
							}
							destroy_artifact = THIS
						}
					}
					death = {
						death_reason = death_mysterious
						killer = scope:target_ruler
					}
				}
			}
			scope:target_ruler = {
				create_bael_effect = yes
				set_global_variable = bael_came_global
				create_title_and_vassal_change = {
					type = conquest
					save_scope_as = title_change
					add_claim_on_loss = yes
				}
				every_held_title = {
					limit = {
						is_titular = no
						is_leased_out = no
						is_head_of_faith = no
						tier >= tier_county
					}
					change_title_holder_include_vassals = {
						holder = scope:bael
						change = scope:title_change
					}
				}
				resolve_title_and_vassal_change = scope:title_change
				death = {
					death_reason = death_cloven_in_half
					killer = scope:bael
				}
			}
			scope:bael = {
				if = {
					limit = {
						any_artifact = {
							has_variable = magic_scepter
						}
					}
					random_artifact = {
						limit = {
							has_variable = magic_scepter
						}
						save_scope_as = hscepter
					}
					add_personal_artifact_claim = scope:hscepter
				}
				random_vassal = {
					limit = {
						is_powerful_vassal = yes
						is_powerful_being = no
						is_ai = yes
						highest_held_title_tier >= tier_county
					}
					save_scope_as = tvassal1
				}
				scope:tvassal1 = {
					create_abraxas_effect = yes
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change2
						add_claim_on_loss = yes
					}
					every_held_title = {
						limit = {
							is_titular = no
							is_leased_out = no
							is_head_of_faith = no
							tier >= tier_county
						}
						change_title_holder_include_vassals = {
							holder = scope:abraxas
							change = scope:title_change2
						}
					}
					resolve_title_and_vassal_change = scope:title_change2
					death = {
						death_reason = death_cloven_in_half
						killer = scope:abraxas
					}
					scope:abraxas = {
						create_title_and_vassal_change = {
							type = granted
							save_scope_as = title_change3
							add_claim_on_loss = no
						}
						change_liege = {
							liege = scope:bael
							change = scope:title_change3
						}
						resolve_title_and_vassal_change = scope:title_change3
						set_variable = {
							name = di_supports
							value = scope:bael
						}
					}
				}
				assign_councillor_type = {
					type = councillor_spymaster
					target = scope:abraxas
					remove_existing_councillor = yes
				}
				#add_hook = {
				#	type = loyalty_hook
				#	target = scope:abraxas
				#}
				if = {
					limit = {
						any_court_position_holder = {
							type = mage_court_position
						}
					}
					revoke_court_position = {
						court_position = mage_court_position
					}
				}
				appoint_court_position = {
					recipient = scope:abraxas
					court_position = mage_court_position
				}
				random_vassal = {
					limit = {
						is_powerful_vassal = yes
						is_powerful_being = no
						is_ai = yes
						highest_held_title_tier >= tier_county
					}
					save_scope_as = tvassal2
				}
				scope:tvassal2 = {
					create_mammon_effect = yes
					create_title_and_vassal_change = {
						type = granted
						save_scope_as = title_change4
						add_claim_on_loss = yes
					}
					every_held_title = {
						limit = {
							is_titular = no
							is_leased_out = no
							is_head_of_faith = no
							tier >= tier_county
						}
						change_title_holder_include_vassals = {
							holder = scope:mammon
							change = scope:title_change4
						}
					}
					resolve_title_and_vassal_change = scope:title_change4
					death = {
						death_reason = death_cloven_in_half
						killer = scope:mammon
					}
					scope:mammon = {
						create_title_and_vassal_change = {
							type = granted
							save_scope_as = title_change5
							add_claim_on_loss = no
						}
						change_liege = {
							liege = scope:bael
							change = scope:title_change5
						}
						resolve_title_and_vassal_change = scope:title_change5
						set_variable = {
							name = di_supports
							value = scope:bael
						}
						if = {
							limit = {
								has_trait = gallivanter
							}
							remove_trait = gallivanter
						}
					}
				}
				assign_councillor_type = {
					type = councillor_steward
					target = scope:mammon
					remove_existing_councillor = yes
				}
				#add_hook = {
				#	type = loyalty_hook
				#	target = scope:mammon
				#}
				add_character_modifier = {
					modifier = di_mammon_support_modifier
				}
				add_character_modifier = {
					modifier = di_abraxas_support_modifier
				}
				add_character_modifier = {
					modifier = di_astaroth_support_modifier
				}
				every_courtier = {
					scope:bael = {
						add_hook = {
							type = loyalty_hook
							target = PREV
						}
					}
				}
				every_vassal = {
					scope:bael = {
						add_hook = {
							type = loyalty_hook
							target = PREV
						}
					}
				}
				spawn_army = {
					men_at_arms = {
						type = demonic_knights
						stacks = 20
					}
					location = scope:bael.capital_province
					name = demonic_knights
					inheritable = no
					uses_supply = no
				}
				every_character_war = {
					limit = {
						primary_attacker = scope:bael
						primary_defender = { is_ai = yes }
					}
					end_war = attacker
				}
				every_character_war = {
					limit = {
						primary_defender = scope:bael
						primary_attacker = { is_ai = yes }
					}
					end_war = defender
				}
				every_neighboring_and_across_water_top_liege_realm_owner = {
					if = {
						limit = {
							exists = primary_title
							primary_title = {
								is_titular = no
							}
						}
						scope:bael = {
							add_pressed_claim = prev.primary_title
						}
					}
				}
				trigger_event = {
					id = magic_ev10.166
					months = 6
				}
				create_story = story_conqueror
			}
		}
		every_ruler = {
			limit = {
				is_ai = no
			}
			trigger_event = magic_ev10.121
		}
		trigger_event = {
			id = magic_ev10.122
			days = 7
		}
	}
}
#Bael info
magic_ev10.121 = {
	type = character_event
	window = fullscreen_event
	title = ev10.121.title
	desc = ev10.121.desc
	theme = plague
	#theme = legend
	override_background = { reference = bael_arrives }
	immediate = {
		play_music_cue = apocalyptic_plague
		#play_music_cue = mx_cue_legend
		scope:bael = {
			primary_title = {
				save_scope_as = evil_seed
			}
		}
	}
	option = {
		name = ev10.121.a
	}
}

#hecate warning
magic_ev10.122 = {
	title = hecate_name
	desc = ev10.122.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = scope:demon
	
	trigger = {
		is_ai = no
		is_imprisoned = no
		any_living_character = {
			has_character_flag = bael_flag
		}
		#OR = {
		#	has_character_flag = ms_met_hecate
		#	has_character_flag = ms_met_hecate2
		#}
	}
	immediate = {
		hidden_effect_new_object = {
			create_character = {
				name = hecate_name
				gender = female
				employer = ROOT
				template = hecate_demon_character
				save_scope_as = demon
				after_creation = {
					add_character_flag = {
						flag = just_summoned_demon_flag
						days = 7
					}
					set_sexuality = bisexual
					add_character_flag = hecate
					add_character_flag = special_magic_character
					give_witch_secret_or_trait_effect2 = yes
					add_character_modifier = master_magic_modifier
					add_character_modifier = whisperer_modifier
					turn_into_greater_demon = yes
					add_trait_xp = {
						trait = demon2
						track = hell_powers
						value = 90
					}
					add_trait_xp = {
						trait = demon2
						track = demon_reputation
						value = 90
					}
					turn_into_mage_effect = yes
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = 85
					}
					add_trait_xp = {
						trait = archmage
						track = secret_knowledge
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = combat_magic
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = alchemy
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = demonology
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = power_saturation
						value = 100
					}
					save_or_load_demon_visual_effect = yes
				}
			}
		}
	}
	option = {
		name = ev10.122.a
		trigger_event = magic_ev10.123
	}
}

#hecate warning 2.
magic_ev10.123 = {
	title = hecate_name
	desc = ev10.123.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	option = {
		name = ev10.123.a
		trigger_event = magic_ev10.124
	}
}
#hecate warning 3.
magic_ev10.124 = {
	title = hecate_name
	desc = ev10.124.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	right_portrait = scope:demon
	option = {
		name = ev10.124.a
		trigger_event = magic_ev10.125
	}
	option = {
		name = ev10.124.b
		trigger_event = magic_ev10.125
	}
}
#hecate warning 4.
magic_ev10.125 = {
	title = hecate_name
	desc = ev10.125.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	option = {
		name = ev10.125.a
		trigger_event = magic_ev10.126
	}
}
#hecate warning 5.
magic_ev10.126 = {
	title = ev10.126.title
	desc = ev10.126.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	lower_center_portrait = scope:bael
	option = {
		name = ev10.126.a
		trigger_event = magic_ev10.127
	}
	option = {
		name = ev10.126.b
		trigger_event = magic_ev10.128
	}
	option = {
		name = ev10.126.c
		trigger_event = magic_ev10.129
	}
}
#hecate warning - about Mammon
magic_ev10.127 = {
	title = ev10.126.title
	desc = ev10.127.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	immediate = {
		hidden_effect = {
			add_character_flag = {
				flag = knows_mammon_desc_flag
				months = 6
			}
		}
	}
	option = {
		name = ev10.126.b
		trigger = {
			NOT = {
				has_character_flag = knows_abraxas_desc_flag
			}
		}
		trigger_event = magic_ev10.128
	}
	option = {
		name = ev10.126.c
		trigger = {
			NOT = {
				has_character_flag = knows_astaroth_desc_flag
			}
		}
		trigger_event = magic_ev10.129
	}
	option = {
		name = ev10.127.a
		trigger_event = magic_ev10.132
	}
}
#hecate warning - about Abraxas
magic_ev10.128 = {
	title = ev10.126.title
	desc = ev10.128.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	immediate = {
		hidden_effect = {
			add_character_flag = {
				flag = knows_abraxas_desc_flag
				months = 6
			}
		}
	}
	option = {
		name = ev10.126.a
		trigger = {
			NOT = {
				has_character_flag = knows_mammon_desc_flag
			}
		}
		trigger_event = magic_ev10.127
	}
	option = {
		name = ev10.126.c
		trigger = {
			NOT = {
				has_character_flag = knows_astaroth_desc_flag
			}
		}
		trigger_event = magic_ev10.129
	}
	option = {
		name = ev10.127.a
		trigger_event = magic_ev10.132
	}
}
#hecate warning - about Astaroth
magic_ev10.129 = {
	title = ev10.126.title
	desc = ev10.129.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	immediate = {
		hidden_effect = {
			add_character_flag = {
				flag = knows_astaroth_desc_flag
				months = 6
			}
		}
	}
	option = {
		name = ev10.129.a
		trigger_event = magic_ev10.130
	}
}
#hecate warning - about Astaroth 2.
magic_ev10.130 = {
	title = ev10.126.title
	desc = ev10.130.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = personality_rational
	}
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	option = {
		name = ev10.130.a
		trigger_event = magic_ev10.131
	}
}
#hecate warning - about Astaroth 3.
magic_ev10.131 = {
	title = ev10.126.title
	desc = ev10.131.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = interested
	}
	right_portrait = scope:demon
	option = {
		name = ev10.126.a
		trigger = {
			NOT = {
				has_character_flag = knows_mammon_desc_flag
			}
		}
		trigger_event = magic_ev10.127
	}
	option = {
		name = ev10.126.b
		trigger = {
			NOT = {
				has_character_flag = knows_abraxas_desc_flag
			}
		}
		trigger_event = magic_ev10.128
	}
	option = {
		name = ev10.127.a
		trigger_event = magic_ev10.132
	}
}
#hecate warning - ends
magic_ev10.132 = {
	title = ev10.126.title
	desc = ev10.132.desc
	theme = realm
	left_portrait = {
		character = ROOT
	}
	right_portrait = scope:demon
	option = {
		name = ev10.132.a
		stress_impact = {
			cynical = minor_stress_loss
			craven = minor_stress_gain
		}
	}
	after = {
		hidden_effect = {
			scope:demon = {
				death = natural
			}
		}
	}
}

#loremaster/archmage nikcname
magic_ev10.133 = {
	hidden = yes
	trigger = {
		is_alive = yes
		OR = {
			has_character_modifier = mc_loremaster_modifier
			has_character_modifier = mc_archmage_modifier
		}
		NOT = {
			has_trait = incapable
		}
	}
	immediate = {
		if = {
			limit = {
				has_character_modifier = mc_loremaster_modifier
				NOT = {
					any_living_character = {
						has_nickname = mage3_nickname
					}
				}
			}
			if = {
				limit = {
					NOR = {
						has_nickname = mage2_nickname
						has_nickname = mage3_nickname
						has_nickname = archmage_nickname
						has_nickname = mage4m_nickname
						has_nickname = mage5m_nickname
						has_nickname = mage6m_nickname
						has_nickname = mage4f_nickname
						has_nickname = mage5f_nickname
						has_nickname = mage6f_nickname
						has_nickname = demonslayer_nickname
						has_nickname = horned_nickname
					}
				}
				give_nickname = mage3_nickname
			}
		}
		else_if = {
			limit = {
				has_character_modifier = mc_archmage_modifier
				NOT = {
					any_living_character = {
						has_nickname = archmage_nickname
					}
				}
			}
			if = {
				limit = {
					NOR = {
						has_nickname = mage2_nickname
						has_nickname = archmage_nickname
						has_nickname = mage4m_nickname
						has_nickname = mage5m_nickname
						has_nickname = mage6m_nickname
						has_nickname = mage4f_nickname
						has_nickname = mage5f_nickname
						has_nickname = mage6f_nickname
						has_nickname = demonslayer_nickname
						has_nickname = horned_nickname
					}
				}
				if = {
					limit = {
						is_male = yes
					}
					give_nickname = archmage_nickname
				}
				else = {
					give_nickname = mage5f_nickname
				}
			}
		}
	}
}
#Astaroth (apocalypse)
magic_ev10.134 = {
	title = astaroth_name
	desc = ev10.134.desc
	theme = realm
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = ROOT
		animation = shock
	}
	right_portrait = {
		character = scope:asta
		#animation = personality_callous
		animation = personality_bold
		outfit_tags = { western_stealth_hood }
	}
	trigger = {
		is_alive = yes
		is_ai = no
		is_imprisoned = no
		is_true_mage = yes
		any_living_character = {
			has_character_flag = bael_flag
		}
	}
	immediate = {
		di_astaroth_setup = yes
		stress_impact = {
			craven = major_stress_gain
		}
	}
	option = {
		name = ev10.134.a
	}
	option = {
		name = ev10.134.b
	}
	after = {
		trigger_event = magic_ev10.135
	}
}
#Astaroth 2.
magic_ev10.135 = {
	title = astaroth_name
	desc = ev10.135.desc
	theme = realm
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = ROOT
		triggered_animation = {
			trigger = {
				is_the_choosen_one_trigger = no
			}
			animation = fear
		}
	}
	right_portrait = {
		character = scope:asta
		#animation = personality_bold
		animation = menacing
		outfit_tags = { western_stealth_hood }
	}
	immediate = {
		if = {
			limit = {
				NOR = {
					has_trait = wounded_1
					has_trait = wounded_2
					has_trait = wounded_3
				}
			}
			add_trait = wounded_1
		}
	}
	option = {
		name = ev5.28.0.z4	#No...!
		death = {
			death_reason = death_murder
			killer = scope:asta
		}
	}
	option = {
		name = ev10.135.a
		trigger = {
			is_the_choosen_one_trigger = yes
		}
		custom_tooltip = ev10.135.a_ct
		hidden_effect = {
			scope:asta = {
				remove_character_modifier = antimagic_seal_modifier
			}
		}
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:asta
		}
	}
	option = {
		name = ev10.135.b
		trigger = {
			OR = {
				has_trait = shrewd
				has_trait = intellect_good_1
				has_trait = intellect_good_2
				has_trait = intellect_good_3
			}
		}
		trigger_event = magic_ev10.136
	}
}
#Astaroth 3.
magic_ev10.136 = {
	title = astaroth_name
	desc = ev10.136.desc
	theme = realm
	override_background = {
		reference = bedchamber
	}
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	right_portrait = {
		character = scope:asta
		animation = shock
		outfit_tags = { western_stealth_hood }
	}
	
	option = {
		name = ev5.28.0.a	#Power strike!
		custom_tooltip = ev6.15.0.a_ct
		spend_standard_ps_effect = yes
		trigger_event = magic_ev10.137
	}
}
#Astaroth 4.
magic_ev10.137 = {
	title = astaroth_name
	desc = ev10.137.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = personality_bold
	}
	override_background = {
		reference = bedchamber
	}
	
	option = {
		name = ev10.137.a
		add_stress = medium_stress_loss
		gain_cm_xp5_effect = yes
		scope:asta = {
			hidden_effect = {
				if = {
					limit = {
						any_character_artifact = {
							has_artifact_modifier = artifact_ring_of_dead_modifier
						}
					}
					random_character_artifact = {
						limit = {
							has_artifact_modifier = artifact_ring_of_dead_modifier
						}
						destroy_artifact = THIS
					}
				}
			}
			death = {
				death_reason = death_duel
				killer = ROOT
			}
		}
		hidden_effect = {
			trigger_event = {
				id = magic_ev10.138
				days = 7
			}
		}
	}
}

#Astaroth 5. (Hecate)
magic_ev10.138 = {
	title = hecate_name
	desc = ev10.138.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = thinking
	}
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	trigger = {
		is_alive = yes
		is_imprisoned = no
		is_ai = no
		NOT = {
			any_artifact = {
				has_artifact_modifier = artifact_ring_of_dead_modifier
			}
		}
	}
	immediate = {
		hidden_effect_new_object = {
			create_character = {
				name = hecate_name
				gender = female
				employer = ROOT
				template = hecate_demon_character
				save_scope_as = demon
				after_creation = {
					add_character_flag = {
						flag = just_summoned_demon_flag
						days = 7
					}
					set_sexuality = bisexual
					add_character_flag = hecate
					add_character_flag = special_magic_character
					give_witch_secret_or_trait_effect2 = yes
					add_character_modifier = master_magic_modifier
					add_character_modifier = whisperer_modifier
					turn_into_greater_demon = yes
					add_trait_xp = {
						trait = demon2
						track = hell_powers
						value = 90
					}
					add_trait_xp = {
						trait = demon2
						track = demon_reputation
						value = 90
					}
					turn_into_mage_effect = yes
					add_trait_xp = {
						trait = source
						track = magic_potential
						value = 85
					}
					add_trait_xp = {
						trait = archmage
						track = secret_knowledge
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = combat_magic
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = alchemy
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = demonology
						value = 100
					}
					add_trait_xp = {
						trait = archmage
						track = power_saturation
						value = 100
					}
					save_or_load_demon_visual_effect = yes
				}
			}
		}
	}
	option = {
		name = ev10.138.a
		trigger_event = magic_ev10.139
	}
}
#Astaroth 6. (Hecate)
magic_ev10.139 = {
	title = hecate_name
	desc = ev10.139.desc
	theme = realm
	left_portrait = {
		character = ROOT
		animation = interested
	}
	right_portrait = {
		character = scope:demon
		animation = admiration
	}
	artifact = {
        target = scope:newly_created_artifact
        position = lower_left_portrait
    }
	immediate = {
		create_dead_ring_artifact_effect = {
			OWNER = ROOT
		}
	}
	option = {
		name = ev10.139.a
		hidden_effect = {
			scope:demon = {
				death = natural
			}
		}
	}
}

#Asmodeus returns
magic_ev10.140 = {
	title = asmodeus_name
	desc = ev10.140.desc
	theme = witchcraft
	left_portrait = root
	right_portrait = {
		character = scope:demon
		animation = personality_bold
		#outfit_tags = { ep1_adventurer_cloak }
	}
	trigger = {
		is_alive = yes
		is_ai = no
		is_imprisoned = no
		#NOT = {
		#	any_living_character = {
		#		has_character_flag = asmodeus
		#	}
		#}
	}
	#immediate = {
	#	hidden_effect_new_object = {
	#		if = {
	#			limit = {
	#				NOT = {
	#					exists = scope:this0
	#				}
	#			}
	#			save_scope_as = this0
	#		}
	#		create_asmodeus_demon_effect = yes
	#	}
	#}
	option = {
		name = ev10.140.a	#Challenge
		trigger = {
			NOT = {
				has_character_flag = punished_by_asmodeus_flag
			}
		}
		trigger_event = magic_ev10.145
	}
	option = {
		name = ev10.140.c	#Challenge2
		trigger = {
			has_character_flag = punished_by_asmodeus_flag
		}
		trigger_event = magic_ev10.145
	}
	option = {
		name = ev6.1.0.b	#Wish
		trigger = {
			NOR = {
				has_trait = stuttering
				has_character_flag = punished_by_asmodeus_flag
			}
		}
		trigger_event = magic_ev10.142
	}
	option = {
		name = ev10.140.b	#Apologize
		trigger = {
			is_the_choosen_one_trigger = no
		}
		trigger_event = magic_ev10.141
	}
}
#Asmodeus returns - Apologize (death)
magic_ev10.141 = {
	title = asmodeus_name
	desc = ev10.141.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = fear
	}
	right_portrait = {
		character = scope:demon
		animation = eccentric
		#outfit_tags = { ep1_adventurer_cloak }
	}
	option = {
		name = harm.0541.a	# "..."
		death = {
			death_reason = death_mysterious
			killer = scope:demon
		}
	}
	after = {
		hidden_effect = {
			scope:demon = {
				death = natural
			}
		}
	}
}

#Asmodeus returns - Apologize (wish)
magic_ev10.142 = {
	title = asmodeus_name
	desc = ev10.142.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = delirium
	}
	right_portrait = {
		character = scope:demon
		animation = eyeroll
		#outfit_tags = { ep1_adventurer_cloak }
	}
	#immediate = {
	#}
	option = {
		name = ev10.142.a
		add_trait = stuttering
		trigger_event = magic_ev10.143
	}
}
#Asmodeus returns - Apologize (wish) 2.
magic_ev10.143 = {
	title = asmodeus_name
	desc = ev10.143.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = delirium
	}
	right_portrait = {
		character = scope:demon
		animation = personality_callous
		#outfit_tags = { ep1_adventurer_cloak }
	}
	option = {
		name = ev10.143.a
		trigger_event = magic_ev10.144
	}
}
#Asmodeus returns - Apologize (wish) 3.
magic_ev10.144 = {
	title = asmodeus_name
	desc = ev10.144.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = delirium
	}
	lower_right_portrait = scope:demon
	option = {
		name = ev5.21.0.a
		remove_trait = stuttering
		every_close_family_member = {
			limit = {
				NOR = {
					has_trait = demon2
					has_trait = golem
					has_trait = necromancer
				}
				is_the_choosen_one_trigger = no
				is_ai = yes
				is_antimagic_trigger = no
			}
			death = natural
		}
	}
	after = {
		hidden_effect = {
			add_character_flag = punished_by_asmodeus_flag
			scope:demon = {
				death = natural
			}
		}
	}
}
#Asmodeus returns - Apologize (challenge)
magic_ev10.145 = {
	title = asmodeus_name
	desc = ev10.145.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_bold
	}
	right_portrait = {
		character = scope:demon
		animation = personality_callous
		#outfit_tags = { ep1_adventurer_cloak }
	}
	
	option = {
		name = intrigue_dread.4200.a	#Let's get started!
		configure_start_mage_duel_effect = {
			MD_ATTACKER = root
			MD_DEFENDER = scope:demon
		}
		hidden_effect = {
			scope:demon = {
				trigger_event = {
					id = magic_ev2.13
					months = 6
				}
			}
		}
	}
}

#Asmodeus returns - Apologize (challenge)
magic_ev10.146 = {
	title = mage_duel_won
	desc = ev10.146.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = personality_bold
	}
	immediate = {
		spend_standard_ps_effect = yes
		show_duel_conclusion_effect = { WINNER = ROOT LOSER = scope:char2 }
		scope:char2 = {
			save_temporary_scope_as = dem
			hidden_effect = {
				clear_all_md_staff_effect = yes
			}
			send_interface_toast = {
				title = banish_demon
				death = {
					death_reason = death_duel
					killer = ROOT
				}
			}
		}
	}
	option = {
		name = ev10.146.a
		add_proper_prize_for_md_winner_effect = yes
		hidden_effect = {
			clear_all_md_staff_effect = yes
		}
	}
}

#grand rite - mamulet
magic_ev10.147 = {
	type = activity_event
	title = witch_amulet
	desc = ev10.147.desc
	theme = witchcraft
	override_background = {
		reference = bp1_bonfire
	}
	left_portrait = root
	artifact = {
        target = scope:mamulet
        position = lower_left_portrait
    }
	trigger = {
		has_trait = true_witch
		any_character_artifact = {
			has_variable = mamulet
			NOR = {
				has_artifact_modifier = artifact_hypnotic_power
				has_artifact_modifier = artifact_hypnotic_power2
			}
		}
	}

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					any_character_artifact = {
						has_variable = mamulet
						rarity = illustrious
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
				}
				random_character_artifact = {
					limit = {
						has_variable = mamulet
						rarity = illustrious
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
					save_scope_as = mamulet
				}
			}
			else_if = {
				limit = {
					any_character_artifact = {
						has_variable = mamulet
						rarity = famed
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
				}
				random_character_artifact = {
					limit = {
						has_variable = mamulet
						rarity = famed
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
					save_scope_as = mamulet
				}
			}
			else_if = {
				limit = {
					any_character_artifact = {
						has_variable = mamulet
						rarity = masterwork
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
				}
				random_character_artifact = {
					limit = {
						has_variable = mamulet
						rarity = masterwork
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
					save_scope_as = mamulet
				}
			}
			else = {
				random_character_artifact = {
					limit = {
						has_variable = mamulet
						NOR = {
							has_artifact_modifier = artifact_hypnotic_power
							has_artifact_modifier = artifact_hypnotic_power2
						}
					}
					save_scope_as = mamulet
				}
			}
		}
	}
	option = {
		name = ev10.147.b
		trigger = {
			is_true_mage = yes
			is_antimagic_trigger = no
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
		}
		show_as_unavailable = {
			is_antimagic_trigger = no
			is_true_mage = yes
		}
		spend_standard_ps_effect = yes
		scope:mamulet = {
			add_artifact_modifier = artifact_hypnotic_power2
		}
		gain_sc_xp1_effect = yes
	}
	option = {
		name = ev10.147.a
		trigger = {
			has_trait = true_witch
		}
		scope:mamulet = {
			add_artifact_modifier = artifact_hypnotic_power
		}
	}
}

#mage duel during battle
magic_ev10.148 = {
	title = diplomatic_scheme_lifestyle.3101.t
	desc = ev10.148.desc
	theme = battle
	left_portrait = {
		character = root
		animation = personality_bold
		outfit_tags = { military_outfit }
	}
	lower_right_portrait = scope:ecommander
	cooldown = { years = 1 }
	option = {
		name = ev10.148.a
		add_prestige = minor_prestige_gain
		stress_impact = {
			brave = major_stress_loss
			craven = major_stress_gain
			compassionate = minor_stress_gain
			sadistic = minor_stress_loss
		}
		show_as_tooltip = {
			configure_start_mage_duel_effect = {
				MD_ATTACKER = root
				MD_DEFENDER = scope:ecommander
			}
		}
		save_scope_as = ecommander2
		scope:ecommander = {
			trigger_event = magic_ev10.149
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = brave
			}
			modifier = {
				add = 1
				has_trait = impatient
			}
			modifier = {
				add = 1
				has_trait = sadistic
			}
			modifier = {
				add = 7
				overall_magic_power_value > scope:ecommander.overall_magic_power_value
			}
			modifier = {
				add = 3
				any_character_artifact = {
					OR = {
						has_artifact_modifier = singularity_modifier5
						has_artifact_modifier = singularity_modifierX
					}
				}
			}
		}
	}
	option = {
		name = ev10.148.b
		stress_impact = {
			brave = major_stress_gain
			craven = major_stress_loss
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 2
				has_trait = craven
			}
			modifier = {
				add = 1
				has_trait = patient
			}
			modifier = {
				add = 1
				has_trait = content
			}
			modifier = {
				add = 1
				NOR = {
					any_character_war = {
						primary_attacker = ROOT
						primary_defender = scope:ecommander
					}
					any_character_war = {
						primary_defender = ROOT
						primary_attacker = scope:ecommander
					}
				}
			}
			modifier = {
				add = 7
				overall_magic_power_value < scope:ecommander.overall_magic_power_value
			}
			modifier = {
				add = 6
				scope:ecommander = {
					any_character_artifact = {
						OR = {
							has_artifact_modifier = singularity_modifier5
							has_artifact_modifier = singularity_modifierX
						}
					}
				}
			}
		}
	}
}
#mage duel during battle 2.
magic_ev10.149 = {
	title = diplomatic_scheme_lifestyle.3101.t
	desc = ev10.149.desc
	theme = battle
	left_portrait = {
		character = root
		animation = personality_bold
		outfit_tags = { military_outfit }
	}
	right_portrait = {
		character = scope:ecommander2
		animation = aggressive_unarmed
		outfit_tags = { military_outfit }
	}
	option = {
		name = ev4.36.0.a
		stress_impact = {
			brave = major_stress_loss
			craven = major_stress_gain
		}
		configure_start_mage_duel_effect = {
			MD_ATTACKER = scope:ecommander2
			MD_DEFENDER = ROOT
		}
	}
}

#witch contract #13 - Library
magic_ev10.150 = {
	title = laamp_magic_1013_desc_title
	desc = ev10.150.desc
	theme = realm
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
		animation = thinking
	}
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
			}
		}
	}
	option = {
		name = ev10.150.a
		trigger = {
			NOT = {
				has_trait = scholar
			}
		}
		duel = {
			skill = diplomacy
			target = scope:employer
			5 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				show_as_tooltip = {
					add_contact = scope:employer
					custom_tooltip = laamp_magic_1013_desc_ct
					add_prestige = task_contract_success_prestige_gain_half_value
				}
				
				hidden_effect = {
					laamp_magic_1013_reward_hidden_effect = yes
					#scope:task_contract = {
					#	complete_task_contract = success_standard
					#}
					scope:task_contract = {
						complete_task_contract = success_critical
					}
				}
			}
			5 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				diplomacy > scope:employer.diplomacy
			}
		}
	}
	option = {
		name = ev10.150.a
		trigger = {
			has_trait = scholar
		}
		show_as_tooltip = {
			add_contact = scope:employer
			custom_tooltip = laamp_magic_1013_desc_ct
			add_prestige = task_contract_success_prestige_gain_half_value
		}
		
		hidden_effect = {
			laamp_magic_1013_reward_hidden_effect = yes
			scope:task_contract = {
				complete_task_contract = success_critical
			}
		}
		ai_chance = {
			base = 1000
		}
	}
	option = {
		name = ev10.150.b
		duel = {
			skill = intrigue
			target = scope:employer
			6 = {
				desc = ev3.52.a_1
				compare_modifier = {
					value = scope:duel_value
					multiplier = 1
					min = 0
				}
				show_as_tooltip = {
					custom_tooltip = laamp_magic_1013_desc_ct
					add_prestige = task_contract_success_prestige_gain_half_value
				}
				hidden_effect = {
					laamp_magic_1013_reward_hidden_effect = yes
					scope:task_contract = {
						complete_task_contract = success_standard
					}
					#scope:task_contract = {
					#	complete_task_contract = success_critical
					#}
				}
			}
			4 = {
				desc = ev3.52.a_2
				compare_modifier = {
					value = scope:duel_value
					multiplier = -1
					min = 0
				}
				send_interface_toast = {
					title = ev3.52.a_2
					scope:task_contract = {
						complete_task_contract = failure_standard
					}
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 19
				intrigue > scope:employer.intrigue
			}
		}
	}
	option = {
		name = ev10.150.c
		pay_short_term_gold = {
			target = scope:employer
			gold = medium_gold_value_check
		}
		show_as_tooltip = {
			custom_tooltip = laamp_magic_1013_desc_ct
			add_prestige = task_contract_success_prestige_gain_half_value
		}
		hidden_effect = {
			laamp_magic_1013_reward_hidden_effect = yes
			scope:task_contract = {
				complete_task_contract = success_standard
			}
			#scope:task_contract = {
			#	complete_task_contract = success_critical
			#}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev10.150.d
		stress_impact = {
			content = minor_stress_loss
			scholar = minor_stress_gain
		}
		scope:task_contract = {
			invalidate_contract = yes
		}
		ai_chance = {
			base = 3
		}
	}
}
#witch contract #14 - Court mage evaluation
magic_ev10.151 = {
	title = laamp_magic_1014_desc_title
	desc = ev10.151.desc
	theme = realm
	left_portrait = {
		character = root
		animation = interested
	}
	right_portrait = {
		character = scope:employer
		animation = thinking
	}
	lower_center_portrait = scope:cmage
	immediate = {
		hidden_effect = {
			scope:task_contract.task_contract_employer = {
				save_scope_as = employer
				random_court_position_holder = {
					type = mage_court_position
					limit = {
						NOT = { is_at_war_with = scope:employer }
						is_imprisoned = no
					}
					save_scope_as = cmage
				}
			}
		}
	}
	option = {
		name = ev10.151.a
		trigger_event = magic_ev10.152
		ai_chance = {
			base = 1000
		}
	}
}
#witch contract #14 - Court mage evaluation 2.
magic_ev10.152 = {
	title = laamp_magic_1014_desc_title
	desc = ev10.152.desc
	theme = realm
	left_portrait = {
		character = root
		animation = thinking
	}
	right_portrait = {
		character = scope:cmage
		animation = eccentric
	}
	lower_center_portrait = scope:employer
	option = {
		name = ev10.152.a
		trigger = {
			OR = {
				has_trait = true_witch
				is_true_mage = yes
			}
		}
		add_character_flag = {
			flag = laamp_magic_1014_true_flag
			months = 1
		}
		trigger_event = magic_ev10.153
	}
	option = {
		name = ev10.152.b
		trigger = {
			OR = {
				has_trait = true_witch
				has_perk = magical_senses_perk
			}
		}
		add_character_flag = {
			flag = laamp_magic_1014_true_flag
			months = 1
		}
		trigger_event = magic_ev10.153
	}
	option = {
		name = ev10.152.c
		trigger = {
			has_access_to_aura_reading_trigger = yes
			OR = {
				always = yes
				is_true_mage = yes
			}
			custom_description = {
				text = power_needed_custom
				can_spend_standard_ps_trigger = yes
			}
			custom_description = {
				text = have_antimagic_seal
				is_antimagic_trigger = no
			}
		}
		show_as_unavailable = {
			has_access_to_aura_reading_trigger = yes
		}
		add_character_flag = {
			flag = laamp_magic_1014_true_flag
			months = 1
		}
		spend_standard_ps_effect = yes
		trigger_event = magic_ev10.153
		add_internal_flag = special
	}
	option = {
		name = ev10.152.d
		trigger_event = magic_ev10.153
	}
}
#witch contract #14 - Court mage evaluation 2.
magic_ev10.153 = {
	title = laamp_magic_1014_desc_title
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_character_flag = laamp_magic_1014_true_flag
					scope:cmage = {
						is_a_demon_trigger = no
						OR = {
							is_false_mage = yes
							is_witch_trigger = no
						}
					}
				}
				desc = ev10.153.desc1
			}
			triggered_desc = {
				trigger = {
					has_character_flag = laamp_magic_1014_true_flag
					scope:cmage = {
						is_a_demon_trigger = no
						is_witch_trigger = yes
						NOR = {
							has_trait = archmage
							has_focus = arcane_focus
							has_trait = true_witch
						}
					}
				}
				desc = ev10.153.desc2
			}
			triggered_desc = {
				trigger = {
					has_character_flag = laamp_magic_1014_true_flag
					scope:cmage = {
						is_a_demon_trigger = no
						has_trait = true_witch
						NOR = {
							has_trait = archmage
							has_focus = arcane_focus
						}
					}
				}
				desc = ev10.153.desc3
			}
			triggered_desc = {
				trigger = {
					has_character_flag = laamp_magic_1014_true_flag
					scope:cmage = {
						OR = {
							is_true_mage = yes
							is_a_demon_trigger = yes
							has_focus = arcane_focus
						}
					}
				}
				desc = ev10.153.desc4
			}
			desc = ev10.153.desc5
		}
	}
	theme = realm
	left_portrait = {
		character = root
		#animation = thinking
	}
	right_portrait = {
		character = scope:employer
		animation = interested
	}
	lower_center_portrait = scope:cmage
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					scope:employer = {
						government_has_flag = government_is_administrative
					}
				}
				save_scope_as = adventurer
				save_scope_as = actor
				scope:employer = {
					save_scope_as = recipient
				}
			}
			else = {
				save_scope_as = recipient
				scope:employer = {
					save_scope_as = actor
					random_held_county = {
						limit = {
							NOT = {
								THIS = scope:employer.capital_county
							}
						}
						add_to_list = offered_titles
						save_scope_as = new_primary_title
					}
				}
			}
		}
	}
	option = {
		name = ev10.153.f	#I would be a better court magician than he is.
		trigger = {
			has_trait = archmage
			NOT = {
				has_trait = gallivanter
			}
			diplomacy > scope:cmage.diplomacy
			scope:employer = {
				highest_held_title_tier >= tier_kingdom
				any_held_county = {
					exists = title_province
					count > 1
				}
				is_powerful_being = no
			}
		}
		stress_impact = {
			ambitious = minor_stress_loss
			arrogant = minor_stress_loss
			humble = minor_stress_gain
			content = minor_stress_gain
		}
		scope:employer = {
			revoke_court_position = {
				court_position = mage_court_position
			}
		}
		if = {
			limit = {
				NOR = {
					has_relation_rival = scope:cmage
					has_relation_nemesis = scope:cmage
				}
			}
			set_relation_rival = scope:cmage
		}
		else = {
			scope:cmage = {
				add_opinion = {
					target = ROOT
					modifier = hate_opinion
					opinion = -100
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		if = {
			limit = {
				scope:employer = {
					government_has_flag = government_is_administrative
				}
			}
			hidden_effect = {
				save_scope_value_as = { name = piety_option value = no }
				save_scope_value_as = { name = gold_option value = no }
				save_scope_value_as = { name = hook value = no }
			}
			procure_estate_interaction_effect = yes
		}
		else = {
			hidden_effect = {
				save_scope_value_as = {
					name = negotiate_settlement_legitimacy_cost
					value = 0
				}
			}
			negotiate_settlement_interaction_effect = yes
		}
		hidden_effect = {
			every_held_title = {
				limit = {
					any_claimant = {
						THIS = scope:employer
					}
				}
				scope:employer = {
					remove_claim = PREV
				}
			}
		}
		scope:employer = {
			appoint_court_position = {
				recipient = ROOT
				court_position = mage_court_position
			}
		}
		ai_chance = {
			base = 100
		}
	}
	option = {
		name = ev10.153.a	#He is undoubtedly a proficient wizard
		if = {
			limit = {
				has_character_flag = laamp_magic_1014_true_flag
				scope:cmage = {
					OR = {
						is_true_mage = yes
						is_a_demon_trigger = yes
						has_focus = arcane_focus
					}
				}
			}
			stress_impact = {
				just = minor_stress_loss
				honest = minor_stress_loss
				deceitful = minor_stress_gain
				arbitrary = minor_stress_gain
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
				honest = minor_stress_gain
				deceitful = minor_stress_loss
				arbitrary = minor_stress_loss
			}
		}
		scope:cmage = {
			if = {
				limit = {
					is_false_mage = yes
				}
				add_opinion = {
					target = ROOT
					modifier = grateful_opinion
					opinion = 100
				}
				ROOT = {
					if = {
						limit = {
							NOT = {
								has_hook = scope:cmage
							}
						}
						add_hook = {
							type = obligation_hook
							target = scope:cmage
						}
						if = {
							limit = {
								scope:cmage = {
									is_ruler = yes
									is_landed_or_landless_administrative = yes
									NOT = {
										is_contact_of = ROOT
									}
								}
							}
							add_contact = ROOT
						}
					}
				}
			}
			else = {
				add_opinion = {
					target = ROOT
					modifier = grateful_opinion
					opinion = 20
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.153.b	#He is at most an average court mage
		if = {
			limit = {
				has_character_flag = laamp_magic_1014_true_flag
				scope:cmage = {
					is_a_demon_trigger = no
					has_trait = true_witch
					NOR = {
						has_trait = archmage
						has_focus = arcane_focus
					}
				}
			}
			stress_impact = {
				just = minor_stress_loss
				honest = minor_stress_loss
				deceitful = minor_stress_gain
				arbitrary = minor_stress_gain
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
				honest = minor_stress_gain
				deceitful = minor_stress_loss
				arbitrary = minor_stress_loss
			}
		}
		scope:cmage = {
			if = {
				limit = {
					is_false_mage = yes
				}
				add_opinion = {
					target = ROOT
					modifier = grateful_opinion
					opinion = 10
				}
			}
			else = {
				add_opinion = {
					target = ROOT
					modifier = disgusted_opinion
					opinion = -10
				}
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.153.c	#He is not fit for the job
		if = {
			limit = {
				has_character_flag = laamp_magic_1014_true_flag
				OR = {
					AND = {
						scope:cmage = {
							is_a_demon_trigger = no
							OR = {
								is_false_mage = yes
								is_witch_trigger = no
							}
						}
					}
					AND = {
						scope:cmage = {
							is_a_demon_trigger = no
							is_witch_trigger = yes
							NOR = {
								has_trait = archmage
								has_focus = arcane_focus
								has_trait = true_witch
							}
						}
					}
				}
			}
			stress_impact = {
				just = minor_stress_loss
				honest = minor_stress_loss
				deceitful = minor_stress_gain
				arbitrary = minor_stress_gain
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
				honest = minor_stress_gain
				deceitful = minor_stress_loss
				arbitrary = minor_stress_loss
			}
		}
		random = {
			chance = 90
			scope:employer = {
				revoke_court_position = {
					court_position = mage_court_position
				}
			}
			hidden_effect = {
				scope:cmage = {
					add_character_flag = {
						flag = revoked_cmage
						years = 10
					}
				}
			}
		}
		scope:cmage = {
			add_opinion = {
				target = ROOT
				modifier = disappointed_opinion
				opinion = -50
			}
		}
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.153.d	#He is a fraud
		if = {
			limit = {
				has_character_flag = laamp_magic_1014_true_flag
				OR = {
					AND = {
						scope:cmage = {
							is_a_demon_trigger = no
							OR = {
								is_false_mage = yes
								is_witch_trigger = no
							}
						}
					}
					AND = {
						scope:cmage = {
							is_a_demon_trigger = no
							is_witch_trigger = yes
							NOR = {
								has_trait = archmage
								has_focus = arcane_focus
								has_trait = true_witch
							}
						}
					}
				}
			}
			stress_impact = {
				just = minor_stress_loss
				honest = minor_stress_loss
				deceitful = minor_stress_gain
				arbitrary = minor_stress_gain
			}
		}
		else = {
			stress_impact = {
				just = minor_stress_gain
				honest = minor_stress_gain
				deceitful = minor_stress_loss
				arbitrary = minor_stress_loss
			}
		}
		scope:cmage = {
			add_character_flag = {
				flag = revoked_cmage
				years = 10
			}
			if = {
				limit = {
					any_secret = {
						secret_type = secret_false_mage
					}
				}
				random_secret = {
					limit = {
						secret_type = secret_false_mage
					}
					expose_secret = ROOT
				}
			}
		}
		scope:employer = {
			revoke_court_position = {
				court_position = mage_court_position
			}
		}
		if = {
			limit = {
				NOR = {
					has_relation_rival = scope:cmage
					has_relation_nemesis = scope:cmage
				}
			}
			set_relation_rival = scope:cmage
		}
		else = {
			scope:cmage = {
				add_opinion = {
					target = ROOT
					modifier = hate_opinion
					opinion = -100
				}
			}
		}
		
		scope:task_contract = {
			complete_task_contract = success_standard
		}
		ai_chance = {
			base = 1
		}
	}
	option = {
		name = ev10.153.e	#I cannot help here
		add_prestige = -100
		scope:task_contract = {
			invalidate_contract = yes
		}
		ai_chance = {
			base = 0
		}
	}
	after = {
		hidden_effect = {
			if = {
				limit = {
					has_character_flag = laamp_magic_1014_true_flag
				}
				remove_character_flag = laamp_magic_1014_true_flag
			}
		}
	}
}
#abdul break the barrier
magic_ev10.154 = {
	title = ev10.154.title
	desc = ev10.154.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = thinking
	}
	trigger = {
		exists = scope:abdul_target
	}
	immediate = {
		custom_tooltip = ev10.154.a_ct
		hidden_effect = {
			every_living_character = {
				limit = {
					has_character_flag = us_magic_barrier_flag
				}
				remove_character_flag = us_magic_barrier_flag
			}
			remove_global_variable = us_magic_barrier_var
		}
	}
	
	option = {
		name = ev10.154.a
		hidden_effect = {
			scope:abdul_target = {
				trigger_event = {
					id = magic_ev6.42
					days = 7
				}
			}
		}
	}
}
#vassal distrusts mage liege
magic_ev10.155 = {
	hidden = yes
	trigger = {
		is_alive = yes
		is_landed_or_landless_administrative = yes
		is_true_mage = yes
		wh_attraction_value > 5
		any_vassal = {
			is_adult = yes
			is_powerful_vassal = yes
			is_witch_trigger = no
			NOR = {
				has_trait = trusting
				has_trait = archmage
				has_character_flag = distrusts_mages_flag
			}
			culture = {
				NOT = {
					has_cultural_tradition = mage_rulership_tradition
				}
			}
		}
	}
	immediate = {
		random_vassal = {
			limit = {
				is_adult = yes
				is_powerful_vassal = yes
				is_witch_trigger = no
				NOR = {
					has_trait = trusting
					has_trait = archmage
					has_character_flag = distrusts_mages_flag
				}
				culture = {
					NOT = {
						has_cultural_tradition = mage_rulership_tradition
					}
				}
			}
			add_character_flag = {
				flag = distrusts_mages_flag
				years = 40
			}
			save_scope_as = distrusts_mages_ruler
			every_living_character = {
				limit = {
					has_trait = archmage
					NOT = {
						has_relation_mmaster = scope:distrusts_mages_ruler
					}
				}
				scope:distrusts_mages_ruler = {
					add_opinion = {
						target = PREV
						modifier = distrusts_mages
						years = 40
					}
				}
			}
		}
		trigger_event = {
			id = magic_ev10.155
			years = 25
		}
	}
}
#striving for power - ai mages/true witches
magic_ev10.156 = {
	hidden = yes
	trigger = {
		is_alive = yes
		is_ai = yes
		is_imprisoned = no
		OR = {
			has_trait = true_witch
			is_true_mage = yes
		}
		NOR = {
			#any_relation = {
			#	type = mminion
			#}
			has_trait = incapable
			has_trait = content
			has_trait = lazy
			has_character_flag = special_magic_character
			has_character_flag = abdul_dude
			has_character_flag = asmodeus
			has_character_flag = bael_flag
			has_character_flag = abraxas
			has_character_flag = astaroth_flag
			has_character_flag = hecate
			#any_character_artifact = {
			#	has_variable = magic1
			#	count > 8
			#}
		}
		any_artifact = {
			has_variable = magic1
			NOT = { artifact_owner = ROOT }
		}
	}
	immediate = {
		ai_striving_for_magic_power_effect = yes
		if = {
			limit = {
				OR = {
					has_trait = ambitious
					has_trait = greedy
				}
			}
			random = {
				chance = 33
				trigger_event = {
					id = magic_ev10.156
					years = { 4 7 }
				}
			}
		}
		else = {
			random = {
				chance = 10
				trigger_event = {
					id = magic_ev10.156
					years = { 4 7 }
				}
			}
		}
	}
}
#item from magic domination
magic_ev10.157 = {
	hidden = yes
	trigger = {
		is_alive = yes
		is_ai = yes
		is_imprisoned = no
		scope:oart2 = {
			is_alive = yes
			is_imprisoned = no
		}
		scope:art2.artifact_owner = scope:oart2
		has_strong_usable_hook = scope:oart2
		has_hook_of_type = {
			target = scope:oart2
			type = magic_domination_hook
		}
	}
	immediate = {
		scope:oart2 = {
			send_interface_toast = {
				title = magic_domination
				left_icon = scope:oart2
				right_icon = ROOT
				ROOT = {
					use_hook = scope:oart2
					scope:art2 = {
						set_owner = {
							target = ROOT
							history = {
								type = given
								actor = scope:oart2
								recipient = ROOT
								location = scope:oart2.location
							}
						}
					}
				}
			}
		}
	}
}
#forced to disable singularity
magic_ev10.158 = {
	title = ev10.158.title
	desc = ev10.158.desc
	theme = witchcraft
	left_portrait = {
		character = root
		animation = anger
	}
	artifact = {
        target = scope:singularity
        position = lower_left_portrait
    }
	
	option = {
		name = ev10.158.a
		hidden_effect = {
			if = {
				limit = {
					NOT = {
						has_character_flag = me_as_project_done
					}
				}
				add_character_flag = me_as_project_done
			}
		}
		scope:singularity = {
			hidden_effect = {
				clear_artifact_modifiers = yes
				set_variable = singularity_sleeping
				reforge_artifact = { visuals = ancient_singularity type = miscellaneous }
			}
			add_artifact_modifier = singularity_modifier1
		}
		stress_impact = {
			ambitious = major_stress_gain
			arrogant = major_stress_gain
			humble = major_stress_loss
			content = major_stress_loss
		}
		ai_chance = {
			base = 10
		}
	}
	option = {
		name = ev10.158.b
		add_prestige_level = -1
		if = {
			limit = {
				has_variable = mc_member_var
			}
			remove_from_mc_effect = yes
		}
		every_living_character = {
			limit = {
				is_true_mage = yes
				NOT = {
					has_any_scripted_relation = ROOT
				}
			}
			set_relation_rival = ROOT
		}
		if = {
			limit = {
				NOT = {
					has_character_modifier = excluded_from_magic_community
				}
			}
			add_character_modifier = {
				modifier = excluded_from_magic_community
				years = 20
			}
		}
		stress_impact = {
			ambitious = minor_stress_loss
			arrogant = minor_stress_loss
			craven = major_stress_gain
			gregarious = medium_stress_gain
		}
		ai_chance = {
			base = 0
		}
	}
}

#rector
magic_ev10.159 = {
	title = rector_magic_academy_modifier
	desc = ev10.159.desc
	theme = university
	left_portrait = {
		character = root
		animation = thinking
	}
	trigger = {
		is_alive = yes
		has_character_modifier = rector_magic_academy_modifier
	}
	immediate = {
		hidden_effect = {
			every_living_character = {
				limit = {
					NOT = {
						THIS = ROOT
					}
					has_character_modifier = rector_magic_academy_modifier
				}
				remove_character_modifier = rector_magic_academy_modifier
			}
			if = {
				limit = {
					exists = global_var:magic_academy_opened
				}
				remove_global_variable = magic_academy_opened
			}
			every_living_character = {
				limit = {
					exists = house
					THIS = house.house_head
					house = {
						has_house_modifier = house_magic_academy_modifier
					}
				}
				house = {
					remove_house_modifier = house_magic_academy_modifier
				}
			}
		}
	}
	option = {
		name = ev10.159.a
		custom_tooltip = ev10.159.a_ct
		custom_tooltip = ev10.159.a_ct2
		set_global_variable = magic_academy_opened
		every_living_character = {
			limit = {
				NOT = { THIS = ROOT }
				has_trait = true_witch
				NOR = {
					has_focus = arcane_focus
					is_true_mage = yes
					has_trait = source
				}
			}
			add_opinion = {
				target = ROOT
				modifier = grateful_opinion
				opinion = 50
			}
			hidden_effect = {
				set_focus = arcane_focus
			}
		}
		hidden_effect = {
			every_player = {
				limit = {
					is_witch_trigger = yes
				}
				send_interface_toast = {
					title = rector_magic_academy_modifier
					left_icon = ROOT
					custom_tooltip = ev10.159.a_ct
				}
			}
		}
		ai_chance = {
			base = 0
		}
	}
	option = {
		name = ev10.159.b
		trigger = {
			exists = house
		}
		house = {
			add_house_modifier = {
				modifier = house_magic_academy_modifier
			}
		}
		custom_tooltip = ev10.159.a_ct2
		house = {
			every_house_member = {
				limit = {
					NOT = { THIS = ROOT }
					is_witch_trigger = yes
					can_unlock_arcane_focus_trigger = no
				}
				add_opinion = {
					target = ROOT
					modifier = grateful_opinion
					opinion = 50
				}
			}
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				exists = house
				ROOT = house.house_head
			}
			modifier = {
				add = 3
				has_trait = family_first
			}
			modifier = {
				add = -5
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.159.c
		trigger = {
			is_ruler = yes
		}
		custom_tooltip = ev10.159.c_ct
		stress_impact = {
			just = major_stress_loss
		}
		every_living_character = {
			limit = {
				NOT = { THIS = ROOT }
				is_true_mage = yes
			}
			add_opinion = {
				target = ROOT
				modifier = approving_opinion
				opinion = 20
			}
		}
		trigger_event = {
			id = magic_ev10.160
			years = { 3 4 }
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = just
			}
			modifier = {
				add = -5
				has_trait = paranoid
			}
		}
	}
	option = {
		name = ev10.159.d
		trigger = {
			is_ruler = yes
		}
		add_learning_skill = 1
		gain_al_xp_small_effect = yes
		gain_cm_xp5_effect = yes
		gain_sc_xp2_effect = yes
		stress_impact = {
			shy = major_stress_loss
			greedy = minor_stress_loss
			generous = major_stress_gain
			scholar = minor_stress_loss
		}
		ai_chance = {
			base = 1
			modifier = {
				add = 1
				has_trait = scholar
			}
			modifier = {
				add = 1
				has_trait = ambitious
			}
		}
	}
}
#new mage for rector
magic_ev10.160 = {
	hidden = yes
	trigger = {
		is_alive = yes
		has_character_modifier = rector_magic_academy_modifier
	}
	immediate = {
		random_list = {
			1 = {
				create_character = {
					employer = ROOT
					gender_female_chance = 50
					template = student_mage_character
					save_scope_as = new_mage
					after_creation = {
						give_witch_secret_or_trait_effect2 = yes
						turn_into_mage_effect = yes
						add_learning_skill = 2
					}
				}
				send_interface_toast = {
					title = ev10.160.title
					left_icon = scope:new_mage
					add_hook = {
						type = obligation_hook
						target = scope:new_mage
					}
				}
				trigger_event = {
					id = magic_ev10.160
					years = { 5 7 }
				}
			}
			1 = {
				trigger_event = {
					id = magic_ev10.160
					years = { 3 5 }
				}
			}
		}
	}
}
#singularity malfunction
magic_ev10.161 = {
	title = ev10.161.title
	desc = ev10.161.desc
	theme = realm
	left_portrait = {
		character = root
		animation = thinking
	}
	artifact = {
        target = scope:msing
        position = lower_center_portrait
    }
	trigger = {
		is_alive = yes
		is_imprisoned = no
		is_ai = no
		any_character_artifact = {
			has_artifact_modifier = singularity_modifier5
		}
		NOT = {
			has_character_flag = sing_malfunction_flag
		}
		NOT = {
			has_character_flag = me_sing_project_progress
		}
	}
	immediate = {
		hidden_effect = {
			random_character_artifact = {
				limit = {
					has_artifact_modifier = singularity_modifier5
				}
				save_scope_as = msing
			}
			add_character_flag = sing_malfunction_flag
		}
	}
	option = {
		name = ev10.161.a
		trigger_event = {
			id = magic_ev10.162
			days = 25
		}
	}
	option = {
		name = ev10.161.b
		trigger_event = {
			id = magic_ev10.163
			days = 25
		}
	}
}
#singularity malfunction 2.
magic_ev10.162 = {
	title = ev10.161.title
	desc = ev10.162.desc
	theme = realm
	left_portrait = {
		character = root
		animation = personality_rational
	}
	artifact = {
        target = scope:msing
        position = lower_center_portrait
    }
	trigger = {
		is_alive = yes
		any_character_artifact = {
			has_artifact_modifier = singularity_modifier5
		}
		NOT = {
			has_character_flag = me_sing_project_progress
		}
	}
	option = {
		name = ev10.162.a
		if = {
			limit = {
				NOR = {
					has_trait = brave
					has_trait = craven
				}
			}
			stress_impact = {
				craven = medium_stress_gain
			}
		}
		else = {
			add_stress = minor_stress_gain
		}
		trigger_event = {
			id = magic_ev10.163
			days = 35
		}
	}
}
#singularity malfunction 3.
magic_ev10.163 = {
	title = ev10.161.title
	desc = ev10.163.desc
	theme = realm
	left_portrait = {
		character = root
		animation = fear
	}
	artifact = {
        target = scope:msing
        position = lower_center_portrait
    }
	trigger = {
		is_alive = yes
		any_character_artifact = {
			has_artifact_modifier = singularity_modifier5
		}
		NOT = {
			has_character_flag = me_sing_project_progress
		}
	}
	immediate = {
		if = {
			limit = {
				exists = location
			}
			location = {
				every_character_in_location = {
					limit = {
						OR = {
							is_ai = no
							is_powerful_being = no
						}
						NOT = {
							has_trait = cancer
						}
					}
					random = {
						chance = 50
						add_trait = cancer
					}
				}
			}
		}
	}
	option = {
		name = ev10.163.a
		trigger_event = {
			id = magic_ev10.164
			days = 35
		}
	}
}
#singularity malfunction - exploooosion
magic_ev10.164 = {
	hidden = yes
	trigger = {
		any_artifact = {
			has_artifact_modifier = singularity_modifier5
		}
		NOT = {
			has_character_flag = me_sing_project_progress
		}
	}
	immediate = {
		if = {
			limit = {
				exists = scope:ttile
			}
			clear_saved_scope = ttile
		}
		scope:msing.artifact_owner = {
			scope:msing = {
				destroy_artifact = this
			}
			if = {
				limit = {
					OR = {
						is_ai = no
						is_powerful_being = no
					}
				}
				send_interface_toast = {
					title = ev10.164.title
					show_as_tooltip = {
						death = natural
					}
				}
				if = {
					limit = {
						exists = player_heir
					}
					player_heir = {
						save_scope_as = pheir
					}
				}
			}
			else = {
				send_interface_toast = {
					title = ev10.164.title
					add_stress = medium_stress_gain
				}
			}
			if = {
				limit = {
					exists = location
				}
				location = {
					add_province_modifier = {
						modifier = magical_radiation_modifier
						years = 20
					}
					if = {
						limit = {
							NOT = {
								has_province_modifier = magic_damaged_walls_modifier
							}
						}
						add_province_modifier = {
							modifier = magic_damaged_walls_modifier
							years = 10
						}
					}
					county = {
						save_scope_as = ttile
					}
					every_character_in_location = {
						limit = {
							OR = {
								is_ai = no
								is_powerful_being = no
							}
						}
						death = {
							death_reason = death_fire
						}
					}
				}
			}
			else = {
				death = {
					death_reason = death_fire
				}
			}
		}
		if = {
			limit = {
				exists = scope:ttile
			}
			every_player = {
				trigger_event = magic_ev10.165
			}
		}
		if = {
			limit = {
				exists = scope:pheir
				scope:pheir = {
					is_alive = yes
				}
			}
			scope:pheir = {
				send_interface_toast = {
					title = ev10.164.title
					left_icon = ROOT
					ROOT = {
						show_as_tooltip = {
							death = natural
						}
					}
				}
			}
		}
	}
}

magic_ev10.165 = {
	title = ev2.74.title
	type = character_event
	desc = ev2.74.desc
	
	theme = witchcraft
	left_portrait = root
	trigger = {
		is_alive = yes
		exists = scope:ttile
	}
	immediate = {
		scope:ttile = {
			title_province = {
				show_as_tooltip = {
					add_province_modifier = {
						modifier = magical_radiation_modifier
						years = 20
					}
					add_province_modifier = {
						modifier = magic_damaged_walls_modifier
						years = 10
					}
				}
			}
		}
	}

	option = {
		name = ev2.74.a
	}
	#after = {
	#	clear_saved_scope = ttile
	#}
}

#bael kills mages
magic_ev10.166 = {
	hidden = yes
	trigger = {
		is_alive = yes
	}
	immediate = {
		if = {
			limit = {
				is_imprisoned = no
				is_incapable = no
				NOT = {
					any_scheme = {
						is_hostile = yes
					}
				}
			}
			if = {
				limit = {
					exists = scope:pvic1
				}
				clear_saved_scope = pvic1
			}
			ordered_living_character = {
				limit = {
					in_diplomatic_range = ROOT
					NOR = {
						has_character_flag = special_magic_character
						has_strong_hook = ROOT
						is_imprisoned_by = ROOT
						THIS = ROOT
						has_variable = di_supports
					}
					is_adult = yes
				}
				order_by = wh_attraction_value
				check_range_bounds = no
				position = 0
				save_scope_as = pvic1
			}
			if = {
				limit = {
					exists = scope:pvic1
				}
				start_scheme = {
					type = murder
					target_character = scope:pvic1
				}
			}
		}
		trigger_event = {
			id = magic_ev10.166
			years = 1
		}
	}
}

#turn into adventurer
magic_ev10.167 = {
	hidden = yes
	trigger = {
		is_alive = yes
		is_imprisoned = no
		is_ruler = no
	}
	immediate = {
		create_landless_adventurer_title_effect = {
			REASON = flag:wanderer
			FLAVOR_CHAR = ROOT
		}
	}
}